/**
 * Bundled by jsDelivr using Rollup v2.79.1 and Terser v5.19.2.
 * Original file: /npm/queue-tick@1.0.1/queue-microtask.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
var e$t="function"==typeof queueMicrotask?queueMicrotask:e=>Promise.resolve().then(e);

/**
 * Bundled by jsDelivr using Rollup v2.79.1 and Terser v5.19.2.
 * Original file: /npm/fast-fifo@1.3.2/index.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
const t$w=class t{constructor(t){if(!(t>0)||0!=(t-1&t))throw new Error("Max size for a FixedFIFO should be a power of two");this.buffer=new Array(t),this.mask=t-1,this.top=0,this.btm=0,this.next=null;}clear(){this.top=this.btm=0,this.next=null,this.buffer.fill(void 0);}push(t){return void 0===this.buffer[this.top]&&(this.buffer[this.top]=t,this.top=this.top+1&this.mask,!0)}shift(){const t=this.buffer[this.btm];if(void 0!==t)return this.buffer[this.btm]=void 0,this.btm=this.btm+1&this.mask,t}peek(){return this.buffer[this.btm]}isEmpty(){return void 0===this.buffer[this.btm]}};var i$r=class i{constructor(i){this.hwm=i||16,this.head=new t$w(this.hwm),this.tail=this.head,this.length=0;}clear(){this.head=this.tail,this.head.clear(),this.length=0;}push(i){if(this.length++,!this.head.push(i)){const h=this.head;this.head=h.next=new t$w(2*this.head.buffer.length),this.head.push(i);}}shift(){0!==this.length&&this.length--;const t=this.tail.shift();if(void 0===t&&this.tail.next){const t=this.tail.next;return this.tail.next=null,this.tail=t,this.tail.shift()}return t}peek(){const t=this.tail.peek();return void 0===t&&this.tail.next?this.tail.next.peek():t}isEmpty(){return 0===this.length}};

/**
 * Bundled by jsDelivr using Rollup v2.79.1 and Terser v5.19.2.
 * Original file: /npm/text-decoder@1.2.0/index.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
var e$s=class e{constructor(e){this.decoder=new TextDecoder("utf16le"===e?"utf16-le":e);}get remaining(){return -1}decode(e){return this.decoder.decode(e,{stream:!0})}flush(){return this.decoder.decode(new Uint8Array(0))}};const t$v=e$s,r$A=e$s;var s$x=class s{constructor(e="utf8"){switch(this.encoding=function(e){switch(e=e.toLowerCase()){case"utf8":case"utf-8":return "utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return "utf16le";case"latin1":case"binary":return "latin1";case"base64":case"ascii":case"hex":return e;default:throw new Error("Unknown encoding: "+e)}}(e),this.encoding){case"utf8":this.decoder=new r$A;break;case"utf16le":case"base64":throw new Error("Unsupported encoding: "+this.encoding);default:this.decoder=new t$v(this.encoding);}}get remaining(){return this.decoder.remaining}push(e){return "string"==typeof e?e:this.decoder.decode(e)}write(e){return this.push(e)}end(e){let t="";return e&&(t=this.push(e)),t+=this.decoder.flush(),t}};

/**
 * Bundled by jsDelivr using Rollup v2.79.1 and Terser v5.19.2.
 * Original file: /npm/streamx@2.20.1/index.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
function r$z(t){return t&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function n$z(){}function s$w(){s$w.init.call(this);}function a$n(t){return void 0===t._maxListeners?s$w.defaultMaxListeners:t._maxListeners}function l$l(t,e,i,r){var s,l,u,h;if("function"!=typeof i)throw new TypeError('"listener" argument must be a function');if((l=t._events)?(l.newListener&&(t.emit("newListener",e,i.listener?i.listener:i),l=t._events),u=l[e]):(l=t._events=new n$z,t._eventsCount=0),u){if("function"==typeof u?u=l[e]=r?[i,u]:[u,i]:r?u.unshift(i):u.push(i),!u.warned&&(s=a$n(t))&&s>0&&u.length>s){u.warned=!0;var o=new Error("Possible EventEmitter memory leak detected. "+u.length+" "+e+" listeners added. Use emitter.setMaxListeners() to increase limit");o.name="MaxListenersExceededWarning",o.emitter=t,o.type=e,o.count=u.length,h=o,"function"==typeof console.warn?console.warn(h):console.log(h);}}else u=l[e]=i,++t._eventsCount;return t}function u$n(t,e,i){var r=!1;function n(){t.removeListener(e,n),r||(r=!0,i.apply(t,arguments));}return n.listener=i,n}function h$m(t){var e=this._events;if(e){var i=e[t];if("function"==typeof i)return 1;if(i)return i.length}return 0}function o$w(t,e){for(var i=new Array(e);e--;)i[e]=t[e];return i}n$z.prototype=Object.create(null),s$w.EventEmitter=s$w,s$w.usingDomains=!1,s$w.prototype.domain=void 0,s$w.prototype._events=void 0,s$w.prototype._maxListeners=void 0,s$w.defaultMaxListeners=10,s$w.init=function(){this.domain=null,s$w.usingDomains&&undefined.active,this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=new n$z,this._eventsCount=0),this._maxListeners=this._maxListeners||void 0;},s$w.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||isNaN(t))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=t,this},s$w.prototype.getMaxListeners=function(){return a$n(this)},s$w.prototype.emit=function(t){var e,i,r,n,s,a,l,u="error"===t;if(a=this._events)u=u&&null==a.error;else if(!u)return !1;if(l=this.domain,u){if(e=arguments[1],!l){if(e instanceof Error)throw e;var h=new Error('Uncaught, unspecified "error" event. ('+e+")");throw h.context=e,h}return e||(e=new Error('Uncaught, unspecified "error" event')),e.domainEmitter=this,e.domain=l,e.domainThrown=!1,l.emit("error",e),!1}if(!(i=a[t]))return !1;var d="function"==typeof i;switch(r=arguments.length){case 1:!function(t,e,i){if(e)t.call(i);else for(var r=t.length,n=o$w(t,r),s=0;s<r;++s)n[s].call(i);}(i,d,this);break;case 2:!function(t,e,i,r){if(e)t.call(i,r);else for(var n=t.length,s=o$w(t,n),a=0;a<n;++a)s[a].call(i,r);}(i,d,this,arguments[1]);break;case 3:!function(t,e,i,r,n){if(e)t.call(i,r,n);else for(var s=t.length,a=o$w(t,s),l=0;l<s;++l)a[l].call(i,r,n);}(i,d,this,arguments[1],arguments[2]);break;case 4:!function(t,e,i,r,n,s){if(e)t.call(i,r,n,s);else for(var a=t.length,l=o$w(t,a),u=0;u<a;++u)l[u].call(i,r,n,s);}(i,d,this,arguments[1],arguments[2],arguments[3]);break;default:for(n=new Array(r-1),s=1;s<r;s++)n[s-1]=arguments[s];!function(t,e,i,r){if(e)t.apply(i,r);else for(var n=t.length,s=o$w(t,n),a=0;a<n;++a)s[a].apply(i,r);}(i,d,this,n);}return !0},s$w.prototype.addListener=function(t,e){return l$l(this,t,e,!1)},s$w.prototype.on=s$w.prototype.addListener,s$w.prototype.prependListener=function(t,e){return l$l(this,t,e,!0)},s$w.prototype.once=function(t,e){if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');return this.on(t,u$n(this,t,e)),this},s$w.prototype.prependOnceListener=function(t,e){if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');return this.prependListener(t,u$n(this,t,e)),this},s$w.prototype.removeListener=function(t,e){var i,r,s,a,l;if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');if(!(r=this._events))return this;if(!(i=r[t]))return this;if(i===e||i.listener&&i.listener===e)0==--this._eventsCount?this._events=new n$z:(delete r[t],r.removeListener&&this.emit("removeListener",t,i.listener||e));else if("function"!=typeof i){for(s=-1,a=i.length;a-- >0;)if(i[a]===e||i[a].listener&&i[a].listener===e){l=i[a].listener,s=a;break}if(s<0)return this;if(1===i.length){if(i[0]=void 0,0==--this._eventsCount)return this._events=new n$z,this;delete r[t];}else !function(t,e){for(var i=e,r=i+1,n=t.length;r<n;i+=1,r+=1)t[i]=t[r];t.pop();}(i,s);r.removeListener&&this.emit("removeListener",t,l||e);}return this},s$w.prototype.off=function(t,e){return this.removeListener(t,e)},s$w.prototype.removeAllListeners=function(t){var e,i;if(!(i=this._events))return this;if(!i.removeListener)return 0===arguments.length?(this._events=new n$z,this._eventsCount=0):i[t]&&(0==--this._eventsCount?this._events=new n$z:delete i[t]),this;if(0===arguments.length){for(var r,s=Object.keys(i),a=0;a<s.length;++a)"removeListener"!==(r=s[a])&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=new n$z,this._eventsCount=0,this}if("function"==typeof(e=i[t]))this.removeListener(t,e);else if(e)do{this.removeListener(t,e[e.length-1]);}while(e[0]);return this},s$w.prototype.listeners=function(t){var e,i=this._events;return i&&(e=i[t])?"function"==typeof e?[e.listener||e]:function(t){for(var e=new Array(t.length),i=0;i<e.length;++i)e[i]=t[i].listener||t[i];return e}(e):[]},s$w.listenerCount=function(t,e){return "function"==typeof t.listenerCount?t.listenerCount(e):h$m.call(t,e)},s$w.prototype.listenerCount=h$m,s$w.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};var d$h=r$z(Object.freeze({__proto__:null,default:s$w,EventEmitter:s$w}));const{EventEmitter:p$i}=d$h,f$n=new Error("Stream was destroyed"),_$b=new Error("Premature close"),c$o=e$t,S$d=i$r,m$e=s$x,x$9=536870911,b$c=1^x$9,w$e=64,y$o=128,v$b=256,g$k=1024,k$9=2048,T$b=4096,L$d=8192,E$h=16384,N$a=32768,P$a=131072,W$a=131328,C$e=536805375,M$c=768^x$9,A$d=536838143,q$9=536739839,U$c=1<<18,O$a=2<<18,F$b=4<<18,R$9=8<<18,j$9=16<<18,D$d=32<<18,B$g=64<<18,I$c=128<<18,z$9=256<<18,K$b=512<<18,G$9=1024<<18,H$a=469499903,J$9=535822335,Q$e=503316479,V$9=268435455,X$9=262160,Y$b=536608751,Z$9=8404992,$$9=14,tt$6=15,et$6=8405006,it$6=33587200,rt$6=33587215,nt$5=2359296,st$6=270794767,at$5=Symbol.asyncIterator||Symbol("asyncIterator");let lt$5 = class lt{constructor(t,{highWaterMark:e=16384,map:i=null,mapWritable:r,byteLength:n,byteLengthWritable:s}={}){this.stream=t,this.queue=new S$d,this.highWaterMark=e,this.buffered=0,this.error=null,this.pipeline=null,this.drains=null,this.byteLength=s||n||Ct$5,this.map=r||i,this.afterWrite=_t$5.bind(this),this.afterUpdateNextTick=mt$5.bind(this);}get ended(){return 0!=(this.stream._duplexState&D$d)}push(t){return null!==this.map&&(t=this.map(t)),this.buffered+=this.byteLength(t),this.queue.push(t),this.buffered<this.highWaterMark?(this.stream._duplexState|=R$9,!0):(this.stream._duplexState|=6291456,!1)}shift(){const t=this.queue.shift();return this.buffered-=this.byteLength(t),0===this.buffered&&(this.stream._duplexState&=534773759),t}end(t){"function"==typeof t?this.stream.once("finish",t):null!=t&&this.push(t),this.stream._duplexState=(this.stream._duplexState|K$b)&J$9;}autoBatch(t,e){const i=[],r=this.stream;for(i.push(t);(r._duplexState&st$6)===nt$5;)i.push(r._writableState.shift());if(0!=(r._duplexState&tt$6))return e(null);r._writev(i,e);}update(){const t=this.stream;t._duplexState|=O$a;do{for(;(t._duplexState&st$6)===R$9;){const e=this.shift();t._duplexState|=67371008,t._write(e,this.afterWrite);}0==(1310720&t._duplexState)&&this.updateNonPrimary();}while(!0===this.continueUpdate());t._duplexState&=536346623;}updateNonPrimary(){const t=this.stream;if((144965647&t._duplexState)===K$b)return t._duplexState=402653183&(t._duplexState|U$c),void t._final(pt$5.bind(this));4!=(t._duplexState&$$9)?1==(t._duplexState&rt$6)&&(t._duplexState=(t._duplexState|X$9)&b$c,t._open(xt$5.bind(this))):0==(t._duplexState&it$6)&&(t._duplexState|=X$9,t._destroy(ft$5.bind(this)));}continueUpdate(){return 0!=(this.stream._duplexState&I$c)&&(this.stream._duplexState&=Q$e,!0)}updateCallback(){(35127311&this.stream._duplexState)===F$b?this.update():this.updateNextTick();}updateNextTick(){0==(this.stream._duplexState&I$c)&&(this.stream._duplexState|=I$c,0==(this.stream._duplexState&O$a)&&c$o(this.afterUpdateNextTick));}};let ut$5 = class ut{constructor(t,{highWaterMark:e=16384,map:i=null,mapReadable:r,byteLength:n,byteLengthReadable:s}={}){this.stream=t,this.queue=new S$d,this.highWaterMark=0===e?1:e,this.buffered=0,this.readAhead=e>0,this.error=null,this.pipeline=null,this.byteLength=s||n||Ct$5,this.map=r||i,this.pipeTo=null,this.afterRead=ct$5.bind(this),this.afterUpdateNextTick=St$5.bind(this);}get ended(){return 0!=(this.stream._duplexState&E$h)}pipe(t,e){if(null!==this.pipeTo)throw new Error("Can only pipe to one destination");if("function"!=typeof e&&(e=null),this.stream._duplexState|=512,this.pipeTo=t,this.pipeline=new ot$5(this.stream,t,e),e&&this.stream.on("error",Mt$5),Wt$5(t))t._writableState.pipeline=this.pipeline,e&&t.on("error",Mt$5),t.on("finish",this.pipeline.finished.bind(this.pipeline));else {const e=this.pipeline.done.bind(this.pipeline,t),i=this.pipeline.done.bind(this.pipeline,t,null);t.on("error",e),t.on("close",i),t.on("finish",this.pipeline.finished.bind(this.pipeline));}t.on("drain",dt$5.bind(this)),this.stream.emit("piping",t),t.emit("pipe",this.stream);}push(t){const e=this.stream;return null===t?(this.highWaterMark=0,e._duplexState=536805311&(e._duplexState|g$k),!1):null!==this.map&&null===(t=this.map(t))?(e._duplexState&=C$e,this.buffered<this.highWaterMark):(this.buffered+=this.byteLength(t),this.queue.push(t),e._duplexState=(e._duplexState|y$o)&C$e,this.buffered<this.highWaterMark)}shift(){const t=this.queue.shift();return this.buffered-=this.byteLength(t),0===this.buffered&&(this.stream._duplexState&=536862591),t}unshift(t){const e=[null!==this.map?this.map(t):t];for(;this.buffered>0;)e.push(this.shift());for(let t=0;t<e.length-1;t++){const i=e[t];this.buffered+=this.byteLength(i),this.queue.push(i);}this.push(e[e.length-1]);}read(){const t=this.stream;if((16527&t._duplexState)===y$o){const e=this.shift();return null!==this.pipeTo&&!1===this.pipeTo.write(e)&&(t._duplexState&=M$c),0!=(t._duplexState&k$9)&&t.emit("data",e),e}return !1===this.readAhead&&(t._duplexState|=P$a,this.updateNextTick()),null}drain(){const t=this.stream;for(;(16527&t._duplexState)===y$o&&0!=(768&t._duplexState);){const e=this.shift();null!==this.pipeTo&&!1===this.pipeTo.write(e)&&(t._duplexState&=M$c),0!=(t._duplexState&k$9)&&t.emit("data",e);}}update(){const t=this.stream;t._duplexState|=32;do{for(this.drain();this.buffered<this.highWaterMark&&(214047&t._duplexState)===P$a;)t._duplexState|=65552,t._read(this.afterRead),this.drain();4224==(12431&t._duplexState)&&(t._duplexState|=L$d,t.emit("readable")),0==(80&t._duplexState)&&this.updateNonPrimary();}while(!0===this.continueUpdate());t._duplexState&=536870879;}updateNonPrimary(){const t=this.stream;(1167&t._duplexState)===g$k&&(t._duplexState=536869887&(t._duplexState|E$h),t.emit("end"),(t._duplexState&et$6)===Z$9&&(t._duplexState|=4),null!==this.pipeTo&&this.pipeTo.end()),4!=(t._duplexState&$$9)?1==(t._duplexState&rt$6)&&(t._duplexState=(t._duplexState|X$9)&b$c,t._open(xt$5.bind(this))):0==(t._duplexState&it$6)&&(t._duplexState|=X$9,t._destroy(ft$5.bind(this)));}continueUpdate(){return 0!=(this.stream._duplexState&N$a)&&(this.stream._duplexState&=A$d,!0)}updateCallback(){(32879&this.stream._duplexState)===w$e?this.update():this.updateNextTick();}updateNextTick(){0==(this.stream._duplexState&N$a)&&(this.stream._duplexState|=N$a,0==(32&this.stream._duplexState)&&c$o(this.afterUpdateNextTick));}};let ht$6 = class ht{constructor(t){this.data=null,this.afterTransform=bt$5.bind(t),this.afterFinal=null;}};let ot$5 = class ot{constructor(t,e,i){this.from=t,this.to=e,this.afterPipe=i,this.error=null,this.pipeToFinished=!1;}finished(){this.pipeToFinished=!0;}done(t,e){e&&(this.error=e),t!==this.to||(this.to=null,null===this.from)?t!==this.from||(this.from=null,null===this.to)?(null!==this.afterPipe&&this.afterPipe(this.error),this.to=this.from=this.afterPipe=null):0==(t._duplexState&E$h)&&this.to.destroy(this.error||new Error("Readable stream closed before ending")):0!=(this.from._duplexState&E$h)&&this.pipeToFinished||this.from.destroy(this.error||new Error("Writable stream closed prematurely"));}};function dt$5(){this.stream._duplexState|=512,this.updateCallback();}function pt$5(t){const e=this.stream;t&&e.destroy(t),0==(e._duplexState&$$9)&&(e._duplexState|=D$d,e.emit("finish")),(e._duplexState&et$6)===Z$9&&(e._duplexState|=4),e._duplexState&=H$a,0==(e._duplexState&O$a)?this.update():this.updateNextTick();}function ft$5(t){const e=this.stream;t||this.error===f$n||(t=this.error),t&&e.emit("error",t),e._duplexState|=8,e.emit("close");const i=e._readableState,r=e._writableState;if(null!==i&&null!==i.pipeline&&i.pipeline.done(e,t),null!==r){for(;null!==r.drains&&r.drains.length>0;)r.drains.shift().resolve(!1);null!==r.pipeline&&r.pipeline.done(e,t);}}function _t$5(t){const e=this.stream;t&&e.destroy(t),e._duplexState&=H$a,null!==this.drains&&function(t){for(let e=0;e<t.length;e++)0==--t[e].writes&&(t.shift().resolve(!0),e--);}(this.drains),(6553615&e._duplexState)===j$9&&(e._duplexState&=532676607,(e._duplexState&B$g)===B$g&&e.emit("drain")),this.updateCallback();}function ct$5(t){t&&this.stream.destroy(t),this.stream._duplexState&=536870895,!1===this.readAhead&&0==(this.stream._duplexState&v$b)&&(this.stream._duplexState&=q$9),this.updateCallback();}function St$5(){0==(32&this.stream._duplexState)&&(this.stream._duplexState&=A$d,this.update());}function mt$5(){0==(this.stream._duplexState&O$a)&&(this.stream._duplexState&=Q$e,this.update());}function xt$5(t){const e=this.stream;t&&e.destroy(t),0==(4&e._duplexState)&&(0==(17423&e._duplexState)&&(e._duplexState|=w$e),0==(142606351&e._duplexState)&&(e._duplexState|=F$b),e.emit("open")),e._duplexState&=Y$b,null!==e._writableState&&e._writableState.updateCallback(),null!==e._readableState&&e._readableState.updateCallback();}function bt$5(t,e){null!=e&&this.push(e),this._writableState.afterWrite(t);}function wt$5(t){null!==this._readableState&&("data"===t&&(this._duplexState|=133376,this._readableState.updateNextTick()),"readable"===t&&(this._duplexState|=T$b,this._readableState.updateNextTick())),null!==this._writableState&&"drain"===t&&(this._duplexState|=B$g,this._writableState.updateNextTick());}let yt$5 = class yt extends p$i{constructor(t){super(),this._duplexState=0,this._readableState=null,this._writableState=null,t&&(t.open&&(this._open=t.open),t.destroy&&(this._destroy=t.destroy),t.predestroy&&(this._predestroy=t.predestroy),t.signal&&t.signal.addEventListener("abort",At$5.bind(this))),this.on("newListener",wt$5);}_open(t){t(null);}_destroy(t){t(null);}_predestroy(){}get readable(){return null!==this._readableState||void 0}get writable(){return null!==this._writableState||void 0}get destroyed(){return 0!=(8&this._duplexState)}get destroying(){return 0!=(this._duplexState&$$9)}destroy(t){0==(this._duplexState&$$9)&&(t||(t=f$n),this._duplexState=535822271&(4|this._duplexState),null!==this._readableState&&(this._readableState.highWaterMark=0,this._readableState.error=t),null!==this._writableState&&(this._writableState.highWaterMark=0,this._writableState.error=t),this._duplexState|=2,this._predestroy(),this._duplexState&=536870909,null!==this._readableState&&this._readableState.updateNextTick(),null!==this._writableState&&this._writableState.updateNextTick());}};let vt$5 = class vt extends yt$5{constructor(t){super(t),this._duplexState|=8519681,this._readableState=new ut$5(this,t),t&&(!1===this._readableState.readAhead&&(this._duplexState&=q$9),t.read&&(this._read=t.read),t.eagerOpen&&this._readableState.updateNextTick(),t.encoding&&this.setEncoding(t.encoding));}setEncoding(t){const e=new m$e(t),i=this._readableState.map||Nt$5;return this._readableState.map=function(t){const r=e.push(t);return ""===r&&(0!==t.byteLength||e.remaining>0)?null:i(r)},this}_read(t){t(null);}pipe(t,e){return this._readableState.updateNextTick(),this._readableState.pipe(t,e),t}read(){return this._readableState.updateNextTick(),this._readableState.read()}push(t){return this._readableState.updateNextTick(),this._readableState.push(t)}unshift(t){return this._readableState.updateNextTick(),this._readableState.unshift(t)}resume(){return this._duplexState|=W$a,this._readableState.updateNextTick(),this}pause(){return this._duplexState&=!1===this._readableState.readAhead?536739583:536870655,this}static _fromAsyncIterator(t,e){let i;const r=new vt({...e,read(e){t.next().then(n).then(e.bind(null,null)).catch(e);},predestroy(){i=t.return();},destroy(t){if(!i)return t(null);i.then(t.bind(null,null)).catch(t);}});return r;function n(t){t.done?r.push(null):r.push(t.value);}}static from(t,e){if(Wt$5(i=t)&&i.readable)return t;var i;if(t[at$5])return this._fromAsyncIterator(t[at$5](),e);Array.isArray(t)||(t=void 0===t?[]:[t]);let r=0;return new vt({...e,read(e){this.push(r===t.length?null:t[r++]),e(null);}})}static isBackpressured(t){return 0!=(17422&t._duplexState)||t._readableState.buffered>=t._readableState.highWaterMark}static isPaused(t){return 0==(t._duplexState&v$b)}[at$5](){const t=this;let e=null,i=null,r=null;return this.on("error",(t=>{e=t;})),this.on("readable",(function(){null!==i&&n(t.read());})),this.on("close",(function(){null!==i&&n(null);})),{[at$5](){return this},next:()=>new Promise((function(e,s){i=e,r=s;const a=t.read();null!==a?n(a):0!=(8&t._duplexState)&&n(null);})),return:()=>s(null),throw:t=>s(t)};function n(n){null!==r&&(e?r(e):null===n&&0==(t._duplexState&E$h)?r(f$n):i({value:n,done:null===n}),r=i=null);}function s(e){return t.destroy(e),new Promise(((i,r)=>{if(8&t._duplexState)return i({value:void 0,done:!0});t.once("close",(function(){e?r(e):i({value:void 0,done:!0});}));}))}}};let gt$5 = class gt extends yt$5{constructor(t){super(t),this._duplexState|=16385,this._writableState=new lt$5(this,t),t&&(t.writev&&(this._writev=t.writev),t.write&&(this._write=t.write),t.final&&(this._final=t.final),t.eagerOpen&&this._writableState.updateNextTick());}cork(){this._duplexState|=G$9;}uncork(){this._duplexState&=V$9,this._writableState.updateNextTick();}_writev(t,e){e(null);}_write(t,e){this._writableState.autoBatch(t,e);}_final(t){t(null);}static isBackpressured(t){return 0!=(146800654&t._duplexState)}static drained(t){if(t.destroyed)return Promise.resolve(!1);const e=t._writableState;var i;const r=((i=t)._writev!==gt.prototype._writev&&i._writev!==kt$5.prototype._writev?Math.min(1,e.queue.length):e.queue.length)+(t._duplexState&z$9?1:0);return 0===r?Promise.resolve(!0):(null===e.drains&&(e.drains=[]),new Promise((t=>{e.drains.push({writes:r,resolve:t});})))}write(t){return this._writableState.updateNextTick(),this._writableState.push(t)}end(t){return this._writableState.updateNextTick(),this._writableState.end(t),this}};let kt$5 = class kt extends vt$5{constructor(t){super(t),this._duplexState=1|this._duplexState&P$a,this._writableState=new lt$5(this,t),t&&(t.writev&&(this._writev=t.writev),t.write&&(this._write=t.write),t.final&&(this._final=t.final));}cork(){this._duplexState|=G$9;}uncork(){this._duplexState&=V$9,this._writableState.updateNextTick();}_writev(t,e){e(null);}_write(t,e){this._writableState.autoBatch(t,e);}_final(t){t(null);}write(t){return this._writableState.updateNextTick(),this._writableState.push(t)}end(t){return this._writableState.updateNextTick(),this._writableState.end(t),this}};let Tt$5 = class Tt extends kt$5{constructor(t){super(t),this._transformState=new ht$6(this),t&&(t.transform&&(this._transform=t.transform),t.flush&&(this._flush=t.flush));}_write(t,e){this._readableState.buffered>=this._readableState.highWaterMark?this._transformState.data=t:this._transform(t,this._transformState.afterTransform);}_read(t){if(null!==this._transformState.data){const e=this._transformState.data;this._transformState.data=null,t(null),this._transform(e,this._transformState.afterTransform);}else t(null);}destroy(t){super.destroy(t),null!==this._transformState.data&&(this._transformState.data=null,this._transformState.afterTransform());}_transform(t,e){e(null,t);}_flush(t){t(null);}_final(t){this._transformState.afterFinal=t,this._flush(Lt$5.bind(this));}};function Lt$5(t,e){const i=this._transformState.afterFinal;if(t)return i(t);null!=e&&this.push(e),this.push(null),i(null);}function Et$5(t,...e){const i=Array.isArray(t)?[...t,...e]:[t,...e],r=i.length&&"function"==typeof i[i.length-1]?i.pop():null;if(i.length<2)throw new Error("Pipeline requires at least 2 streams");let n=i[0],s=null,a=null;for(let t=1;t<i.length;t++)s=i[t],Wt$5(n)?n.pipe(s,u):(l(n,!0,t>1,u),n.pipe(s)),n=s;if(r){let t=!1;const e=Wt$5(s)||!(!s._writableState||!s._writableState.autoDestroy);s.on("error",(t=>{null===a&&(a=t);})),s.on("finish",(()=>{t=!0,e||r(a);})),e&&s.on("close",(()=>r(a||(t?null:_$b))));}return s;function l(t,e,i,r){t.on("error",r),t.on("close",(function(){if(t._readableState&&!t._readableState.ended)return r(_$b);if(i&&t._writableState&&!t._writableState.ended)return r(_$b)}));}function u(t){if(t&&!a){a=t;for(const e of i)e.destroy(t);}}}function Nt$5(t){return t}function Pt$5(t){return !!t._readableState||!!t._writableState}function Wt$5(t){return "number"==typeof t._duplexState&&Pt$5(t)}function Ct$5(t){return function(t){return "object"==typeof t&&null!==t&&"number"==typeof t.byteLength}(t)?t.byteLength:1024}function Mt$5(){}function At$5(){this.destroy(new Error("Stream aborted."));}var qt$4={pipeline:Et$5,pipelinePromise:function(...t){return new Promise(((e,i)=>Et$5(...t,(t=>{if(t)return i(t);e();}))))},isStream:Pt$5,isStreamx:Wt$5,isEnded:function(t){return !!t._readableState&&t._readableState.ended},isFinished:function(t){return !!t._writableState&&t._writableState.ended},getStreamError:function(t,e={}){const i=t._readableState&&t._readableState.error||t._writableState&&t._writableState.error;return e.all||i!==f$n?i:null},Stream:yt$5,Writable:gt$5,Readable:vt$5,Duplex:kt$5,Transform:Tt$5,PassThrough:class extends Tt$5{}},Ut$3=qt$4.Duplex,Ot$3=qt$4.PassThrough,Ft$3=qt$4.Readable,Rt$3=qt$4.Stream,jt$3=qt$4.Transform,Dt$3=qt$4.Writable,Bt$3=qt$4.getStreamError,It$3=qt$4.isEnded,zt$3=qt$4.isFinished,Kt$3=qt$4.isStream,Gt$3=qt$4.isStreamx,Ht$3=qt$4.pipeline,Jt$3=qt$4.pipelinePromise;

var streamx = /*#__PURE__*/Object.freeze({
	__proto__: null,
	Duplex: Ut$3,
	PassThrough: Ot$3,
	Readable: Ft$3,
	Stream: Rt$3,
	Transform: jt$3,
	Writable: Dt$3,
	default: qt$4,
	getStreamError: Bt$3,
	isEnded: It$3,
	isFinished: zt$3,
	isStream: Kt$3,
	isStreamx: Gt$3,
	pipeline: Ht$3,
	pipelinePromise: Jt$3
});

/**
 * Bundled by jsDelivr using Rollup v2.79.1 and Terser v5.19.2.
 * Original file: /npm/b4a@1.6.7/browser.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
var t$u={exports:{}};function e$r(t){return t.length}var n$y={byteLength:e$r,toString:function(t){const e=t.byteLength;let n="";for(let r=0;r<e;r++)n+=String.fromCharCode(t[r]);return n},write:function(t,n,r=0,o=e$r(n)){const f=Math.min(o,t.byteLength-r);for(let e=0;e<f;e++)t[r+e]=n.charCodeAt(e);return f}};const r$y="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o$v=new Uint8Array(256);for(let t=0;t<64;t++)o$v[r$y.charCodeAt(t)]=t;function f$m(t){let e=t.length;return 61===t.charCodeAt(e-1)&&e--,e>1&&61===t.charCodeAt(e-1)&&e--,3*e>>>2}o$v[45]=62,o$v[95]=63;var i$q={byteLength:f$m,toString:function(t){const e=t.byteLength;let n="";for(let o=0;o<e;o+=3)n+=r$y[t[o]>>2]+r$y[(3&t[o])<<4|t[o+1]>>4]+r$y[(15&t[o+1])<<2|t[o+2]>>6]+r$y[63&t[o+2]];return e%3==2?n=n.substring(0,n.length-1)+"=":e%3==1&&(n=n.substring(0,n.length-2)+"=="),n},write:function(t,e,n=0,r=f$m(e)){const i=Math.min(r,t.byteLength-n);for(let n=0,r=0;r<i;n+=4){const f=o$v[e.charCodeAt(n)],i=o$v[e.charCodeAt(n+1)],u=o$v[e.charCodeAt(n+2)],a=o$v[e.charCodeAt(n+3)];t[r++]=f<<2|i>>4,t[r++]=(15&i)<<4|u>>2,t[r++]=(3&u)<<6|63&a;}return i}};function u$m(t){return t.length>>>1}var a$m={byteLength:u$m,toString:function(t){const e=t.byteLength;t=new DataView(t.buffer,t.byteOffset,e);let n="",r=0;for(let o=e-e%4;r<o;r+=4)n+=t.getUint32(r).toString(16).padStart(8,"0");for(;r<e;r++)n+=t.getUint8(r).toString(16).padStart(2,"0");return n},write:function(t,e,n=0,r=u$m(e)){const o=Math.min(r,t.byteLength-n);for(let r=0;r<o;r++){const o=b$b(e.charCodeAt(2*r)),f=b$b(e.charCodeAt(2*r+1));if(void 0===o||void 0===f)return t.subarray(0,r);t[n+r]=o<<4|f;}return o}};function b$b(t){return t>=48&&t<=57?t-48:t>=65&&t<=70?t-65+10:t>=97&&t<=102?t-97+10:void 0}function c$n(t){let e=0;for(let n=0,r=t.length;n<r;n++){const o=t.charCodeAt(n);if(o>=55296&&o<=56319&&n+1<r){const r=t.charCodeAt(n+1);if(r>=56320&&r<=57343){e+=4,n++;continue}}e+=o<=127?1:o<=2047?2:3;}return e}let g$j,s$v;if("undefined"!=typeof TextDecoder){const t=new TextDecoder;g$j=function(e){return t.decode(e)};}else g$j=function(t){const e=t.byteLength;let n="",r=0;for(;r<e;){let o=t[r];if(o<=127){n+=String.fromCharCode(o),r++;continue}let f=0,i=0;if(o<=223?(f=1,i=31&o):o<=239?(f=2,i=15&o):o<=244&&(f=3,i=7&o),e-r-f>0){let e=0;for(;e<f;)o=t[r+e+1],i=i<<6|63&o,e+=1;}else i=65533,f=e-r;n+=String.fromCodePoint(i),r+=f+1;}return n};if("undefined"!=typeof TextEncoder){const t=new TextEncoder;s$v=function(e,n,r=0,o=c$n(n)){const f=Math.min(o,e.byteLength-r);return t.encodeInto(n,e.subarray(r,r+f)),f};}else s$v=function(t,e,n=0,r=c$n(e)){const o=Math.min(r,t.byteLength-n);t=t.subarray(n,n+o);let f=0,i=0;for(;f<e.length;){const n=e.codePointAt(f);if(n<=127){t[i++]=n,f++;continue}let r=0,o=0;for(n<=2047?(r=6,o=192):n<=65535?(r=12,o=224):n<=2097151&&(r=18,o=240),t[i++]=o|n>>r,r-=6;r>=0;)t[i++]=128|n>>r&63,r-=6;f+=n>=65536?2:1;}return o};var y$n={byteLength:c$n,toString:g$j,write:s$v};function h$l(t){return 2*t.length}var l$k={byteLength:h$l,toString:function(t){const e=t.byteLength;let n="";for(let r=0;r<e-1;r+=2)n+=String.fromCharCode(t[r]+256*t[r+1]);return n},write:function(t,e,n=0,r=h$l(e)){const o=Math.min(r,t.byteLength-n);let f=o;for(let r=0;r<e.length&&!((f-=2)<0);++r){const o=e.charCodeAt(r),f=o>>8,i=o%256;t[n+2*r]=i,t[n+2*r+1]=f;}return o}};!function(t,e){const r=n$y,o=i$q,f=a$m,u=y$n,b=l$k,c=255===new Uint8Array(Uint16Array.of(255).buffer)[0];function g(t){switch(t){case"ascii":return r;case"base64":return o;case"hex":return f;case"utf8":case"utf-8":case void 0:case null:return u;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return b;default:throw new Error(`Unknown encoding: ${t}`)}}function s(t){return t instanceof Uint8Array}function h(t,e,n){return "string"==typeof t?function(t,e){const n=g(e),r=new Uint8Array(n.byteLength(t));return n.write(r,t,0,r.byteLength),r}(t,e):Array.isArray(t)?function(t){const e=new Uint8Array(t.length);return e.set(t),e}(t):ArrayBuffer.isView(t)?function(t){const e=new Uint8Array(t.byteLength);return e.set(t),e}(t):function(t,e,n){return new Uint8Array(t,e,n)}(t,e,n)}function L(t,e,n,r,o){if(0===t.byteLength)return -1;if("string"==typeof n?(r=n,n=0):void 0===n?n=o?0:t.length-1:n<0&&(n+=t.byteLength),n>=t.byteLength){if(o)return -1;n=t.byteLength-1;}else if(n<0){if(!o)return -1;n=0;}if("string"==typeof e)e=h(e,r);else if("number"==typeof e)return e&=255,o?t.indexOf(e,n):t.lastIndexOf(e,n);if(0===e.byteLength)return -1;if(o){let r=-1;for(let o=n;o<t.byteLength;o++)if(t[o]===e[-1===r?0:o-r]){if(-1===r&&(r=o),o-r+1===e.byteLength)return r}else -1!==r&&(o-=o-r),r=-1;}else {n+e.byteLength>t.byteLength&&(n=t.byteLength-e.byteLength);for(let r=n;r>=0;r--){let n=!0;for(let o=0;o<e.byteLength;o++)if(t[r+o]!==e[o]){n=!1;break}if(n)return r}}return -1}function w(t,e,n,r){return L(t,e,n,r,!0)}function d(t,e,n){const r=t[e];t[e]=t[n],t[n]=r;}t.exports=e={isBuffer:s,isEncoding:function(t){try{return g(t),!0}catch{return !1}},alloc:function(t,n,r){const o=new Uint8Array(t);return void 0!==n&&e.fill(o,n,0,o.byteLength,r),o},allocUnsafe:function(t){return new Uint8Array(t)},allocUnsafeSlow:function(t){return new Uint8Array(t)},byteLength:function(t,e){return g(e).byteLength(t)},compare:function(t,e){if(t===e)return 0;const n=Math.min(t.byteLength,e.byteLength);t=new DataView(t.buffer,t.byteOffset,t.byteLength),e=new DataView(e.buffer,e.byteOffset,e.byteLength);let r=0;for(let o=n-n%4;r<o;r+=4){if(t.getUint32(r,c)!==e.getUint32(r,c))break}for(;r<n;r++){const n=t.getUint8(r),o=e.getUint8(r);if(n<o)return -1;if(n>o)return 1}return t.byteLength>e.byteLength?1:t.byteLength<e.byteLength?-1:0},concat:function(t,e){void 0===e&&(e=t.reduce(((t,e)=>t+e.byteLength),0));const n=new Uint8Array(e);let r=0;for(const e of t){if(r+e.byteLength>n.byteLength){const t=e.subarray(0,n.byteLength-r);return n.set(t,r),n}n.set(e,r),r+=e.byteLength;}return n},copy:function(t,e,n=0,r=0,o=t.byteLength){if(o>0&&o<r)return 0;if(o===r)return 0;if(0===t.byteLength||0===e.byteLength)return 0;if(n<0)throw new RangeError("targetStart is out of range");if(r<0||r>=t.byteLength)throw new RangeError("sourceStart is out of range");if(o<0)throw new RangeError("sourceEnd is out of range");n>=e.byteLength&&(n=e.byteLength),o>t.byteLength&&(o=t.byteLength),e.byteLength-n<o-r&&(o=e.length-n+r);const f=o-r;return t===e?e.copyWithin(n,r,o):e.set(t.subarray(r,o),n),f},equals:function(t,e){if(t===e)return !0;if(t.byteLength!==e.byteLength)return !1;const n=t.byteLength;t=new DataView(t.buffer,t.byteOffset,t.byteLength),e=new DataView(e.buffer,e.byteOffset,e.byteLength);let r=0;for(let o=n-n%4;r<o;r+=4)if(t.getUint32(r,c)!==e.getUint32(r,c))return !1;for(;r<n;r++)if(t.getUint8(r)!==e.getUint8(r))return !1;return !0},fill:function(t,e,n,r,o){if("string"==typeof e?"string"==typeof n?(o=n,n=0,r=t.byteLength):"string"==typeof r&&(o=r,r=t.byteLength):"number"==typeof e?e&=255:"boolean"==typeof e&&(e=+e),n<0||t.byteLength<n||t.byteLength<r)throw new RangeError("Out of range index");if(void 0===n&&(n=0),void 0===r&&(r=t.byteLength),r<=n)return t;if(e||(e=0),"number"==typeof e)for(let o=n;o<r;++o)t[o]=e;else {const f=(e=s(e)?e:h(e,o)).byteLength;for(let o=0;o<r-n;++o)t[o+n]=e[o%f];}return t},from:h,includes:function(t,e,n,r){return -1!==w(t,e,n,r)},indexOf:w,lastIndexOf:function(t,e,n,r){return L(t,e,n,r,!1)},swap16:function(t){const e=t.byteLength;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let n=0;n<e;n+=2)d(t,n,n+1);return t},swap32:function(t){const e=t.byteLength;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let n=0;n<e;n+=4)d(t,n,n+3),d(t,n+1,n+2);return t},swap64:function(t){const e=t.byteLength;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let n=0;n<e;n+=8)d(t,n,n+7),d(t,n+1,n+6),d(t,n+2,n+5),d(t,n+3,n+4);return t},toBuffer:function(t){return t},toString:function(t,e,n=0,r=t.byteLength){const o=t.byteLength;return n>=o||r<=n?"":(n<0&&(n=0),r>o&&(r=o),(0!==n||r<o)&&(t=t.subarray(n,r)),g(e).toString(t))},write:function(t,e,n,r,o){return void 0===n?o="utf8":void 0===r&&"string"==typeof n?(o=n,n=void 0):void 0===o&&"string"==typeof r&&(o=r,r=void 0),g(o).write(t,e,n,r)},writeDoubleLE:function(t,e,n){return void 0===n&&(n=0),new DataView(t.buffer,t.byteOffset,t.byteLength).setFloat64(n,e,!0),n+8},writeFloatLE:function(t,e,n){return void 0===n&&(n=0),new DataView(t.buffer,t.byteOffset,t.byteLength).setFloat32(n,e,!0),n+4},writeUInt32LE:function(t,e,n){return void 0===n&&(n=0),new DataView(t.buffer,t.byteOffset,t.byteLength).setUint32(n,e,!0),n+4},writeInt32LE:function(t,e,n){return void 0===n&&(n=0),new DataView(t.buffer,t.byteOffset,t.byteLength).setInt32(n,e,!0),n+4},readDoubleLE:function(t,e){return void 0===e&&(e=0),new DataView(t.buffer,t.byteOffset,t.byteLength).getFloat64(e,!0)},readFloatLE:function(t,e){return void 0===e&&(e=0),new DataView(t.buffer,t.byteOffset,t.byteLength).getFloat32(e,!0)},readUInt32LE:function(t,e){return void 0===e&&(e=0),new DataView(t.buffer,t.byteOffset,t.byteLength).getUint32(e,!0)},readInt32LE:function(t,e){return void 0===e&&(e=0),new DataView(t.buffer,t.byteOffset,t.byteLength).getInt32(e,!0)},writeDoubleBE:function(t,e,n){return void 0===n&&(n=0),new DataView(t.buffer,t.byteOffset,t.byteLength).setFloat64(n,e,!1),n+8},writeFloatBE:function(t,e,n){return void 0===n&&(n=0),new DataView(t.buffer,t.byteOffset,t.byteLength).setFloat32(n,e,!1),n+4},writeUInt32BE:function(t,e,n){return void 0===n&&(n=0),new DataView(t.buffer,t.byteOffset,t.byteLength).setUint32(n,e,!1),n+4},writeInt32BE:function(t,e,n){return void 0===n&&(n=0),new DataView(t.buffer,t.byteOffset,t.byteLength).setInt32(n,e,!1),n+4},readDoubleBE:function(t,e){return void 0===e&&(e=0),new DataView(t.buffer,t.byteOffset,t.byteLength).getFloat64(e,!1)},readFloatBE:function(t,e){return void 0===e&&(e=0),new DataView(t.buffer,t.byteOffset,t.byteLength).getFloat32(e,!1)},readUInt32BE:function(t,e){return void 0===e&&(e=0),new DataView(t.buffer,t.byteOffset,t.byteLength).getUint32(e,!1)},readInt32BE:function(t,e){return void 0===e&&(e=0),new DataView(t.buffer,t.byteOffset,t.byteLength).getInt32(e,!1)}};}(t$u,t$u.exports);var L$c=t$u.exports;

/**
 * Bundled by jsDelivr using Rollup v2.79.1 and Terser v5.19.2.
 * Original file: /npm/ready-resource@1.1.1/index.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
function e$q(e){return e&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function t$t(){}function n$x(){n$x.init.call(this);}function r$x(e){return void 0===e._maxListeners?n$x.defaultMaxListeners:e._maxListeners}function i$p(e,n,i,s){var o,u,l,f;if("function"!=typeof i)throw new TypeError('"listener" argument must be a function');if((u=e._events)?(u.newListener&&(e.emit("newListener",n,i.listener?i.listener:i),u=e._events),l=u[n]):(u=e._events=new t$t,e._eventsCount=0),l){if("function"==typeof l?l=u[n]=s?[i,l]:[l,i]:s?l.unshift(i):l.push(i),!l.warned&&(o=r$x(e))&&o>0&&l.length>o){l.warned=!0;var a=new Error("Possible EventEmitter memory leak detected. "+l.length+" "+n+" listeners added. Use emitter.setMaxListeners() to increase limit");a.name="MaxListenersExceededWarning",a.emitter=e,a.type=n,a.count=l.length,f=a,"function"==typeof console.warn?console.warn(f):console.log(f);}}else l=u[n]=i,++e._eventsCount;return e}function s$u(e,t,n){var r=!1;function i(){e.removeListener(t,i),r||(r=!0,n.apply(e,arguments));}return i.listener=n,i}function o$u(e){var t=this._events;if(t){var n=t[e];if("function"==typeof n)return 1;if(n)return n.length}return 0}function u$l(e,t){for(var n=new Array(t);t--;)n[t]=e[t];return n}t$t.prototype=Object.create(null),n$x.EventEmitter=n$x,n$x.usingDomains=!1,n$x.prototype.domain=void 0,n$x.prototype._events=void 0,n$x.prototype._maxListeners=void 0,n$x.defaultMaxListeners=10,n$x.init=function(){this.domain=null,n$x.usingDomains&&undefined.active,this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=new t$t,this._eventsCount=0),this._maxListeners=this._maxListeners||void 0;},n$x.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=e,this},n$x.prototype.getMaxListeners=function(){return r$x(this)},n$x.prototype.emit=function(e){var t,n,r,i,s,o,l,f="error"===e;if(o=this._events)f=f&&null==o.error;else if(!f)return !1;if(l=this.domain,f){if(t=arguments[1],!l){if(t instanceof Error)throw t;var a=new Error('Uncaught, unspecified "error" event. ('+t+")");throw a.context=t,a}return t||(t=new Error('Uncaught, unspecified "error" event')),t.domainEmitter=this,t.domain=l,t.domainThrown=!1,l.emit("error",t),!1}if(!(n=o[e]))return !1;var c="function"==typeof n;switch(r=arguments.length){case 1:!function(e,t,n){if(t)e.call(n);else for(var r=e.length,i=u$l(e,r),s=0;s<r;++s)i[s].call(n);}(n,c,this);break;case 2:!function(e,t,n,r){if(t)e.call(n,r);else for(var i=e.length,s=u$l(e,i),o=0;o<i;++o)s[o].call(n,r);}(n,c,this,arguments[1]);break;case 3:!function(e,t,n,r,i){if(t)e.call(n,r,i);else for(var s=e.length,o=u$l(e,s),l=0;l<s;++l)o[l].call(n,r,i);}(n,c,this,arguments[1],arguments[2]);break;case 4:!function(e,t,n,r,i,s){if(t)e.call(n,r,i,s);else for(var o=e.length,l=u$l(e,o),f=0;f<o;++f)l[f].call(n,r,i,s);}(n,c,this,arguments[1],arguments[2],arguments[3]);break;default:for(i=new Array(r-1),s=1;s<r;s++)i[s-1]=arguments[s];!function(e,t,n,r){if(t)e.apply(n,r);else for(var i=e.length,s=u$l(e,i),o=0;o<i;++o)s[o].apply(n,r);}(n,c,this,i);}return !0},n$x.prototype.addListener=function(e,t){return i$p(this,e,t,!1)},n$x.prototype.on=n$x.prototype.addListener,n$x.prototype.prependListener=function(e,t){return i$p(this,e,t,!0)},n$x.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.on(e,s$u(this,e,t)),this},n$x.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.prependListener(e,s$u(this,e,t)),this},n$x.prototype.removeListener=function(e,n){var r,i,s,o,u;if("function"!=typeof n)throw new TypeError('"listener" argument must be a function');if(!(i=this._events))return this;if(!(r=i[e]))return this;if(r===n||r.listener&&r.listener===n)0==--this._eventsCount?this._events=new t$t:(delete i[e],i.removeListener&&this.emit("removeListener",e,r.listener||n));else if("function"!=typeof r){for(s=-1,o=r.length;o-- >0;)if(r[o]===n||r[o].listener&&r[o].listener===n){u=r[o].listener,s=o;break}if(s<0)return this;if(1===r.length){if(r[0]=void 0,0==--this._eventsCount)return this._events=new t$t,this;delete i[e];}else !function(e,t){for(var n=t,r=n+1,i=e.length;r<i;n+=1,r+=1)e[n]=e[r];e.pop();}(r,s);i.removeListener&&this.emit("removeListener",e,u||n);}return this},n$x.prototype.off=function(e,t){return this.removeListener(e,t)},n$x.prototype.removeAllListeners=function(e){var n,r;if(!(r=this._events))return this;if(!r.removeListener)return 0===arguments.length?(this._events=new t$t,this._eventsCount=0):r[e]&&(0==--this._eventsCount?this._events=new t$t:delete r[e]),this;if(0===arguments.length){for(var i,s=Object.keys(r),o=0;o<s.length;++o)"removeListener"!==(i=s[o])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=new t$t,this._eventsCount=0,this}if("function"==typeof(n=r[e]))this.removeListener(e,n);else if(n)do{this.removeListener(e,n[n.length-1]);}while(n[0]);return this},n$x.prototype.listeners=function(e){var t,n=this._events;return n&&(t=n[e])?"function"==typeof t?[t.listener||t]:function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(t):[]},n$x.listenerCount=function(e,t){return "function"==typeof e.listenerCount?e.listenerCount(t):o$u.call(e,t)},n$x.prototype.listenerCount=o$u,n$x.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};const l$j=e$q(Object.freeze({__proto__:null,default:n$x,EventEmitter:n$x}));var f$l=class f extends l$j{constructor(){super(),this.opening=null,this.closing=null,this.opened=!1,this.closed=!1;}ready(){return null!==this.opening||(this.opening=async function(e){try{await e._open();}catch(t){throw e.close(),t}e.opened=!0,e.emit("ready");}(this)),this.opening}close(){return null!==this.closing||(this.closing=async function(e){try{!1===e.opened&&null!==e.opening&&await e.opening;}catch{}!0!==e.opened&&null!==e.opening||await e._close();e.closed=!0,e.emit("close");}(this)),this.closing}async _open(){}async _close(){}};

/**
 * Bundled by jsDelivr using Rollup v2.79.1 and Terser v5.19.2.
 * Original file: /npm/debounceify@1.1.0/index.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
var n$w=function(n,u=null){return r.running=null,r;async function r(){if(null!==r.running)try{await r.running;}catch(n){}if(null!==r.running)return r.running;r.running=n.call(u);try{return await r.running}finally{r.running=null;}}};

/**
 * Bundled by jsDelivr using Rollup v2.79.1 and Terser v5.19.2.
 * Original file: /npm/b4a@1.6.6/browser.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
var t$s={exports:{}};function e$p(t){return t.length}var n$v={byteLength:e$p,toString:function(t){const e=t.byteLength;let n="";for(let r=0;r<e;r++)n+=String.fromCharCode(t[r]);return n},write:function(t,n,r=0,o=e$p(n)){const f=Math.min(o,t.byteLength-r);for(let e=0;e<f;e++)t[r+e]=n.charCodeAt(e);return f}};const r$w="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o$t=new Uint8Array(256);for(let t=0;t<64;t++)o$t[r$w.charCodeAt(t)]=t;function f$k(t){let e=t.length;return 61===t.charCodeAt(e-1)&&e--,e>1&&61===t.charCodeAt(e-1)&&e--,3*e>>>2}o$t[45]=62,o$t[95]=63;var i$o={byteLength:f$k,toString:function(t){const e=t.byteLength;let n="";for(let o=0;o<e;o+=3)n+=r$w[t[o]>>2]+r$w[(3&t[o])<<4|t[o+1]>>4]+r$w[(15&t[o+1])<<2|t[o+2]>>6]+r$w[63&t[o+2]];return e%3==2?n=n.substring(0,n.length-1)+"=":e%3==1&&(n=n.substring(0,n.length-2)+"=="),n},write:function(t,e,n=0,r=f$k(e)){const i=Math.min(r,t.byteLength-n);for(let n=0,r=0;r<i;n+=4){const f=o$t[e.charCodeAt(n)],i=o$t[e.charCodeAt(n+1)],u=o$t[e.charCodeAt(n+2)],a=o$t[e.charCodeAt(n+3)];t[r++]=f<<2|i>>4,t[r++]=(15&i)<<4|u>>2,t[r++]=(3&u)<<6|63&a;}return i}};function u$k(t){return t.length>>>1}var a$l={byteLength:u$k,toString:function(t){const e=t.byteLength;t=new DataView(t.buffer,t.byteOffset,e);let n="",r=0;for(let o=e-e%4;r<o;r+=4)n+=t.getUint32(r).toString(16).padStart(8,"0");for(;r<e;r++)n+=t.getUint8(r).toString(16).padStart(2,"0");return n},write:function(t,e,n=0,r=u$k(e)){const o=Math.min(r,t.byteLength-n);for(let r=0;r<o;r++){const o=c$m(e.charCodeAt(2*r)),f=c$m(e.charCodeAt(2*r+1));if(void 0===o||void 0===f)return t.subarray(0,r);t[n+r]=o<<4|f;}return o}};function c$m(t){return t>=48&&t<=57?t-48:t>=65&&t<=70?t-65+10:t>=97&&t<=102?t-97+10:void 0}function g$i(t){let e=0;for(let n=0,r=t.length;n<r;n++){const o=t.charCodeAt(n);if(o>=55296&&o<=56319&&n+1<r){const r=t.charCodeAt(n+1);if(r>=56320&&r<=57343){e+=4,n++;continue}}e+=o<=127?1:o<=2047?2:3;}return e}let s$t,y$m;if("undefined"!=typeof TextDecoder){const t=new TextDecoder;s$t=function(e){return t.decode(e)};}else s$t=function(t){const e=t.byteLength;let n="",r=0;for(;r<e;){let o=t[r];if(o<=127){n+=String.fromCharCode(o),r++;continue}let f=0,i=0;if(o<=223?(f=1,i=31&o):o<=239?(f=2,i=15&o):o<=244&&(f=3,i=7&o),e-r-f>0){let e=0;for(;e<f;)o=t[r+e+1],i=i<<6|63&o,e+=1;}else i=65533,f=e-r;n+=String.fromCodePoint(i),r+=f+1;}return n};if("undefined"!=typeof TextEncoder){const t=new TextEncoder;y$m=function(e,n,r=0,o=g$i(n)){const f=Math.min(o,e.byteLength-r);return t.encodeInto(n,e.subarray(r,r+f)),f};}else y$m=function(t,e,n=0,r=g$i(e)){const o=Math.min(r,t.byteLength-n);t=t.subarray(n,n+o);let f=0,i=0;for(;f<e.length;){const n=e.codePointAt(f);if(n<=127){t[i++]=n,f++;continue}let r=0,o=0;for(n<=2047?(r=6,o=192):n<=65535?(r=12,o=224):n<=2097151&&(r=18,o=240),t[i++]=o|n>>r,r-=6;r>=0;)t[i++]=128|n>>r&63,r-=6;f+=n>=65536?2:1;}return o};var b$a={byteLength:g$i,toString:s$t,write:y$m};function h$k(t){return 2*t.length}var l$i={byteLength:h$k,toString:function(t){const e=t.byteLength;let n="";for(let r=0;r<e-1;r+=2)n+=String.fromCharCode(t[r]+256*t[r+1]);return n},write:function(t,e,n=0,r=h$k(e)){const o=Math.min(r,t.byteLength-n);let f=o;for(let r=0;r<e.length&&!((f-=2)<0);++r){const o=e.charCodeAt(r),f=o>>8,i=o%256;t[n+2*r]=i,t[n+2*r+1]=f;}return o}};!function(t,e){const r=n$v,o=i$o,f=a$l,u=b$a,c=l$i,g=255===new Uint8Array(Uint16Array.of(255).buffer)[0];function s(t){switch(t){case"ascii":return r;case"base64":return o;case"hex":return f;case"utf8":case"utf-8":case void 0:return u;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return c;default:throw new Error(`Unknown encoding: ${t}`)}}function y(t){return t instanceof Uint8Array}function h(t,e,n){return "string"==typeof t?function(t,e){const n=s(e),r=new Uint8Array(n.byteLength(t));return n.write(r,t,0,r.byteLength),r}(t,e):Array.isArray(t)?function(t){const e=new Uint8Array(t.length);return e.set(t),e}(t):ArrayBuffer.isView(t)?function(t){const e=new Uint8Array(t.byteLength);return e.set(t),e}(t):function(t,e,n){return new Uint8Array(t,e,n)}(t,e,n)}function L(t,e,n,r,o){if(0===t.byteLength)return -1;if("string"==typeof n?(r=n,n=0):void 0===n?n=o?0:t.length-1:n<0&&(n+=t.byteLength),n>=t.byteLength){if(o)return -1;n=t.byteLength-1;}else if(n<0){if(!o)return -1;n=0;}if("string"==typeof e)e=h(e,r);else if("number"==typeof e)return e&=255,o?t.indexOf(e,n):t.lastIndexOf(e,n);if(0===e.byteLength)return -1;if(o){let r=-1;for(let o=n;o<t.byteLength;o++)if(t[o]===e[-1===r?0:o-r]){if(-1===r&&(r=o),o-r+1===e.byteLength)return r}else -1!==r&&(o-=o-r),r=-1;}else {n+e.byteLength>t.byteLength&&(n=t.byteLength-e.byteLength);for(let r=n;r>=0;r--){let n=!0;for(let o=0;o<e.byteLength;o++)if(t[r+o]!==e[o]){n=!1;break}if(n)return r}}return -1}function w(t,e,n,r){return L(t,e,n,r,!0)}function d(t,e,n){const r=t[e];t[e]=t[n],t[n]=r;}t.exports=e={isBuffer:y,isEncoding:function(t){try{return s(t),!0}catch{return !1}},alloc:function(t,n,r){const o=new Uint8Array(t);return void 0!==n&&e.fill(o,n,0,o.byteLength,r),o},allocUnsafe:function(t){return new Uint8Array(t)},allocUnsafeSlow:function(t){return new Uint8Array(t)},byteLength:function(t,e){return s(e).byteLength(t)},compare:function(t,e){if(t===e)return 0;const n=Math.min(t.byteLength,e.byteLength);t=new DataView(t.buffer,t.byteOffset,t.byteLength),e=new DataView(e.buffer,e.byteOffset,e.byteLength);let r=0;for(let o=n-n%4;r<o;r+=4){if(t.getUint32(r,g)!==e.getUint32(r,g))break}for(;r<n;r++){const n=t.getUint8(r),o=e.getUint8(r);if(n<o)return -1;if(n>o)return 1}return t.byteLength>e.byteLength?1:t.byteLength<e.byteLength?-1:0},concat:function(t,e){void 0===e&&(e=t.reduce(((t,e)=>t+e.byteLength),0));const n=new Uint8Array(e);let r=0;for(const e of t){if(r+e.byteLength>n.byteLength){const t=e.subarray(0,n.byteLength-r);return n.set(t,r),n}n.set(e,r),r+=e.byteLength;}return n},copy:function(t,e,n=0,r=0,o=t.byteLength){if(o>0&&o<r)return 0;if(o===r)return 0;if(0===t.byteLength||0===e.byteLength)return 0;if(n<0)throw new RangeError("targetStart is out of range");if(r<0||r>=t.byteLength)throw new RangeError("sourceStart is out of range");if(o<0)throw new RangeError("sourceEnd is out of range");n>=e.byteLength&&(n=e.byteLength),o>t.byteLength&&(o=t.byteLength),e.byteLength-n<o-r&&(o=e.length-n+r);const f=o-r;return t===e?e.copyWithin(n,r,o):e.set(t.subarray(r,o),n),f},equals:function(t,e){if(t===e)return !0;if(t.byteLength!==e.byteLength)return !1;const n=t.byteLength;t=new DataView(t.buffer,t.byteOffset,t.byteLength),e=new DataView(e.buffer,e.byteOffset,e.byteLength);let r=0;for(let o=n-n%4;r<o;r+=4)if(t.getUint32(r,g)!==e.getUint32(r,g))return !1;for(;r<n;r++)if(t.getUint8(r)!==e.getUint8(r))return !1;return !0},fill:function(t,e,n,r,o){if("string"==typeof e?"string"==typeof n?(o=n,n=0,r=t.byteLength):"string"==typeof r&&(o=r,r=t.byteLength):"number"==typeof e?e&=255:"boolean"==typeof e&&(e=+e),n<0||t.byteLength<n||t.byteLength<r)throw new RangeError("Out of range index");if(void 0===n&&(n=0),void 0===r&&(r=t.byteLength),r<=n)return t;if(e||(e=0),"number"==typeof e)for(let o=n;o<r;++o)t[o]=e;else {const f=(e=y(e)?e:h(e,o)).byteLength;for(let o=0;o<r-n;++o)t[o+n]=e[o%f];}return t},from:h,includes:function(t,e,n,r){return -1!==w(t,e,n,r)},indexOf:w,lastIndexOf:function(t,e,n,r){return L(t,e,n,r,!1)},swap16:function(t){const e=t.byteLength;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let n=0;n<e;n+=2)d(t,n,n+1);return t},swap32:function(t){const e=t.byteLength;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let n=0;n<e;n+=4)d(t,n,n+3),d(t,n+1,n+2);return t},swap64:function(t){const e=t.byteLength;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let n=0;n<e;n+=8)d(t,n,n+7),d(t,n+1,n+6),d(t,n+2,n+5),d(t,n+3,n+4);return t},toBuffer:function(t){return t},toString:function(t,e,n=0,r=t.byteLength){const o=t.byteLength;return n>=o||r<=n?"":(n<0&&(n=0),r>o&&(r=o),(0!==n||r<o)&&(t=t.subarray(n,r)),s(e).toString(t))},write:function(t,e,n,r,o){return void 0===n?o="utf8":void 0===r&&"string"==typeof n?(o=n,n=void 0):void 0===o&&"string"==typeof r&&(o=r,r=void 0),s(o).write(t,e,n,r)},writeDoubleLE:function(t,e,n){return void 0===n&&(n=0),new DataView(t.buffer,t.byteOffset,t.byteLength).setFloat64(n,e,!0),n+8},writeFloatLE:function(t,e,n){return void 0===n&&(n=0),new DataView(t.buffer,t.byteOffset,t.byteLength).setFloat32(n,e,!0),n+4},writeUInt32LE:function(t,e,n){return void 0===n&&(n=0),new DataView(t.buffer,t.byteOffset,t.byteLength).setUint32(n,e,!0),n+4},writeInt32LE:function(t,e,n){return void 0===n&&(n=0),new DataView(t.buffer,t.byteOffset,t.byteLength).setInt32(n,e,!0),n+4},readDoubleLE:function(t,e){return void 0===e&&(e=0),new DataView(t.buffer,t.byteOffset,t.byteLength).getFloat64(e,!0)},readFloatLE:function(t,e){return void 0===e&&(e=0),new DataView(t.buffer,t.byteOffset,t.byteLength).getFloat32(e,!0)},readUInt32LE:function(t,e){return void 0===e&&(e=0),new DataView(t.buffer,t.byteOffset,t.byteLength).getUint32(e,!0)},readInt32LE:function(t,e){return void 0===e&&(e=0),new DataView(t.buffer,t.byteOffset,t.byteLength).getInt32(e,!0)}};}(t$s,t$s.exports);var L$b=t$s.exports;

/**
 * Bundled by jsDelivr using Rollup v2.79.1 and Terser v5.19.2.
 * Original file: /npm/compact-encoding@2.15.0/index.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
var t$r={},r$v={};const n$u=r$v.LE=255===new Uint8Array(new Uint16Array([255]).buffer)[0];r$v.BE=!n$u;var o$s={exports:{}};!function(t,n){const o=L$b,{BE:d}=r$v;n=t.exports={preencode(e,t){e.end+=t.byteLength;},encode(e,t){e.buffer.set(t,e.start),e.start+=t.byteLength;},decode(e){const t=e.buffer.subarray(e.start,e.end);return e.start=e.end,t}};const f=n.buffer={preencode(e,t){t?s.preencode(e,t):e.end++;},encode(e,t){t?s.encode(e,t):e.buffer[e.start++]=0;},decode(e){const t=e.buffer.subarray(e.start);return 0===t.byteLength?null:(e.start=e.end,t)}};function a(e,t){const r=e.BYTES_PER_ELEMENT;return {preencode(e,t){e.end+=t.byteLength;},encode(e,r){const n=new Uint8Array(r.buffer,r.byteOffset,r.byteLength);d&&t&&t(n),e.buffer.set(n,e.start),e.start+=r.byteLength;},decode(n){let o=n.buffer.subarray(n.start);return o.byteOffset%r!=0&&(o=new Uint8Array(o)),d&&t&&t(o),n.start=n.end,new e(o.buffer,o.byteOffset,o.byteLength/r)}}}n.binary={...f,preencode(e,t){"string"==typeof t?u.preencode(e,t):f.preencode(e,t);},encode(e,t){"string"==typeof t?u.encode(e,t):f.encode(e,t);}},n.arraybuffer={preencode(e,t){e.end+=t.byteLength;},encode(e,t){const r=new Uint8Array(t);e.buffer.set(r,e.start),e.start+=t.byteLength;},decode(e){const t=new ArrayBuffer(e.end-e.start);return new Uint8Array(t).set(e.buffer.subarray(e.start)),e.start=e.end,t}};const s=n.uint8array=a(Uint8Array);function c(e){return {preencode(t,r){t.end+=o.byteLength(r,e);},encode(t,r){t.start+=o.write(t.buffer,r,t.start,e);},decode(t){const r=o.toString(t.buffer,e,t.start);return t.start=t.end,r}}}n.uint16array=a(Uint16Array,o.swap16),n.uint32array=a(Uint32Array,o.swap32),n.int8array=a(Int8Array),n.int16array=a(Int16Array,o.swap16),n.int32array=a(Int32Array,o.swap32),n.biguint64array=a(BigUint64Array,o.swap64),n.bigint64array=a(BigInt64Array,o.swap64),n.float32array=a(Float32Array,o.swap32),n.float64array=a(Float64Array,o.swap64);const u=n.string=n.utf8=c("utf-8");n.ascii=c("ascii"),n.hex=c("hex"),n.base64=c("base64"),n.ucs2=n.utf16le=c("utf16le"),n.array=function(e){return {preencode(t,r){for(const n of r)e.preencode(t,n);},encode(t,r){for(const n of r)e.encode(t,n);},decode(t){const r=[];for(;t.start<t.end;)r.push(e.decode(t));return r}}},n.json={preencode(e,t){u.preencode(e,JSON.stringify(t));},encode(e,t){u.encode(e,JSON.stringify(t));},decode:e=>JSON.parse(u.decode(e))},n.ndjson={preencode(e,t){u.preencode(e,JSON.stringify(t)+"\n");},encode(e,t){u.encode(e,JSON.stringify(t)+"\n");},decode:e=>JSON.parse(u.decode(e))};}(o$s,o$s.exports);var d$g={preencode:function e(t,r){if(r<251)t.end++;else if(r<256)t.end+=2;else if(r<65536)t.end+=3;else if(r<16777216)t.end+=4;else if(r<4294967296)t.end+=5;else {t.end++;const n=Math.floor(Math.log(r)/Math.log(2))-32;e(t,n),t.end+=6;}},encode:function e(t,r){const n=251,o=r-n;if(r<n)t.buffer[t.start++]=r;else if(r<256)t.buffer[t.start++]=n,t.buffer[t.start++]=o;else if(r<65536)t.buffer[t.start++]=252,t.buffer[t.start++]=o>>8&255,t.buffer[t.start++]=255&o;else if(r<16777216)t.buffer[t.start++]=253,t.buffer[t.start++]=o>>16,t.buffer[t.start++]=o>>8&255,t.buffer[t.start++]=255&o;else if(r<4294967296)t.buffer[t.start++]=254,t.buffer[t.start++]=o>>24,t.buffer[t.start++]=o>>16&255,t.buffer[t.start++]=o>>8&255,t.buffer[t.start++]=255&o;else {const r=Math.floor(Math.log(o)/Math.log(2))-32;t.buffer[t.start++]=255,e(t,r);const n=o/Math.pow(2,r-11);for(let e=5;e>=0;e--)t.buffer[t.start++]=n/Math.pow(2,8*e)&255;}},decode:function e(t){const r=251;if(t.end-t.start<1)throw new Error("Out of bounds");const n=t.buffer[t.start++];if(n<r)return n;if(t.end-t.start<n-r+1)throw new Error("Out of bounds.");if(n<252)return t.buffer[t.start++]+r;if(n<253)return (t.buffer[t.start++]<<8)+t.buffer[t.start++]+r;if(n<254)return (t.buffer[t.start++]<<16)+(t.buffer[t.start++]<<8)+t.buffer[t.start++]+r;if(n<255)return 16777216*t.buffer[t.start++]+(t.buffer[t.start++]<<16)+(t.buffer[t.start++]<<8)+t.buffer[t.start++]+r;const o=e(t);if(t.end-t.start<6)throw new Error("Out of bounds");let d=0;for(let e=5;e>=0;e--)d+=t.buffer[t.start++]*Math.pow(2,8*e);return d*Math.pow(2,o-11)+r}};!function(t){const n=L$b,{BE:f}=r$v;t.state=function(e=0,t=0,r=null){return {start:e,end:t,buffer:r,cache:null}};const a=t.raw=o$s.exports,s=t.uint={preencode(e,t){e.end+=t<=252?1:t<=65535?3:t<=4294967295?5:9;},encode(e,t){t<=252?c.encode(e,t):t<=65535?(e.buffer[e.start++]=253,u.encode(e,t)):t<=4294967295?(e.buffer[e.start++]=254,b.encode(e,t)):(e.buffer[e.start++]=255,w.encode(e,t));},decode(e){const t=c.decode(e);return t<=252?t:253===t?u.decode(e):254===t?b.decode(e):w.decode(e)}},c=t.uint8={preencode(e,t){e.end+=1;},encode(e,t){e.buffer[e.start++]=t;},decode(e){if(e.start>=e.end)throw new Error("Out of bounds");return e.buffer[e.start++]}},u=t.uint16={preencode(e,t){e.end+=2;},encode(e,t){e.buffer[e.start++]=t,e.buffer[e.start++]=t>>>8;},decode(e){if(e.end-e.start<2)throw new Error("Out of bounds");return e.buffer[e.start++]+256*e.buffer[e.start++]}},i=t.uint24={preencode(e,t){e.end+=3;},encode(e,t){e.buffer[e.start++]=t,e.buffer[e.start++]=t>>>8,e.buffer[e.start++]=t>>>16;},decode(e){if(e.end-e.start<3)throw new Error("Out of bounds");return e.buffer[e.start++]+256*e.buffer[e.start++]+65536*e.buffer[e.start++]}},b=t.uint32={preencode(e,t){e.end+=4;},encode(e,t){e.buffer[e.start++]=t,e.buffer[e.start++]=t>>>8,e.buffer[e.start++]=t>>>16,e.buffer[e.start++]=t>>>24;},decode(e){if(e.end-e.start<4)throw new Error("Out of bounds");return e.buffer[e.start++]+256*e.buffer[e.start++]+65536*e.buffer[e.start++]+16777216*e.buffer[e.start++]}},y=t.uint40={preencode(e,t){e.end+=5;},encode(e,t){const r=Math.floor(t/256);c.encode(e,t),b.encode(e,r);},decode(e){if(e.end-e.start<5)throw new Error("Out of bounds");return c.decode(e)+256*b.decode(e)}},p=t.uint48={preencode(e,t){e.end+=6;},encode(e,t){const r=Math.floor(t/65536);u.encode(e,t),b.encode(e,r);},decode(e){if(e.end-e.start<6)throw new Error("Out of bounds");return u.decode(e)+65536*b.decode(e)}},l=t.uint56={preencode(e,t){e.end+=7;},encode(e,t){const r=Math.floor(t/16777216);i.encode(e,t),b.encode(e,r);},decode(e){if(e.end-e.start<7)throw new Error("Out of bounds");return i.decode(e)+16777216*b.decode(e)}},w=t.uint64={preencode(e,t){e.end+=8;},encode(e,t){const r=Math.floor(t/4294967296);b.encode(e,t),b.encode(e,r);},decode(e){if(e.end-e.start<8)throw new Error("Out of bounds");return b.decode(e)+4294967296*b.decode(e)}};t.int=J(s),t.int8=J(c),t.int16=J(u),t.int24=J(i),t.int32=J(b),t.int40=J(y),t.int48=J(p),t.int56=J(l),t.int64=J(w);const g=t.biguint64={preencode(e,t){e.end+=8;},encode(e,t){new DataView(e.buffer.buffer,e.start+e.buffer.byteOffset,8).setBigUint64(0,t,!0),e.start+=8;},decode(e){if(e.end-e.start<8)throw new Error("Out of bounds");const t=new DataView(e.buffer.buffer,e.start+e.buffer.byteOffset,8).getBigUint64(0,!0);return e.start+=8,t}};t.bigint64=I(g);const h=t.biguint={preencode(e,t){let r=0;for(let e=t;e;e>>=64n)r++;s.preencode(e,r),e.end+=8*r;},encode(e,t){let r=0;for(let e=t;e;e>>=64n)r++;s.encode(e,r);const n=new DataView(e.buffer.buffer,e.start+e.buffer.byteOffset,8*r);for(let e=t,r=0;e;e>>=64n,r+=8)n.setBigUint64(r,BigInt.asUintN(64,e),!0);e.start+=8*r;},decode(e){const t=s.decode(e);if(e.end-e.start<8*t)throw new Error("Out of bounds");const r=new DataView(e.buffer.buffer,e.start+e.buffer.byteOffset,8*t);let n=0n;for(let e=t-1;e>=0;e--)n=(n<<64n)+r.getBigUint64(8*e,!0);return e.start+=8*t,n}};t.bigint=I(h),t.lexint=d$g,t.float32={preencode(e,t){e.end+=4;},encode(e,t){new DataView(e.buffer.buffer,e.start+e.buffer.byteOffset,4).setFloat32(0,t,!0),e.start+=4;},decode(e){if(e.end-e.start<4)throw new Error("Out of bounds");const t=new DataView(e.buffer.buffer,e.start+e.buffer.byteOffset,4).getFloat32(0,!0);return e.start+=4,t}},t.float64={preencode(e,t){e.end+=8;},encode(e,t){new DataView(e.buffer.buffer,e.start+e.buffer.byteOffset,8).setFloat64(0,t,!0),e.start+=8;},decode(e){if(e.end-e.start<8)throw new Error("Out of bounds");const t=new DataView(e.buffer.buffer,e.start+e.buffer.byteOffset,8).getFloat64(0,!0);return e.start+=8,t}};const O=t.buffer={preencode(e,t){t?A.preencode(e,t):e.end++;},encode(e,t){t?A.encode(e,t):e.buffer[e.start++]=0;},decode(e){const t=s.decode(e);if(0===t)return null;if(e.end-e.start<t)throw new Error("Out of bounds");return e.buffer.subarray(e.start,e.start+=t)}};function E(e,t){const r=e.BYTES_PER_ELEMENT;return {preencode(e,t){s.preencode(e,t.length),e.end+=t.byteLength;},encode(e,r){s.encode(e,r.length);const n=new Uint8Array(r.buffer,r.byteOffset,r.byteLength);f&&t&&t(n),e.buffer.set(n,e.start),e.start+=r.byteLength;},decode(n){const o=s.decode(n);let d=n.buffer.subarray(n.start,n.start+=o*r);if(d.byteLength!==o*r)throw new Error("Out of bounds");return d.byteOffset%r!=0&&(d=new Uint8Array(d)),f&&t&&t(d),new e(d.buffer,d.byteOffset,d.byteLength/r)}}}t.binary={...O,preencode(e,t){"string"==typeof t?U.preencode(e,t):O.preencode(e,t);},encode(e,t){"string"==typeof t?U.encode(e,t):O.encode(e,t);}},t.arraybuffer={preencode(e,t){s.preencode(e,t.byteLength),e.end+=t.byteLength;},encode(e,t){s.encode(e,t.byteLength);const r=new Uint8Array(t);e.buffer.set(r,e.start),e.start+=t.byteLength;},decode(e){const t=s.decode(e),r=new ArrayBuffer(t);return new Uint8Array(r).set(e.buffer.subarray(e.start,e.start+=t)),r}};const A=t.uint8array=E(Uint8Array);function L(e){return {preencode(t,r){const o=n.byteLength(r,e);s.preencode(t,o),t.end+=o;},encode(t,r){const o=n.byteLength(r,e);s.encode(t,o),n.write(t.buffer,r,t.start,e),t.start+=o;},decode(t){const r=s.decode(t);if(t.end-t.start<r)throw new Error("Out of bounds");return n.toString(t.buffer,e,t.start,t.start+=r)},fixed:t=>({preencode(e){e.end+=t;},encode(r,o){n.write(r.buffer,o,r.start,t,e),r.start+=t;},decode(r){if(r.end-r.start<t)throw new Error("Out of bounds");return n.toString(r.buffer,e,r.start,r.start+=t)}})}}t.uint16array=E(Uint16Array,n.swap16),t.uint32array=E(Uint32Array,n.swap32),t.int8array=E(Int8Array),t.int16array=E(Int16Array,n.swap16),t.int32array=E(Int32Array,n.swap32),t.biguint64array=E(BigUint64Array,n.swap64),t.bigint64array=E(BigInt64Array,n.swap64),t.float32array=E(Float32Array,n.swap32),t.float64array=E(Float64Array,n.swap64);const U=t.string=t.utf8=L("utf-8");t.ascii=L("ascii"),t.hex=L("hex"),t.base64=L("base64"),t.ucs2=t.utf16le=L("utf16le"),t.bool={preencode(e,t){e.end++;},encode(e,t){e.buffer[e.start++]=t?1:0;},decode(e){if(e.start>=e.end)throw Error("Out of bounds");return 1===e.buffer[e.start++]}};const x=t.fixed=function(e){return {preencode(t,r){t.end+=e;},encode(t,r){t.buffer.set(r,t.start),t.start+=e;},decode(t){if(t.end-t.start<e)throw new Error("Out of bounds");return t.buffer.subarray(t.start,t.start+=e)}}};t.fixed32=x(32),t.fixed64=x(64),t.array=function(e){return {preencode(t,r){s.preencode(t,r.length);for(let n=0;n<r.length;n++)e.preencode(t,r[n]);},encode(t,r){s.encode(t,r.length);for(let n=0;n<r.length;n++)e.encode(t,r[n]);},decode(t){const r=s.decode(t);if(r>1048576)throw new Error("Array is too big");const n=new Array(r);for(let o=0;o<r;o++)n[o]=e.decode(t);return n}}},t.frame=function(e){const r=t.state();return {preencode(t,r){const n=t.end;e.preencode(t,r),s.preencode(t,t.end-n);},encode(t,n){r.end=0,e.preencode(r,n),s.encode(t,r.end),e.encode(t,n);},decode(t){const r=t.end,n=s.decode(t);t.end=t.start+n;const o=e.decode(t);return t.start=t.end,t.end=r,o}}},t.json={preencode(e,t){U.preencode(e,JSON.stringify(t));},encode(e,t){U.encode(e,JSON.stringify(t));},decode:e=>JSON.parse(U.decode(e))},t.ndjson={preencode(e,t){U.preencode(e,JSON.stringify(t)+"\n");},encode(e,t){U.encode(e,JSON.stringify(t)+"\n");},decode:e=>JSON.parse(U.decode(e))},t.none={preencode(e,t){},encode(e,t){},decode:e=>null};const B={preencode(e,t){s.preencode(e,t.length);for(let r=0;r<t.length;r++)N.preencode(e,t[r]);},encode(e,t){s.encode(e,t.length);for(let r=0;r<t.length;r++)N.encode(e,t[r]);},decode(e){const t=[];let r=s.decode(e);for(;r-- >0;)t.push(N.decode(e));return t}},S={preencode(e,t){const r=Object.keys(t);s.preencode(e,r.length);for(const n of r)U.preencode(e,n),N.preencode(e,t[n]);},encode(e,t){const r=Object.keys(t);s.encode(e,r.length);for(const n of r)U.encode(e,n),N.encode(e,t[n]);},decode(e){let t=s.decode(e);const r={};for(;t-- >0;){r[U.decode(e)]=N.decode(e);}return r}},M=[t.none,t.bool,t.string,t.buffer,t.uint,t.int,t.float64,B,S],N=t.any={preencode(e,t){const r=j(t);s.preencode(e,r),M[r].preencode(e,t);},encode(e,t){const r=j(t);s.encode(e,r),M[r].encode(e,t);},decode(e){const t=s.decode(e);if(t>=M.length)throw new Error("Unknown type: "+t);return M[t].decode(e)}};function j(e){if(null==e)return 0;if("boolean"==typeof e)return 1;if("string"==typeof e)return 2;if(n.isBuffer(e))return 3;if("number"==typeof e)return Number.isInteger(e)?e>=0?4:5:6;if(Array.isArray(e))return 7;if("object"==typeof e)return 8;throw new Error("Unsupported type for "+e)}function J(e){return {preencode(t,r){e.preencode(t,m(r));},encode(t,r){e.encode(t,m(r));},decode(t){return 0===(r=e.decode(t))?r:0==(1&r)?r/2:-(r+1)/2;var r;}}}function m(e){return e<0?2*-e-1:0===e?0:2*e}function I(e){return {preencode(t,r){e.preencode(t,D(r));},encode(t,r){e.encode(t,D(r));},decode(t){return 0n===(r=e.decode(t))?r:0n===(1n&r)?r/2n:-(r+1n)/2n;var r;}}}function D(e){return e<0n?2n*-e-1n:0n===e?0n:2n*e}t.from=function(e){return "string"==typeof e?function(e){switch(e){case"ascii":return a.ascii;case"utf-8":case"utf8":return a.utf8;case"hex":return a.hex;case"base64":return a.base64;case"utf16-le":case"utf16le":case"ucs-2":case"ucs2":return a.ucs2;case"ndjson":return a.ndjson;case"json":return a.json;default:return a.binary}}(e):e.preencode?e:e.encodingLength?function(e){return {preencode(t,r){t.end+=e.encodingLength(r);},encode(t,r){e.encode(r,t.buffer,t.start),t.start+=e.encode.bytes;},decode(t){const r=e.decode(t.buffer,t.start,t.end);return t.start+=e.decode.bytes,r}}}(e):function(e){let t=null,r=null;return {preencode(n,o){t=o,r=e.encode(o),n.end+=r.byteLength;},encode(n,o){a.encode(n,o===t?r:e.encode(o)),t=r=null;},decode:t=>e.decode(a.decode(t))}}(e)},t.encode=function(e,r){const o=t.state();return e.preencode(o,r),o.buffer=n.allocUnsafe(o.end),e.encode(o,r),o.buffer},t.decode=function(e,r){return e.decode(t.state(0,r.byteLength,r))};}(t$r);t$r.array;t$r.arraybuffer;t$r.ascii;t$r.base64;t$r.bigint;t$r.bigint64;t$r.bigint64array;t$r.biguint64array;t$r.binary;t$r.bool;t$r.decode;t$r.encode;t$r.fixed32;t$r.fixed64;t$r.float32;t$r.float32array;t$r.float64;t$r.float64array;t$r.frame;t$r.from;t$r.hex;t$r.int;t$r.int16;t$r.int16array;t$r.int24;t$r.int32;t$r.int32array;t$r.int40;t$r.int48;t$r.int56;t$r.int64;t$r.int8;t$r.int8array;t$r.json;t$r.lexint;t$r.ndjson;t$r.none;t$r.state;t$r.ucs2;t$r.uint16array;t$r.uint32array;t$r.utf16le;

/**
 * Bundled by jsDelivr using Rollup v2.79.1 and Terser v5.19.2.
 * Original file: /npm/safety-catch@1.0.2/index.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
var r$u=function(r){if(function(r){return !!r&&(r instanceof TypeError||r instanceof SyntaxError||r instanceof ReferenceError||r instanceof EvalError||r instanceof RangeError||r instanceof URIError||"ERR_ASSERTION"===r.code)}(r))throw function(r){queueMicrotask((()=>{throw r}));}(r),r};

/**
 * Bundled by jsDelivr using Rollup v2.79.1 and Terser v5.19.2.
 * Original file: /npm/z32@1.1.0/index.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
var r$t={};const n$t=L$b,e$o="ybndrfg8ejkmcpqxot1uwisza345h769",o$r=49,a$k=122,s$s=new Int8Array(1+a$k-o$r);s$s.fill(-1);for(let t=0;t<32;t++){const r=e$o.charCodeAt(t)-o$r;s$s[r]=t;}r$t.encode=function(t){"string"==typeof t&&(t=n$t.from(t));const r=8*t.byteLength;let o="";for(let n=0;n<r;n+=5){const r=n>>>3,a=7&n;if(a<=3){o+=e$o[t[r]>>>3-a&31];continue}const s=a-3,c=t[r]<<s&31,i=(r>=t.byteLength?0:t[r+1])>>>8-s;o+=e$o[c|i];}return o};r$t.decode=function(t,r){let e=0,o=0;const a=7&t.length,s=(t.length-a)/8;r||(r=n$t.allocUnsafe(Math.ceil(5*t.length/8)));for(let n=0;n<s;n++){const n=f$j(t,o++),a=f$j(t,o++),s=f$j(t,o++),c=f$j(t,o++),i=f$j(t,o++),u=f$j(t,o++),l=f$j(t,o++),h=f$j(t,o++);r[e++]=n<<3|a>>>2,r[e++]=(3&a)<<6|s<<1|c>>>4,r[e++]=(15&c)<<4|i>>>1,r[e++]=(1&i)<<7|u<<2|l>>>3,r[e++]=(7&l)<<5|h;}if(0===a)return r.subarray(0,e);const c=f$j(t,o++),i=f$j(t,o++);if(r[e++]=c<<3|i>>>2,a<=2)return r.subarray(0,e);const u=f$j(t,o++),l=f$j(t,o++);if(r[e++]=(3&i)<<6|u<<1|l>>>4,a<=4)return r.subarray(0,e);const h=f$j(t,o++);if(r[e++]=(15&l)<<4|h>>>1,a<=5)return r.subarray(0,e);const b=f$j(t,o++),d=f$j(t,o++);if(r[e++]=(1&h)<<7|b<<2|d>>>3,a<=7)return r.subarray(0,e);const y=f$j(t,o++);return r[e++]=(7&d)<<5|y,r.subarray(0,e)};r$t.ALPHABET=e$o;function f$j(t,r){if(r>t.length)return 0;const n=t.charCodeAt(r);if(n<o$r||n>a$k)throw Error('Invalid character in base32 input: "'+t[r]+'" at position '+r);const e=s$s[n-o$r];if(-1===e)throw Error('Invalid character in base32 input: "'+t[r]+'" at position '+r);return e}

/**
 * Bundled by jsDelivr using Rollup v2.79.1 and Terser v5.19.2.
 * Original file: /npm/hypercore-id-encoding@1.3.0/index.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
const t$q=r$t,n$s=L$b;var o$q={encode:i$n,decode:s$r,normalize:function(e){return i$n(s$r(e))},isValid:function(e){try{return s$r(e),!0}catch{return !1}}};function i$n(e){if(!n$s.isBuffer(e))throw new Error("Key must be a Buffer");if(32!==e.byteLength)throw new Error("Key must be 32-bytes long");return t$q.encode(e)}function s$r(e){if(n$s.isBuffer(e)){if(32!==e.byteLength)throw new Error("ID must be 32-bytes long");return e}if("string"==typeof e){if(e.startsWith("pear://")&&(e=e.slice(7).split("/")[0]),52===e.length)return t$q.decode(e);if(64===e.length){const r=n$s.from(e,"hex");if(32===r.byteLength)return r}}throw new Error("Invalid Hypercore key")}

/**
 * Bundled by jsDelivr using Rollup v2.79.1 and Terser v5.19.2.
 * Original file: /npm/nanoassert@2.0.0/index.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
var r$s=function r(e,t){if(!e){var o=new a$j(t);throw Error.captureStackTrace&&Error.captureStackTrace(o,r),o}};let a$j = class a extends Error{};a$j.prototype.name="AssertionError";

/**
 * Bundled by jsDelivr using Rollup v2.79.1 and Terser v5.19.2.
 * Original file: /npm/signal-promise@1.0.3/index.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
var s$q=class s{constructor(){this._resolve=null,this._reject=null,this._promise=null,this._bind=t$p.bind(this),this._onerror=e$n.bind(this),this._onsuccess=e$n.bind(this,null),this._timers=new Set;}wait(s){return this._promise||(this._promise=new Promise(this._bind),this._promise.then(this._onsuccess).catch(this._onerror)),s?this._sleep(s):this._promise}_sleep(s){return new Promise(((e,t)=>{const i={id:setTimeout((()=>{this._timers.delete(i),e(!0);}),s),resolve:e,reject:t};this._timers.add(i);}))}notify(s){if(!this._promise)return;const e=this._resolve,t=this._reject;this._promise=null,s?t(s):e(!0);}};function e$n(s){for(const{id:e,resolve:t,reject:i}of this._timers)clearTimeout(e),s?i(s):t(!0);this._timers.clear();}function t$p(s,e){this._resolve=s,this._reject=e;}

/**
 * Bundled by jsDelivr using Rollup v2.79.1 and Terser v5.19.2.
 * Original file: /npm/core-coupler@1.1.1/index.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
const t$o=r$u;var s$p=class s{constructor(e,t){this.target=e,this.wakeup=t,this.coupled=new Set,this._onpeeraddBound=this._onpeeradd.bind(this),this.target.on("peer-add",this._onpeeraddBound);}add(e){this.coupled.add(e),this._couple(e);}remove(e){this.coupled.delete(e);}destroy(){this.target.off("peer-add",this._onpeeraddBound);}async _couple(e){try{let t=null;for(const s of this.target.peers)await this._hasPeer(e,s)||(null===t&&(t=[]),t.push(s));if(null!==t&&this.coupled.has(e))for(const s of t)this.wakeup(s,[e]);}catch(e){t$o(e);}}async _onpeeradd(e){try{let t=null;for(const s of this.coupled)await this._hasPeer(s,e)||(null===t&&(t=[]),t.push(s));null!==t&&this.wakeup(e,t);}catch(e){t$o(e);}}_hasPeer(e,t){const s=t.protomux.getLastChannel({protocol:"hypercore",id:e.discoveryKey});return s?s.fullyOpened():Promise.resolve(!1)}};

/**
 * Bundled by jsDelivr using Rollup v2.79.1 and Terser v5.19.2.
 * Original file: /npm/mutexify@1.4.0/promise.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
var n$r=e$t,r$r=function(){var e=[],r=null,t=function(){r(o);},u=function(o){return r?e.push(o):(r=o,u.locked=!0,n$r(t),0)};u.locked=!1;var o=function(n,t,o){r=null,u.locked=!1,e.length&&u(e.shift()),n&&n(t,o);};return u},t$n=function(){var e=r$r(),n=function(){return new Promise(e)};return Object.defineProperty(n,"locked",{get:function(){return e.locked},enumerable:!0}),n};

/**
 * Bundled by jsDelivr using Rollup v2.79.1 and Terser v5.19.2.
 * Original file: /npm/tiny-buffer-map@1.2.0/index.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
const e$m=L$b;var s$o=class s{constructor(t){this.m=t?[...t]:[];}get size(){return this.m.length}get(t){for(let e=0;e<this.m.length;e++){const s=this.m[e];if(i$m(s[0],t))return s[1]}}set(t,e){for(let s=0;s<this.m.length;s++){const h=this.m[s];if(i$m(h[0],t))return void(h[1]=e)}this.m.push([t,e]);}delete(t){for(let e=0;e<this.m.length;e++){if(i$m(this.m[e][0],t))return void this.m.splice(e,1)}}has(t){return void 0!==this.get(t)}*[Symbol.iterator](){for(let t=0;t<this.m.length;t++)yield this.m[t];}*keys(){for(let t=0;t<this.m.length;t++)yield this.m[t][0];}*values(){for(let t=0;t<this.m.length;t++)yield this.m[t][1];}clear(){this.m=[];}};function i$m(t,s){return t.equals?t.equals(s):e$m.equals(t,s)}

/**
 * Bundled by jsDelivr using Rollup v2.79.1 and Terser v5.19.2.
 * Original file: /npm/random-access-file@4.0.7/browser.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
var r$q=function(){throw new Error("random-access-file is not supported in the browser")};

/**
 * Bundled by jsDelivr using Rollup v2.79.1 and Terser v5.19.2.
 * Original file: /npm/b4a@1.6.4/browser.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
var t$m={exports:{}};function e$l(t){return t.length}var n$q={byteLength:e$l,toString:function(t){const e=t.byteLength;let n="";for(let r=0;r<e;r++)n+=String.fromCharCode(t[r]);return n},write:function(t,n,r=0,o=e$l(n)){const f=Math.min(o,t.byteLength-r);for(let e=0;e<f;e++)t[r+e]=n.charCodeAt(e);return f}};const r$p="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o$p=new Uint8Array(256);for(let t=0;t<64;t++)o$p[r$p.charCodeAt(t)]=t;function f$i(t){let e=t.length;return 61===t.charCodeAt(e-1)&&e--,e>1&&61===t.charCodeAt(e-1)&&e--,3*e>>>2}o$p[45]=62,o$p[95]=63;var i$l={byteLength:f$i,toString:function(t){const e=t.byteLength;let n="";for(let o=0;o<e;o+=3)n+=r$p[t[o]>>2]+r$p[(3&t[o])<<4|t[o+1]>>4]+r$p[(15&t[o+1])<<2|t[o+2]>>6]+r$p[63&t[o+2]];return e%3==2?n=n.substring(0,n.length-1)+"=":e%3==1&&(n=n.substring(0,n.length-2)+"=="),n},write:function(t,e,n=0,r=f$i(e)){const i=Math.min(r,t.byteLength-n);for(let n=0,r=0;r<i;n+=4){const f=o$p[e.charCodeAt(n)],i=o$p[e.charCodeAt(n+1)],u=o$p[e.charCodeAt(n+2)],a=o$p[e.charCodeAt(n+3)];t[r++]=f<<2|i>>4,t[r++]=(15&i)<<4|u>>2,t[r++]=(3&u)<<6|63&a;}return i}};function u$j(t){return t.length>>>1}var a$i={byteLength:u$j,toString:function(t){const e=t.byteLength;t=new DataView(t.buffer,t.byteOffset,e);let n="",r=0;for(let o=e-e%4;r<o;r+=4)n+=t.getUint32(r).toString(16).padStart(8,"0");for(;r<e;r++)n+=t.getUint8(r).toString(16).padStart(2,"0");return n},write:function(t,e,n=0,r=u$j(e)){const o=Math.min(r,t.byteLength-n);for(let r=0;r<o;r++){const o=c$l(e.charCodeAt(2*r)),f=c$l(e.charCodeAt(2*r+1));if(void 0===o||void 0===f)return t.subarray(0,r);t[n+r]=o<<4|f;}return o}};function c$l(t){return t>=48&&t<=57?t-48:t>=65&&t<=70?t-65+10:t>=97&&t<=102?t-97+10:void 0}function g$h(t){let e=0;for(let n=0,r=t.length;n<r;n++){const o=t.charCodeAt(n);if(o>=55296&&o<=56319&&n+1<r){const r=t.charCodeAt(n+1);if(r>=56320&&r<=57343){e+=4,n++;continue}}e+=o<=127?1:o<=2047?2:3;}return e}let s$n,y$l;if("undefined"!=typeof TextDecoder){const t=new TextDecoder;s$n=function(e){return t.decode(e)};}else s$n=function(t){const e=t.byteLength;let n="",r=0;for(;r<e;){let o=t[r];if(o<=127){n+=String.fromCharCode(o),r++;continue}let f=0,i=0;if(o<=223?(f=1,i=31&o):o<=239?(f=2,i=15&o):o<=244&&(f=3,i=7&o),e-r-f>0){let e=0;for(;e<f;)o=t[r+e+1],i=i<<6|63&o,e+=1;}else i=65533,f=e-r;n+=String.fromCodePoint(i),r+=f+1;}return n};if("undefined"!=typeof TextEncoder){const t=new TextEncoder;y$l=function(e,n,r=0,o=g$h(n)){const f=Math.min(o,e.byteLength-r);return t.encodeInto(n,e.subarray(r,r+f)),f};}else y$l=function(t,e,n=0,r=g$h(e)){const o=Math.min(r,t.byteLength-n);t=t.subarray(n,n+o);let f=0,i=0;for(;f<e.length;){const n=e.codePointAt(f);if(n<=127){t[i++]=n,f++;continue}let r=0,o=0;for(n<=2047?(r=6,o=192):n<=65535?(r=12,o=224):n<=2097151&&(r=18,o=240),t[i++]=o|n>>r,r-=6;r>=0;)t[i++]=128|n>>r&63,r-=6;f+=n>=65536?2:1;}return o};var b$9={byteLength:g$h,toString:s$n,write:y$l};function h$j(t){return 2*t.length}var l$h={byteLength:h$j,toString:function(t){const e=t.byteLength;let n="";for(let r=0;r<e-1;r+=2)n+=String.fromCharCode(t[r]+256*t[r+1]);return n},write:function(t,e,n=0,r=h$j(e)){const o=Math.min(r,t.byteLength-n);let f=o;for(let r=0;r<e.length&&!((f-=2)<0);++r){const o=e.charCodeAt(r),f=o>>8,i=o%256;t[n+2*r]=i,t[n+2*r+1]=f;}return o}};!function(t,e){const r=n$q,o=i$l,f=a$i,u=b$9,c=l$h,g=255===new Uint8Array(Uint16Array.of(255).buffer)[0];function s(t){switch(t){case"ascii":return r;case"base64":return o;case"hex":return f;case"utf8":case"utf-8":case void 0:return u;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return c;default:throw new Error(`Unknown encoding: ${t}`)}}function y(t){return t instanceof Uint8Array}function h(t,e,n){return "string"==typeof t?function(t,e){const n=s(e),r=new Uint8Array(n.byteLength(t));return n.write(r,t,0,r.byteLength),r}(t,e):Array.isArray(t)?function(t){const e=new Uint8Array(t.length);return e.set(t),e}(t):ArrayBuffer.isView(t)?function(t){const e=new Uint8Array(t.byteLength);return e.set(t),e}(t):function(t,e,n){return new Uint8Array(t,e,n)}(t,e,n)}function L(t,e,n,r,o){if(0===t.byteLength)return -1;if("string"==typeof n?(r=n,n=0):void 0===n?n=o?0:t.length-1:n<0&&(n+=t.byteLength),n>=t.byteLength){if(o)return -1;n=t.byteLength-1;}else if(n<0){if(!o)return -1;n=0;}if("string"==typeof e)e=h(e,r);else if("number"==typeof e)return e&=255,o?t.indexOf(e,n):t.lastIndexOf(e,n);if(0===e.byteLength)return -1;if(o){let r=-1;for(let o=n;o<t.byteLength;o++)if(t[o]===e[-1===r?0:o-r]){if(-1===r&&(r=o),o-r+1===e.byteLength)return r}else -1!==r&&(o-=o-r),r=-1;}else {n+e.byteLength>t.byteLength&&(n=t.byteLength-e.byteLength);for(let r=n;r>=0;r--){let n=!0;for(let o=0;o<e.byteLength;o++)if(t[r+o]!==e[o]){n=!1;break}if(n)return r}}return -1}function w(t,e,n,r){return L(t,e,n,r,!0)}function d(t,e,n){const r=t[e];t[e]=t[n],t[n]=r;}t.exports=e={isBuffer:y,isEncoding:function(t){try{return s(t),!0}catch{return !1}},alloc:function(t,n,r){const o=new Uint8Array(t);return void 0!==n&&e.fill(o,n,0,o.byteLength,r),o},allocUnsafe:function(t){return new Uint8Array(t)},allocUnsafeSlow:function(t){return new Uint8Array(t)},byteLength:function(t,e){return s(e).byteLength(t)},compare:function(t,e){if(t===e)return 0;const n=Math.min(t.byteLength,e.byteLength);t=new DataView(t.buffer,t.byteOffset,t.byteLength),e=new DataView(e.buffer,e.byteOffset,e.byteLength);let r=0;for(let o=n-n%4;r<o;r+=4){if(t.getUint32(r,g)!==e.getUint32(r,g))break}for(;r<n;r++){const n=t.getUint8(r),o=e.getUint8(r);if(n<o)return -1;if(n>o)return 1}return t.byteLength>e.byteLength?1:t.byteLength<e.byteLength?-1:0},concat:function(t,e){void 0===e&&(e=t.reduce(((t,e)=>t+e.byteLength),0));const n=new Uint8Array(e);let r=0;for(const e of t){if(r+e.byteLength>n.byteLength){const t=e.subarray(0,n.byteLength-r);return n.set(t,r),n}n.set(e,r),r+=e.byteLength;}return n},copy:function(t,e,n=0,r=0,o=t.byteLength){if(o>0&&o<r)return 0;if(o===r)return 0;if(0===t.byteLength||0===e.byteLength)return 0;if(n<0)throw new RangeError("targetStart is out of range");if(r<0||r>=t.byteLength)throw new RangeError("sourceStart is out of range");if(o<0)throw new RangeError("sourceEnd is out of range");n>=e.byteLength&&(n=e.byteLength),o>t.byteLength&&(o=t.byteLength),e.byteLength-n<o-r&&(o=e.length-n+r);const f=o-r;return t===e?e.copyWithin(n,r,o):e.set(t.subarray(r,o),n),f},equals:function(t,e){if(t===e)return !0;if(t.byteLength!==e.byteLength)return !1;const n=t.byteLength;t=new DataView(t.buffer,t.byteOffset,t.byteLength),e=new DataView(e.buffer,e.byteOffset,e.byteLength);let r=0;for(let o=n-n%4;r<o;r+=4)if(t.getUint32(r,g)!==e.getUint32(r,g))return !1;for(;r<n;r++)if(t.getUint8(r)!==e.getUint8(r))return !1;return !0},fill:function(t,e,n,r,o){if("string"==typeof e?"string"==typeof n?(o=n,n=0,r=t.byteLength):"string"==typeof r&&(o=r,r=t.byteLength):"number"==typeof e?e&=255:"boolean"==typeof e&&(e=+e),n<0||t.byteLength<n||t.byteLength<r)throw new RangeError("Out of range index");if(void 0===n&&(n=0),void 0===r&&(r=t.byteLength),r<=n)return t;if(e||(e=0),"number"==typeof e)for(let o=n;o<r;++o)t[o]=e;else {const f=(e=y(e)?e:h(e,o)).byteLength;for(let o=0;o<r-n;++o)t[o+n]=e[o%f];}return t},from:h,includes:function(t,e,n,r){return -1!==w(t,e,n,r)},indexOf:w,lastIndexOf:function(t,e,n,r){return L(t,e,n,r,!1)},swap16:function(t){const e=t.byteLength;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let n=0;n<e;n+=2)d(t,n,n+1);return t},swap32:function(t){const e=t.byteLength;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let n=0;n<e;n+=4)d(t,n,n+3),d(t,n+1,n+2);return t},swap64:function(t){const e=t.byteLength;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let n=0;n<e;n+=8)d(t,n,n+7),d(t,n+1,n+6),d(t,n+2,n+5),d(t,n+3,n+4);return t},toBuffer:function(t){return t},toString:function(t,e,n=0,r=t.byteLength){const o=t.byteLength;return n>=o||r<=n?"":(n<0&&(n=0),r>o&&(r=o),(0!==n||r<o)&&(t=t.subarray(n,r)),s(e).toString(t))},write:function(t,e,n,r,o){return void 0===n?o="utf8":void 0===r&&"string"==typeof n?(o=n,n=void 0):void 0===o&&"string"==typeof r&&(o=r,r=void 0),s(o).write(t,e,n,r)},writeDoubleLE:function(t,e,n){return void 0===n&&(n=0),new DataView(t.buffer,t.byteOffset,t.byteLength).setFloat64(n,e,!0),n+8},writeFloatLE:function(t,e,n){return void 0===n&&(n=0),new DataView(t.buffer,t.byteOffset,t.byteLength).setFloat32(n,e,!0),n+4},writeUInt32LE:function(t,e,n){return void 0===n&&(n=0),new DataView(t.buffer,t.byteOffset,t.byteLength).setUint32(n,e,!0),n+4},writeInt32LE:function(t,e,n){return void 0===n&&(n=0),new DataView(t.buffer,t.byteOffset,t.byteLength).setInt32(n,e,!0),n+4},readDoubleLE:function(t,e){return void 0===e&&(e=0),new DataView(t.buffer,t.byteOffset,t.byteLength).getFloat64(e,!0)},readFloatLE:function(t,e){return void 0===e&&(e=0),new DataView(t.buffer,t.byteOffset,t.byteLength).getFloat32(e,!0)},readUInt32LE:function(t,e){return void 0===e&&(e=0),new DataView(t.buffer,t.byteOffset,t.byteLength).getUint32(e,!0)},readInt32LE:function(t,e){return void 0===e&&(e=0),new DataView(t.buffer,t.byteOffset,t.byteLength).getInt32(e,!0)}};}(t$m,t$m.exports);var L$a=t$m.exports;

/**
 * Bundled by jsDelivr using Rollup v2.79.1 and Terser v5.19.2.
 * Original file: /npm/is-options@1.0.2/index.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
const e$k=L$a;var o$o=function(t){return "object"==typeof t&&t&&!e$k.isBuffer(t)};

/**
 * Bundled by jsDelivr using Rollup v2.79.1 and Terser v5.19.2.
 * Original file: /npm/nanoassert@2.0.0/index.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
var r$o=function r(e,t){if(!e){var o=new a$h(t);throw Error.captureStackTrace&&Error.captureStackTrace(o,r),o}};let a$h = class a extends Error{};a$h.prototype.name="AssertionError";

/**
 * Bundled by jsDelivr using Rollup v2.79.1 and Terser v5.19.2.
 * Original file: /npm/sha512-wasm@2.3.4/index.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
var g$g,C$d,Q$d={exports:{}},i$k=(()=>{for(var A=new Uint8Array(128),I=0;I<64;I++)A[I<26?I+65:I<52?I+71:I<62?I-4:4*I-205]=I;return I=>{for(var g=I.length,C=new Uint8Array(3*(g-("="==I[g-1])-("="==I[g-2]))/4|0),Q=0,i=0;Q<g;){var t=A[I.charCodeAt(Q++)],e=A[I.charCodeAt(Q++)],E=A[I.charCodeAt(Q++)],o=A[I.charCodeAt(Q++)];C[i++]=t<<2|e>>4,C[i++]=e<<4|E>>2,C[i++]=E<<6|o;}return C}})(),t$l=(g$g={"wasm-binary:./sha512.wat"(A,I){I.exports=i$k("AGFzbQEAAAABNAVgAX4BfmAIfn5+fn5+fn4AYAR+fn5+AX5gEX9+fn5+fn5+fn5+fn5+fn5+AGAEf39/fwADBgUAAQIDBAUDAQABBikIfgFCAAt+AUIAC34BQgALfgFCAAt+AUIAC34BQgALfgFCAAt+AUIACwcTAgZtZW1vcnkCAAZzaGE1MTIABAqZHgVCACAAQoCA/P+PgECDQhCJIABC//+DgPD/P4NCEIqEIQAgAEL/gfyH8J/A/wCDQgiJIABCgP6D+I/gv4B/g0IIioQLvAMBBn4jBCMFgyMEQn+FIwaDhSEKIwAjAYMjACMCg4UjASMCg4UhCyMAQhyKIwBCIoqFIwBCJ4qFIQwjBEIOiiMEQhKKhSMEQimKhSENIwcgCnwgDXwgAHwgBHwhCCAMIAt8IQkjAyAIfCQHIAggCXwkAyMHIwSDIwdCf4UjBYOFIQojAyMAgyMDIwGDhSMAIwGDhSELIwNCHIojA0IiioUjA0InioUhDCMHQg6KIwdCEoqFIwdCKYqFIQ0jBiAKfCANfCABfCAFfCEIIAwgC3whCSMCIAh8JAYgCCAJfCQCIwYjB4MjBkJ/hSMEg4UhCiMCIwODIwIjAIOFIwMjAIOFIQsjAkIciiMCQiKKhSMCQieKhSEMIwZCDoojBkISioUjBkIpioUhDSMFIAp8IA18IAJ8IAZ8IQggDCALfCEJIwEgCHwkBSAIIAl8JAEjBSMGgyMFQn+FIweDhSEKIwEjAoMjASMDg4UjAyMCg4UhCyMBQhyKIwFCIoqFIwFCJ4qFIQwjBUIOiiMFQhKKhSMFQimKhSENIwQgCnwgDXwgA3wgB3whCCAMIAt8IQkjACAIfCQEIAggCXwkAAsrACAAQhOKIABCPYqFIABCBoiFIAF8IAJCAYogAkIIioUgAkIHiIUgA3x8C6QRACAAKQPQAUIAUQRAIABCiJLznf/M+YTqADcDACAAQrvOqqbY0Ouzu383AwggAEKr8NP0r+68tzw3AxAgAELx7fT4paf9p6V/NwMYIABC0YWa7/rPlIfRADcDICAAQp/Y+dnCkdqCm383AyggAELr+obav7X2wR83AzAgAEL5wvibkaOz8NsANwM4IABCATcD0AELIAApAwAkACAAKQMIJAEgACkDECQCIAApAxgkAyAAKQMgJAQgACkDKCQFIAApAzAkBiAAKQM4JAcgARAAIQEgAhAAIQIgAxAAIQMgBBAAIQQgBRAAIQUgBhAAIQYgBxAAIQcgCBAAIQggCRAAIQkgChAAIQogCxAAIQsgDBAAIQwgDRAAIQ0gDhAAIQ4gDxAAIQ8gEBAAIRAgASACIAMgBEKi3KK5jfOLxcIAQs3LvZ+SktGb8QBCr/a04v75vuC1f0K8t6eM2PT22mkQASAFIAYgByAIQrjqopq/y7CrOUKZoJewm77E+NkAQpuf5fjK1OCfkn9CmIK2093al46rfxABIAkgCiALIAxCwoSMmIrT6oNYQr7fwauU4NbBEkKM5ZL35LfhmCRC4un+r724n4bVABABIA0gDiAPIBBC75Luk8+ul9/yAEKxrdrY47+s74B/QrWknK7y1IHum39ClM2k+8yu/M1BEAEgDyAKIAIgARACIQEgECALIAMgAhACIQIgASAMIAQgAxACIQMgAiANIAUgBBACIQQgAyAOIAYgBRACIQUgBCAPIAcgBhACIQYgBSAQIAggBxACIQcgBiABIAkgCBACIQggByACIAogCRACIQkgCCADIAsgChACIQogCSAEIAwgCxACIQsgCiAFIA0gDBACIQwgCyAGIA4gDRACIQ0gDCAHIA8gDhACIQ4gDSAIIBAgDxACIQ8gDiAJIAEgEBACIRAgASACIAMgBELSlcX3mbjazWRC48u8wuPwkd9vQrWrs9zouOfgD0LluLK9x7mohiQQASAFIAYgByAIQvWErMn1jcv0LUKDyZv1ppWhusoAQtT3h+rLu6rY3ABCtafFmKib4vz2ABABIAkgCiALIAxCq7+b866qlJ+Yf0KQ5NDt0s3xmKh/Qr/C7MeJ+cmBsH9C5J289/v436y/fxABIA0gDiAPIBBCwp+i7bP+gvBGQqXOqpj5qOTTVULvhI6AnuqY5QZC8Ny50PCsypQUEAEgDyAKIAIgARACIQEgECALIAMgAhACIQIgASAMIAQgAxACIQMgAiANIAUgBBACIQQgAyAOIAYgBRACIQUgBCAPIAcgBhACIQYgBSAQIAggBxACIQcgBiABIAkgCBACIQggByACIAogCRACIQkgCCADIAsgChACIQogCSAEIAwgCxACIQsgCiAFIA0gDBACIQwgCyAGIA4gDRACIQ0gDCAHIA8gDhACIQ4gDSAIIBAgDxACIQ8gDiAJIAEgEBACIRAgASACIAMgBEL838i21NDC2ydCppKb4YWnyI0uQu3VkNbFv5uWzQBC3+fW7Lmig5zTABABIAUgBiAHIAhC3se93cjqnIXlAEKo5d7js9eCtfYAQubdtr/kpbLhgX9Cu+qIpNGQi7mSfxABIAkgCiALIAxC5IbE55SU+t+if0KB4Ijiu8mZjah/QpGv4oeN7uKlQkKw/NKysLSUtkcQASANIA4gDyAQQpikvbedg7rJUUKQ0parxcTBzFZCqsDEu9WwjYd0Qrij75WDjqi1EBABIA8gCiACIAEQAiEBIBAgCyADIAIQAiECIAEgDCAEIAMQAiEDIAIgDSAFIAQQAiEEIAMgDiAGIAUQAiEFIAQgDyAHIAYQAiEGIAUgECAIIAcQAiEHIAYgASAJIAgQAiEIIAcgAiAKIAkQAiEJIAggAyALIAoQAiEKIAkgBCAMIAsQAiELIAogBSANIAwQAiEMIAsgBiAOIA0QAiENIAwgByAPIA4QAiEOIA0gCCAQIA8QAiEPIA4gCSABIBAQAiEQIAEgAiADIARCyKHLxuuisNIZQtPWhoqFgdubHkKZ17v8zemdpCdCqJHtjN6Wr9g0EAEgBSAGIAcgCELjtKWuvJaDjjlCy5WGmq7JquzOAELzxo+798myztsAQqPxyrW9/puX6AAQASAJIAogCyAMQvzlvu/l3eDH9ABC4N7cmPTt2NL4AELy1sKPyoKe5IR/QuzzkNOBwcDjjH8QASANIA4gDyAQQqi8jJui/7/fkH9C6fuK9L2dm6ikf0KV8pmW+/7o/L5/QqumyZuunt64RhABIA8gCiACIAEQAiEBIBAgCyADIAIQAiECIAEgDCAEIAMQAiEDIAIgDSAFIAQQAiEEIAMgDiAGIAUQAiEFIAQgDyAHIAYQAiEGIAUgECAIIAcQAiEHIAYgASAJIAgQAiEIIAcgAiAKIAkQAiEJIAggAyALIAoQAiEKIAkgBCAMIAsQAiELIAogBSANIAwQAiEMIAsgBiAOIA0QAiENIAwgByAPIA4QAiEOIA0gCCAQIA8QAiEPIA4gCSABIBAQAiEQIAEgAiADIARCnMOZ0e7Zz5NKQoeEg47ymK7DUUKe1oPv7Lqf7WpC+KK78/7v0751EAEgBSAGIAcgCEK6392Qp/WZ+AZCprGiltq437EKQq6b5PfLgOafEUKbjvGY0ebCuBsQASAJIAogCyAMQoT7kZjS/t3tKEKTyZyGtO+q5TJCvP2mrqHBr888QsyawODJ+NmOwwAQASANIA4gDyAQQraF+dnsl/XizABCqvyV48+zyr/ZAELs9dvWs/Xb5d8AQpewndLEsYai7AAQASAAIAApAwAjAHw3AwAgACAAKQMIIwF8NwMIIAAgACkDECMCfDcDECAAIAApAxgjA3w3AxggACAAKQMgIwR8NwMgIAAgACkDKCMFfDcDKCAAIAApAzAjBnw3AzAgACAAKQM4Iwd8NwM4C8MIARV+IAApA0AhBCAAKQNIIQUgBEL/AIMgAq18IQggBCEGIAQgAq18IQQgACAENwNAIAQgBlQEQCAFQgF8IQUgACAFNwNICwJAIAApA1AhCSAAKQNYIQogACkDYCELIAApA2ghDCAAKQNwIQ0gACkDeCEOIAApA4ABIQ8gACkDiAEhECAAKQOQASERIAApA5gBIRIgACkDoAEhEyAAKQOoASEUIAApA7ABIRUgACkDuAEhFiAAKQPAASEXIAApA8gBIRggCEKAAX0iCEIAUw0AIAAgCSAKIAsgDCANIA4gDyAQIBEgEiATIBQgFSAWIBcgGBADA0AgASkDACEJIAEpAwghCiABKQMQIQsgASkDGCEMIAEpAyAhDSABKQMoIQ4gASkDMCEPIAEpAzghECABKQNAIREgASkDSCESIAEpA1AhEyABKQNYIRQgASkDYCEVIAEpA2ghFiABKQNwIRcgASkDeCEYIAFBgAFqIQEgCEKAAX0iCEIAUwRAIAAgCTcDUCAAIAo3A1ggACALNwNgIAAgDDcDaCAAIA03A3AgACAONwN4IAAgDzcDgAEgACAQNwOIASAAIBE3A5ABIAAgEjcDmAEgACATNwOgASAAIBQ3A6gBIAAgFTcDsAEgACAWNwO4ASAAIBc3A8ABIAAgGDcDyAEMAgsgACAJIAogCyAMIA0gDiAPIBAgESASIBMgFCAVIBYgFyAYEAMMAAsLIANBAUYEQCAEQv8AgyEIQoABIAhCB4NCA4aGIQcCQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkAgCKdBA3YODwMEBQYHCAkKCwwNDg8QAQILCyAHIBeEIRdCACEHCyAHIBiEIRhCACEHIAAgCSAKIAsgDCANIA4gDyAQIBEgEiATIBQgFSAWIBcgGBADIAAgBDcDQEIAIQlCACEKQgAhC0IAIQxCACENQgAhDkIAIQ9CACEQQgAhEUIAIRJCACETQgAhFEIAIRVCACEWQgAhF0IAIRgLIAcgCYQhCUIAIQcLIAcgCoQhCkIAIQcLIAcgC4QhC0IAIQcLIAcgDIQhDEIAIQcLIAcgDYQhDUIAIQcLIAcgDoQhDkIAIQcLIAcgD4QhD0IAIQcLIAcgEIQhEEIAIQcLIAcgEYQhEUIAIQcLIAcgEoQhEkIAIQcLIAcgE4QhE0IAIQcLIAcgFIQhFEIAIQcLIAcgFYQhFUIAIQcLIAcgFoQhFkIAIQcLIARCPYggBUIDiHwQACEXIARCCH4QACEYIAAgCSAKIAsgDCANIA4gDyAQIBEgEiATIBQgFSAWIBcgGBADIAAgACkDABAANwMAIAAgACkDCBAANwMIIAAgACkDEBAANwMQIAAgACkDGBAANwMYIAAgACkDIBAANwMgIAAgACkDKBAANwMoIAAgACkDMBAANwMwIAAgACkDOBAANwM4Cws=");}},function(){return C$d||(0, g$g[Object.keys(g$g)[0]])((C$d={exports:{}}).exports,C$d),C$d.exports})(),e$j=new WebAssembly.Module(t$l);const E$g=r$s,o$n=L$a,r$n="undefined"!=typeof WebAssembly&&(s$m={imports:{debug:{log(...A){console.log(...A.map((A=>(A>>>0).toString(16).padStart(8,"0"))));},log_tee:A=>(console.log((A>>>0).toString(16).padStart(8,"0")),A)}}},new WebAssembly.Instance(e$j,s$m).exports);var s$m;let B$f=0;const h$i=[];Q$d.exports=y$k;const n$p=Q$d.exports.SHA512_BYTES=64,D$c=216,p$h=128;function y$k(){if(!(this instanceof y$k))return new y$k;if(!r$n)throw new Error("WASM not loaded. Wait for Sha512.ready(cb)");h$i.length||(h$i.push(B$f),B$f+=D$c),this.finalized=!1,this.digestLength=n$p,this.pointer=h$i.pop(),this.pos=0,this.wasm=r$n,this._memory=new Uint8Array(r$n.memory.buffer),this._memory.fill(0,this.pointer,this.pointer+D$c),this.pointer+this.digestLength>this._memory.length&&this._realloc(this.pointer+D$c);}function w$d(A){if(!(this instanceof w$d))return new w$d(A);this.pad=o$n.alloc(128),this.inner=y$k(),this.outer=y$k();const I=o$n.alloc(64);A.byteLength>128&&(y$k().update(A).digest(I),A=I),this.pad.fill(54);for(let I=0;I<A.byteLength;I++)this.pad[I]^=A[I];this.inner.update(this.pad),this.pad.fill(92);for(let I=0;I<A.byteLength;I++)this.pad[I]^=A[I];this.outer.update(this.pad),this.pad.fill(0),I.fill(0);}function a$g(){}y$k.prototype._realloc=function(A){r$n.memory.grow(Math.max(0,Math.ceil(Math.abs(A-this._memory.length)/65536))),this._memory=new Uint8Array(r$n.memory.buffer);},y$k.prototype.update=function(A,I){E$g(!1===this.finalized,"Hash instance finalized"),B$f%8!=0&&(B$f+=8-B$f%8),E$g(B$f%8==0,"input should be aligned for int64");const[g,C]=function(A,I){var g=o$n.from(A,I);return [g,g.byteLength]}(A,I);var Q;return E$g(g instanceof Uint8Array,"input must be Uint8Array or Buffer"),B$f+A.length>this._memory.length&&this._realloc(B$f+A.length),this._memory.fill(0,B$f,B$f+(C+(Q=p$h)-1&-Q)-p$h),this._memory.set(g.subarray(0,p$h-this.pos),this.pointer+80+this.pos),this._memory.set(g.subarray(p$h-this.pos),B$f),this.pos=this.pos+C&127,r$n.sha512(this.pointer,B$f,C,0),this},y$k.prototype.digest=function(A,I=0){E$g(!1===this.finalized,"Hash instance finalized"),this.finalized=!0,h$i.push(this.pointer);const g=this.pointer+80+this.pos;this._memory.fill(0,g,this.pointer+80+p$h),r$n.sha512(this.pointer,B$f,0,1);const C=this._memory.subarray(this.pointer,this.pointer+this.digestLength);if(!A)return C;if("string"==typeof A)return o$n.toString(C,A);E$g(A instanceof Uint8Array,"output must be Uint8Array or Buffer"),E$g(A.byteLength>=this.digestLength+I,"output must have at least 'SHA512_BYTES' bytes remaining");for(let g=0;g<this.digestLength;g++)A[g+I]=C[g];return A},y$k.WASM=r$n,y$k.WASM_SUPPORTED="undefined"!=typeof WebAssembly,y$k.ready=function(A){return A||(A=a$g),r$n?(A(),Promise.resolve()):A(new Error("WebAssembly not supported"))},y$k.prototype.ready=y$k.ready,w$d.prototype.update=function(A,I){return this.inner.update(A,I),this},w$d.prototype.digest=function(A,I=0){return this.outer.update(this.inner.digest()),this.outer.digest(A,I)},y$k.HMAC=w$d;var c$k=Q$d.exports;Q$d.exports.HMAC;Q$d.exports.WASM;Q$d.exports.WASM_SUPPORTED;Q$d.exports.ready;

/**
 * Bundled by jsDelivr using Rollup v2.79.1 and Terser v5.19.2.
 * Original file: /npm/sha512-universal@1.2.1/index.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
var h$h={exports:{}};const e$i=r$o,r$m=L$b;var n$o=a$f;const o$m=128;var f$h=[1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591];function a$f(){return this instanceof a$f?(this.hh=new Int32Array(8),this.hl=new Int32Array(8),this.buffer=new Uint8Array(128),this.finalised=!1,this.bytesRead=0,this.pos=0,this.hh[0]=1779033703,this.hh[1]=3144134277,this.hh[2]=1013904242,this.hh[3]=2773480762,this.hh[4]=1359893119,this.hh[5]=2600822924,this.hh[6]=528734635,this.hh[7]=1541459225,this.hl[0]=4089235720,this.hl[1]=2227873595,this.hl[2]=4271175723,this.hl[3]=1595750129,this.hl[4]=2917565137,this.hl[5]=725511199,this.hl[6]=4215389547,this.hl[7]=327033209,this):new a$f}function p$g(t,s,i,h){t[s]=i>>24&255,t[s+1]=i>>16&255,t[s+2]=i>>8&255,t[s+3]=255&i,t[s+4]=h>>24&255,t[s+5]=h>>16&255,t[s+6]=h>>8&255,t[s+7]=255&h;}function u$i(t,s,i,h){for(var e,r,n,o,a,p,u,l,d,y,c,b,m,A,g,w,x,v,L,S,R,D,E,U,H,I,M=new Int32Array(16),O=new Int32Array(16),P=t[0],_=t[1],T=t[2],W=t[3],B=t[4],C=t[5],Y=t[6],j=t[7],k=s[0],q=s[1],z=s[2],F=s[3],G=s[4],J=s[5],K=s[6],N=s[7],Q=0;h>=128;){for(L=0;L<16;L++)S=8*L+Q,M[L]=i[S+0]<<24|i[S+1]<<16|i[S+2]<<8|i[S+3],O[L]=i[S+4]<<24|i[S+5]<<16|i[S+6]<<8|i[S+7];for(L=0;L<80;L++)if(e=P,r=_,n=T,o=W,a=B,p=C,u=Y,d=k,y=q,c=z,b=F,m=G,A=J,g=K,E=65535&(D=N),U=D>>>16,H=65535&(R=j),I=R>>>16,E+=65535&(D=(G>>>14|B<<18)^(G>>>18|B<<14)^(B>>>9|G<<23)),U+=D>>>16,H+=65535&(R=(B>>>14|G<<18)^(B>>>18|G<<14)^(G>>>9|B<<23)),I+=R>>>16,E+=65535&(D=G&J^~G&K),U+=D>>>16,H+=65535&(R=B&C^~B&Y),I+=R>>>16,E+=65535&(D=f$h[2*L+1]),U+=D>>>16,H+=65535&(R=f$h[2*L]),I+=R>>>16,R=M[L%16],U+=(D=O[L%16])>>>16,H+=65535&R,I+=R>>>16,H+=(U+=(E+=65535&D)>>>16)>>>16,E=65535&(D=v=65535&E|U<<16),U=D>>>16,H=65535&(R=x=65535&H|(I+=H>>>16)<<16),I=R>>>16,E+=65535&(D=(k>>>28|P<<4)^(P>>>2|k<<30)^(P>>>7|k<<25)),U+=D>>>16,H+=65535&(R=(P>>>28|k<<4)^(k>>>2|P<<30)^(k>>>7|P<<25)),I+=R>>>16,U+=(D=k&q^k&z^q&z)>>>16,H+=65535&(R=P&_^P&T^_&T),I+=R>>>16,l=65535&(H+=(U+=(E+=65535&D)>>>16)>>>16)|(I+=H>>>16)<<16,w=65535&E|U<<16,E=65535&(D=b),U=D>>>16,H=65535&(R=o),I=R>>>16,U+=(D=v)>>>16,H+=65535&(R=x),I+=R>>>16,_=e,T=r,W=n,B=o=65535&(H+=(U+=(E+=65535&D)>>>16)>>>16)|(I+=H>>>16)<<16,C=a,Y=p,j=u,P=l,q=d,z=y,F=c,G=b=65535&E|U<<16,J=m,K=A,N=g,k=w,L%16==15)for(S=0;S<16;S++)R=M[S],E=65535&(D=O[S]),U=D>>>16,H=65535&R,I=R>>>16,R=M[(S+9)%16],E+=65535&(D=O[(S+9)%16]),U+=D>>>16,H+=65535&R,I+=R>>>16,x=M[(S+1)%16],E+=65535&(D=((v=O[(S+1)%16])>>>1|x<<31)^(v>>>8|x<<24)^(v>>>7|x<<25)),U+=D>>>16,H+=65535&(R=(x>>>1|v<<31)^(x>>>8|v<<24)^x>>>7),I+=R>>>16,x=M[(S+14)%16],U+=(D=((v=O[(S+14)%16])>>>19|x<<13)^(x>>>29|v<<3)^(v>>>6|x<<26))>>>16,H+=65535&(R=(x>>>19|v<<13)^(v>>>29|x<<3)^x>>>6),I+=R>>>16,I+=(H+=(U+=(E+=65535&D)>>>16)>>>16)>>>16,M[S]=65535&H|I<<16,O[S]=65535&E|U<<16;E=65535&(D=k),U=D>>>16,H=65535&(R=P),I=R>>>16,R=t[0],U+=(D=s[0])>>>16,H+=65535&R,I+=R>>>16,I+=(H+=(U+=(E+=65535&D)>>>16)>>>16)>>>16,t[0]=P=65535&H|I<<16,s[0]=k=65535&E|U<<16,E=65535&(D=q),U=D>>>16,H=65535&(R=_),I=R>>>16,R=t[1],U+=(D=s[1])>>>16,H+=65535&R,I+=R>>>16,I+=(H+=(U+=(E+=65535&D)>>>16)>>>16)>>>16,t[1]=_=65535&H|I<<16,s[1]=q=65535&E|U<<16,E=65535&(D=z),U=D>>>16,H=65535&(R=T),I=R>>>16,R=t[2],U+=(D=s[2])>>>16,H+=65535&R,I+=R>>>16,I+=(H+=(U+=(E+=65535&D)>>>16)>>>16)>>>16,t[2]=T=65535&H|I<<16,s[2]=z=65535&E|U<<16,E=65535&(D=F),U=D>>>16,H=65535&(R=W),I=R>>>16,R=t[3],U+=(D=s[3])>>>16,H+=65535&R,I+=R>>>16,I+=(H+=(U+=(E+=65535&D)>>>16)>>>16)>>>16,t[3]=W=65535&H|I<<16,s[3]=F=65535&E|U<<16,E=65535&(D=G),U=D>>>16,H=65535&(R=B),I=R>>>16,R=t[4],U+=(D=s[4])>>>16,H+=65535&R,I+=R>>>16,I+=(H+=(U+=(E+=65535&D)>>>16)>>>16)>>>16,t[4]=B=65535&H|I<<16,s[4]=G=65535&E|U<<16,E=65535&(D=J),U=D>>>16,H=65535&(R=C),I=R>>>16,R=t[5],U+=(D=s[5])>>>16,H+=65535&R,I+=R>>>16,I+=(H+=(U+=(E+=65535&D)>>>16)>>>16)>>>16,t[5]=C=65535&H|I<<16,s[5]=J=65535&E|U<<16,E=65535&(D=K),U=D>>>16,H=65535&(R=Y),I=R>>>16,R=t[6],U+=(D=s[6])>>>16,H+=65535&R,I+=R>>>16,I+=(H+=(U+=(E+=65535&D)>>>16)>>>16)>>>16,t[6]=Y=65535&H|I<<16,s[6]=K=65535&E|U<<16,E=65535&(D=N),U=D>>>16,H=65535&(R=j),I=R>>>16,R=t[7],U+=(D=s[7])>>>16,H+=65535&R,I+=R>>>16,I+=(H+=(U+=(E+=65535&D)>>>16)>>>16)>>>16,t[7]=j=65535&H|I<<16,s[7]=N=65535&E|U<<16,Q+=128,h-=128;}}function l$g(t){if(!(this instanceof l$g))return new l$g(t);this.pad=r$m.alloc(128),this.inner=a$f(),this.outer=a$f();const s=r$m.alloc(64);t.byteLength>128&&(a$f().update(t).digest(s),t=s),this.pad.fill(54);for(let s=0;s<t.byteLength;s++)this.pad[s]^=t[s];this.inner.update(this.pad),this.pad.fill(92);for(let s=0;s<t.byteLength;s++)this.pad[s]^=t[s];this.outer.update(this.pad),this.pad.fill(0),s.fill(0);}a$f.prototype.update=function(t,s){e$i(!1===this.finalised,"Hash instance finalised");var[i,h]=function(t,s){var i=r$m.from(t,s);return [i,i.byteLength]}(t,s);this.bytesRead+=h;const n=h+this.pos&-128;this.buffer.set(i.subarray(0,o$m-this.pos),this.pos);const f=this.pos;return (h-=o$m-this.pos)>=0&&(u$i(this.hh,this.hl,this.buffer,128),this.pos=0),h>127&&(u$i(this.hh,this.hl,i.subarray(o$m-f,n-f),n-o$m),h%=128),this.buffer.set(i.subarray(i.byteLength-h)),this.pos=127&this.bytesRead,this.buffer.fill(0,this.pos),this},a$f.prototype.digest=function(t,s=0){if(e$i(!1===this.finalised,"Hash instance finalised"),this.finalised=!0,this.buffer.fill(0,this.pos),this.buffer[this.pos]=128,this.pos>111&&(u$i(this.hh,this.hl,this.buffer,128),this.buffer.fill(0),this.pos=0),p$g(this.buffer,120,this.bytesRead/536870912|0,this.bytesRead<<3),u$i(this.hh,this.hl,this.buffer,128),t instanceof Uint8Array&&t.byteLength>63){for(let i=0;i<8;i++)p$g(t,8*i+s,this.hh[i],this.hl[i]);return t}const i=new Uint8Array(64);for(let t=0;t<8;t++)p$g(i,8*t,this.hh[t],this.hl[t]);return "string"==typeof t?r$m.toString(i,t):i},l$g.prototype.update=function(t,s){return this.inner.update(t,s),this},l$g.prototype.digest=function(t,s=0){return this.outer.update(this.inner.digest()),this.outer.digest(t,s)},a$f.HMAC=l$g;const d$f=c$k;var y$j=n$o;h$h.exports=function(){return new y$j};h$h.exports.ready=function(t){d$f.ready((function(){t();}));};h$h.exports.WASM_SUPPORTED=d$f.SUPPORTED;h$h.exports.WASM_LOADED=!1;h$h.exports.SHA512_BYTES=64,d$f.ready((function(t){t||(h$h.exports.WASM_LOADED=!0,h$h.exports=y$j=d$f);}));var A$c=h$h.exports;

/**
 * Bundled by jsDelivr using Rollup v2.79.1 and Terser v5.19.2.
 * Original file: /npm/blake2b-wasm@2.4.0/index.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
var C$c,g$f,i$j={exports:{}},h$g=(()=>{for(var A=new Uint8Array(128),I=0;I<64;I++)A[I<26?I+65:I<52?I+71:I<62?I-4:4*I-205]=I;return I=>{for(var C=I.length,g=new Uint8Array(3*(C-("="==I[C-1])-("="==I[C-2]))/4|0),i=0,h=0;i<C;){var Q=A[I.charCodeAt(i++)],E=A[I.charCodeAt(i++)],B=A[I.charCodeAt(i++)],o=A[I.charCodeAt(i++)];g[h++]=Q<<2|E>>4,g[h++]=E<<4|B>>2,g[h++]=B<<6|o;}return g}})(),Q$c=(C$c={"wasm-binary:./blake2b.wat"(A,I){I.exports=h$g("AGFzbQEAAAABEANgAn9/AGADf39/AGABfwADBQQAAQICBQUBAQroBwdNBQZtZW1vcnkCAAxibGFrZTJiX2luaXQAAA5ibGFrZTJiX3VwZGF0ZQABDWJsYWtlMmJfZmluYWwAAhBibGFrZTJiX2NvbXByZXNzAAMKvz8EwAIAIABCADcDACAAQgA3AwggAEIANwMQIABCADcDGCAAQgA3AyAgAEIANwMoIABCADcDMCAAQgA3AzggAEIANwNAIABCADcDSCAAQgA3A1AgAEIANwNYIABCADcDYCAAQgA3A2ggAEIANwNwIABCADcDeCAAQoiS853/zPmE6gBBACkDAIU3A4ABIABCu86qptjQ67O7f0EIKQMAhTcDiAEgAEKr8NP0r+68tzxBECkDAIU3A5ABIABC8e30+KWn/aelf0EYKQMAhTcDmAEgAELRhZrv+s+Uh9EAQSApAwCFNwOgASAAQp/Y+dnCkdqCm39BKCkDAIU3A6gBIABC6/qG2r+19sEfQTApAwCFNwOwASAAQvnC+JuRo7Pw2wBBOCkDAIU3A7gBIABCADcDwAEgAEIANwPIASAAQgA3A9ABC20BA38gAEHAAWohAyAAQcgBaiEEIAQpAwCnIQUCQANAIAEgAkYNASAFQYABRgRAIAMgAykDACAFrXw3AwBBACEFIAAQAwsgACAFaiABLQAAOgAAIAVBAWohBSABQQFqIQEMAAsLIAQgBa03AwALYQEDfyAAQcABaiEBIABByAFqIQIgASABKQMAIAIpAwB8NwMAIABCfzcD0AEgAikDAKchAwJAA0AgA0GAAUYNASAAIANqQQA6AAAgA0EBaiEDDAALCyACIAOtNwMAIAAQAwuqOwIgfgl/IABBgAFqISEgAEGIAWohIiAAQZABaiEjIABBmAFqISQgAEGgAWohJSAAQagBaiEmIABBsAFqIScgAEG4AWohKCAhKQMAIQEgIikDACECICMpAwAhAyAkKQMAIQQgJSkDACEFICYpAwAhBiAnKQMAIQcgKCkDACEIQoiS853/zPmE6gAhCUK7zqqm2NDrs7t/IQpCq/DT9K/uvLc8IQtC8e30+KWn/aelfyEMQtGFmu/6z5SH0QAhDUKf2PnZwpHagpt/IQ5C6/qG2r+19sEfIQ9C+cL4m5Gjs/DbACEQIAApAwAhESAAKQMIIRIgACkDECETIAApAxghFCAAKQMgIRUgACkDKCEWIAApAzAhFyAAKQM4IRggACkDQCEZIAApA0ghGiAAKQNQIRsgACkDWCEcIAApA2AhHSAAKQNoIR4gACkDcCEfIAApA3ghICANIAApA8ABhSENIA8gACkD0AGFIQ8gASAFIBF8fCEBIA0gAYVCIIohDSAJIA18IQkgBSAJhUIYiiEFIAEgBSASfHwhASANIAGFQhCKIQ0gCSANfCEJIAUgCYVCP4ohBSACIAYgE3x8IQIgDiAChUIgiiEOIAogDnwhCiAGIAqFQhiKIQYgAiAGIBR8fCECIA4gAoVCEIohDiAKIA58IQogBiAKhUI/iiEGIAMgByAVfHwhAyAPIAOFQiCKIQ8gCyAPfCELIAcgC4VCGIohByADIAcgFnx8IQMgDyADhUIQiiEPIAsgD3whCyAHIAuFQj+KIQcgBCAIIBd8fCEEIBAgBIVCIIohECAMIBB8IQwgCCAMhUIYiiEIIAQgCCAYfHwhBCAQIASFQhCKIRAgDCAQfCEMIAggDIVCP4ohCCABIAYgGXx8IQEgECABhUIgiiEQIAsgEHwhCyAGIAuFQhiKIQYgASAGIBp8fCEBIBAgAYVCEIohECALIBB8IQsgBiALhUI/iiEGIAIgByAbfHwhAiANIAKFQiCKIQ0gDCANfCEMIAcgDIVCGIohByACIAcgHHx8IQIgDSAChUIQiiENIAwgDXwhDCAHIAyFQj+KIQcgAyAIIB18fCEDIA4gA4VCIIohDiAJIA58IQkgCCAJhUIYiiEIIAMgCCAefHwhAyAOIAOFQhCKIQ4gCSAOfCEJIAggCYVCP4ohCCAEIAUgH3x8IQQgDyAEhUIgiiEPIAogD3whCiAFIAqFQhiKIQUgBCAFICB8fCEEIA8gBIVCEIohDyAKIA98IQogBSAKhUI/iiEFIAEgBSAffHwhASANIAGFQiCKIQ0gCSANfCEJIAUgCYVCGIohBSABIAUgG3x8IQEgDSABhUIQiiENIAkgDXwhCSAFIAmFQj+KIQUgAiAGIBV8fCECIA4gAoVCIIohDiAKIA58IQogBiAKhUIYiiEGIAIgBiAZfHwhAiAOIAKFQhCKIQ4gCiAOfCEKIAYgCoVCP4ohBiADIAcgGnx8IQMgDyADhUIgiiEPIAsgD3whCyAHIAuFQhiKIQcgAyAHICB8fCEDIA8gA4VCEIohDyALIA98IQsgByALhUI/iiEHIAQgCCAefHwhBCAQIASFQiCKIRAgDCAQfCEMIAggDIVCGIohCCAEIAggF3x8IQQgECAEhUIQiiEQIAwgEHwhDCAIIAyFQj+KIQggASAGIBJ8fCEBIBAgAYVCIIohECALIBB8IQsgBiALhUIYiiEGIAEgBiAdfHwhASAQIAGFQhCKIRAgCyAQfCELIAYgC4VCP4ohBiACIAcgEXx8IQIgDSAChUIgiiENIAwgDXwhDCAHIAyFQhiKIQcgAiAHIBN8fCECIA0gAoVCEIohDSAMIA18IQwgByAMhUI/iiEHIAMgCCAcfHwhAyAOIAOFQiCKIQ4gCSAOfCEJIAggCYVCGIohCCADIAggGHx8IQMgDiADhUIQiiEOIAkgDnwhCSAIIAmFQj+KIQggBCAFIBZ8fCEEIA8gBIVCIIohDyAKIA98IQogBSAKhUIYiiEFIAQgBSAUfHwhBCAPIASFQhCKIQ8gCiAPfCEKIAUgCoVCP4ohBSABIAUgHHx8IQEgDSABhUIgiiENIAkgDXwhCSAFIAmFQhiKIQUgASAFIBl8fCEBIA0gAYVCEIohDSAJIA18IQkgBSAJhUI/iiEFIAIgBiAdfHwhAiAOIAKFQiCKIQ4gCiAOfCEKIAYgCoVCGIohBiACIAYgEXx8IQIgDiAChUIQiiEOIAogDnwhCiAGIAqFQj+KIQYgAyAHIBZ8fCEDIA8gA4VCIIohDyALIA98IQsgByALhUIYiiEHIAMgByATfHwhAyAPIAOFQhCKIQ8gCyAPfCELIAcgC4VCP4ohByAEIAggIHx8IQQgECAEhUIgiiEQIAwgEHwhDCAIIAyFQhiKIQggBCAIIB58fCEEIBAgBIVCEIohECAMIBB8IQwgCCAMhUI/iiEIIAEgBiAbfHwhASAQIAGFQiCKIRAgCyAQfCELIAYgC4VCGIohBiABIAYgH3x8IQEgECABhUIQiiEQIAsgEHwhCyAGIAuFQj+KIQYgAiAHIBR8fCECIA0gAoVCIIohDSAMIA18IQwgByAMhUIYiiEHIAIgByAXfHwhAiANIAKFQhCKIQ0gDCANfCEMIAcgDIVCP4ohByADIAggGHx8IQMgDiADhUIgiiEOIAkgDnwhCSAIIAmFQhiKIQggAyAIIBJ8fCEDIA4gA4VCEIohDiAJIA58IQkgCCAJhUI/iiEIIAQgBSAafHwhBCAPIASFQiCKIQ8gCiAPfCEKIAUgCoVCGIohBSAEIAUgFXx8IQQgDyAEhUIQiiEPIAogD3whCiAFIAqFQj+KIQUgASAFIBh8fCEBIA0gAYVCIIohDSAJIA18IQkgBSAJhUIYiiEFIAEgBSAafHwhASANIAGFQhCKIQ0gCSANfCEJIAUgCYVCP4ohBSACIAYgFHx8IQIgDiAChUIgiiEOIAogDnwhCiAGIAqFQhiKIQYgAiAGIBJ8fCECIA4gAoVCEIohDiAKIA58IQogBiAKhUI/iiEGIAMgByAefHwhAyAPIAOFQiCKIQ8gCyAPfCELIAcgC4VCGIohByADIAcgHXx8IQMgDyADhUIQiiEPIAsgD3whCyAHIAuFQj+KIQcgBCAIIBx8fCEEIBAgBIVCIIohECAMIBB8IQwgCCAMhUIYiiEIIAQgCCAffHwhBCAQIASFQhCKIRAgDCAQfCEMIAggDIVCP4ohCCABIAYgE3x8IQEgECABhUIgiiEQIAsgEHwhCyAGIAuFQhiKIQYgASAGIBd8fCEBIBAgAYVCEIohECALIBB8IQsgBiALhUI/iiEGIAIgByAWfHwhAiANIAKFQiCKIQ0gDCANfCEMIAcgDIVCGIohByACIAcgG3x8IQIgDSAChUIQiiENIAwgDXwhDCAHIAyFQj+KIQcgAyAIIBV8fCEDIA4gA4VCIIohDiAJIA58IQkgCCAJhUIYiiEIIAMgCCARfHwhAyAOIAOFQhCKIQ4gCSAOfCEJIAggCYVCP4ohCCAEIAUgIHx8IQQgDyAEhUIgiiEPIAogD3whCiAFIAqFQhiKIQUgBCAFIBl8fCEEIA8gBIVCEIohDyAKIA98IQogBSAKhUI/iiEFIAEgBSAafHwhASANIAGFQiCKIQ0gCSANfCEJIAUgCYVCGIohBSABIAUgEXx8IQEgDSABhUIQiiENIAkgDXwhCSAFIAmFQj+KIQUgAiAGIBZ8fCECIA4gAoVCIIohDiAKIA58IQogBiAKhUIYiiEGIAIgBiAYfHwhAiAOIAKFQhCKIQ4gCiAOfCEKIAYgCoVCP4ohBiADIAcgE3x8IQMgDyADhUIgiiEPIAsgD3whCyAHIAuFQhiKIQcgAyAHIBV8fCEDIA8gA4VCEIohDyALIA98IQsgByALhUI/iiEHIAQgCCAbfHwhBCAQIASFQiCKIRAgDCAQfCEMIAggDIVCGIohCCAEIAggIHx8IQQgECAEhUIQiiEQIAwgEHwhDCAIIAyFQj+KIQggASAGIB98fCEBIBAgAYVCIIohECALIBB8IQsgBiALhUIYiiEGIAEgBiASfHwhASAQIAGFQhCKIRAgCyAQfCELIAYgC4VCP4ohBiACIAcgHHx8IQIgDSAChUIgiiENIAwgDXwhDCAHIAyFQhiKIQcgAiAHIB18fCECIA0gAoVCEIohDSAMIA18IQwgByAMhUI/iiEHIAMgCCAXfHwhAyAOIAOFQiCKIQ4gCSAOfCEJIAggCYVCGIohCCADIAggGXx8IQMgDiADhUIQiiEOIAkgDnwhCSAIIAmFQj+KIQggBCAFIBR8fCEEIA8gBIVCIIohDyAKIA98IQogBSAKhUIYiiEFIAQgBSAefHwhBCAPIASFQhCKIQ8gCiAPfCEKIAUgCoVCP4ohBSABIAUgE3x8IQEgDSABhUIgiiENIAkgDXwhCSAFIAmFQhiKIQUgASAFIB18fCEBIA0gAYVCEIohDSAJIA18IQkgBSAJhUI/iiEFIAIgBiAXfHwhAiAOIAKFQiCKIQ4gCiAOfCEKIAYgCoVCGIohBiACIAYgG3x8IQIgDiAChUIQiiEOIAogDnwhCiAGIAqFQj+KIQYgAyAHIBF8fCEDIA8gA4VCIIohDyALIA98IQsgByALhUIYiiEHIAMgByAcfHwhAyAPIAOFQhCKIQ8gCyAPfCELIAcgC4VCP4ohByAEIAggGXx8IQQgECAEhUIgiiEQIAwgEHwhDCAIIAyFQhiKIQggBCAIIBR8fCEEIBAgBIVCEIohECAMIBB8IQwgCCAMhUI/iiEIIAEgBiAVfHwhASAQIAGFQiCKIRAgCyAQfCELIAYgC4VCGIohBiABIAYgHnx8IQEgECABhUIQiiEQIAsgEHwhCyAGIAuFQj+KIQYgAiAHIBh8fCECIA0gAoVCIIohDSAMIA18IQwgByAMhUIYiiEHIAIgByAWfHwhAiANIAKFQhCKIQ0gDCANfCEMIAcgDIVCP4ohByADIAggIHx8IQMgDiADhUIgiiEOIAkgDnwhCSAIIAmFQhiKIQggAyAIIB98fCEDIA4gA4VCEIohDiAJIA58IQkgCCAJhUI/iiEIIAQgBSASfHwhBCAPIASFQiCKIQ8gCiAPfCEKIAUgCoVCGIohBSAEIAUgGnx8IQQgDyAEhUIQiiEPIAogD3whCiAFIAqFQj+KIQUgASAFIB18fCEBIA0gAYVCIIohDSAJIA18IQkgBSAJhUIYiiEFIAEgBSAWfHwhASANIAGFQhCKIQ0gCSANfCEJIAUgCYVCP4ohBSACIAYgEnx8IQIgDiAChUIgiiEOIAogDnwhCiAGIAqFQhiKIQYgAiAGICB8fCECIA4gAoVCEIohDiAKIA58IQogBiAKhUI/iiEGIAMgByAffHwhAyAPIAOFQiCKIQ8gCyAPfCELIAcgC4VCGIohByADIAcgHnx8IQMgDyADhUIQiiEPIAsgD3whCyAHIAuFQj+KIQcgBCAIIBV8fCEEIBAgBIVCIIohECAMIBB8IQwgCCAMhUIYiiEIIAQgCCAbfHwhBCAQIASFQhCKIRAgDCAQfCEMIAggDIVCP4ohCCABIAYgEXx8IQEgECABhUIgiiEQIAsgEHwhCyAGIAuFQhiKIQYgASAGIBh8fCEBIBAgAYVCEIohECALIBB8IQsgBiALhUI/iiEGIAIgByAXfHwhAiANIAKFQiCKIQ0gDCANfCEMIAcgDIVCGIohByACIAcgFHx8IQIgDSAChUIQiiENIAwgDXwhDCAHIAyFQj+KIQcgAyAIIBp8fCEDIA4gA4VCIIohDiAJIA58IQkgCCAJhUIYiiEIIAMgCCATfHwhAyAOIAOFQhCKIQ4gCSAOfCEJIAggCYVCP4ohCCAEIAUgGXx8IQQgDyAEhUIgiiEPIAogD3whCiAFIAqFQhiKIQUgBCAFIBx8fCEEIA8gBIVCEIohDyAKIA98IQogBSAKhUI/iiEFIAEgBSAefHwhASANIAGFQiCKIQ0gCSANfCEJIAUgCYVCGIohBSABIAUgHHx8IQEgDSABhUIQiiENIAkgDXwhCSAFIAmFQj+KIQUgAiAGIBh8fCECIA4gAoVCIIohDiAKIA58IQogBiAKhUIYiiEGIAIgBiAffHwhAiAOIAKFQhCKIQ4gCiAOfCEKIAYgCoVCP4ohBiADIAcgHXx8IQMgDyADhUIgiiEPIAsgD3whCyAHIAuFQhiKIQcgAyAHIBJ8fCEDIA8gA4VCEIohDyALIA98IQsgByALhUI/iiEHIAQgCCAUfHwhBCAQIASFQiCKIRAgDCAQfCEMIAggDIVCGIohCCAEIAggGnx8IQQgECAEhUIQiiEQIAwgEHwhDCAIIAyFQj+KIQggASAGIBZ8fCEBIBAgAYVCIIohECALIBB8IQsgBiALhUIYiiEGIAEgBiARfHwhASAQIAGFQhCKIRAgCyAQfCELIAYgC4VCP4ohBiACIAcgIHx8IQIgDSAChUIgiiENIAwgDXwhDCAHIAyFQhiKIQcgAiAHIBV8fCECIA0gAoVCEIohDSAMIA18IQwgByAMhUI/iiEHIAMgCCAZfHwhAyAOIAOFQiCKIQ4gCSAOfCEJIAggCYVCGIohCCADIAggF3x8IQMgDiADhUIQiiEOIAkgDnwhCSAIIAmFQj+KIQggBCAFIBN8fCEEIA8gBIVCIIohDyAKIA98IQogBSAKhUIYiiEFIAQgBSAbfHwhBCAPIASFQhCKIQ8gCiAPfCEKIAUgCoVCP4ohBSABIAUgF3x8IQEgDSABhUIgiiENIAkgDXwhCSAFIAmFQhiKIQUgASAFICB8fCEBIA0gAYVCEIohDSAJIA18IQkgBSAJhUI/iiEFIAIgBiAffHwhAiAOIAKFQiCKIQ4gCiAOfCEKIAYgCoVCGIohBiACIAYgGnx8IQIgDiAChUIQiiEOIAogDnwhCiAGIAqFQj+KIQYgAyAHIBx8fCEDIA8gA4VCIIohDyALIA98IQsgByALhUIYiiEHIAMgByAUfHwhAyAPIAOFQhCKIQ8gCyAPfCELIAcgC4VCP4ohByAEIAggEXx8IQQgECAEhUIgiiEQIAwgEHwhDCAIIAyFQhiKIQggBCAIIBl8fCEEIBAgBIVCEIohECAMIBB8IQwgCCAMhUI/iiEIIAEgBiAdfHwhASAQIAGFQiCKIRAgCyAQfCELIAYgC4VCGIohBiABIAYgE3x8IQEgECABhUIQiiEQIAsgEHwhCyAGIAuFQj+KIQYgAiAHIB58fCECIA0gAoVCIIohDSAMIA18IQwgByAMhUIYiiEHIAIgByAYfHwhAiANIAKFQhCKIQ0gDCANfCEMIAcgDIVCP4ohByADIAggEnx8IQMgDiADhUIgiiEOIAkgDnwhCSAIIAmFQhiKIQggAyAIIBV8fCEDIA4gA4VCEIohDiAJIA58IQkgCCAJhUI/iiEIIAQgBSAbfHwhBCAPIASFQiCKIQ8gCiAPfCEKIAUgCoVCGIohBSAEIAUgFnx8IQQgDyAEhUIQiiEPIAogD3whCiAFIAqFQj+KIQUgASAFIBt8fCEBIA0gAYVCIIohDSAJIA18IQkgBSAJhUIYiiEFIAEgBSATfHwhASANIAGFQhCKIQ0gCSANfCEJIAUgCYVCP4ohBSACIAYgGXx8IQIgDiAChUIgiiEOIAogDnwhCiAGIAqFQhiKIQYgAiAGIBV8fCECIA4gAoVCEIohDiAKIA58IQogBiAKhUI/iiEGIAMgByAYfHwhAyAPIAOFQiCKIQ8gCyAPfCELIAcgC4VCGIohByADIAcgF3x8IQMgDyADhUIQiiEPIAsgD3whCyAHIAuFQj+KIQcgBCAIIBJ8fCEEIBAgBIVCIIohECAMIBB8IQwgCCAMhUIYiiEIIAQgCCAWfHwhBCAQIASFQhCKIRAgDCAQfCEMIAggDIVCP4ohCCABIAYgIHx8IQEgECABhUIgiiEQIAsgEHwhCyAGIAuFQhiKIQYgASAGIBx8fCEBIBAgAYVCEIohECALIBB8IQsgBiALhUI/iiEGIAIgByAafHwhAiANIAKFQiCKIQ0gDCANfCEMIAcgDIVCGIohByACIAcgH3x8IQIgDSAChUIQiiENIAwgDXwhDCAHIAyFQj+KIQcgAyAIIBR8fCEDIA4gA4VCIIohDiAJIA58IQkgCCAJhUIYiiEIIAMgCCAdfHwhAyAOIAOFQhCKIQ4gCSAOfCEJIAggCYVCP4ohCCAEIAUgHnx8IQQgDyAEhUIgiiEPIAogD3whCiAFIAqFQhiKIQUgBCAFIBF8fCEEIA8gBIVCEIohDyAKIA98IQogBSAKhUI/iiEFIAEgBSARfHwhASANIAGFQiCKIQ0gCSANfCEJIAUgCYVCGIohBSABIAUgEnx8IQEgDSABhUIQiiENIAkgDXwhCSAFIAmFQj+KIQUgAiAGIBN8fCECIA4gAoVCIIohDiAKIA58IQogBiAKhUIYiiEGIAIgBiAUfHwhAiAOIAKFQhCKIQ4gCiAOfCEKIAYgCoVCP4ohBiADIAcgFXx8IQMgDyADhUIgiiEPIAsgD3whCyAHIAuFQhiKIQcgAyAHIBZ8fCEDIA8gA4VCEIohDyALIA98IQsgByALhUI/iiEHIAQgCCAXfHwhBCAQIASFQiCKIRAgDCAQfCEMIAggDIVCGIohCCAEIAggGHx8IQQgECAEhUIQiiEQIAwgEHwhDCAIIAyFQj+KIQggASAGIBl8fCEBIBAgAYVCIIohECALIBB8IQsgBiALhUIYiiEGIAEgBiAafHwhASAQIAGFQhCKIRAgCyAQfCELIAYgC4VCP4ohBiACIAcgG3x8IQIgDSAChUIgiiENIAwgDXwhDCAHIAyFQhiKIQcgAiAHIBx8fCECIA0gAoVCEIohDSAMIA18IQwgByAMhUI/iiEHIAMgCCAdfHwhAyAOIAOFQiCKIQ4gCSAOfCEJIAggCYVCGIohCCADIAggHnx8IQMgDiADhUIQiiEOIAkgDnwhCSAIIAmFQj+KIQggBCAFIB98fCEEIA8gBIVCIIohDyAKIA98IQogBSAKhUIYiiEFIAQgBSAgfHwhBCAPIASFQhCKIQ8gCiAPfCEKIAUgCoVCP4ohBSABIAUgH3x8IQEgDSABhUIgiiENIAkgDXwhCSAFIAmFQhiKIQUgASAFIBt8fCEBIA0gAYVCEIohDSAJIA18IQkgBSAJhUI/iiEFIAIgBiAVfHwhAiAOIAKFQiCKIQ4gCiAOfCEKIAYgCoVCGIohBiACIAYgGXx8IQIgDiAChUIQiiEOIAogDnwhCiAGIAqFQj+KIQYgAyAHIBp8fCEDIA8gA4VCIIohDyALIA98IQsgByALhUIYiiEHIAMgByAgfHwhAyAPIAOFQhCKIQ8gCyAPfCELIAcgC4VCP4ohByAEIAggHnx8IQQgECAEhUIgiiEQIAwgEHwhDCAIIAyFQhiKIQggBCAIIBd8fCEEIBAgBIVCEIohECAMIBB8IQwgCCAMhUI/iiEIIAEgBiASfHwhASAQIAGFQiCKIRAgCyAQfCELIAYgC4VCGIohBiABIAYgHXx8IQEgECABhUIQiiEQIAsgEHwhCyAGIAuFQj+KIQYgAiAHIBF8fCECIA0gAoVCIIohDSAMIA18IQwgByAMhUIYiiEHIAIgByATfHwhAiANIAKFQhCKIQ0gDCANfCEMIAcgDIVCP4ohByADIAggHHx8IQMgDiADhUIgiiEOIAkgDnwhCSAIIAmFQhiKIQggAyAIIBh8fCEDIA4gA4VCEIohDiAJIA58IQkgCCAJhUI/iiEIIAQgBSAWfHwhBCAPIASFQiCKIQ8gCiAPfCEKIAUgCoVCGIohBSAEIAUgFHx8IQQgDyAEhUIQiiEPIAogD3whCiAFIAqFQj+KIQUgISAhKQMAIAEgCYWFNwMAICIgIikDACACIAqFhTcDACAjICMpAwAgAyALhYU3AwAgJCAkKQMAIAQgDIWFNwMAICUgJSkDACAFIA2FhTcDACAmICYpAwAgBiAOhYU3AwAgJyAnKQMAIAcgD4WFNwMAICggKCkDACAIIBCFhTcDAAs=");}},function(){return g$f||(0, C$c[Object.keys(C$c)[0]])((g$f={exports:{}}).exports,g$f),g$f.exports})(),E$f=WebAssembly.compile(Q$c),B$e=r$s,o$l=L$b,D$b=null,f$g="undefined"!=typeof WebAssembly&&(async A=>(await WebAssembly.instantiate(await E$f,A)).exports)().then((A=>{D$b=A;})),t$k=64,e$h=[];i$j.exports=s$l;var y$i=i$j.exports.BYTES_MIN=16,w$c=i$j.exports.BYTES_MAX=64;i$j.exports.BYTES=32;var K$a=i$j.exports.KEYBYTES_MIN=16,F$a=i$j.exports.KEYBYTES_MAX=64;i$j.exports.KEYBYTES=32;var U$b=i$j.exports.SALTBYTES=16,S$c=i$j.exports.PERSONALBYTES=16;function s$l(A,I,C,g,i){if(!(this instanceof s$l))return new s$l(A,I,C,g,i);if(!D$b)throw new Error("WASM not loaded. Wait for Blake2b.ready(cb)");A||(A=32),!0!==i&&(B$e(A>=y$i,"digestLength must be at least "+y$i+", was given "+A),B$e(A<=w$c,"digestLength must be at most "+w$c+", was given "+A),null!=I&&(B$e(I instanceof Uint8Array,"key must be Uint8Array or Buffer"),B$e(I.length>=K$a,"key must be at least "+K$a+", was given "+I.length),B$e(I.length<=F$a,"key must be at least "+F$a+", was given "+I.length)),null!=C&&(B$e(C instanceof Uint8Array,"salt must be Uint8Array or Buffer"),B$e(C.length===U$b,"salt must be exactly "+U$b+", was given "+C.length)),null!=g&&(B$e(g instanceof Uint8Array,"personal must be Uint8Array or Buffer"),B$e(g.length===S$c,"personal must be exactly "+S$c+", was given "+g.length))),e$h.length||(e$h.push(t$k),t$k+=216),this.digestLength=A,this.finalized=!1,this.pointer=e$h.pop(),this._memory=new Uint8Array(D$b.memory.buffer),this._memory.fill(0,0,64),this._memory[0]=this.digestLength,this._memory[1]=I?I.length:0,this._memory[2]=1,this._memory[3]=1,C&&this._memory.set(C,32),g&&this._memory.set(g,48),this.pointer+216>this._memory.length&&this._realloc(this.pointer+216),D$b.blake2b_init(this.pointer,this.digestLength),I&&(this.update(I),this._memory.fill(0,t$k,t$k+I.length),this._memory[this.pointer+200]=128);}function n$n(){}s$l.prototype._realloc=function(A){D$b.memory.grow(Math.max(0,Math.ceil(Math.abs(A-this._memory.length)/65536))),this._memory=new Uint8Array(D$b.memory.buffer);},s$l.prototype.update=function(A){return B$e(!1===this.finalized,"Hash instance finalized"),B$e(A instanceof Uint8Array,"input must be Uint8Array or Buffer"),t$k+A.length>this._memory.length&&this._realloc(t$k+A.length),this._memory.set(A,t$k),D$b.blake2b_update(this.pointer,t$k,t$k+A.length),this},s$l.prototype.digest=function(A){if(B$e(!1===this.finalized,"Hash instance finalized"),this.finalized=!0,e$h.push(this.pointer),D$b.blake2b_final(this.pointer),!A||"binary"===A)return this._memory.slice(this.pointer+128,this.pointer+128+this.digestLength);if("string"==typeof A)return o$l.toString(this._memory,A,this.pointer+128,this.pointer+128+this.digestLength);B$e(A instanceof Uint8Array&&A.length>=this.digestLength,"input must be Uint8Array or Buffer");for(var I=0;I<this.digestLength;I++)A[I]=this._memory[this.pointer+128+I];return A},s$l.prototype.final=s$l.prototype.digest,s$l.WASM=D$b,s$l.SUPPORTED="undefined"!=typeof WebAssembly,s$l.ready=function(A){return A||(A=n$n),f$g?f$g.then((()=>A()),A):A(new Error("WebAssembly not supported"))},s$l.prototype.ready=s$l.ready,s$l.prototype.getPartialHash=function(){return this._memory.slice(this.pointer,this.pointer+216)},s$l.prototype.setPartialHash=function(A){this._memory.set(A,this.pointer);};var r$l=i$j.exports;i$j.exports.SUPPORTED;i$j.exports.WASM;i$j.exports.ready;

/**
 * Bundled by jsDelivr using Rollup v2.79.1 and Terser v5.19.2.
 * Original file: /npm/blake2b@2.1.4/index.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
var n$m={exports:{}},e$g=r$s,o$k=r$l;function a$e(t,r,n){var e=t[r]+t[n],o=t[r+1]+t[n+1];e>=4294967296&&o++,t[r]=e,t[r+1]=o;}function s$k(t,r,n,e){var o=t[r]+n;n<0&&(o+=4294967296);var a=t[r+1]+e;o>=4294967296&&a++,t[r]=o,t[r+1]=a;}function i$i(t,r){return t[r]^t[r+1]<<8^t[r+2]<<16^t[r+3]<<24}function u$h(t,r,n,e,o,i){var u=h$f[o],f=h$f[o+1],l=h$f[i],p=h$f[i+1];a$e(c$j,t,r),s$k(c$j,t,u,f);var y=c$j[e]^c$j[t],A=c$j[e+1]^c$j[t+1];c$j[e]=A,c$j[e+1]=y,a$e(c$j,n,e),y=c$j[r]^c$j[n],A=c$j[r+1]^c$j[n+1],c$j[r]=y>>>24^A<<8,c$j[r+1]=A>>>24^y<<8,a$e(c$j,t,r),s$k(c$j,t,l,p),y=c$j[e]^c$j[t],A=c$j[e+1]^c$j[t+1],c$j[e]=y>>>16^A<<16,c$j[e+1]=A>>>16^y<<16,a$e(c$j,n,e),y=c$j[r]^c$j[n],A=c$j[r+1]^c$j[n+1],c$j[r]=A>>>31^y<<1,c$j[r+1]=y>>>31^A<<1;}var f$f=new Uint32Array([4089235720,1779033703,2227873595,3144134277,4271175723,1013904242,1595750129,2773480762,2917565137,1359893119,725511199,2600822924,4215389547,528734635,327033209,1541459225]),l$f=new Uint8Array([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3].map((function(t){return 2*t}))),c$j=new Uint32Array(32),h$f=new Uint32Array(32);function p$f(t,r){var n=0;for(n=0;n<16;n++)c$j[n]=t.h[n],c$j[n+16]=f$f[n];for(c$j[24]=c$j[24]^t.t,c$j[25]=c$j[25]^t.t/4294967296,r&&(c$j[28]=~c$j[28],c$j[29]=~c$j[29]),n=0;n<32;n++)h$f[n]=i$i(t.b,4*n);for(n=0;n<12;n++)u$h(0,8,16,24,l$f[16*n+0],l$f[16*n+1]),u$h(2,10,18,26,l$f[16*n+2],l$f[16*n+3]),u$h(4,12,20,28,l$f[16*n+4],l$f[16*n+5]),u$h(6,14,22,30,l$f[16*n+6],l$f[16*n+7]),u$h(0,10,20,30,l$f[16*n+8],l$f[16*n+9]),u$h(2,12,22,24,l$f[16*n+10],l$f[16*n+11]),u$h(4,14,16,26,l$f[16*n+12],l$f[16*n+13]),u$h(6,8,18,28,l$f[16*n+14],l$f[16*n+15]);for(n=0;n<16;n++)t.h[n]=t.h[n]^c$j[n]^c$j[n+16];}var y$h=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]);function A$b(t,r,n,e){y$h.fill(0),this.b=new Uint8Array(128),this.h=new Uint32Array(16),this.t=0,this.c=0,this.outlen=t,y$h[0]=t,r&&(y$h[1]=r.length),y$h[2]=1,y$h[3]=1,n&&y$h.set(n,32),e&&y$h.set(e,48);for(var o=0;o<16;o++)this.h[o]=f$f[o]^i$i(y$h,4*o);r&&(v$a(this,r),this.c=128);}function v$a(t,r){for(var n=0;n<r.length;n++)128===t.c&&(t.t+=t.c,p$f(t,!1),t.c=0),t.b[t.c++]=r[n];}function m$d(t){return t<16?"0"+t.toString(16):t.toString(16)}A$b.prototype.update=function(t){return e$g(t instanceof Uint8Array,"input must be Uint8Array or Buffer"),v$a(this,t),this},A$b.prototype.digest=function(t){var r=t&&"binary"!==t&&"hex"!==t?t:new Uint8Array(this.outlen);return e$g(r instanceof Uint8Array,'out must be "binary", "hex", Uint8Array, or Buffer'),e$g(r.length>=this.outlen,"out must have at least outlen bytes of space"),function(t,r){t.t+=t.c;for(;t.c<128;)t.b[t.c++]=0;p$f(t,!0);for(var n=0;n<t.outlen;n++)r[n]=t.h[n>>2]>>8*(3&n);}(this,r),"hex"===t?function(t){for(var r="",n=0;n<t.length;n++)r+=m$d(t[n]);return r}(r):r},A$b.prototype.final=A$b.prototype.digest,A$b.ready=function(t){o$k.ready((function(){t();}));};var g$e=A$b;n$m.exports=function(t,r,n,o,a){return !0!==a&&(e$g(t>=S$b,"outlen must be at least "+S$b+", was given "+t),e$g(t<=w$b,"outlen must be at most "+w$b+", was given "+t),null!=r&&(e$g(r instanceof Uint8Array,"key must be Uint8Array or Buffer"),e$g(r.length>=E$e,"key must be at least "+E$e+", was given "+r.length),e$g(r.length<=B$d,"key must be at most "+B$d+", was given "+r.length)),null!=n&&(e$g(n instanceof Uint8Array,"salt must be Uint8Array or Buffer"),e$g(n.length===T$a,"salt must be exactly "+T$a+", was given "+n.length)),null!=o&&(e$g(o instanceof Uint8Array,"personal must be Uint8Array or Buffer"),e$g(o.length===Y$a,"personal must be exactly "+Y$a+", was given "+o.length))),new g$e(t,r,n,o)};n$m.exports.ready=function(t){o$k.ready((function(){t();}));};n$m.exports.WASM_SUPPORTED=o$k.SUPPORTED;n$m.exports.WASM_LOADED=!1;var S$b=n$m.exports.BYTES_MIN=16,w$b=n$m.exports.BYTES_MAX=64;n$m.exports.BYTES=32;var E$e=n$m.exports.KEYBYTES_MIN=16,B$d=n$m.exports.KEYBYTES_MAX=64;n$m.exports.KEYBYTES=32;var T$a=n$m.exports.SALTBYTES=16,Y$a=n$m.exports.PERSONALBYTES=16;o$k.ready((function(t){t||(n$m.exports.WASM_LOADED=!0,n$m.exports=o$k);}));var d$e=n$m.exports;

/**
 * Bundled by jsDelivr using Rollup v2.79.1 and Terser v5.19.2.
 * Original file: /npm/xsalsa20@1.2.0/index.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
var A$a,I$b,E$d,B$c=(()=>{for(var A=new Uint8Array(128),I=0;I<64;I++)A[I<26?I+65:I<52?I+71:I<62?I-4:4*I-205]=I;return I=>{for(var E=I.length,B=new Uint8Array(3*(E-("="==I[E-1])-("="==I[E-2]))/4|0),g=0,Q=0;g<E;){var o=A[I.charCodeAt(g++)],i=A[I.charCodeAt(g++)],t=A[I.charCodeAt(g++)],C=A[I.charCodeAt(g++)];B[Q++]=o<<2|i>>4,B[Q++]=i<<4|t>>2,B[Q++]=t<<6|C;}return B}})(),g$d=(A$a={"wasm-binary:./xsalsa20.wat"(A,I){I.exports=B$c("AGFzbQEAAAABGgNgBn9/f39/fwBgBn9/f39+fwF+YAN/f38AAwcGAAEBAgICBQUBAQroBwcoAwZtZW1vcnkCAAx4c2Fsc2EyMF94b3IAAAxjb3JlX3NhbHNhMjAABArqEQYYACAAIAEgAiADIAQgACkDACAFEAE3AwALPQBB8AAgAyAFEAMgACABIAIgA0EQaiAEQfAAEAJB8ABCADcDAEH4AEIANwMAQYABQgA3AwBBiAFCADcDAAuHBQEBfyACQQBGBEBCAA8LQdAAIAUpAwA3AwBB2AAgBUEIaikDADcDAEHgACAFQRBqKQMANwMAQegAIAVBGGopAwA3AwBBACADKQMANwMAQQggBDcDAAJAA0AgAkHAAEkNAUEQQQBB0AAQBSAAIAEpAwBBECkDAIU3AwAgAEEIaiABQQhqKQMAQRgpAwCFNwMAIABBEGogAUEQaikDAEEgKQMAhTcDACAAQRhqIAFBGGopAwBBKCkDAIU3AwAgAEEgaiABQSBqKQMAQTApAwCFNwMAIABBKGogAUEoaikDAEE4KQMAhTcDACAAQTBqIAFBMGopAwBBwAApAwCFNwMAIABBOGogAUE4aikDAEHIACkDAIU3AwBBCEEIKQMAQgF8NwMAIABBwABqIQAgAUHAAGohASACQcAAayECDAALC0EIKQMAIQQgAkEASwRAQRBBAEHQABAFAkACQAJAAkACQAJAAkACQCACQQhuDgcHBgUEAwIBAAsgAEE4aiABQThqKQMAQcgAKQMAhTcDAAsgAEEwaiABQTBqKQMAQcAAKQMAhTcDAAsgAEEoaiABQShqKQMAQTgpAwCFNwMACyAAQSBqIAFBIGopAwBBMCkDAIU3AwALIABBGGogAUEYaikDAEEoKQMAhTcDAAsgAEEQaiABQRBqKQMAQSApAwCFNwMACyAAQQhqIAFBCGopAwBBGCkDAIU3AwALIAAgASkDAEEQKQMAhTcDAAtBEEIANwMAQRhCADcDAEEgQgA3AwBBKEIANwMAQTBCADcDAEE4QgA3AwBBwABCADcDAEHIAEIANwMAQdAAQgA3AwBB2ABCADcDAEHgAEIANwMAQegAQgA3AwAgBA8LnQUBEX9B5fDBiwYhA0HuyIGZAyEIQbLaiMsHIQ1B9MqB2QYhEiACKAIAIQQgAkEEaigCACEFIAJBCGooAgAhBiACQQxqKAIAIQcgAkEQaigCACEOIAJBFGooAgAhDyACQRhqKAIAIRAgAkEcaigCACERIAEoAgAhCSABQQRqKAIAIQogAUEIaigCACELIAFBDGooAgAhDEEUIRMCQANAIBNBAEYNASAHIAMgD2pBB3dzIQcgCyAHIANqQQl3cyELIA8gCyAHakENd3MhDyADIA8gC2pBEndzIQMgDCAIIARqQQd3cyEMIBAgDCAIakEJd3MhECAEIBAgDGpBDXdzIQQgCCAEIBBqQRJ3cyEIIBEgDSAJakEHd3MhESAFIBEgDWpBCXdzIQUgCSAFIBFqQQ13cyEJIA0gCSAFakESd3MhDSAGIBIgDmpBB3dzIQYgCiAGIBJqQQl3cyEKIA4gCiAGakENd3MhDiASIA4gCmpBEndzIRIgBCADIAZqQQd3cyEEIAUgBCADakEJd3MhBSAGIAUgBGpBDXdzIQYgAyAGIAVqQRJ3cyEDIAkgCCAHakEHd3MhCSAKIAkgCGpBCXdzIQogByAKIAlqQQ13cyEHIAggByAKakESd3MhCCAOIA0gDGpBB3dzIQ4gCyAOIA1qQQl3cyELIAwgCyAOakENd3MhDCANIAwgC2pBEndzIQ0gDyASIBFqQQd3cyEPIBAgDyASakEJd3MhECARIBAgD2pBDXdzIREgEiARIBBqQRJ3cyESIBNBAmshEwwACwsgACADNgIAIABBBGogCDYCACAAQQhqIA02AgAgAEEMaiASNgIAIABBEGogCTYCACAAQRRqIAo2AgAgAEEYaiALNgIAIABBHGogDDYCAAsKACAAIAEgAhAFC90GASF/QeXwwYsGIQNB7siBmQMhCEGy2ojLByENQfTKgdkGIRIgAigCACEEIAJBBGooAgAhBSACQQhqKAIAIQYgAkEMaigCACEHIAJBEGooAgAhDiACQRRqKAIAIQ8gAkEYaigCACEQIAJBHGooAgAhESABKAIAIQkgAUEEaigCACEKIAFBCGooAgAhCyABQQxqKAIAIQwgAyETIAQhFCAFIRUgBiEWIAchFyAIIRggCSEZIAohGiALIRsgDCEcIA0hHSAOIR4gDyEfIBAhICARISEgEiEiQRQhIwJAA0AgI0EARg0BIAcgAyAPakEHd3MhByALIAcgA2pBCXdzIQsgDyALIAdqQQ13cyEPIAMgDyALakESd3MhAyAMIAggBGpBB3dzIQwgECAMIAhqQQl3cyEQIAQgECAMakENd3MhBCAIIAQgEGpBEndzIQggESANIAlqQQd3cyERIAUgESANakEJd3MhBSAJIAUgEWpBDXdzIQkgDSAJIAVqQRJ3cyENIAYgEiAOakEHd3MhBiAKIAYgEmpBCXdzIQogDiAKIAZqQQ13cyEOIBIgDiAKakESd3MhEiAEIAMgBmpBB3dzIQQgBSAEIANqQQl3cyEFIAYgBSAEakENd3MhBiADIAYgBWpBEndzIQMgCSAIIAdqQQd3cyEJIAogCSAIakEJd3MhCiAHIAogCWpBDXdzIQcgCCAHIApqQRJ3cyEIIA4gDSAMakEHd3MhDiALIA4gDWpBCXdzIQsgDCALIA5qQQ13cyEMIA0gDCALakESd3MhDSAPIBIgEWpBB3dzIQ8gECAPIBJqQQl3cyEQIBEgECAPakENd3MhESASIBEgEGpBEndzIRIgI0ECayEjDAALCyAAIAMgE2o2AgAgAEEEaiAEIBRqNgIAIABBCGogBSAVajYCACAAQQxqIAYgFmo2AgAgAEEQaiAHIBdqNgIAIABBFGogCCAYajYCACAAQRhqIAkgGWo2AgAgAEEcaiAKIBpqNgIAIABBIGogCyAbajYCACAAQSRqIAwgHGo2AgAgAEEoaiANIB1qNgIAIABBLGogDiAeajYCACAAQTBqIA8gH2o2AgAgAEE0aiAQICBqNgIAIABBOGogESAhajYCACAAQTxqIBIgImo2AgAL");}},function(){return I$b||(0, A$a[Object.keys(A$a)[0]])((I$b={exports:{}}).exports,I$b),I$b.exports})(),Q$b=new WebAssembly.Module(g$d),o$j="undefined"!=typeof WebAssembly&&new WebAssembly.Instance(Q$b,E$d).exports,i$h=new Uint8Array([101,120,112,97,110,100,32,51,50,45,98,121,116,101,32,107]),t$j=144,C$b=t$j,e$f=[],h$e=r$k;function r$k(A,I){if(!(this instanceof r$k))return new r$k(A,I);if(!A||A.length<24)throw new Error("nonce must be at least 24 bytes");if(!I||I.length<32)throw new Error("key must be at least 32 bytes");this._xor=o$j?new a$d(A,I):new n$l(A,I);}function a$d(A,I){e$f.length||(e$f.push(t$j),t$j+=64),this._pointer=e$f.pop(),this._nonce=this._pointer+8,this._key=this._nonce+24,this._overflow=0,this._memory=new Uint8Array(o$j.memory.buffer),this._memory.fill(0,this._pointer,this._pointer+8),this._memory.set(A,this._nonce),this._memory.set(I,this._key);}function n$l(A,I){this._s=new Uint8Array(32),this._z=new Uint8Array(16),this._overflow=0,y$g(this._s,A,I,i$h);for(var E=0;E<8;E++)this._z[E]=A[E+16];}function s$j(A,I,E,B){for(var g,Q=255&B[0]|(255&B[1])<<8|(255&B[2])<<16|(255&B[3])<<24,o=255&E[0]|(255&E[1])<<8|(255&E[2])<<16|(255&E[3])<<24,i=255&E[4]|(255&E[5])<<8|(255&E[6])<<16|(255&E[7])<<24,t=255&E[8]|(255&E[9])<<8|(255&E[10])<<16|(255&E[11])<<24,C=255&E[12]|(255&E[13])<<8|(255&E[14])<<16|(255&E[15])<<24,e=255&B[4]|(255&B[5])<<8|(255&B[6])<<16|(255&B[7])<<24,h=255&I[0]|(255&I[1])<<8|(255&I[2])<<16|(255&I[3])<<24,r=255&I[4]|(255&I[5])<<8|(255&I[6])<<16|(255&I[7])<<24,a=255&I[8]|(255&I[9])<<8|(255&I[10])<<16|(255&I[11])<<24,n=255&I[12]|(255&I[13])<<8|(255&I[14])<<16|(255&I[15])<<24,s=255&B[8]|(255&B[9])<<8|(255&B[10])<<16|(255&B[11])<<24,y=255&E[16]|(255&E[17])<<8|(255&E[18])<<16|(255&E[19])<<24,w=255&E[20]|(255&E[21])<<8|(255&E[22])<<16|(255&E[23])<<24,D=255&E[24]|(255&E[25])<<8|(255&E[26])<<16|(255&E[27])<<24,c=255&E[28]|(255&E[29])<<8|(255&E[30])<<16|(255&E[31])<<24,M=255&B[12]|(255&B[13])<<8|(255&B[14])<<16|(255&B[15])<<24,p=Q,f=o,d=i,l=t,k=C,G=e,q=h,S=r,_=a,N=n,m=s,u=y,K=w,R=D,F=c,U=M,H=0;H<20;H+=2)p^=(g=(K^=(g=(_^=(g=(k^=(g=p+K|0)<<7|g>>>25)+p|0)<<9|g>>>23)+k|0)<<13|g>>>19)+_|0)<<18|g>>>14,G^=(g=(f^=(g=(R^=(g=(N^=(g=G+f|0)<<7|g>>>25)+G|0)<<9|g>>>23)+N|0)<<13|g>>>19)+R|0)<<18|g>>>14,m^=(g=(q^=(g=(d^=(g=(F^=(g=m+q|0)<<7|g>>>25)+m|0)<<9|g>>>23)+F|0)<<13|g>>>19)+d|0)<<18|g>>>14,U^=(g=(u^=(g=(S^=(g=(l^=(g=U+u|0)<<7|g>>>25)+U|0)<<9|g>>>23)+l|0)<<13|g>>>19)+S|0)<<18|g>>>14,p^=(g=(l^=(g=(d^=(g=(f^=(g=p+l|0)<<7|g>>>25)+p|0)<<9|g>>>23)+f|0)<<13|g>>>19)+d|0)<<18|g>>>14,G^=(g=(k^=(g=(S^=(g=(q^=(g=G+k|0)<<7|g>>>25)+G|0)<<9|g>>>23)+q|0)<<13|g>>>19)+S|0)<<18|g>>>14,m^=(g=(N^=(g=(_^=(g=(u^=(g=m+N|0)<<7|g>>>25)+m|0)<<9|g>>>23)+u|0)<<13|g>>>19)+_|0)<<18|g>>>14,U^=(g=(F^=(g=(R^=(g=(K^=(g=U+F|0)<<7|g>>>25)+U|0)<<9|g>>>23)+K|0)<<13|g>>>19)+R|0)<<18|g>>>14;p=p+Q|0,f=f+o|0,d=d+i|0,l=l+t|0,k=k+C|0,G=G+e|0,q=q+h|0,S=S+r|0,_=_+a|0,N=N+n|0,m=m+s|0,u=u+y|0,K=K+w|0,R=R+D|0,F=F+c|0,U=U+M|0,A[0]=p>>>0&255,A[1]=p>>>8&255,A[2]=p>>>16&255,A[3]=p>>>24&255,A[4]=f>>>0&255,A[5]=f>>>8&255,A[6]=f>>>16&255,A[7]=f>>>24&255,A[8]=d>>>0&255,A[9]=d>>>8&255,A[10]=d>>>16&255,A[11]=d>>>24&255,A[12]=l>>>0&255,A[13]=l>>>8&255,A[14]=l>>>16&255,A[15]=l>>>24&255,A[16]=k>>>0&255,A[17]=k>>>8&255,A[18]=k>>>16&255,A[19]=k>>>24&255,A[20]=G>>>0&255,A[21]=G>>>8&255,A[22]=G>>>16&255,A[23]=G>>>24&255,A[24]=q>>>0&255,A[25]=q>>>8&255,A[26]=q>>>16&255,A[27]=q>>>24&255,A[28]=S>>>0&255,A[29]=S>>>8&255,A[30]=S>>>16&255,A[31]=S>>>24&255,A[32]=_>>>0&255,A[33]=_>>>8&255,A[34]=_>>>16&255,A[35]=_>>>24&255,A[36]=N>>>0&255,A[37]=N>>>8&255,A[38]=N>>>16&255,A[39]=N>>>24&255,A[40]=m>>>0&255,A[41]=m>>>8&255,A[42]=m>>>16&255,A[43]=m>>>24&255,A[44]=u>>>0&255,A[45]=u>>>8&255,A[46]=u>>>16&255,A[47]=u>>>24&255,A[48]=K>>>0&255,A[49]=K>>>8&255,A[50]=K>>>16&255,A[51]=K>>>24&255,A[52]=R>>>0&255,A[53]=R>>>8&255,A[54]=R>>>16&255,A[55]=R>>>24&255,A[56]=F>>>0&255,A[57]=F>>>8&255,A[58]=F>>>16&255,A[59]=F>>>24&255,A[60]=U>>>0&255,A[61]=U>>>8&255,A[62]=U>>>16&255,A[63]=U>>>24&255;}function y$g(A,I,E,B){for(var g,Q=255&B[0]|(255&B[1])<<8|(255&B[2])<<16|(255&B[3])<<24,o=255&E[0]|(255&E[1])<<8|(255&E[2])<<16|(255&E[3])<<24,i=255&E[4]|(255&E[5])<<8|(255&E[6])<<16|(255&E[7])<<24,t=255&E[8]|(255&E[9])<<8|(255&E[10])<<16|(255&E[11])<<24,C=255&E[12]|(255&E[13])<<8|(255&E[14])<<16|(255&E[15])<<24,e=255&B[4]|(255&B[5])<<8|(255&B[6])<<16|(255&B[7])<<24,h=255&I[0]|(255&I[1])<<8|(255&I[2])<<16|(255&I[3])<<24,r=255&I[4]|(255&I[5])<<8|(255&I[6])<<16|(255&I[7])<<24,a=255&I[8]|(255&I[9])<<8|(255&I[10])<<16|(255&I[11])<<24,n=255&I[12]|(255&I[13])<<8|(255&I[14])<<16|(255&I[15])<<24,s=255&B[8]|(255&B[9])<<8|(255&B[10])<<16|(255&B[11])<<24,y=255&E[16]|(255&E[17])<<8|(255&E[18])<<16|(255&E[19])<<24,w=255&E[20]|(255&E[21])<<8|(255&E[22])<<16|(255&E[23])<<24,D=255&E[24]|(255&E[25])<<8|(255&E[26])<<16|(255&E[27])<<24,c=255&E[28]|(255&E[29])<<8|(255&E[30])<<16|(255&E[31])<<24,M=255&B[12]|(255&B[13])<<8|(255&B[14])<<16|(255&B[15])<<24,p=0;p<20;p+=2)Q^=(g=(w^=(g=(a^=(g=(C^=(g=Q+w|0)<<7|g>>>25)+Q|0)<<9|g>>>23)+C|0)<<13|g>>>19)+a|0)<<18|g>>>14,e^=(g=(o^=(g=(D^=(g=(n^=(g=e+o|0)<<7|g>>>25)+e|0)<<9|g>>>23)+n|0)<<13|g>>>19)+D|0)<<18|g>>>14,s^=(g=(h^=(g=(i^=(g=(c^=(g=s+h|0)<<7|g>>>25)+s|0)<<9|g>>>23)+c|0)<<13|g>>>19)+i|0)<<18|g>>>14,M^=(g=(y^=(g=(r^=(g=(t^=(g=M+y|0)<<7|g>>>25)+M|0)<<9|g>>>23)+t|0)<<13|g>>>19)+r|0)<<18|g>>>14,Q^=(g=(t^=(g=(i^=(g=(o^=(g=Q+t|0)<<7|g>>>25)+Q|0)<<9|g>>>23)+o|0)<<13|g>>>19)+i|0)<<18|g>>>14,e^=(g=(C^=(g=(r^=(g=(h^=(g=e+C|0)<<7|g>>>25)+e|0)<<9|g>>>23)+h|0)<<13|g>>>19)+r|0)<<18|g>>>14,s^=(g=(n^=(g=(a^=(g=(y^=(g=s+n|0)<<7|g>>>25)+s|0)<<9|g>>>23)+y|0)<<13|g>>>19)+a|0)<<18|g>>>14,M^=(g=(c^=(g=(D^=(g=(w^=(g=M+c|0)<<7|g>>>25)+M|0)<<9|g>>>23)+w|0)<<13|g>>>19)+D|0)<<18|g>>>14;A[0]=Q>>>0&255,A[1]=Q>>>8&255,A[2]=Q>>>16&255,A[3]=Q>>>24&255,A[4]=e>>>0&255,A[5]=e>>>8&255,A[6]=e>>>16&255,A[7]=e>>>24&255,A[8]=s>>>0&255,A[9]=s>>>8&255,A[10]=s>>>16&255,A[11]=s>>>24&255,A[12]=M>>>0&255,A[13]=M>>>8&255,A[14]=M>>>16&255,A[15]=M>>>24&255,A[16]=h>>>0&255,A[17]=h>>>8&255,A[18]=h>>>16&255,A[19]=h>>>24&255,A[20]=r>>>0&255,A[21]=r>>>8&255,A[22]=r>>>16&255,A[23]=r>>>24&255,A[24]=a>>>0&255,A[25]=a>>>8&255,A[26]=a>>>16&255,A[27]=a>>>24&255,A[28]=n>>>0&255,A[29]=n>>>8&255,A[30]=n>>>16&255,A[31]=n>>>24&255;}r$k.NONCEBYTES=24,r$k.KEYBYTES=32,r$k.core_hsalsa20=y$g,r$k.SIGMA=i$h,r$k.prototype.update=function(A,I){if(!A)throw new Error("input must be Uint8Array or Buffer");return I||(I=new Uint8Array(A.length)),A.length&&this._xor.update(A,I),I},r$k.prototype.final=r$k.prototype.finalize=function(){this._xor.finalize(),this._xor=null;},a$d.prototype.realloc=function(A){o$j.memory.grow(Math.ceil(Math.abs(A-this._memory.length)/65536)),this._memory=new Uint8Array(o$j.memory.buffer);},a$d.prototype.update=function(A,I){var E=this._overflow+A.length,B=t$j+this._overflow;(C$b=t$j+E)>=this._memory.length&&this.realloc(C$b),this._memory.set(A,B),o$j.xsalsa20_xor(this._pointer,t$j,t$j,E,this._nonce,this._key),I.set(this._memory.subarray(B,t$j+E)),this._overflow=63&E;},a$d.prototype.finalize=function(){this._memory.fill(0,this._pointer,this._key+32),C$b>t$j&&(this._memory.fill(0,t$j,C$b),C$b=0),e$f.push(this._pointer);},n$l.prototype.update=function(A,I){for(var E=new Uint8Array(64),B=0,g=this._overflow,Q=A.length+this._overflow,o=this._z,t=-this._overflow,C=-this._overflow;Q>=64;){for(s$j(E,o,this._s,i$h);g<64;g++)I[C+g]=A[t+g]^E[g];for(B=1,g=8;g<16;g++)B+=255&o[g]|0,o[g]=255&B,B>>>=8;Q-=64,C+=64,t+=64,g=0;}if(Q>0)for(s$j(E,o,this._s,i$h);g<Q;g++)I[C+g]=A[t+g]^E[g];this._overflow=63&Q;},n$l.prototype.finalize=function(){this._s.fill(0),this._z.fill(0);};

/**
 * Bundled by jsDelivr using Rollup v2.79.1 and Terser v5.19.2.
 * Original file: /npm/sha256-wasm@2.2.2/index.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
var g$c,i$g,t$i={exports:{}},Q$a=(()=>{for(var A=new Uint8Array(128),I=0;I<64;I++)A[I<26?I+65:I<52?I+71:I<62?I-4:4*I-205]=I;return I=>{for(var g=I.length,i=new Uint8Array(3*(g-("="==I[g-1])-("="==I[g-2]))/4|0),t=0,Q=0;t<g;){var B=A[I.charCodeAt(t++)],C=A[I.charCodeAt(t++)],E=A[I.charCodeAt(t++)],e=A[I.charCodeAt(t++)];i[Q++]=B<<2|C>>4,i[Q++]=C<<4|E>>2,i[Q++]=E<<6|e;}return i}})(),B$b=(g$c={"wasm-binary:./sha256.wat"(A,I){I.exports=Q$a("AGFzbQEAAAABNAVgAX8Bf2AIf39/f39/f38AYAR/f39/AX9gEX9/f39/f39/f39/f39/f39/AGAEf39/fwADBgUAAQIDBAUDAQABBikIfwFBAAt/AUEAC38BQQALfwFBAAt/AUEAC38BQQALfwFBAAt/AUEACwcTAgZtZW1vcnkCAAZzaGEyNTYABAreFwUZACAAQf+B/AdxQQh4IABBgP6DeHFBCHdyC7wDAQZ/IwQjBXEjBEF/cyMGcXMhCiMAIwFxIwAjAnFzIwEjAnFzIQsjAEECeCMAQQ14cyMAQRZ4cyEMIwRBBngjBEELeHMjBEEZeHMhDSMHIApqIA1qIABqIARqIQggDCALaiEJIwMgCGokByAIIAlqJAMjByMEcSMHQX9zIwVxcyEKIwMjAHEjAyMBcXMjACMBcXMhCyMDQQJ4IwNBDXhzIwNBFnhzIQwjB0EGeCMHQQt4cyMHQRl4cyENIwYgCmogDWogAWogBWohCCAMIAtqIQkjAiAIaiQGIAggCWokAiMGIwdxIwZBf3MjBHFzIQojAiMDcSMCIwBxcyMDIwBxcyELIwJBAngjAkENeHMjAkEWeHMhDCMGQQZ4IwZBC3hzIwZBGXhzIQ0jBSAKaiANaiACaiAGaiEIIAwgC2ohCSMBIAhqJAUgCCAJaiQBIwUjBnEjBUF/cyMHcXMhCiMBIwJxIwEjA3FzIwIjA3FzIQsjAUECeCMBQQ14cyMBQRZ4cyEMIwVBBngjBUELeHMjBUEZeHMhDSMEIApqIA1qIANqIAdqIQggDCALaiEJIwAgCGokBCAIIAlqJAALKwAgAEEReCAAQRN4cyAAQQp2cyABaiACQQd4IAJBEnhzIAJBA3ZzIANqagvLCwEwfyAAKAJoRQRAIABB58yn0AY2AgAgAEGF3Z7bezYCBCAAQfLmu+MDNgIIIABBuuq/qno2AgwgAEH/pLmIBTYCECAAQYzRldh5NgIUIABBq7OP/AE2AhggAEGZmoPfBTYCHCAAQQE2AmgLIAAoAgAkACAAKAIEJAEgACgCCCQCIAAoAgwkAyAAKAIQJAQgACgCFCQFIAAoAhgkBiAAKAIcJAcgARAAIQEgAhAAIQIgAxAAIQMgBBAAIQQgBRAAIQUgBhAAIQYgBxAAIQcgCBAAIQggCRAAIQkgChAAIQogCxAAIQsgDBAAIQwgDRAAIQ0gDhAAIQ4gDxAAIQ8gEBAAIRAgASACIAMgBEGY36iUBEGRid2JB0HP94Oue0Glt9fNfhABIAUgBiAHIAhB24TbygNB8aPEzwVBpIX+kXlB1b3x2HoQASAJIAogCyAMQZjVnsB9QYG2jZQBQb6LxqECQcP7sagFEAEgDSAOIA8gEEH0uvmVB0H+4/qGeEGnjfDeeUH04u+MfBABIA8gCiACIAEQAiEBIBAgCyADIAIQAiECIAEgDCAEIAMQAiEDIAIgDSAFIAQQAiEEIAMgDiAGIAUQAiEFIAQgDyAHIAYQAiEGIAUgECAIIAcQAiEHIAYgASAJIAgQAiEIIAcgAiAKIAkQAiEJIAggAyALIAoQAiEKIAkgBCAMIAsQAiELIAogBSANIAwQAiEMIAsgBiAOIA0QAiENIAwgByAPIA4QAiEOIA0gCCAQIA8QAiEPIA4gCSABIBAQAiEQIAEgAiADIARBwdPtpH5Bho/5/X5BxruG/gBBzMOyoAIQASAFIAYgByAIQe/YpO8CQaqJ0tMEQdzTwuUFQdqR5rcHEAEgCSAKIAsgDEHSovnBeUHtjMfBekHIz4yAe0HH/+X6exABIA0gDiAPIBBB85eAt3xBx6KerX1B0capNkHn0qShARABIA8gCiACIAEQAiEBIBAgCyADIAIQAiECIAEgDCAEIAMQAiEDIAIgDSAFIAQQAiEEIAMgDiAGIAUQAiEFIAQgDyAHIAYQAiEGIAUgECAIIAcQAiEHIAYgASAJIAgQAiEIIAcgAiAKIAkQAiEJIAggAyALIAoQAiEKIAkgBCAMIAsQAiELIAogBSANIAwQAiEMIAsgBiAOIA0QAiENIAwgByAPIA4QAiEOIA0gCCAQIA8QAiEPIA4gCSABIBAQAiEQIAEgAiADIARBhZXcvQJBuMLs8AJB/Nux6QRBk5rgmQUQASAFIAYgByAIQdTmqagGQbuVqLMHQa6Si454QYXZyJN5EAEgCSAKIAsgDEGh0f+VekHLzOnAekHwlq6SfEGjo7G7fBABIA0gDiAPIBBBmdDLjH1BpIzktH1Bheu4oH9B8MCqgwEQASAPIAogAiABEAIhASAQIAsgAyACEAIhAiABIAwgBCADEAIhAyACIA0gBSAEEAIhBCADIA4gBiAFEAIhBSAEIA8gByAGEAIhBiAFIBAgCCAHEAIhByAGIAEgCSAIEAIhCCAHIAIgCiAJEAIhCSAIIAMgCyAKEAIhCiAJIAQgDCALEAIhCyAKIAUgDSAMEAIhDCALIAYgDiANEAIhDSAMIAcgDyAOEAIhDiANIAggECAPEAIhDyAOIAkgASAQEAIhECABIAIgAyAEQZaCk80BQYjY3fEBQczuoboCQbX5wqUDEAEgBSAGIAcgCEGzmfDIA0HK1OL2BEHPlPPcBUHz37nBBhABIAkgCiALIAxB7oW+pAdB78aVxQdBlPChpnhBiISc5ngQASANIA4gDyAQQfr/+4V5QevZwaJ6QffH5vd7QfLxxbN8EAEgACAAKAIAIwBqNgIAIAAgACgCBCMBajYCBCAAIAAoAggjAmo2AgggACAAKAIMIwNqNgIMIAAgACgCECMEajYCECAAIAAoAhQjBWo2AhQgACAAKAIYIwZqNgIYIAAgACgCHCMHajYCHAuKCAIBfhJ/IAApAyAhBCAEp0E/cSACaiEGIAQgAq18IQQgACAENwMgAkAgACgCKCEHIAAoAiwhCCAAKAIwIQkgACgCNCEKIAAoAjghCyAAKAI8IQwgACgCQCENIAAoAkQhDiAAKAJIIQ8gACgCTCEQIAAoAlAhESAAKAJUIRIgACgCWCETIAAoAlwhFCAAKAJgIRUgACgCZCEWIAZBwABrIgZBAEgNACAAIAcgCCAJIAogCyAMIA0gDiAPIBAgESASIBMgFCAVIBYQAwNAIAEoAgAhByABKAIEIQggASgCCCEJIAEoAgwhCiABKAIQIQsgASgCFCEMIAEoAhghDSABKAIcIQ4gASgCICEPIAEoAiQhECABKAIoIREgASgCLCESIAEoAjAhEyABKAI0IRQgASgCOCEVIAEoAjwhFiABQcAAaiEBIAZBwABrIgZBAEgEQCAAIAc2AiggACAINgIsIAAgCTYCMCAAIAo2AjQgACALNgI4IAAgDDYCPCAAIA02AkAgACAONgJEIAAgDzYCSCAAIBA2AkwgACARNgJQIAAgEjYCVCAAIBM2AlggACAUNgJcIAAgFTYCYCAAIBY2AmQMAgsgACAHIAggCSAKIAsgDCANIA4gDyAQIBEgEiATIBQgFSAWEAMMAAsLIANBAUYEQCAEp0E/cSEGQYABIAZBA3FBA3R0IQUCQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkAgBkECdg4PAwQFBgcICQoLDA0ODxABAgsLIAUgFXIhFUEAIQULIAUgFnIhFkEAIQUgACAHIAggCSAKIAsgDCANIA4gDyAQIBEgEiATIBQgFSAWEAMgACAENwMgQQAhB0EAIQhBACEJQQAhCkEAIQtBACEMQQAhDUEAIQ5BACEPQQAhEEEAIRFBACESQQAhE0EAIRRBACEVQQAhFgsgBSAHciEHQQAhBQsgBSAIciEIQQAhBQsgBSAJciEJQQAhBQsgBSAKciEKQQAhBQsgBSALciELQQAhBQsgBSAMciEMQQAhBQsgBSANciENQQAhBQsgBSAOciEOQQAhBQsgBSAPciEPQQAhBQsgBSAQciEQQQAhBQsgBSARciERQQAhBQsgBSASciESQQAhBQsgBSATciETQQAhBQsgBSAUciEUQQAhBQsgBEIdiKcQACEVIARCA4anEAAhFiAAIAcgCCAJIAogCyAMIA0gDiAPIBAgESASIBMgFCAVIBYQAyAAIAAoAgAQADYCACAAIAAoAgQQADYCBCAAIAAoAggQADYCCCAAIAAoAgwQADYCDCAAIAAoAhAQADYCECAAIAAoAhQQADYCFCAAIAAoAhgQADYCGCAAIAAoAhwQADYCHAsL");}},function(){return i$g||(0, g$c[Object.keys(g$c)[0]])((i$g={exports:{}}).exports,i$g),i$g.exports})(),C$a=new WebAssembly.Module(B$b);const E$c=r$s,e$e=L$b,o$i="undefined"!=typeof WebAssembly&&(h$d={imports:{debug:{log(...A){console.log(...A.map((A=>(A>>>0).toString(16).padStart(8,"0"))));},log_tee:A=>(console.log((A>>>0).toString(16).padStart(8,"0")),A)}}},new WebAssembly.Instance(C$a,h$d).exports);var h$d;let s$i=0;const r$j=[];t$i.exports=y$f;const n$k=t$i.exports.SHA256_BYTES=32,a$c=108;function y$f(){if(!(this instanceof y$f))return new y$f;if(!o$i)throw new Error("WASM not loaded. Wait for Sha256.ready(cb)");r$j.length||(r$j.push(s$i),s$i+=a$c),this.finalized=!1,this.digestLength=n$k,this.pointer=r$j.pop(),this.pos=0,this._memory=new Uint8Array(o$i.memory.buffer),this._memory.fill(0,this.pointer,this.pointer+a$c),this.pointer+this.digestLength>this._memory.length&&this._realloc(this.pointer+a$c);}function c$i(A){if(!(this instanceof c$i))return new c$i(A);this.pad=e$e.alloc(64),this.inner=y$f(),this.outer=y$f();const I=e$e.alloc(32);A.byteLength>64&&(y$f().update(A).digest(I),A=I),this.pad.fill(54);for(let I=0;I<A.byteLength;I++)this.pad[I]^=A[I];this.inner.update(this.pad),this.pad.fill(92);for(let I=0;I<A.byteLength;I++)this.pad[I]^=A[I];this.outer.update(this.pad),this.pad.fill(0),I.fill(0);}function p$e(){}y$f.prototype._realloc=function(A){o$i.memory.grow(Math.max(0,Math.ceil(Math.abs(A-this._memory.length)/65536))),this._memory=new Uint8Array(o$i.memory.buffer);},y$f.prototype.update=function(A,I){E$c(!1===this.finalized,"Hash instance finalized"),s$i%4!=0&&(s$i+=4-s$i%4),E$c(s$i%4==0,"input shoud be aligned for int32");const[g,i]=function(A,I){var g=e$e.from(A,I);return [g,g.byteLength]}(A,I);var t;return E$c(g instanceof Uint8Array,"input must be Uint8Array or Buffer"),s$i+i>this._memory.length&&this._realloc(s$i+A.length),this._memory.fill(0,s$i,s$i+(i+(t=64)-1&-t)-64),this._memory.set(g.subarray(0,64-this.pos),this.pointer+40+this.pos),this._memory.set(g.subarray(64-this.pos),s$i),this.pos=this.pos+i&63,o$i.sha256(this.pointer,s$i,i,0),this},y$f.prototype.digest=function(A,I=0){E$c(!1===this.finalized,"Hash instance finalized"),this.finalized=!0,r$j.push(this.pointer);const g=this.pointer+40+this.pos;this._memory.fill(0,g,this.pointer+40+64),o$i.sha256(this.pointer,s$i,0,1);const i=this._memory.subarray(this.pointer,this.pointer+this.digestLength);if(!A)return i;if("string"==typeof A)return e$e.toString(i,A);E$c(A instanceof Uint8Array,"output must be Uint8Array or Buffer"),E$c(A.byteLength>=this.digestLength+I,"output must have at least 'SHA256_BYTES' bytes remaining");for(let g=0;g<this.digestLength;g++)A[g+I]=i[g];return A},y$f.WASM=o$i,y$f.WASM_SUPPORTED="undefined"!=typeof WebAssembly,y$f.ready=function(A){return A||(A=p$e),o$i?(A(),Promise.resolve()):A(new Error("WebAssembly not supported"))},y$f.prototype.ready=y$f.ready,c$i.prototype.update=function(A,I){return this.inner.update(A,I),this},c$i.prototype.digest=function(A,I=0){return this.outer.update(this.inner.digest()),this.outer.digest(A,I)},y$f.HMAC=c$i;var M$b=t$i.exports;t$i.exports.HMAC;t$i.exports.WASM;t$i.exports.WASM_SUPPORTED;t$i.exports.ready;

/**
 * Bundled by jsDelivr using Rollup v2.79.1 and Terser v5.19.2.
 * Original file: /npm/sha256-universal@1.2.1/index.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
var e$d={exports:{}},n$j={exports:{}};const r$i=r$o,o$h=L$a;n$j.exports=u$g;const a$b=n$j.exports.SHA256_BYTES=32,h$c=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298];function f$e(t,s,i,e){return ((t>>>17|t<<15)^(t>>>19|t<<13)^t>>>10)+s+(((i>>>7|i<<25)^(i>>>18|i<<14)^i>>>3)+e)<<0}function p$d(t,s){var i,e,n,[r,o,a,p,u,d,c,y]=t;const g=new Uint32Array(64);for(let t=0;t<16;t++)g[t]=l$e(s[t]);for(let t=16;t<64;t++)g[t]=f$e(g[t-2],g[t-7],g[t-15],g[t-16]);for(let t=0;t<64;t+=4)b(t);function b(t){i=r&o^r&a^o&a,e=(r>>>2|r<<30)^(r>>>13|r<<19)^(r>>>22|r<<10),n=y+(u&d^~u&c)+((u>>>6|u<<26)^(u>>>11|u<<21)^(u>>>25|u<<7))+g[t]+h$c[t],y=p+n,i=(p=n+(e+i))&r^p&o^r&o,e=(p>>>2|p<<30)^(p>>>13|p<<19)^(p>>>22|p<<10),n=c+(y&u^~y&d)+((y>>>6|y<<26)^(y>>>11|y<<21)^(y>>>25|y<<7))+g[t+1]+h$c[t+1],c=a+n,i=(a=n+(e+i))&p^a&r^p&r,e=(a>>>2|a<<30)^(a>>>13|a<<19)^(a>>>22|a<<10),n=d+(c&y^~c&u)+((c>>>6|c<<26)^(c>>>11|c<<21)^(c>>>25|c<<7))+g[t+2]+h$c[t+2],d=o+n,i=(o=n+(e+i))&a^o&p^a&p,e=(o>>>2|o<<30)^(o>>>13|o<<19)^(o>>>22|o<<10),n=u+(d&c^~d&y)+((d>>>6|d<<26)^(d>>>11|d<<21)^(d>>>25|d<<7))+g[t+3]+h$c[t+3],u=r+n,r=n+(e+i);}t[0]=t[0]+r,t[1]=t[1]+o,t[2]=t[2]+a,t[3]=t[3]+p,t[4]=t[4]+u,t[5]=t[5]+d,t[6]=t[6]+c,t[7]=t[7]+y;}function u$g(){return this instanceof u$g?(this.buffer=new ArrayBuffer(64),this.bytesRead=0,this.pos=0,this.digestLength=a$b,this.finalised=!1,this.load=new Uint8Array(this.buffer),this.words=new Uint32Array(this.buffer),this.state=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),this):new u$g}function d$d(t){if(!(this instanceof d$d))return new d$d(t);this.pad=o$h.alloc(64),this.inner=u$g(),this.outer=u$g();const s=o$h.alloc(32);t.byteLength>64&&(u$g().update(t).digest(s),t=s),this.pad.fill(54);for(let s=0;s<t.byteLength;s++)this.pad[s]^=t[s];this.inner.update(this.pad),this.pad.fill(92);for(let s=0;s<t.byteLength;s++)this.pad[s]^=t[s];this.outer.update(this.pad),this.pad.fill(0),s.fill(0);}function l$e(t){return (16711935&t)>>>8|(16711935&t)<<24|((4278255360&t)<<8|(4278255360&t)>>>24)}u$g.prototype.update=function(t,s){r$i(!1===this.finalised,"Hash instance finalised");var[i,e]=function(t,s){var i=o$h.from(t,s);return [i,i.byteLength]}(t,s),n=0;for(this.bytesRead+=e;e>0&&(this.load.set(i.subarray(n,n+64-this.pos),this.pos),n+=64-this.pos,!((e-=64-this.pos)<0));)this.pos=0,p$d(this.state,this.words);return this.pos=63&this.bytesRead,this.load.fill(0,this.pos),this},u$g.prototype.digest=function(t,s=0){r$i(!1===this.finalised,"Hash instance finalised"),this.finalised=!0,this.load.fill(0,this.pos),this.load[this.pos]=128,this.pos>55&&(p$d(this.state,this.words),this.words.fill(0),this.pos=0);const i=new DataView(this.buffer);i.setUint32(56,this.bytesRead/2**29),i.setUint32(60,this.bytesRead<<3),p$d(this.state,this.words);const e=new Uint8Array(this.state.map(l$e).buffer);if(!t)return new Uint8Array(e);if("string"==typeof t)return o$h.toString(e,t);r$i(t instanceof Uint8Array,"input must be Uint8Array or Buffer"),r$i(t.byteLength>=this.digestLength+s,"input not large enough for digest");for(let i=0;i<this.digestLength;i++)t[i+s]=e[i];return t},d$d.prototype.update=function(t,s){return this.inner.update(t,s),this},d$d.prototype.digest=function(t,s=0){return this.outer.update(this.inner.digest()),this.outer.digest(t,s)},u$g.HMAC=d$d;const c$h=n$j.exports,y$e=M$b;var g$b=c$h;e$d.exports=function(){return new g$b};e$d.exports.ready=function(t){y$e.ready((function(){t();}));};e$d.exports.WASM_SUPPORTED=y$e.WASM_SUPPORTED;e$d.exports.WASM_LOADED=!1;e$d.exports.SHA256_BYTES=32,y$e.ready((function(t){t||(e$d.exports.WASM_LOADED=!0,e$d.exports=g$b=y$e);}));var m$c=e$d.exports;

/**
 * Bundled by jsDelivr using Rollup v2.79.1 and Terser v5.19.2.
 * Original file: /npm/chacha20-universal@1.0.4/index.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
const e$c=r$s;var s$h=i$f;const n$i=[1634760805,857760878,2036477234,1797285236];function i$f(t,s,i){e$c(32===s.byteLength),e$c(8===t.byteLength||12===t.byteLength);const f=new Uint32Array(t.buffer,t.byteOffset,t.byteLength/4),r=new Uint32Array(s.buffer,s.byteOffset,s.byteLength/4);i||(i=0),e$c(i<Number.MAX_SAFE_INTEGER),this.finalized=!1,this.pos=0,this.state=new Uint32Array(16);for(let t=0;t<4;t++)this.state[t]=n$i[t];for(let t=0;t<8;t++)this.state[4+t]=r[t];return this.state[12]=4294967295&i,8===f.byteLength?(this.state[13]=(i&&0xffffffff00000000)>>32,this.state[14]=f[0],this.state[15]=f[1]):(this.state[13]=f[0],this.state[14]=f[1],this.state[15]=f[2]),this}function f$d(t){const e=new Uint32Array(16);for(let s=16;s--;)e[s]=t[s];for(let t=0;t<20;t+=2)h$b(e,0,4,8,12),h$b(e,1,5,9,13),h$b(e,2,6,10,14),h$b(e,3,7,11,15),h$b(e,0,5,10,15),h$b(e,1,6,11,12),h$b(e,2,7,8,13),h$b(e,3,4,9,14);for(let s=0;s<16;s++)e[s]+=t[s];return new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}function r$h(t,e){return t<<e|t>>>32-e}function h$b(t,e,s,n,i){t[e]+=t[s],t[i]^=t[e],t[i]=r$h(t[i],16),t[n]+=t[i],t[s]^=t[n],t[s]=r$h(t[s],12),t[e]+=t[s],t[i]^=t[e],t[i]=r$h(t[i],8),t[n]+=t[i],t[s]^=t[n],t[s]=r$h(t[s],7);}i$f.prototype.update=function(t,s){e$c(!this.finalized,"cipher finalized."),e$c(t.byteLength>=s.byteLength,"output cannot be shorter than input.");let n=s.length,i=this.pos%64;this.pos+=n;let r=0,h=f$d(this.state);for(;i>0&&n>0;)t[r]=s[r++]^h[i],i=i+1&63,i||this.state[12]++,n--;for(;n>0;){if(h=f$d(this.state),n<64){for(let e=0;e<n;e++)t[r]=s[r++]^h[i++],i&=63;return}for(;i<64;)t[r]=s[r++]^h[i++];this.state[12]++,i=0,n-=64;}},i$f.prototype.final=function(){this.state.fill(0),this.pos=0,this.finalized=!0;};

/**
 * Bundled by jsDelivr using Rollup v2.79.1 and Terser v5.19.2.
 * Original file: /npm/siphash24@1.3.1/index.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
var I$a,h$a,Q$9=(()=>{for(var A=new Uint8Array(128),I=0;I<64;I++)A[I<26?I+65:I<52?I+71:I<62?I-4:4*I-205]=I;return I=>{for(var h=I.length,Q=new Uint8Array(3*(h-("="==I[h-1])-("="==I[h-2]))/4|0),g=0,C=0;g<h;){var E=A[I.charCodeAt(g++)],B=A[I.charCodeAt(g++)],e=A[I.charCodeAt(g++)],r=A[I.charCodeAt(g++)];Q[C++]=E<<2|B>>4,Q[C++]=B<<4|e>>2,Q[C++]=e<<6|r;}return Q}})(),g$a=(I$a={"wasm-binary:./siphash24.wat"(A,I){I.exports=Q$9("AGFzbQEAAAABBgFgAn9/AAMCAQAFBQEBCpBOBxQCBm1lbW9yeQIAB3NpcGhhc2gAAArdCAHaCAIIfgJ/QvXKzYPXrNu38wAhAkLt3pHzlszct+QAIQNC4eSV89bs2bzsACEEQvPK0cunjNmy9AAhBUEIKQMAIQdBECkDACEIIAGtQjiGIQYgAUEHcSELIAAgAWogC2shCiAFIAiFIQUgBCAHhSEEIAMgCIUhAyACIAeFIQICQANAIAAgCkYNASAAKQMAIQkgBSAJhSEFIAIgA3whAiADQg2JIQMgAyAChSEDIAJCIIkhAiAEIAV8IQQgBUIQiSEFIAUgBIUhBSACIAV8IQIgBUIViSEFIAUgAoUhBSAEIAN8IQQgA0IRiSEDIAMgBIUhAyAEQiCJIQQgAiADfCECIANCDYkhAyADIAKFIQMgAkIgiSECIAQgBXwhBCAFQhCJIQUgBSAEhSEFIAIgBXwhAiAFQhWJIQUgBSAChSEFIAQgA3whBCADQhGJIQMgAyAEhSEDIARCIIkhBCACIAmFIQIgAEEIaiEADAALCwJAAkACQAJAAkACQAJAAkAgCw4HBwYFBAMCAQALIAYgADEABkIwhoQhBgsgBiAAMQAFQiiGhCEGCyAGIAAxAARCIIaEIQYLIAYgADEAA0IYhoQhBgsgBiAAMQACQhCGhCEGCyAGIAAxAAFCCIaEIQYLIAYgADEAAIQhBgsgBSAGhSEFIAIgA3whAiADQg2JIQMgAyAChSEDIAJCIIkhAiAEIAV8IQQgBUIQiSEFIAUgBIUhBSACIAV8IQIgBUIViSEFIAUgAoUhBSAEIAN8IQQgA0IRiSEDIAMgBIUhAyAEQiCJIQQgAiADfCECIANCDYkhAyADIAKFIQMgAkIgiSECIAQgBXwhBCAFQhCJIQUgBSAEhSEFIAIgBXwhAiAFQhWJIQUgBSAChSEFIAQgA3whBCADQhGJIQMgAyAEhSEDIARCIIkhBCACIAaFIQIgBEL/AYUhBCACIAN8IQIgA0INiSEDIAMgAoUhAyACQiCJIQIgBCAFfCEEIAVCEIkhBSAFIASFIQUgAiAFfCECIAVCFYkhBSAFIAKFIQUgBCADfCEEIANCEYkhAyADIASFIQMgBEIgiSEEIAIgA3whAiADQg2JIQMgAyAChSEDIAJCIIkhAiAEIAV8IQQgBUIQiSEFIAUgBIUhBSACIAV8IQIgBUIViSEFIAUgAoUhBSAEIAN8IQQgA0IRiSEDIAMgBIUhAyAEQiCJIQQgAiADfCECIANCDYkhAyADIAKFIQMgAkIgiSECIAQgBXwhBCAFQhCJIQUgBSAEhSEFIAIgBXwhAiAFQhWJIQUgBSAChSEFIAQgA3whBCADQhGJIQMgAyAEhSEDIARCIIkhBCACIAN8IQIgA0INiSEDIAMgAoUhAyACQiCJIQIgBCAFfCEEIAVCEIkhBSAFIASFIQUgAiAFfCECIAVCFYkhBSAFIAKFIQUgBCADfCEEIANCEYkhAyADIASFIQMgBEIgiSEEQQAgAiADIAQgBYWFhTcDAAs=");}},function(){return h$a||(0, I$a[Object.keys(I$a)[0]])((h$a={exports:{}}).exports,h$a),h$a.exports})(),C$9=new WebAssembly.Module(g$a),E$b=function(A,I,h){var Q,g={h:S$a(h,4),l:S$a(h,0)},C={h:S$a(h,12),l:S$a(h,8)},E={h:g.h,l:g.l},B=g,r={h:C.h,l:C.l},i=C,n=0,l=I.length,F=l-7,a=new Uint8Array(new ArrayBuffer(8));e$b(E,{h:1936682341,l:1886610805}),e$b(r,{h:1685025377,l:1852075885}),e$b(B,{h:1819895653,l:1852142177}),e$b(i,{h:1952801890,l:2037671283});for(;n<F;)e$b(i,Q={h:S$a(I,n+4),l:S$a(I,n)}),t$h(E,r,B,i),t$h(E,r,B,i),e$b(E,Q),n+=8;a[7]=l;var U=0;for(;n<l;)a[U++]=I[n++];for(;U<7;)a[U++]=0;Q={h:a[7]<<24|a[6]<<16|a[5]<<8|a[4],l:a[3]<<24|a[2]<<16|a[1]<<8|a[0]},e$b(i,Q),t$h(E,r,B,i),t$h(E,r,B,i),e$b(E,Q),e$b(B,{h:0,l:255}),t$h(E,r,B,i),t$h(E,r,B,i),t$h(E,r,B,i),t$h(E,r,B,i);var o=E;e$b(o,r),e$b(o,B),e$b(o,i),A[0]=255&o.l,A[1]=o.l>>8&255,A[2]=o.l>>16&255,A[3]=o.l>>24&255,A[4]=255&o.h,A[5]=o.h>>8&255,A[6]=o.h>>16&255,A[7]=o.h>>24&255;};function B$a(A,I){var h=A.l+I.l,Q={h:A.h+I.h+(h/2>>>31)>>>0,l:h>>>0};A.h=Q.h,A.l=Q.l;}function e$b(A,I){A.h^=I.h,A.h>>>=0,A.l^=I.l,A.l>>>=0;}function r$g(A,I){var h={h:A.h<<I|A.l>>>32-I,l:A.l<<I|A.h>>>32-I};A.h=h.h,A.l=h.l;}function i$e(A){var I=A.l;A.l=A.h,A.h=I;}function t$h(A,I,h,Q){B$a(A,I),B$a(h,Q),r$g(I,13),r$g(Q,16),e$b(I,A),e$b(Q,h),i$e(A),B$a(h,I),B$a(A,Q),r$g(I,17),r$g(Q,21),e$b(I,h),e$b(Q,A),i$e(h);}function S$a(A,I){return A[I+3]<<24|A[I+2]<<16|A[I+1]<<8|A[I]}var n$h,l$d=r$s,F$9="undefined"!=typeof WebAssembly&&new WebAssembly.Instance(C$9,n$h).exports,a$a=E$b,U$a=y$d,o$g=y$d.BYTES=8,D$a=y$d.KEYBYTES=16;y$d.WASM_SUPPORTED=!!F$9,y$d.WASM_LOADED=!!F$9;var s$g=new Uint8Array(F$9?F$9.memory.buffer:0);function y$d(A,I,h,Q){var g;return h||(h=new Uint8Array(8)),!0!==Q&&(l$d(h.length>=o$g,"output must be at least "+o$g),l$d(I.length>=D$a,"key must be at least "+D$a)),F$9?(A.length+24>s$g.length&&(g=A.length+24,F$9.memory.grow(Math.max(0,Math.ceil(Math.abs(g-s$g.length)/65536))),s$g=new Uint8Array(F$9.memory.buffer)),s$g.set(I,8),s$g.set(A,24),F$9.siphash(24,A.length),h.set(s$g.subarray(0,8))):a$a(h,A,I),h}

/**
 * Bundled by jsDelivr using Rollup v2.79.1 and Terser v5.19.2.
 * Original file: /npm/sodium-javascript@0.8.0/index.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
function s$f(t){throw new Error('Could not dynamically require "'+t+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var c$g,_$a={exports:{}},y$c={exports:{}};function i$d(t){t.fill(0);}!function(e){var r,n=r$s,o=(r=globalThis.crypto||globalThis.msCrypto)&&r.getRandomValues?function(t,e){for(let n=0;n<e;n+=65536)r.getRandomValues(new Uint8Array(t.buffer,n+t.byteOffset,Math.min(e-n,65536)));}:null!=s$f&&(r=s$f("crypto"))&&r.randomBytes?function(t,e){new Uint8Array(t.buffer,t.byteOffset,e).set(r.randomBytes(e));}:function(){throw new Error("No secure random number generator available")};Object.defineProperty(e.exports,"randombytes",{value:o}),e.exports.randombytes_buf=function(t){n(t,"out must be given"),o(t,t.byteLength);};}(y$c);var p$c={sodium_malloc:function(t){return new Uint8Array(t)},sodium_free:function(t){i$d(t),function(){if(c$g)return c$g;var t=globalThis.MessageChannel;null==t&&({MessageChannel:t}=s$f("worker_threads"));return c$g=new t}().port1.postMessage(t.buffer,[t.buffer]);},sodium_memzero:i$d},u$f={exports:{}};!function(t){function e(t,e,r,n,o){var a=0;for(let h=0;h<o;h++)a|=t[e+h]^r[n+h];return (1&a-1>>>8)-1}t.exports={crypto_verify_16:function(t,r,n,o){return 0===e(t,r,n,o,16)},crypto_verify_32:function(t,r,n,o){return 0===e(t,r,n,o,32)},crypto_verify_64:function(t,r,n,o){return 0===e(t,r,n,o,64)}},Object.defineProperty(t.exports,"vn",{value:e});}(u$f);const f$c=r$s,{vn:b$8}=u$f.exports;var l$c={sodium_increment:function(t){const e=t.byteLength;for(var r=1,n=0;n<e;n++)r+=t[n],t[n]=r,r>>=8;},sodium_memcmp:function(t,e){return f$c(t.byteLength===e.byteLength,"buffers must be the same size"),0===b$8(t,0,e,0,t.byteLength)},sodium_is_zero:function(t){var e=0;for(let r=0;r<t.length;r++)e|=t[r];return 0===e}};const{crypto_verify_32:E$a}=u$f.exports,g$9=A$c,m$b=r$s;var S$9={crypto_auth_BYTES:32,crypto_auth_KEYBYTES:32,crypto_auth:function(t,e,r){m$b(32===t.byteLength,"out should be 'crypto_auth_BYTES' in length"),m$b(32===r.byteLength,"key should be 'crypto_auth_KEYBYTES' in length");const n=new Uint8Array(64),o=g$9.HMAC(r);o.update(e),o.digest(n),t.set(n.subarray(0,32));},crypto_auth_verify:function(t,e,r){m$b(32===t.byteLength,"h should be 'crypto_auth_BYTES' in length"),m$b(32===r.byteLength,"key should be 'crypto_auth_KEYBYTES' in length");const n=g$9.HMAC(r).update(e).digest();return E$a(t,0,n,0)}};const Y$9=A$c,T$9=r$s;if(1!==new Uint16Array([1])[0])throw new Error("Big endian architecture is not supported.");const d$c=64;function B$9(t,e,r){return T$9(t.byteLength===d$c,"out must be 'crypto_hash_sha512_BYTES' bytes long"),Y$9().update(e.subarray(0,r)).digest(t),0}var A$9={crypto_hash:function(t,e,r){return B$9(t,e,r)},crypto_hash_sha512:B$9,crypto_hash_sha512_BYTES:d$c,crypto_hash_BYTES:d$c};if(1!==new Uint16Array([1])[0])throw new Error("Big endian architecture is not supported.");var L$9=function(t){var e,r=new Float64Array(16);if(t)for(e=0;e<t.length;e++)r[e]=t[e];return r},x$8=new Uint8Array(32);x$8[0]=9;var w$a=L$9(),v$9=L$9([1]),U$9=L$9([56129,1]),M$a=L$9([30883,4953,19914,30187,55467,16705,2637,112,59544,30585,16505,36039,65139,11119,27886,20995]),k$8=L$9([61785,9906,39828,60374,45398,33411,5274,224,53552,61171,33010,6542,64743,22239,55772,9222]),N$9=L$9([54554,36645,11616,51542,42930,38181,51040,26924,56412,64982,57905,49316,21502,52590,14035,8553]),K$9=L$9([26200,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214]),C$8=L$9([41136,18958,6951,50414,58488,44335,6150,12099,55207,15867,153,11085,57099,20417,9344,11139]);function O$9(t,e,r){var n,o,a=0,h=0,s=0,c=0,_=0,y=0,i=0,p=0,u=0,f=0,b=0,l=0,E=0,g=0,m=0,S=0,Y=0,T=0,d=0,B=0,A=0,L=0,x=0,w=0,v=0,U=0,M=0,k=0,N=0,K=0,C=0,O=r[0],R=r[1],I=r[2],P=r[3],D=r[4],X=r[5],G=r[6],F=r[7],W=r[8],Z=r[9],V=r[10],H=r[11],z=r[12],j=r[13],q=r[14],Q=r[15];a+=(n=e[0])*O,h+=n*R,s+=n*I,c+=n*P,_+=n*D,y+=n*X,i+=n*G,p+=n*F,u+=n*W,f+=n*Z,b+=n*V,l+=n*H,E+=n*z,g+=n*j,m+=n*q,S+=n*Q,h+=(n=e[1])*O,s+=n*R,c+=n*I,_+=n*P,y+=n*D,i+=n*X,p+=n*G,u+=n*F,f+=n*W,b+=n*Z,l+=n*V,E+=n*H,g+=n*z,m+=n*j,S+=n*q,Y+=n*Q,s+=(n=e[2])*O,c+=n*R,_+=n*I,y+=n*P,i+=n*D,p+=n*X,u+=n*G,f+=n*F,b+=n*W,l+=n*Z,E+=n*V,g+=n*H,m+=n*z,S+=n*j,Y+=n*q,T+=n*Q,c+=(n=e[3])*O,_+=n*R,y+=n*I,i+=n*P,p+=n*D,u+=n*X,f+=n*G,b+=n*F,l+=n*W,E+=n*Z,g+=n*V,m+=n*H,S+=n*z,Y+=n*j,T+=n*q,d+=n*Q,_+=(n=e[4])*O,y+=n*R,i+=n*I,p+=n*P,u+=n*D,f+=n*X,b+=n*G,l+=n*F,E+=n*W,g+=n*Z,m+=n*V,S+=n*H,Y+=n*z,T+=n*j,d+=n*q,B+=n*Q,y+=(n=e[5])*O,i+=n*R,p+=n*I,u+=n*P,f+=n*D,b+=n*X,l+=n*G,E+=n*F,g+=n*W,m+=n*Z,S+=n*V,Y+=n*H,T+=n*z,d+=n*j,B+=n*q,A+=n*Q,i+=(n=e[6])*O,p+=n*R,u+=n*I,f+=n*P,b+=n*D,l+=n*X,E+=n*G,g+=n*F,m+=n*W,S+=n*Z,Y+=n*V,T+=n*H,d+=n*z,B+=n*j,A+=n*q,L+=n*Q,p+=(n=e[7])*O,u+=n*R,f+=n*I,b+=n*P,l+=n*D,E+=n*X,g+=n*G,m+=n*F,S+=n*W,Y+=n*Z,T+=n*V,d+=n*H,B+=n*z,A+=n*j,L+=n*q,x+=n*Q,u+=(n=e[8])*O,f+=n*R,b+=n*I,l+=n*P,E+=n*D,g+=n*X,m+=n*G,S+=n*F,Y+=n*W,T+=n*Z,d+=n*V,B+=n*H,A+=n*z,L+=n*j,x+=n*q,w+=n*Q,f+=(n=e[9])*O,b+=n*R,l+=n*I,E+=n*P,g+=n*D,m+=n*X,S+=n*G,Y+=n*F,T+=n*W,d+=n*Z,B+=n*V,A+=n*H,L+=n*z,x+=n*j,w+=n*q,v+=n*Q,b+=(n=e[10])*O,l+=n*R,E+=n*I,g+=n*P,m+=n*D,S+=n*X,Y+=n*G,T+=n*F,d+=n*W,B+=n*Z,A+=n*V,L+=n*H,x+=n*z,w+=n*j,v+=n*q,U+=n*Q,l+=(n=e[11])*O,E+=n*R,g+=n*I,m+=n*P,S+=n*D,Y+=n*X,T+=n*G,d+=n*F,B+=n*W,A+=n*Z,L+=n*V,x+=n*H,w+=n*z,v+=n*j,U+=n*q,M+=n*Q,E+=(n=e[12])*O,g+=n*R,m+=n*I,S+=n*P,Y+=n*D,T+=n*X,d+=n*G,B+=n*F,A+=n*W,L+=n*Z,x+=n*V,w+=n*H,v+=n*z,U+=n*j,M+=n*q,k+=n*Q,g+=(n=e[13])*O,m+=n*R,S+=n*I,Y+=n*P,T+=n*D,d+=n*X,B+=n*G,A+=n*F,L+=n*W,x+=n*Z,w+=n*V,v+=n*H,U+=n*z,M+=n*j,k+=n*q,N+=n*Q,m+=(n=e[14])*O,S+=n*R,Y+=n*I,T+=n*P,d+=n*D,B+=n*X,A+=n*G,L+=n*F,x+=n*W,w+=n*Z,v+=n*V,U+=n*H,M+=n*z,k+=n*j,N+=n*q,K+=n*Q,S+=(n=e[15])*O,h+=38*(T+=n*I),s+=38*(d+=n*P),c+=38*(B+=n*D),_+=38*(A+=n*X),y+=38*(L+=n*G),i+=38*(x+=n*F),p+=38*(w+=n*W),u+=38*(v+=n*Z),f+=38*(U+=n*V),b+=38*(M+=n*H),l+=38*(k+=n*z),E+=38*(N+=n*j),g+=38*(K+=n*q),m+=38*(C+=n*Q),a=(n=(a+=38*(Y+=n*R))+(o=1)+65535)-65536*(o=Math.floor(n/65536)),h=(n=h+o+65535)-65536*(o=Math.floor(n/65536)),s=(n=s+o+65535)-65536*(o=Math.floor(n/65536)),c=(n=c+o+65535)-65536*(o=Math.floor(n/65536)),_=(n=_+o+65535)-65536*(o=Math.floor(n/65536)),y=(n=y+o+65535)-65536*(o=Math.floor(n/65536)),i=(n=i+o+65535)-65536*(o=Math.floor(n/65536)),p=(n=p+o+65535)-65536*(o=Math.floor(n/65536)),u=(n=u+o+65535)-65536*(o=Math.floor(n/65536)),f=(n=f+o+65535)-65536*(o=Math.floor(n/65536)),b=(n=b+o+65535)-65536*(o=Math.floor(n/65536)),l=(n=l+o+65535)-65536*(o=Math.floor(n/65536)),E=(n=E+o+65535)-65536*(o=Math.floor(n/65536)),g=(n=g+o+65535)-65536*(o=Math.floor(n/65536)),m=(n=m+o+65535)-65536*(o=Math.floor(n/65536)),S=(n=S+o+65535)-65536*(o=Math.floor(n/65536)),a=(n=(a+=o-1+37*(o-1))+(o=1)+65535)-65536*(o=Math.floor(n/65536)),h=(n=h+o+65535)-65536*(o=Math.floor(n/65536)),s=(n=s+o+65535)-65536*(o=Math.floor(n/65536)),c=(n=c+o+65535)-65536*(o=Math.floor(n/65536)),_=(n=_+o+65535)-65536*(o=Math.floor(n/65536)),y=(n=y+o+65535)-65536*(o=Math.floor(n/65536)),i=(n=i+o+65535)-65536*(o=Math.floor(n/65536)),p=(n=p+o+65535)-65536*(o=Math.floor(n/65536)),u=(n=u+o+65535)-65536*(o=Math.floor(n/65536)),f=(n=f+o+65535)-65536*(o=Math.floor(n/65536)),b=(n=b+o+65535)-65536*(o=Math.floor(n/65536)),l=(n=l+o+65535)-65536*(o=Math.floor(n/65536)),E=(n=E+o+65535)-65536*(o=Math.floor(n/65536)),g=(n=g+o+65535)-65536*(o=Math.floor(n/65536)),m=(n=m+o+65535)-65536*(o=Math.floor(n/65536)),S=(n=S+o+65535)-65536*(o=Math.floor(n/65536)),a+=o-1+37*(o-1),t[0]=a,t[1]=h,t[2]=s,t[3]=c,t[4]=_,t[5]=y,t[6]=i,t[7]=p,t[8]=u,t[9]=f,t[10]=b,t[11]=l,t[12]=E,t[13]=g,t[14]=m,t[15]=S;}function R$8(t,e){O$9(t,e,e);}function I$9(t,e,r){for(var n,o=~(r-1),a=0;a<16;a++)n=o&(t[a]^e[a]),t[a]^=n,e[a]^=n;}function P$9(t){var e,r,n=1;for(e=0;e<16;e++)r=t[e]+n+65535,n=Math.floor(r/65536),t[e]=r-65536*n;t[0]+=n-1+37*(n-1);}var D$9={gf:L$9,A:function(t,e,r){for(var n=0;n<16;n++)t[n]=e[n]+r[n];},Z:function(t,e,r){for(var n=0;n<16;n++)t[n]=e[n]-r[n];},M:O$9,S:R$8,sel25519:I$9,pack25519:function(t,e){var r,n,o,a=L$9(),h=L$9();for(r=0;r<16;r++)h[r]=e[r];for(P$9(h),P$9(h),P$9(h),n=0;n<2;n++){for(a[0]=h[0]-65517,r=1;r<15;r++)a[r]=h[r]-65535-(a[r-1]>>16&1),a[r-1]&=65535;a[15]=h[15]-32767-(a[14]>>16&1),o=a[15]>>16&1,a[14]&=65535,I$9(h,a,1-o);}for(r=0;r<16;r++)t[2*r]=255&h[r],t[2*r+1]=h[r]>>8;},unpack25519:function(t,e){var r;for(r=0;r<16;r++)t[r]=e[2*r]+(e[2*r+1]<<8);t[15]&=32767;},inv25519:function(t,e){var r,n=L$9();for(r=0;r<16;r++)n[r]=e[r];for(r=253;r>=0;r--)R$8(n,n),2!==r&&4!==r&&O$9(n,n,e);for(r=0;r<16;r++)t[r]=n[r];},gf0:w$a,gf1:v$9,_9:x$8,_121665:U$9,D:M$a,D2:k$8,X:N$9,Y:K$9,I:C$8};const{_9:X$8,_121665:G$8,gf:F$8,inv25519:W$9,pack25519:Z$8,unpack25519:V$8,sel25519:H$9,A:z$8,M:j$8,Z:q$8,S:Q$8}=D$9,J$8=32,$$8=32;var tt$5={crypto_scalarmult:et$5,crypto_scalarmult_base:function(t,e){return et$5(t,e,X$8)},crypto_scalarmult_BYTES:J$8,crypto_scalarmult_SCALARBYTES:$$8};function et$5(t,e,r){rt$5(t,J$8),rt$5(e,$$8),rt$5(r,J$8);var n,o,a=new Uint8Array(32),h=new Float64Array(80),s=F$8(),c=F$8(),_=F$8(),y=F$8(),i=F$8(),p=F$8();for(o=0;o<31;o++)a[o]=e[o];for(a[31]=127&e[31]|64,a[0]&=248,V$8(h,r),o=0;o<16;o++)c[o]=h[o],y[o]=s[o]=_[o]=0;for(s[0]=y[0]=1,o=254;o>=0;--o)n=a[o>>>3]>>>(7&o)&1,H$9(s,c,n),H$9(_,y,n),z$8(i,s,_),q$8(s,s,_),z$8(_,c,y),q$8(c,c,y),Q$8(y,i),Q$8(p,s),j$8(s,_,s),j$8(_,c,i),z$8(i,s,_),q$8(s,s,_),Q$8(c,s),q$8(_,y,p),j$8(s,_,G$8),z$8(s,s,y),j$8(_,_,s),j$8(s,y,p),j$8(y,c,h),Q$8(c,i),H$9(s,c,n),H$9(_,y,n);for(o=0;o<16;o++)h[o+16]=s[o],h[o+32]=_[o],h[o+48]=c[o],h[o+64]=y[o];var u=h.subarray(32),f=h.subarray(16);return W$9(u,u),j$8(f,f,u),Z$8(t,f),0}function rt$5(t,e){if(!t||t.length<e)throw new Error("Argument must be a buffer"+(" of length "+e))}var nt$4={exports:{}};!function(t){var e=d$e;if(1!==new Uint16Array([1])[0])throw new Error("Big endian architecture is not supported.");t.exports.crypto_generichash_PRIMITIVE="blake2b",t.exports.crypto_generichash_BYTES_MIN=e.BYTES_MIN,t.exports.crypto_generichash_BYTES_MAX=e.BYTES_MAX,t.exports.crypto_generichash_BYTES=e.BYTES,t.exports.crypto_generichash_KEYBYTES_MIN=e.KEYBYTES_MIN,t.exports.crypto_generichash_KEYBYTES_MAX=e.KEYBYTES_MAX,t.exports.crypto_generichash_KEYBYTES=e.KEYBYTES,t.exports.crypto_generichash_WASM_SUPPORTED=e.WASM_SUPPORTED,t.exports.crypto_generichash_WASM_LOADED=!1,t.exports.crypto_generichash=function(t,r,n){e(t.length,n).update(r).final(t);},t.exports.crypto_generichash_ready=e.ready,t.exports.crypto_generichash_batch=function(t,r,n){for(var o=e(t.length,n),a=0;a<r.length;a++)o.update(r[a]);o.final(t);},t.exports.crypto_generichash_instance=function(r,n){return null==n&&(n=t.exports.crypto_generichash_BYTES),e(n,r)},e.ready((function(r){t.exports.crypto_generichash_WASM_LOADED=e.WASM_LOADED;}));}(nt$4);var ot$4={};if(function(t){const e=h$e;if(1!==new Uint16Array([1])[0])throw new Error("Big endian architecture is not supported.");function r(t,r){this._instance=e(t,r);}t.crypto_stream_KEYBYTES=32,t.crypto_stream_NONCEBYTES=24,t.crypto_stream_PRIMITIVE="xsalsa20",t.crypto_stream_xsalsa20_MESSAGEBYTES_MAX=Number.MAX_SAFE_INTEGER,t.crypto_stream=function(e,r,n){e.fill(0),t.crypto_stream_xor(e,e,r,n);},t.crypto_stream_xor=function(t,r,n,o){const a=e(n,o);a.update(r,t),a.final();},t.crypto_stream_xor_instance=function(t,e){return new r(t,e)},r.prototype.update=function(t,e){this._instance.update(e,t);},r.prototype.final=function(){this._instance.finalize(),this._instance=null;};}(ot$4),1!==new Uint16Array([1])[0])throw new Error("Big endian architecture is not supported.");var at$4=function(t){var e,r,n,o,a,h,s,c;this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.leftover=0,this.fin=0,e=255&t[0]|(255&t[1])<<8,this.r[0]=8191&e,r=255&t[2]|(255&t[3])<<8,this.r[1]=8191&(e>>>13|r<<3),n=255&t[4]|(255&t[5])<<8,this.r[2]=7939&(r>>>10|n<<6),o=255&t[6]|(255&t[7])<<8,this.r[3]=8191&(n>>>7|o<<9),a=255&t[8]|(255&t[9])<<8,this.r[4]=255&(o>>>4|a<<12),this.r[5]=a>>>1&8190,h=255&t[10]|(255&t[11])<<8,this.r[6]=8191&(a>>>14|h<<2),s=255&t[12]|(255&t[13])<<8,this.r[7]=8065&(h>>>11|s<<5),c=255&t[14]|(255&t[15])<<8,this.r[8]=8191&(s>>>8|c<<8),this.r[9]=c>>>5&127,this.pad[0]=255&t[16]|(255&t[17])<<8,this.pad[1]=255&t[18]|(255&t[19])<<8,this.pad[2]=255&t[20]|(255&t[21])<<8,this.pad[3]=255&t[22]|(255&t[23])<<8,this.pad[4]=255&t[24]|(255&t[25])<<8,this.pad[5]=255&t[26]|(255&t[27])<<8,this.pad[6]=255&t[28]|(255&t[29])<<8,this.pad[7]=255&t[30]|(255&t[31])<<8;};at$4.prototype.blocks=function(t,e,r){for(var n,o,a,h,s,c,_,y,i,p,u,f,b,l,E,g,m,S,Y,T=this.fin?0:2048,d=this.h[0],B=this.h[1],A=this.h[2],L=this.h[3],x=this.h[4],w=this.h[5],v=this.h[6],U=this.h[7],M=this.h[8],k=this.h[9],N=this.r[0],K=this.r[1],C=this.r[2],O=this.r[3],R=this.r[4],I=this.r[5],P=this.r[6],D=this.r[7],X=this.r[8],G=this.r[9];r>=16;)p=i=0,p+=(d+=8191&(n=255&t[e+0]|(255&t[e+1])<<8))*N,p+=(B+=8191&(n>>>13|(o=255&t[e+2]|(255&t[e+3])<<8)<<3))*(5*G),p+=(A+=8191&(o>>>10|(a=255&t[e+4]|(255&t[e+5])<<8)<<6))*(5*X),p+=(L+=8191&(a>>>7|(h=255&t[e+6]|(255&t[e+7])<<8)<<9))*(5*D),i=(p+=(x+=8191&(h>>>4|(s=255&t[e+8]|(255&t[e+9])<<8)<<12))*(5*P))>>>13,p&=8191,p+=(w+=s>>>1&8191)*(5*I),p+=(v+=8191&(s>>>14|(c=255&t[e+10]|(255&t[e+11])<<8)<<2))*(5*R),p+=(U+=8191&(c>>>11|(_=255&t[e+12]|(255&t[e+13])<<8)<<5))*(5*O),p+=(M+=8191&(_>>>8|(y=255&t[e+14]|(255&t[e+15])<<8)<<8))*(5*C),u=i+=(p+=(k+=y>>>5|T)*(5*K))>>>13,u+=d*K,u+=B*N,u+=A*(5*G),u+=L*(5*X),i=(u+=x*(5*D))>>>13,u&=8191,u+=w*(5*P),u+=v*(5*I),u+=U*(5*R),u+=M*(5*O),i+=(u+=k*(5*C))>>>13,u&=8191,f=i,f+=d*C,f+=B*K,f+=A*N,f+=L*(5*G),i=(f+=x*(5*X))>>>13,f&=8191,f+=w*(5*D),f+=v*(5*P),f+=U*(5*I),f+=M*(5*R),b=i+=(f+=k*(5*O))>>>13,b+=d*O,b+=B*C,b+=A*K,b+=L*N,i=(b+=x*(5*G))>>>13,b&=8191,b+=w*(5*X),b+=v*(5*D),b+=U*(5*P),b+=M*(5*I),l=i+=(b+=k*(5*R))>>>13,l+=d*R,l+=B*O,l+=A*C,l+=L*K,i=(l+=x*N)>>>13,l&=8191,l+=w*(5*G),l+=v*(5*X),l+=U*(5*D),l+=M*(5*P),E=i+=(l+=k*(5*I))>>>13,E+=d*I,E+=B*R,E+=A*O,E+=L*C,i=(E+=x*K)>>>13,E&=8191,E+=w*N,E+=v*(5*G),E+=U*(5*X),E+=M*(5*D),g=i+=(E+=k*(5*P))>>>13,g+=d*P,g+=B*I,g+=A*R,g+=L*O,i=(g+=x*C)>>>13,g&=8191,g+=w*K,g+=v*N,g+=U*(5*G),g+=M*(5*X),m=i+=(g+=k*(5*D))>>>13,m+=d*D,m+=B*P,m+=A*I,m+=L*R,i=(m+=x*O)>>>13,m&=8191,m+=w*C,m+=v*K,m+=U*N,m+=M*(5*G),S=i+=(m+=k*(5*X))>>>13,S+=d*X,S+=B*D,S+=A*P,S+=L*I,i=(S+=x*R)>>>13,S&=8191,S+=w*O,S+=v*C,S+=U*K,S+=M*N,Y=i+=(S+=k*(5*G))>>>13,Y+=d*G,Y+=B*X,Y+=A*D,Y+=L*P,i=(Y+=x*I)>>>13,Y&=8191,Y+=w*R,Y+=v*O,Y+=U*C,Y+=M*K,d=p=8191&(i=(i=((i+=(Y+=k*N)>>>13)<<2)+i|0)+(p&=8191)|0),B=u+=i>>>=13,A=f&=8191,L=b&=8191,x=l&=8191,w=E&=8191,v=g&=8191,U=m&=8191,M=S&=8191,k=Y&=8191,e+=16,r-=16;this.h[0]=d,this.h[1]=B,this.h[2]=A,this.h[3]=L,this.h[4]=x,this.h[5]=w,this.h[6]=v,this.h[7]=U,this.h[8]=M,this.h[9]=k;},at$4.prototype.finish=function(t,e){var r,n,o,a,h=new Uint16Array(10);if(this.leftover){for(a=this.leftover,this.buffer[a++]=1;a<16;a++)this.buffer[a]=0;this.fin=1,this.blocks(this.buffer,0,16);}for(r=this.h[1]>>>13,this.h[1]&=8191,a=2;a<10;a++)this.h[a]+=r,r=this.h[a]>>>13,this.h[a]&=8191;for(this.h[0]+=5*r,r=this.h[0]>>>13,this.h[0]&=8191,this.h[1]+=r,r=this.h[1]>>>13,this.h[1]&=8191,this.h[2]+=r,h[0]=this.h[0]+5,r=h[0]>>>13,h[0]&=8191,a=1;a<10;a++)h[a]=this.h[a]+r,r=h[a]>>>13,h[a]&=8191;for(h[9]-=8192,n=(1^r)-1,a=0;a<10;a++)h[a]&=n;for(n=~n,a=0;a<10;a++)this.h[a]=this.h[a]&n|h[a];for(this.h[0]=65535&(this.h[0]|this.h[1]<<13),this.h[1]=65535&(this.h[1]>>>3|this.h[2]<<10),this.h[2]=65535&(this.h[2]>>>6|this.h[3]<<7),this.h[3]=65535&(this.h[3]>>>9|this.h[4]<<4),this.h[4]=65535&(this.h[4]>>>12|this.h[5]<<1|this.h[6]<<14),this.h[5]=65535&(this.h[6]>>>2|this.h[7]<<11),this.h[6]=65535&(this.h[7]>>>5|this.h[8]<<8),this.h[7]=65535&(this.h[8]>>>8|this.h[9]<<5),o=this.h[0]+this.pad[0],this.h[0]=65535&o,a=1;a<8;a++)o=(this.h[a]+this.pad[a]|0)+(o>>>16)|0,this.h[a]=65535&o;t[e+0]=this.h[0]>>>0&255,t[e+1]=this.h[0]>>>8&255,t[e+2]=this.h[1]>>>0&255,t[e+3]=this.h[1]>>>8&255,t[e+4]=this.h[2]>>>0&255,t[e+5]=this.h[2]>>>8&255,t[e+6]=this.h[3]>>>0&255,t[e+7]=this.h[3]>>>8&255,t[e+8]=this.h[4]>>>0&255,t[e+9]=this.h[4]>>>8&255,t[e+10]=this.h[5]>>>0&255,t[e+11]=this.h[5]>>>8&255,t[e+12]=this.h[6]>>>0&255,t[e+13]=this.h[6]>>>8&255,t[e+14]=this.h[7]>>>0&255,t[e+15]=this.h[7]>>>8&255;},at$4.prototype.update=function(t,e,r){var n,o;if(this.leftover){for((o=16-this.leftover)>r&&(o=r),n=0;n<o;n++)this.buffer[this.leftover+n]=t[e+n];if(r-=o,e+=o,this.leftover+=o,this.leftover<16)return;this.blocks(this.buffer,0,16),this.leftover=0;}if(r>=16&&(o=r-r%16,this.blocks(t,e,o),e+=o,r-=o),r){for(n=0;n<r;n++)this.buffer[this.leftover+n]=t[e+n];this.leftover+=r;}};var ht$5=at$4;const st$5=r$s,ct$4=ht$5,{crypto_verify_16:_t$4}=u$f.exports,yt$4=16,it$5=32;var pt$4={crypto_onetimeauth:ut$4,crypto_onetimeauth_verify:function(t,e,r){st$5(t.byteLength===yt$4,"mac must be 'crypto_onetimeauth_BYTES' bytes"),st$5(null!=e.byteLength,"msg must be buffer"),st$5(r.byteLength===it$5,"key must be 'crypto_onetimeauth_KEYBYTES' bytes");var n=new Uint8Array(16);return ut$4(n,e,r),_t$4(t,0,n,0)},crypto_onetimeauth_BYTES:yt$4,crypto_onetimeauth_KEYBYTES:it$5,crypto_onetimeauth_PRIMITIVE:"poly1305"};function ut$4(t,e,r){st$5(t.byteLength===yt$4,"mac must be 'crypto_onetimeauth_BYTES' bytes"),st$5(null!=e.byteLength,"msg must be buffer"),st$5(r.byteLength===it$5,"key must be 'crypto_onetimeauth_KEYBYTES' bytes");var n=new ct$4(r);n.update(e,0,e.byteLength),n.finish(t,0);}const ft$4=r$s,{crypto_stream:bt$4,crypto_stream_xor:lt$4}=ot$4,{crypto_onetimeauth:Et$4,crypto_onetimeauth_verify:gt$4,crypto_onetimeauth_BYTES:mt$4,crypto_onetimeauth_KEYBYTES:St$4}=pt$4,Yt$2=32,Tt$4=24,dt$4=32,Bt$2=16,At$4=16;var Lt$4={crypto_secretbox:xt$4,crypto_secretbox_open:wt$4,crypto_secretbox_detached:function(t,e,r,n,o){ft$4(t.byteLength===r.byteLength,"o must be 'msg.byteLength' bytes"),ft$4(e.byteLength===At$4,"mac must be 'crypto_secretbox_MACBYTES' bytes"),ft$4(n.byteLength===Tt$4,"n must be 'crypto_secretbox_NONCEBYTES' bytes"),ft$4(o.byteLength===Yt$2,"k must be 'crypto_secretbox_KEYBYTES' bytes");const a=new Uint8Array(r.byteLength+e.byteLength);return vt$4(a,r,n,o),e.set(a.subarray(0,e.byteLength)),t.set(a.subarray(e.byteLength)),!0},crypto_secretbox_open_detached:function(t,e,r,n,o){ft$4(e.byteLength===t.byteLength,"o must be 'msg.byteLength' bytes"),ft$4(r.byteLength===At$4,"mac must be 'crypto_secretbox_MACBYTES' bytes"),ft$4(n.byteLength===Tt$4,"n must be 'crypto_secretbox_NONCEBYTES' bytes"),ft$4(o.byteLength===Yt$2,"k must be 'crypto_secretbox_KEYBYTES' bytes");const a=new Uint8Array(e.byteLength+r.byteLength);return a.set(r),a.set(e,r.byteLength),Ut$2(t,a,n,o)},crypto_secretbox_easy:vt$4,crypto_secretbox_open_easy:Ut$2,crypto_secretbox_KEYBYTES:Yt$2,crypto_secretbox_NONCEBYTES:Tt$4,crypto_secretbox_ZEROBYTES:dt$4,crypto_secretbox_BOXZEROBYTES:Bt$2,crypto_secretbox_MACBYTES:At$4};function xt$4(t,e,r,n){ft$4(t.byteLength===e.byteLength,"c must be 'm.byteLength' bytes");const o=e.byteLength;ft$4(o>=dt$4,"mlen must be at least 'crypto_secretbox_ZEROBYTES'"),ft$4(r.byteLength===Tt$4,"n must be 'crypto_secretbox_NONCEBYTES' bytes"),ft$4(n.byteLength===Yt$2,"k must be 'crypto_secretbox_KEYBYTES' bytes"),lt$4(t,e,r,n),Et$4(t.subarray(Bt$2,Bt$2+mt$4),t.subarray(Bt$2+mt$4,t.byteLength),t.subarray(0,St$4)),t.fill(0,0,Bt$2);}function wt$4(t,e,r,n){ft$4(e.byteLength===t.byteLength,"c must be 'm.byteLength' bytes");const o=t.byteLength;ft$4(o>=dt$4,"mlen must be at least 'crypto_secretbox_ZEROBYTES'"),ft$4(r.byteLength===Tt$4,"n must be 'crypto_secretbox_NONCEBYTES' bytes"),ft$4(n.byteLength===Yt$2,"k must be 'crypto_secretbox_KEYBYTES' bytes");const a=new Uint8Array(St$4);bt$4(a,r,n);return !1!==gt$4(e.subarray(Bt$2,Bt$2+mt$4),e.subarray(Bt$2+mt$4,e.byteLength),a)&&(lt$4(t,e,r,n),t.fill(0,0,32),!0)}function vt$4(t,e,r,n){ft$4(t.byteLength===e.byteLength+At$4,"o must be 'msg.byteLength + crypto_secretbox_MACBYTES' bytes"),ft$4(r.byteLength===Tt$4,"n must be 'crypto_secretbox_NONCEBYTES' bytes"),ft$4(n.byteLength===Yt$2,"k must be 'crypto_secretbox_KEYBYTES' bytes");const o=new Uint8Array(dt$4+e.byteLength),a=new Uint8Array(o.byteLength);o.set(e,dt$4),xt$4(a,o,r,n),t.set(a.subarray(Bt$2));}function Ut$2(t,e,r,n){ft$4(e.byteLength===t.byteLength+At$4,"box must be 'msg.byteLength + crypto_secretbox_MACBYTES' bytes"),ft$4(r.byteLength===Tt$4,"n must be 'crypto_secretbox_NONCEBYTES' bytes"),ft$4(n.byteLength===Yt$2,"k must be 'crypto_secretbox_KEYBYTES' bytes");const o=new Uint8Array(Bt$2+e.byteLength),a=new Uint8Array(o.byteLength);return o.set(e,Bt$2),!1!==wt$4(a,o,r,n)&&(t.set(a.subarray(dt$4)),!0)}const{crypto_hash_sha512:Mt$4}=A$9,{crypto_scalarmult:kt$4,crypto_scalarmult_base:Nt$4}=tt$5,{randombytes:Kt$2}=y$c.exports,{crypto_generichash_batch:Ct$4}=nt$4.exports,{crypto_stream_xsalsa20_MESSAGEBYTES_MAX:Ot$2}=ot$4,{crypto_secretbox_open_easy:Rt$2,crypto_secretbox_easy:It$2,crypto_secretbox_detached:Pt$4,crypto_secretbox_open_detached:Dt$2}=Lt$4,Xt$2=h$e,Gt$2=r$s,Ft$2=32,Wt$4=32,Zt$2=24,Vt$2=32,Ht$2=16,zt$2=Ot$2-16;var jt$2={crypto_box_easy:function(t,e,r,n,o){return Gt$2(t.length>=e.length+Ht$2,"c should be at least 'm.length + crypto_box_MACBYTES' bytes"),Gt$2(e.length<=zt$2,"m should be at most 'crypto_box_MESSAGEBYTES_MAX' bytes"),Jt$2(t.subarray(Ht$2,e.length+Ht$2),t.subarray(0,Ht$2),e,r,n,o)},crypto_box_open_easy:function(t,e,r,n,o){return Gt$2(e.length>=t.length+Ht$2,"c should be at least 'm.length + crypto_box_MACBYTES' bytes"),$t$2(t,e.subarray(Ht$2,t.length+Ht$2),e.subarray(0,Ht$2),r,n,o)},crypto_box_keypair:qt$3,crypto_box_seed_keypair:function(t,e,r){Gt$2(t.byteLength===Ft$2,"pk should be 'crypto_box_PUBLICKEYBYTES' bytes"),Gt$2(e.byteLength===Wt$4,"sk should be 'crypto_box_SECRETKEYBYTES' bytes"),Gt$2(32===e.byteLength,"sk should be 'crypto_box_SEEDBYTES' bytes");const n=new Uint8Array(64);return Mt$4(n,r,32),e.set(n.subarray(0,32)),n.fill(0),Nt$4(t,e)},crypto_box_seal:function(t,e,r){te$5(t,48+e.length),te$5(r,Ft$2);var n=t.subarray(0,Ft$2),o=new Uint8Array(Wt$4);qt$3(n,o);var a=new Uint8Array(Zt$2);Ct$4(a,[n,r]);var h=new Uint8Array(Ft$2);kt$4(h,o,r);var s=new Uint8Array(Vt$2),c=new Uint8Array(16);Xt$2.core_hsalsa20(s,c,h,Xt$2.SIGMA),It$2(t.subarray(n.length),e,a,s),ee$5(o);},crypto_box_seal_open:function(t,e,r,n){te$5(e,48),te$5(t,e.length-48),te$5(r,Ft$2),te$5(n,Wt$4);var o=e.subarray(0,Ft$2),a=new Uint8Array(Zt$2);Ct$4(a,[o,r]);var h=new Uint8Array(Ft$2);kt$4(h,n,o);var s=new Uint8Array(Vt$2),c=new Uint8Array(16);return Xt$2.core_hsalsa20(s,c,h,Xt$2.SIGMA),Rt$2(t,e.subarray(o.length),a,s)},crypto_box_PUBLICKEYBYTES:Ft$2,crypto_box_SECRETKEYBYTES:Wt$4,crypto_box_NONCEBYTES:Zt$2,crypto_box_ZEROBYTES:32,crypto_box_BOXZEROBYTES:16,crypto_box_SEALBYTES:48,crypto_box_SEEDBYTES:32,crypto_box_BEFORENMBYTES:Vt$2,crypto_box_MACBYTES:Ht$2};function qt$3(t,e){return te$5(t,Ft$2),te$5(e,Wt$4),Kt$2(e,32),Nt$4(t,e)}function Qt$2(t,e,r){const n=new Uint8Array(16),o=new Uint8Array(32);return Gt$2(0===kt$4(o,r,e)),Xt$2.core_hsalsa20(t,n,o,Xt$2.SIGMA),!0}function Jt$2(t,e,r,n,o,a){te$5(e,Ht$2),te$5(n,Zt$2),te$5(o,Ft$2),te$5(a,Wt$4);const h=new Uint8Array(Vt$2);Gt$2(Qt$2(h,o,a));const s=function(t,e,r,n,o){return Pt$4(t,e,r,n,o)}(t,e,r,n,h);return ee$5(h),s}function $t$2(t,e,r,n,o,a){const h=new Uint8Array(Vt$2);Gt$2(Qt$2(h,o,a));const s=function(t,e,r,n,o){return Dt$2(t,e,r,n,o)}(t,e,r,n,h);return ee$5(h),s}function te$5(t,e){if(!t||e&&t.length<e)throw new Error("Argument must be a buffer"+(e?" of length "+e:""))}function ee$5(t){for(let e=0;e<t.length;e++)t[e]=0;}const re$5=m$c,ne$5=r$s;if(1!==new Uint16Array([1])[0])throw new Error("Big endian architecture is not supported.");var oe$5={crypto_hash_sha256:function(t,e,r){return ne$5(32===t.byteLength,"out must be 'crypto_hash_sha256_BYTES' bytes long"),re$5().update(e.subarray(0,r)).digest(t),0},crypto_hash_sha256_BYTES:32},ae$5={exports:{}};!function(e){const n=r$s,o=y$c.exports.randombytes_buf,a=d$e;e.exports.crypto_kdf_PRIMITIVE="blake2b",e.exports.crypto_kdf_BYTES_MIN=16,e.exports.crypto_kdf_BYTES_MAX=64,e.exports.crypto_kdf_CONTEXTBYTES=8,e.exports.crypto_kdf_KEYBYTES=32,e.exports.crypto_kdf_derive_from_key=function(t,r,o,h){n(t.length>=e.exports.crypto_kdf_BYTES_MIN,"subkey must be at least crypto_kdf_BYTES_MIN"),n(r>=0&&r<=9007199254740991,"subkey_id must be safe integer"),n(o.length>=e.exports.crypto_kdf_CONTEXTBYTES,"context must be at least crypto_kdf_CONTEXTBYTES");var s=new Uint8Array(a.PERSONALBYTES),c=new Uint8Array(a.SALTBYTES);s.set(o,0,e.exports.crypto_kdf_CONTEXTBYTES),function(t,e){var r=1,n=0;for(t[0]=255&e;++n<8&&(r*=256);)t[n]=e/r&255;}(c,r);var _=Math.min(t.length,e.exports.crypto_kdf_BYTES_MAX);a(_,h.subarray(0,e.exports.crypto_kdf_KEYBYTES),c,s,!0).final(t);},e.exports.crypto_kdf_keygen=function(t){n(t.length>=e.exports.crypto_kdf_KEYBYTES,"out.length must be crypto_kdf_KEYBYTES"),o(t.subarray(0,e.exports.crypto_kdf_KEYBYTES));};}(ae$5);const{crypto_scalarmult_base:he$5}=tt$5,{crypto_generichash:se$5}=nt$4.exports,{randombytes_buf:ce$5}=y$c.exports,_e$4=r$s;var ye$4={crypto_kx_keypair:function(t,e){return _e$4(32===t.byteLength,"pk must be 'crypto_kx_PUBLICKEYBYTES' bytes"),_e$4(32===e.byteLength,"sk must be 'crypto_kx_SECRETKEYBYTES' bytes"),ce$5(e,32),he$5(t,e)},crypto_kx_seed_keypair:function(t,e,r){return _e$4(32===t.byteLength,"pk must be 'crypto_kx_PUBLICKEYBYTES' bytes"),_e$4(32===e.byteLength,"sk must be 'crypto_kx_SECRETKEYBYTES' bytes"),_e$4(32===r.byteLength,"seed must be 'crypto_kx_SEEDBYTES' bytes"),se$5(e,r),he$5(t,e)},crypto_kx_SEEDBYTES:32,crypto_kx_SECRETKEYBYTES:32,crypto_kx_PUBLICKEYBYTES:32},ie$5={};!function(e){const r=r$s,n=s$h;if(1!==new Uint16Array([1])[0])throw new Error("Big endian architecture is not supported.");e.crypto_stream_chacha20_KEYBYTES=32,e.crypto_stream_chacha20_NONCEBYTES=8,e.crypto_stream_chacha20_MESSAGEBYTES_MAX=Number.MAX_SAFE_INTEGER,e.crypto_stream_chacha20_ietf_KEYBYTES=32,e.crypto_stream_chacha20_ietf_NONCEBYTES=12,e.crypto_stream_chacha20_ietf_MESSAGEBYTES_MAX=2**32,e.crypto_stream_chacha20=function(t,r,n){t.fill(0),e.crypto_stream_chacha20_xor(t,t,r,n);},e.crypto_stream_chacha20_xor=function(t,o,a,h){r(a.byteLength===e.crypto_stream_chacha20_NONCEBYTES,"n should be crypto_stream_chacha20_NONCEBYTES"),r(h.byteLength===e.crypto_stream_chacha20_KEYBYTES,"k should be crypto_stream_chacha20_KEYBYTES");const s=new n(a,h);s.update(t,o),s.final();},e.crypto_stream_chacha20_xor_ic=function(t,o,a,h,s){r(a.byteLength===e.crypto_stream_chacha20_NONCEBYTES,"n should be crypto_stream_chacha20_NONCEBYTES"),r(s.byteLength===e.crypto_stream_chacha20_KEYBYTES,"k should be crypto_stream_chacha20_KEYBYTES");const c=new n(a,s,h);c.update(t,o),c.final();},e.crypto_stream_chacha20_xor_instance=function(t,o){return r(t.byteLength===e.crypto_stream_chacha20_NONCEBYTES,"n should be crypto_stream_chacha20_NONCEBYTES"),r(o.byteLength===e.crypto_stream_chacha20_KEYBYTES,"k should be crypto_stream_chacha20_KEYBYTES"),new n(t,o)},e.crypto_stream_chacha20_ietf=function(t,r,n){t.fill(0),e.crypto_stream_chacha20_ietf_xor(t,t,r,n);},e.crypto_stream_chacha20_ietf_xor=function(t,o,a,h){r(a.byteLength===e.crypto_stream_chacha20_ietf_NONCEBYTES,"n should be crypto_stream_chacha20_ietf_NONCEBYTES"),r(h.byteLength===e.crypto_stream_chacha20_ietf_KEYBYTES,"k should be crypto_stream_chacha20_ietf_KEYBYTES");const s=new n(a,h);s.update(t,o),s.final();},e.crypto_stream_chacha20_ietf_xor_ic=function(t,o,a,h,s){r(a.byteLength===e.crypto_stream_chacha20_ietf_NONCEBYTES,"n should be crypto_stream_chacha20_ietf_NONCEBYTES"),r(s.byteLength===e.crypto_stream_chacha20_ietf_KEYBYTES,"k should be crypto_stream_chacha20_ietf_KEYBYTES");const c=new n(a,s,h);c.update(t,o),c.final();},e.crypto_stream_chacha20_ietf_xor_instance=function(t,o){return r(t.byteLength===e.crypto_stream_chacha20_ietf_NONCEBYTES,"n should be crypto_stream_chacha20_ietf_NONCEBYTES"),r(o.byteLength===e.crypto_stream_chacha20_ietf_KEYBYTES,"k should be crypto_stream_chacha20_ietf_KEYBYTES"),new n(t,o)};}(ie$5);const{crypto_stream_chacha20_ietf:pe$5,crypto_stream_chacha20_ietf_xor_ic:ue$5}=ie$5,{crypto_verify_16:fe$5}=u$f.exports,be$4=ht$5,le$5=r$s,Ee$4=32,ge$5=12,me$4=16,Se$2=Number.MAX_SAFE_INTEGER,Ye$2=new Uint8Array(16);function Te$2(t,e,r,n,o,a,h){if(null===n)return Te$2(t,e,r,new Uint8Array(0),o,a,h);le$5(t.byteLength===r.byteLength,"ciphertext should be same length than message"),le$5(a.byteLength===ge$5,"npub should be 'crypto_aead_chacha20poly1305_ietf_NPUBBYTES' long"),le$5(h.byteLength===Ee$4,"k should be 'crypto_aead_chacha20poly1305_ietf_KEYBYTES' long"),le$5(r.byteLength<=Se$2,"message is too large"),le$5(e.byteLength<=me$4,"mac should be 'crypto_aead_chacha20poly1305_ietf_ABYTES' long");const s=new Uint8Array(64);var c=new Uint8Array(8);pe$5(s,a,h);const _=new be$4(s);return s.fill(0),_.update(n,0,n.byteLength),_.update(Ye$2,0,16-n.byteLength&15),ue$5(t,r,a,1,h),_.update(t,0,r.byteLength),_.update(Ye$2,0,16-r.byteLength&15),Be$2(c,0,n.byteLength),_.update(c,0,c.byteLength),Be$2(c,0,r.byteLength),_.update(c,0,c.byteLength),_.finish(e,0),c.fill(0),me$4}function de$5(t,e,r,n,o,a,h){if(null===o)return de$5(t,e,r,n,new Uint8Array(0),a,h);le$5(r.byteLength===t.byteLength,"message should be same length than ciphertext"),le$5(a.byteLength===ge$5,"npub should be 'crypto_aead_chacha20poly1305_ietf_NPUBBYTES' long"),le$5(h.byteLength===Ee$4,"k should be 'crypto_aead_chacha20poly1305_ietf_KEYBYTES' long"),le$5(t.byteLength<=Se$2,"message is too large"),le$5(n.byteLength<=me$4,"mac should be 'crypto_aead_chacha20poly1305_ietf_ABYTES' long");const s=new Uint8Array(64),c=new Uint8Array(8),_=new Uint8Array(me$4);pe$5(s,a,h);const y=new be$4(s);s.fill(0),y.update(o,0,o.byteLength),y.update(Ye$2,0,16-o.byteLength&15);const i=r.byteLength;y.update(r,0,i),y.update(Ye$2,0,16-i&15),Be$2(c,0,o.byteLength),y.update(c,0,c.byteLength),Be$2(c,0,i),y.update(c,0,c.byteLength),y.finish(_,0),le$5(16===_.byteLength);const p=fe$5(_,0,n,0);if(_.fill(0),c.fill(0),!p)throw t.fill(0),new Error("could not verify data");ue$5(t,r,a,1,h);}function Be$2(t,e,r){t.fill(0,0,8);const n=new DataView(t.buffer,t.byteOffset,t.byteLength);n.setUint32(e,4294967295&r,!0),n.setUint32(e+4,r/2**32&4294967295,!0);}var Ae$2={crypto_aead_chacha20poly1305_ietf_encrypt:function t(e,r,n,o,a,h){if(null===n)return t(e,r,new Uint8Array(0),o,a,h);le$5(e.byteLength===r.byteLength+me$4,"ciphertext should be 'crypto_aead_chacha20poly1305_ietf_ABYTES' longer than message"),le$5(a.byteLength===ge$5,"npub should be 'crypto_aead_chacha20poly1305_ietf_NPUBBYTES' long"),le$5(h.byteLength===Ee$4,"k should be 'crypto_aead_chacha20poly1305_ietf_KEYBYTES' long"),le$5(r.byteLength<=Se$2,"message is too large");const s=Te$2(e.subarray(0,r.byteLength),e.subarray(r.byteLength),r,n,o,a,h);return r.byteLength+s},crypto_aead_chacha20poly1305_ietf_encrypt_detached:Te$2,crypto_aead_chacha20poly1305_ietf_decrypt:function t(e,r,n,o,a,h){if(null===o)return t(e,r,n,new Uint8Array(0),a,h);if(le$5(e.byteLength===n.byteLength-me$4,"message should be 'crypto_aead_chacha20poly1305_ietf_ABYTES' shorter than ciphertext"),le$5(a.byteLength===ge$5,"npub should be 'crypto_aead_chacha20poly1305_ietf_NPUBBYTES' long"),le$5(h.byteLength===Ee$4,"k should be 'crypto_aead_chacha20poly1305_ietf_KEYBYTES' long"),le$5(e.byteLength<=Se$2,"message is too large"),n.byteLength<me$4)throw new Error("could not verify data");return de$5(e,r,n.subarray(0,n.byteLength-me$4),n.subarray(n.byteLength-me$4),o,a,h),n.byteLength-me$4},crypto_aead_chacha20poly1305_ietf_decrypt_detached:de$5,crypto_aead_chacha20poly1305_ietf_ABYTES:me$4,crypto_aead_chacha20poly1305_ietf_KEYBYTES:Ee$4,crypto_aead_chacha20poly1305_ietf_NPUBBYTES:ge$5,crypto_aead_chacha20poly1305_ietf_NSECBYTES:0,crypto_aead_chacha20poly1305_ietf_MESSAGEBYTES_MAX:Se$2};const Le$2=r$s;if(1!==new Uint16Array([1])[0])throw new Error("Big endian architecture is not supported.");function xe$4(t,e){return (t&=4294967295)<<(e&=4294967295)|t>>>32-e}function we$4(t,e){Le$2(t instanceof Uint8Array,"src not byte array");let r=t[e];return r|=t[e+1]<<8,r|=t[e+2]<<16,r|=t[e+3]<<24,r}function ve$4(t,e,r){Le$2(t instanceof Uint8Array,"dest not byte array");var n=1,o=0;for(t[r]=255&e;++o<4&&(n*=256);)t[r+o]=e/n&255;}function Ue$2(t,e,r,n,o){t[e]+=t[r],t[o]=xe$4(t[o]^t[e],16),t[n]+=t[o],t[r]=xe$4(t[r]^t[n],12),t[e]+=t[r],t[o]=xe$4(t[o]^t[e],8),t[n]+=t[o],t[r]=xe$4(t[r]^t[n],7);}var Me$2={crypto_core_hchacha20_INPUTBYTES:16,LOAD32_LE:we$4,STORE32_LE:ve$4,QUARTERROUND:Ue$2,crypto_core_hchacha20:function(t,e,r,n){Le$2(t instanceof Uint8Array&&32===t.length,"out is not an array of 32 bytes"),Le$2(r instanceof Uint8Array&&32===r.length,"k is not an array of 32 bytes"),Le$2(null===n||n instanceof Uint8Array&&16===n.length,"c is not null or an array of 16 bytes");let o=0;const a=new Uint32Array(16);for(n?(a[0]=we$4(n,0),a[1]=we$4(n,4),a[2]=we$4(n,8),a[3]=we$4(n,12)):(a[0]=1634760805,a[1]=857760878,a[2]=2036477234,a[3]=1797285236),a[4]=we$4(r,0),a[5]=we$4(r,4),a[6]=we$4(r,8),a[7]=we$4(r,12),a[8]=we$4(r,16),a[9]=we$4(r,20),a[10]=we$4(r,24),a[11]=we$4(r,28),a[12]=we$4(e,0),a[13]=we$4(e,4),a[14]=we$4(e,8),a[15]=we$4(e,12),o=0;o<10;o++)Ue$2(a,0,4,8,12),Ue$2(a,1,5,9,13),Ue$2(a,2,6,10,14),Ue$2(a,3,7,11,15),Ue$2(a,0,5,10,15),Ue$2(a,1,6,11,12),Ue$2(a,2,7,8,13),Ue$2(a,3,4,9,14);return ve$4(t,a[0],0),ve$4(t,a[1],4),ve$4(t,a[2],8),ve$4(t,a[3],12),ve$4(t,a[12],16),ve$4(t,a[13],20),ve$4(t,a[14],24),ve$4(t,a[15],28),0},crypto_core_hchacha20_outputbytes:function(){return 32},crypto_core_hchacha20_inputbytes:function(){return 16},crypto_core_hchacha20_keybytes:function(){return 32},crypto_core_hchacha20_constbytes:function(){return 16}};const ke$4=r$s,{randombytes_buf:Ne$2}=y$c.exports,{crypto_stream_chacha20_ietf:Ke$2,crypto_stream_chacha20_ietf_xor:Ce$2,crypto_stream_chacha20_ietf_xor_ic:Oe$2,crypto_stream_chacha20_ietf_KEYBYTES:Re$2}=ie$5,{crypto_core_hchacha20:Ie$2,crypto_core_hchacha20_INPUTBYTES:Pe$2}=Me$2,De$2=ht$5,{sodium_increment:Xe$2,sodium_is_zero:Ge$2,sodium_memcmp:Fe$2}=l$c,We$2=4,Ze$2=8,Ve$2=32,He$2=Number.MAX_SAFE_INTEGER,ze$2=Number.MAX_SAFE_INTEGER,je$2=new Uint8Array([0]),qe$2=new Uint8Array([1]),Qe$2=new Uint8Array([2]),Je$2=new Uint8Array([qe$2|Qe$2]),$e$2=Ve$2+Ze$2+We$2+8,tr$1=0,er$1=Ve$2,rr=er$1+Ze$2+We$2,nr=new Uint8Array(16);function or(t,e){let r=1,n=0;for(t[0]=255&e;++n<8&&(r*=256);)t[n]=e/r&255;}function ar(t){ke$4(t.byteLength===$e$2,"state is should be crypto_secretstream_xchacha20poly1305_STATEBYTES long");const e=t.subarray(er$1,rr);for(let t=0;t<We$2;t++)e[t]=0;e[0]=1;}function hr(t){ke$4(t.byteLength===$e$2,"state is should be crypto_secretstream_xchacha20poly1305_STATEBYTES long");const e=t.subarray(tr$1,er$1),r=t.subarray(er$1,rr),n=new Uint8Array(Re$2+Ze$2);let o;for(o=0;o<Re$2;o++)n[o]=e[o];for(o=0;o<Ze$2;o++)n[Re$2+o]=r[We$2+o];for(Ce$2(n,n,r,e),o=0;o<Re$2;o++)e[o]=n[o];for(o=0;o<Ze$2;o++)r[We$2+o]=n[Re$2+o];ar(t);}function sr$1(t,e,r){for(let n=0;n<r;n++)t[n]^=e[n];}var cr={crypto_secretstream_xchacha20poly1305_keygen:function(t){ke$4(t.length===Ve$2),Ne$2(t);},crypto_secretstream_xchacha20poly1305_init_push:function(t,e,r){ke$4(t.byteLength===$e$2,"state is should be crypto_secretstream_xchacha20poly1305_STATEBYTES long"),ke$4(e instanceof Uint8Array&&24===e.length,"out not byte array of length crypto_secretstream_xchacha20poly1305_HEADERBYTES"),ke$4(r instanceof Uint8Array&&r.length===Ve$2,"key not byte array of length crypto_secretstream_xchacha20poly1305_KEYBYTES");const n=t.subarray(tr$1,er$1),o=t.subarray(er$1,rr),a=t.subarray(rr);Ne$2(e,24),Ie$2(n,e,r,null),ar(t);for(let t=0;t<Ze$2;t++)o[t+We$2]=e[t+Pe$2];a.fill(0);},crypto_secretstream_xchacha20poly1305_init_pull:function(t,e,r){ke$4(t.byteLength===$e$2,"state is should be crypto_secretstream_xchacha20poly1305_STATEBYTES long"),ke$4(e instanceof Uint8Array&&24===e.length,"_in not byte array of length crypto_secretstream_xchacha20poly1305_HEADERBYTES"),ke$4(r instanceof Uint8Array&&r.length===Ve$2,"key not byte array of length crypto_secretstream_xchacha20poly1305_KEYBYTES");const n=t.subarray(tr$1,er$1),o=t.subarray(er$1,rr),a=t.subarray(rr);Ie$2(n,e,r,null),ar(t);for(let t=0;t<Ze$2;t++)o[t+We$2]=e[t+Pe$2];a.fill(0);},crypto_secretstream_xchacha20poly1305_rekey:hr,crypto_secretstream_xchacha20poly1305_push:function(t,e,r,n,o){ke$4(t.byteLength===$e$2,"state is should be crypto_secretstream_xchacha20poly1305_STATEBYTES long"),n||(n=new Uint8Array(0));const a=t.subarray(tr$1,er$1),h=t.subarray(er$1,rr),s=new Uint8Array(64),c=new Uint8Array(8);ke$4(He$2<=ze$2),Ke$2(s,h,a);const _=new De$2(s);s.fill(0),_.update(n,0,n.byteLength),_.update(nr,0,16-n.byteLength&15),s[0]=o[0],Oe$2(s,s,h,1,a),_.update(s,0,s.byteLength),e[0]=s[0];const y=e.subarray(1,e.byteLength);Oe$2(y,r,h,2,a),_.update(y,0,r.byteLength),_.update(nr,0,16-s.byteLength+r.byteLength&15),or(c,n.byteLength),_.update(c,0,c.byteLength),or(c,s.byteLength+r.byteLength),_.update(c,0,c.byteLength);const i=e.subarray(1+r.byteLength,e.byteLength);return _.finish(i,0),ke$4(16>=Ze$2),sr$1(h.subarray(We$2,h.length),i,Ze$2),Xe$2(h),(0!=(o[0]&Qe$2)||Ge$2(h.subarray(0,We$2)))&&hr(t),17+r.byteLength},crypto_secretstream_xchacha20poly1305_pull:function(t,e,r,n,o){ke$4(t.byteLength===$e$2,"state is should be crypto_secretstream_xchacha20poly1305_STATEBYTES long"),o||(o=new Uint8Array(0));const a=t.subarray(tr$1,er$1),h=t.subarray(er$1,rr),s=new Uint8Array(64),c=new Uint8Array(8),_=new Uint8Array(16);ke$4(n.byteLength>=17,"ciphertext is too short.");const y=n.byteLength-17;Ke$2(s,h,a);const i=new De$2(s);s.fill(0),i.update(o,0,o.byteLength),i.update(nr,0,16-o.byteLength&15),s.fill(0),s[0]=n[0],Oe$2(s,s,h,1,a),r[0]=s[0],s[0]=n[0],i.update(s,0,s.byteLength);const p=n.subarray(1,n.length);i.update(p,0,y),i.update(nr,0,16-s.byteLength+y&15),or(c,o.byteLength),i.update(c,0,c.byteLength),or(c,s.byteLength+e.byteLength),i.update(c,0,c.byteLength),i.finish(_,0);const u=n.subarray(1+y,n.length);if(!Fe$2(_,u))throw _.fill(0),new Error("MAC could not be verified.");return Oe$2(e,p.subarray(0,e.length),h,2,a),sr$1(h.subarray(We$2,h.length),_,Ze$2),Xe$2(h),(0!=(r&Qe$2)||Ge$2(h.subarray(0,We$2)))&&hr(t),y},crypto_secretstream_xchacha20poly1305_STATEBYTES:$e$2,crypto_secretstream_xchacha20poly1305_ABYTES:17,crypto_secretstream_xchacha20poly1305_HEADERBYTES:24,crypto_secretstream_xchacha20poly1305_KEYBYTES:Ve$2,crypto_secretstream_xchacha20poly1305_MESSAGEBYTES_MAX:He$2,crypto_secretstream_xchacha20poly1305_TAGBYTES:1,crypto_secretstream_xchacha20poly1305_TAG_MESSAGE:je$2,crypto_secretstream_xchacha20poly1305_TAG_PUSH:qe$2,crypto_secretstream_xchacha20poly1305_TAG_REKEY:Qe$2,crypto_secretstream_xchacha20poly1305_TAG_FINAL:Je$2},_r={},yr=U$a;if(1!==new Uint16Array([1])[0])throw new Error("Big endian architecture is not supported.");_r.crypto_shorthash_PRIMITIVE="siphash24",_r.crypto_shorthash_BYTES=yr.BYTES,_r.crypto_shorthash_KEYBYTES=yr.KEYBYTES,_r.crypto_shorthash_WASM_SUPPORTED=yr.WASM_SUPPORTED,_r.crypto_shorthash_WASM_LOADED=yr.WASM_LOADED,_r.crypto_shorthash=function(t,e,r,n){yr(e,r,t,n);};const{crypto_verify_32:ir}=u$f.exports,{crypto_hash:pr}=A$9,{gf:ur,gf0:fr,gf1:br,D:lr,D2:Er,X:gr,Y:mr,I:Sr,A:Yr,Z:Tr,M:dr,S:Br,sel25519:Ar,pack25519:Lr,inv25519:xr,unpack25519:wr}=D$9,{randombytes:vr}=y$c.exports,{crypto_scalarmult_BYTES:Ur}=tt$5,{crypto_hash_sha512_BYTES:Mr}=A$9,kr=r$s,Nr=64,Kr=32,Cr=64;var Or={crypto_sign_keypair:Fr,crypto_sign_seed_keypair:function(t,e,r){return Jr(r,32),e.set(r),Fr(t,e,!0)},crypto_sign:Hr,crypto_sign_detached:function(t,e,r){var n=new Uint8Array(e.length+Nr);Hr(n,e,r);for(let e=0;e<Nr;e++)t[e]=n[e];},crypto_sign_open:jr,crypto_sign_verify_detached:function(t,e,r){Jr(t,Nr);var n=new Uint8Array(e.length+Nr),o=0;for(o=0;o<Nr;o++)n[o]=t[o];for(o=0;o<e.length;o++)n[o+Nr]=e[o];return jr(e,n,r)},crypto_sign_BYTES:Nr,crypto_sign_PUBLICKEYBYTES:Kr,crypto_sign_SECRETKEYBYTES:Cr,crypto_sign_SEEDBYTES:32,crypto_sign_ed25519_PUBLICKEYBYTES:32,crypto_sign_ed25519_SECRETKEYBYTES:64,crypto_sign_ed25519_SEEDBYTES:32,crypto_sign_ed25519_BYTES:64,crypto_sign_ed25519_pk_to_curve25519:function(t,e){Jr(t,Kr),Jr(e,32);var r=[ur(),ur(),ur(),ur()],n=ur([1]),o=ur([1]);kr(function(t){var e,r=[Uint8Array.from([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Uint8Array.from([1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Uint8Array.from([38,232,149,143,194,178,39,176,69,195,244,137,242,239,152,240,213,223,172,5,211,198,51,57,177,56,2,136,109,83,252,5]),Uint8Array.from([199,23,106,112,61,77,216,79,186,60,11,118,13,16,103,15,42,32,83,250,44,57,204,198,78,199,253,119,146,172,3,122]),Uint8Array.from([236,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,127]),Uint8Array.from([237,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,127]),Uint8Array.from([238,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,127])],n=new Uint8Array(7);Jr(r,7);for(let o=0;o<r.length;o++)for(e=0;e<31;e++)n[o]|=t[e]^r[o][e];for(let o=0;o<r.length;o++)n[o]|=127&t[e]^r[o][e];var o=0;for(let t=0;t<r.length;t++)o|=n[t]-1;return 0==(o>>8&1)}(e)&&zr(r,e)&&function(t){var e=[ur(),ur(),ur(),ur()];!function(t,e){Xr(t,e,Wr);}(e,t);var r=0;for(let t=0;t<16;t++)r|=65535&e[0][t];return 0===r}(r),"Cannot convert key: bad point");for(let e=0;e<r.length;e++)Lr(t,r[e]);return Tr(o,o,r[1]),Yr(n,n,r[1]),xr(o,o),dr(n,n,o),Lr(t,n),0},crypto_sign_ed25519_sk_to_curve25519:function(t,e){kr(t&&t.byteLength===Ur,"curveSk must be 'crypto_sign_SECRETKEYBYTES' long"),kr(e&&64===e.byteLength,"edSk must be 'crypto_sign_ed25519_SECRETKEYBYTES' long");var r=new Uint8Array(Mr);return pr(r,e,32),r[0]&=248,r[31]&=127,r[31]|=64,t.set(r.subarray(0,Ur)),r.fill(0),t},crypto_sign_ed25519_sk_to_pk:function(t,e){return Jr(t,32),t.set(e.subarray(32)),t},unpackneg:zr,pack:Dr};function Rr(t,e){for(let r=0;r<16;r++)t[r]=0|e[r];}function Ir(t,e){var r=ur(),n=ur(),o=ur(),a=ur(),h=ur(),s=ur(),c=ur(),_=ur(),y=ur();Tr(r,t[1],t[0]),Tr(y,e[1],e[0]),dr(r,r,y),Yr(n,t[0],t[1]),Yr(y,e[0],e[1]),dr(n,n,y),dr(o,t[3],e[3]),dr(o,o,Er),dr(a,t[2],e[2]),Yr(a,a,a),Tr(h,n,r),Tr(s,a,o),Yr(c,a,o),Yr(_,n,r),dr(t[0],h,s),dr(t[1],_,c),dr(t[2],c,s),dr(t[3],h,_);}function Pr(t,e,r){var n;for(n=0;n<4;n++)Ar(t[n],e[n],r);}function Dr(t,e){var r=ur(),n=ur(),o=ur();xr(o,e[2]),dr(r,e[0],o),dr(n,e[1],o),Lr(t,n),t[31]^=qr(r)<<7;}function Xr(t,e,r){var n,o,a=[ur(e[0]),ur(e[1]),ur(e[2]),ur(e[3])];for(Rr(t[0],fr),Rr(t[1],br),Rr(t[2],br),Rr(t[3],fr),o=255;o>=0;--o)Pr(t,a,n=r[o/8|0]>>(7&o)&1),Ir(a,t),Ir(t,t),Pr(t,a,n);}function Gr(t,e){var r=[ur(),ur(),ur(),ur()];Rr(r[0],gr),Rr(r[1],mr),Rr(r[2],br),dr(r[3],gr,mr),Xr(t,r,e);}function Fr(t,e,r){Jr(t,Kr),Jr(e,Cr);var n,o=new Uint8Array(64),a=[ur(),ur(),ur(),ur()];for(r||vr(e,32),pr(o,e,32),o[0]&=248,o[31]&=127,o[31]|=64,Gr(a,o),Dr(t,a),n=0;n<32;n++)e[n+32]=t[n];}var Wr=new Float64Array([237,211,245,92,26,99,18,88,214,156,247,162,222,249,222,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16]);function Zr(t,e){var r,n,o,a;for(n=63;n>=32;--n){for(r=0,o=n-32,a=n-12;o<a;++o)e[o]+=r-16*e[n]*Wr[o-(n-32)],r=e[o]+128>>8,e[o]-=256*r;e[o]+=r,e[n]=0;}for(r=0,o=0;o<32;o++)e[o]+=r-(e[31]>>4)*Wr[o],r=e[o]>>8,e[o]&=255;for(o=0;o<32;o++)e[o]-=r*Wr[o];for(n=0;n<32;n++)e[n+1]+=e[n]>>8,t[n]=255&e[n];}function Vr(t){var e=new Float64Array(64);for(let r=0;r<64;r++)e[r]=t[r];for(let e=0;e<64;e++)t[e]=0;Zr(t,e);}function Hr(t,e,r){Jr(t,Nr+e.length),Jr(e,0),Jr(r,Cr);var n,o,a=e.length,h=new Uint8Array(64),s=new Uint8Array(64),c=new Uint8Array(64),_=new Float64Array(64),y=[ur(),ur(),ur(),ur()];pr(h,r,32),h[0]&=248,h[31]&=127,h[31]|=64;var i=a+64;for(n=0;n<a;n++)t[64+n]=e[n];for(n=0;n<32;n++)t[32+n]=h[32+n];for(pr(c,t.subarray(32),a+32),Vr(c),Gr(y,c),Dr(t,y),n=32;n<64;n++)t[n]=r[n];for(pr(s,t,a+64),Vr(s),n=0;n<64;n++)_[n]=0;for(n=0;n<32;n++)_[n]=c[n];for(n=0;n<32;n++)for(o=0;o<32;o++)_[n+o]+=s[n]*h[o];return Zr(t.subarray(32),_),i}function zr(t,e){var r=ur(),n=ur(),o=ur(),a=ur(),h=ur(),s=ur(),c=ur();return Rr(t[2],br),wr(t[1],e),Br(o,t[1]),dr(a,o,lr),Tr(o,o,t[2]),Yr(a,t[2],a),Br(h,a),Br(s,h),dr(c,s,h),dr(r,c,o),dr(r,r,a),function(t,e){var r,n=ur();for(r=0;r<16;r++)n[r]=e[r];for(r=250;r>=0;r--)Br(n,n),1!==r&&dr(n,n,e);for(r=0;r<16;r++)t[r]=n[r];}(r,r),dr(r,r,o),dr(r,r,a),dr(r,r,a),dr(t[0],r,a),Br(n,t[0]),dr(n,n,a),Qr(n,o)||dr(t[0],t[0],Sr),Br(n,t[0]),dr(n,n,a),!!Qr(n,o)&&(qr(t[0])===e[31]>>7&&Tr(t[0],ur(),t[0]),dr(t[3],t[0],t[1]),!0)}function jr(t,e,r){Jr(t,e.length-Nr),Jr(e,Nr),Jr(r,Kr);var n,o=e.length,a=new Uint8Array(e.length),h=new Uint8Array(32),s=new Uint8Array(64),c=[ur(),ur(),ur(),ur()],_=[ur(),ur(),ur(),ur()];if(o<64)return !1;if(!zr(_,r))return !1;for(n=0;n<o;n++)a[n]=e[n];for(n=0;n<32;n++)a[n+32]=r[n];if(pr(s,a,o),Vr(s),Xr(c,_,s),Gr(_,e.subarray(32)),Ir(c,_),Dr(h,c),o-=64,!ir(e,0,h,0)){for(n=0;n<o;n++)a[n]=0;return !1}for(n=0;n<o;n++)t[n]=e[n+64];return !0}function qr(t){var e=new Uint8Array(32);return Lr(e,t),1&e[0]}function Qr(t,e){var r=new Uint8Array(32),n=new Uint8Array(32);return Lr(r,t),Lr(n,e),ir(r,0,n,0)}function Jr(t,e,r="Argument"){if(!t||e&&t.length<e)throw new Error(r+" must be a buffer"+(e?" of length "+e:""))}!function(t){function e(e){Object.keys(e).forEach((function(r){t.exports[r]=e[r];}));}e(y$c.exports),e(p$c),e(l$c),e(u$f.exports),e(S$9),e(jt$2),e(nt$4.exports),e(A$9),e(oe$5),e(ae$5.exports),e(ye$4),e(Ae$2),e(pt$4),e(tt$5),e(Lt$4),e(cr),e(_r),e(Or),e(ot$4),e(ie$5);}(_$a);var $r=_$a.exports;

/**
 * Bundled by jsDelivr using Rollup v2.79.1 and Terser v5.19.2.
 * Original file: /npm/sodium-universal@4.0.1/index.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
var m$a=$r;

/**
 * Bundled by jsDelivr using Rollup v2.79.1 and Terser v5.19.2.
 * Original file: /npm/compact-encoding@2.15.0/index.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
var t$g={},r$f={};const n$g=r$f.LE=255===new Uint8Array(new Uint16Array([255]).buffer)[0];r$f.BE=!n$g;var o$f={exports:{}};!function(t,n){const o=L$b,{BE:d}=r$f;n=t.exports={preencode(e,t){e.end+=t.byteLength;},encode(e,t){e.buffer.set(t,e.start),e.start+=t.byteLength;},decode(e){const t=e.buffer.subarray(e.start,e.end);return e.start=e.end,t}};const f=n.buffer={preencode(e,t){t?s.preencode(e,t):e.end++;},encode(e,t){t?s.encode(e,t):e.buffer[e.start++]=0;},decode(e){const t=e.buffer.subarray(e.start);return 0===t.byteLength?null:(e.start=e.end,t)}};function a(e,t){const r=e.BYTES_PER_ELEMENT;return {preencode(e,t){e.end+=t.byteLength;},encode(e,r){const n=new Uint8Array(r.buffer,r.byteOffset,r.byteLength);d&&t&&t(n),e.buffer.set(n,e.start),e.start+=r.byteLength;},decode(n){let o=n.buffer.subarray(n.start);return o.byteOffset%r!=0&&(o=new Uint8Array(o)),d&&t&&t(o),n.start=n.end,new e(o.buffer,o.byteOffset,o.byteLength/r)}}}n.binary={...f,preencode(e,t){"string"==typeof t?u.preencode(e,t):f.preencode(e,t);},encode(e,t){"string"==typeof t?u.encode(e,t):f.encode(e,t);}},n.arraybuffer={preencode(e,t){e.end+=t.byteLength;},encode(e,t){const r=new Uint8Array(t);e.buffer.set(r,e.start),e.start+=t.byteLength;},decode(e){const t=new ArrayBuffer(e.end-e.start);return new Uint8Array(t).set(e.buffer.subarray(e.start)),e.start=e.end,t}};const s=n.uint8array=a(Uint8Array);function c(e){return {preencode(t,r){t.end+=o.byteLength(r,e);},encode(t,r){t.start+=o.write(t.buffer,r,t.start,e);},decode(t){const r=o.toString(t.buffer,e,t.start);return t.start=t.end,r}}}n.uint16array=a(Uint16Array,o.swap16),n.uint32array=a(Uint32Array,o.swap32),n.int8array=a(Int8Array),n.int16array=a(Int16Array,o.swap16),n.int32array=a(Int32Array,o.swap32),n.biguint64array=a(BigUint64Array,o.swap64),n.bigint64array=a(BigInt64Array,o.swap64),n.float32array=a(Float32Array,o.swap32),n.float64array=a(Float64Array,o.swap64);const u=n.string=n.utf8=c("utf-8");n.ascii=c("ascii"),n.hex=c("hex"),n.base64=c("base64"),n.ucs2=n.utf16le=c("utf16le"),n.array=function(e){return {preencode(t,r){for(const n of r)e.preencode(t,n);},encode(t,r){for(const n of r)e.encode(t,n);},decode(t){const r=[];for(;t.start<t.end;)r.push(e.decode(t));return r}}},n.json={preencode(e,t){u.preencode(e,JSON.stringify(t));},encode(e,t){u.encode(e,JSON.stringify(t));},decode:e=>JSON.parse(u.decode(e))},n.ndjson={preencode(e,t){u.preencode(e,JSON.stringify(t)+"\n");},encode(e,t){u.encode(e,JSON.stringify(t)+"\n");},decode:e=>JSON.parse(u.decode(e))};}(o$f,o$f.exports);var d$b={preencode:function e(t,r){if(r<251)t.end++;else if(r<256)t.end+=2;else if(r<65536)t.end+=3;else if(r<16777216)t.end+=4;else if(r<4294967296)t.end+=5;else {t.end++;const n=Math.floor(Math.log(r)/Math.log(2))-32;e(t,n),t.end+=6;}},encode:function e(t,r){const n=251,o=r-n;if(r<n)t.buffer[t.start++]=r;else if(r<256)t.buffer[t.start++]=n,t.buffer[t.start++]=o;else if(r<65536)t.buffer[t.start++]=252,t.buffer[t.start++]=o>>8&255,t.buffer[t.start++]=255&o;else if(r<16777216)t.buffer[t.start++]=253,t.buffer[t.start++]=o>>16,t.buffer[t.start++]=o>>8&255,t.buffer[t.start++]=255&o;else if(r<4294967296)t.buffer[t.start++]=254,t.buffer[t.start++]=o>>24,t.buffer[t.start++]=o>>16&255,t.buffer[t.start++]=o>>8&255,t.buffer[t.start++]=255&o;else {const r=Math.floor(Math.log(o)/Math.log(2))-32;t.buffer[t.start++]=255,e(t,r);const n=o/Math.pow(2,r-11);for(let e=5;e>=0;e--)t.buffer[t.start++]=n/Math.pow(2,8*e)&255;}},decode:function e(t){const r=251;if(t.end-t.start<1)throw new Error("Out of bounds");const n=t.buffer[t.start++];if(n<r)return n;if(t.end-t.start<n-r+1)throw new Error("Out of bounds.");if(n<252)return t.buffer[t.start++]+r;if(n<253)return (t.buffer[t.start++]<<8)+t.buffer[t.start++]+r;if(n<254)return (t.buffer[t.start++]<<16)+(t.buffer[t.start++]<<8)+t.buffer[t.start++]+r;if(n<255)return 16777216*t.buffer[t.start++]+(t.buffer[t.start++]<<16)+(t.buffer[t.start++]<<8)+t.buffer[t.start++]+r;const o=e(t);if(t.end-t.start<6)throw new Error("Out of bounds");let d=0;for(let e=5;e>=0;e--)d+=t.buffer[t.start++]*Math.pow(2,8*e);return d*Math.pow(2,o-11)+r}};!function(t){const n=L$b,{BE:f}=r$f;t.state=function(e=0,t=0,r=null){return {start:e,end:t,buffer:r,cache:null}};const a=t.raw=o$f.exports,s=t.uint={preencode(e,t){e.end+=t<=252?1:t<=65535?3:t<=4294967295?5:9;},encode(e,t){t<=252?c.encode(e,t):t<=65535?(e.buffer[e.start++]=253,u.encode(e,t)):t<=4294967295?(e.buffer[e.start++]=254,b.encode(e,t)):(e.buffer[e.start++]=255,w.encode(e,t));},decode(e){const t=c.decode(e);return t<=252?t:253===t?u.decode(e):254===t?b.decode(e):w.decode(e)}},c=t.uint8={preencode(e,t){e.end+=1;},encode(e,t){e.buffer[e.start++]=t;},decode(e){if(e.start>=e.end)throw new Error("Out of bounds");return e.buffer[e.start++]}},u=t.uint16={preencode(e,t){e.end+=2;},encode(e,t){e.buffer[e.start++]=t,e.buffer[e.start++]=t>>>8;},decode(e){if(e.end-e.start<2)throw new Error("Out of bounds");return e.buffer[e.start++]+256*e.buffer[e.start++]}},i=t.uint24={preencode(e,t){e.end+=3;},encode(e,t){e.buffer[e.start++]=t,e.buffer[e.start++]=t>>>8,e.buffer[e.start++]=t>>>16;},decode(e){if(e.end-e.start<3)throw new Error("Out of bounds");return e.buffer[e.start++]+256*e.buffer[e.start++]+65536*e.buffer[e.start++]}},b=t.uint32={preencode(e,t){e.end+=4;},encode(e,t){e.buffer[e.start++]=t,e.buffer[e.start++]=t>>>8,e.buffer[e.start++]=t>>>16,e.buffer[e.start++]=t>>>24;},decode(e){if(e.end-e.start<4)throw new Error("Out of bounds");return e.buffer[e.start++]+256*e.buffer[e.start++]+65536*e.buffer[e.start++]+16777216*e.buffer[e.start++]}},y=t.uint40={preencode(e,t){e.end+=5;},encode(e,t){const r=Math.floor(t/256);c.encode(e,t),b.encode(e,r);},decode(e){if(e.end-e.start<5)throw new Error("Out of bounds");return c.decode(e)+256*b.decode(e)}},p=t.uint48={preencode(e,t){e.end+=6;},encode(e,t){const r=Math.floor(t/65536);u.encode(e,t),b.encode(e,r);},decode(e){if(e.end-e.start<6)throw new Error("Out of bounds");return u.decode(e)+65536*b.decode(e)}},l=t.uint56={preencode(e,t){e.end+=7;},encode(e,t){const r=Math.floor(t/16777216);i.encode(e,t),b.encode(e,r);},decode(e){if(e.end-e.start<7)throw new Error("Out of bounds");return i.decode(e)+16777216*b.decode(e)}},w=t.uint64={preencode(e,t){e.end+=8;},encode(e,t){const r=Math.floor(t/4294967296);b.encode(e,t),b.encode(e,r);},decode(e){if(e.end-e.start<8)throw new Error("Out of bounds");return b.decode(e)+4294967296*b.decode(e)}};t.int=J(s),t.int8=J(c),t.int16=J(u),t.int24=J(i),t.int32=J(b),t.int40=J(y),t.int48=J(p),t.int56=J(l),t.int64=J(w);const g=t.biguint64={preencode(e,t){e.end+=8;},encode(e,t){new DataView(e.buffer.buffer,e.start+e.buffer.byteOffset,8).setBigUint64(0,t,!0),e.start+=8;},decode(e){if(e.end-e.start<8)throw new Error("Out of bounds");const t=new DataView(e.buffer.buffer,e.start+e.buffer.byteOffset,8).getBigUint64(0,!0);return e.start+=8,t}};t.bigint64=I(g);const h=t.biguint={preencode(e,t){let r=0;for(let e=t;e;e>>=64n)r++;s.preencode(e,r),e.end+=8*r;},encode(e,t){let r=0;for(let e=t;e;e>>=64n)r++;s.encode(e,r);const n=new DataView(e.buffer.buffer,e.start+e.buffer.byteOffset,8*r);for(let e=t,r=0;e;e>>=64n,r+=8)n.setBigUint64(r,BigInt.asUintN(64,e),!0);e.start+=8*r;},decode(e){const t=s.decode(e);if(e.end-e.start<8*t)throw new Error("Out of bounds");const r=new DataView(e.buffer.buffer,e.start+e.buffer.byteOffset,8*t);let n=0n;for(let e=t-1;e>=0;e--)n=(n<<64n)+r.getBigUint64(8*e,!0);return e.start+=8*t,n}};t.bigint=I(h),t.lexint=d$b,t.float32={preencode(e,t){e.end+=4;},encode(e,t){new DataView(e.buffer.buffer,e.start+e.buffer.byteOffset,4).setFloat32(0,t,!0),e.start+=4;},decode(e){if(e.end-e.start<4)throw new Error("Out of bounds");const t=new DataView(e.buffer.buffer,e.start+e.buffer.byteOffset,4).getFloat32(0,!0);return e.start+=4,t}},t.float64={preencode(e,t){e.end+=8;},encode(e,t){new DataView(e.buffer.buffer,e.start+e.buffer.byteOffset,8).setFloat64(0,t,!0),e.start+=8;},decode(e){if(e.end-e.start<8)throw new Error("Out of bounds");const t=new DataView(e.buffer.buffer,e.start+e.buffer.byteOffset,8).getFloat64(0,!0);return e.start+=8,t}};const O=t.buffer={preencode(e,t){t?A.preencode(e,t):e.end++;},encode(e,t){t?A.encode(e,t):e.buffer[e.start++]=0;},decode(e){const t=s.decode(e);if(0===t)return null;if(e.end-e.start<t)throw new Error("Out of bounds");return e.buffer.subarray(e.start,e.start+=t)}};function E(e,t){const r=e.BYTES_PER_ELEMENT;return {preencode(e,t){s.preencode(e,t.length),e.end+=t.byteLength;},encode(e,r){s.encode(e,r.length);const n=new Uint8Array(r.buffer,r.byteOffset,r.byteLength);f&&t&&t(n),e.buffer.set(n,e.start),e.start+=r.byteLength;},decode(n){const o=s.decode(n);let d=n.buffer.subarray(n.start,n.start+=o*r);if(d.byteLength!==o*r)throw new Error("Out of bounds");return d.byteOffset%r!=0&&(d=new Uint8Array(d)),f&&t&&t(d),new e(d.buffer,d.byteOffset,d.byteLength/r)}}}t.binary={...O,preencode(e,t){"string"==typeof t?U.preencode(e,t):O.preencode(e,t);},encode(e,t){"string"==typeof t?U.encode(e,t):O.encode(e,t);}},t.arraybuffer={preencode(e,t){s.preencode(e,t.byteLength),e.end+=t.byteLength;},encode(e,t){s.encode(e,t.byteLength);const r=new Uint8Array(t);e.buffer.set(r,e.start),e.start+=t.byteLength;},decode(e){const t=s.decode(e),r=new ArrayBuffer(t);return new Uint8Array(r).set(e.buffer.subarray(e.start,e.start+=t)),r}};const A=t.uint8array=E(Uint8Array);function L(e){return {preencode(t,r){const o=n.byteLength(r,e);s.preencode(t,o),t.end+=o;},encode(t,r){const o=n.byteLength(r,e);s.encode(t,o),n.write(t.buffer,r,t.start,e),t.start+=o;},decode(t){const r=s.decode(t);if(t.end-t.start<r)throw new Error("Out of bounds");return n.toString(t.buffer,e,t.start,t.start+=r)},fixed:t=>({preencode(e){e.end+=t;},encode(r,o){n.write(r.buffer,o,r.start,t,e),r.start+=t;},decode(r){if(r.end-r.start<t)throw new Error("Out of bounds");return n.toString(r.buffer,e,r.start,r.start+=t)}})}}t.uint16array=E(Uint16Array,n.swap16),t.uint32array=E(Uint32Array,n.swap32),t.int8array=E(Int8Array),t.int16array=E(Int16Array,n.swap16),t.int32array=E(Int32Array,n.swap32),t.biguint64array=E(BigUint64Array,n.swap64),t.bigint64array=E(BigInt64Array,n.swap64),t.float32array=E(Float32Array,n.swap32),t.float64array=E(Float64Array,n.swap64);const U=t.string=t.utf8=L("utf-8");t.ascii=L("ascii"),t.hex=L("hex"),t.base64=L("base64"),t.ucs2=t.utf16le=L("utf16le"),t.bool={preencode(e,t){e.end++;},encode(e,t){e.buffer[e.start++]=t?1:0;},decode(e){if(e.start>=e.end)throw Error("Out of bounds");return 1===e.buffer[e.start++]}};const x=t.fixed=function(e){return {preencode(t,r){t.end+=e;},encode(t,r){t.buffer.set(r,t.start),t.start+=e;},decode(t){if(t.end-t.start<e)throw new Error("Out of bounds");return t.buffer.subarray(t.start,t.start+=e)}}};t.fixed32=x(32),t.fixed64=x(64),t.array=function(e){return {preencode(t,r){s.preencode(t,r.length);for(let n=0;n<r.length;n++)e.preencode(t,r[n]);},encode(t,r){s.encode(t,r.length);for(let n=0;n<r.length;n++)e.encode(t,r[n]);},decode(t){const r=s.decode(t);if(r>1048576)throw new Error("Array is too big");const n=new Array(r);for(let o=0;o<r;o++)n[o]=e.decode(t);return n}}},t.frame=function(e){const r=t.state();return {preencode(t,r){const n=t.end;e.preencode(t,r),s.preencode(t,t.end-n);},encode(t,n){r.end=0,e.preencode(r,n),s.encode(t,r.end),e.encode(t,n);},decode(t){const r=t.end,n=s.decode(t);t.end=t.start+n;const o=e.decode(t);return t.start=t.end,t.end=r,o}}},t.json={preencode(e,t){U.preencode(e,JSON.stringify(t));},encode(e,t){U.encode(e,JSON.stringify(t));},decode:e=>JSON.parse(U.decode(e))},t.ndjson={preencode(e,t){U.preencode(e,JSON.stringify(t)+"\n");},encode(e,t){U.encode(e,JSON.stringify(t)+"\n");},decode:e=>JSON.parse(U.decode(e))},t.none={preencode(e,t){},encode(e,t){},decode:e=>null};const B={preencode(e,t){s.preencode(e,t.length);for(let r=0;r<t.length;r++)N.preencode(e,t[r]);},encode(e,t){s.encode(e,t.length);for(let r=0;r<t.length;r++)N.encode(e,t[r]);},decode(e){const t=[];let r=s.decode(e);for(;r-- >0;)t.push(N.decode(e));return t}},S={preencode(e,t){const r=Object.keys(t);s.preencode(e,r.length);for(const n of r)U.preencode(e,n),N.preencode(e,t[n]);},encode(e,t){const r=Object.keys(t);s.encode(e,r.length);for(const n of r)U.encode(e,n),N.encode(e,t[n]);},decode(e){let t=s.decode(e);const r={};for(;t-- >0;){r[U.decode(e)]=N.decode(e);}return r}},M=[t.none,t.bool,t.string,t.buffer,t.uint,t.int,t.float64,B,S],N=t.any={preencode(e,t){const r=j(t);s.preencode(e,r),M[r].preencode(e,t);},encode(e,t){const r=j(t);s.encode(e,r),M[r].encode(e,t);},decode(e){const t=s.decode(e);if(t>=M.length)throw new Error("Unknown type: "+t);return M[t].decode(e)}};function j(e){if(null==e)return 0;if("boolean"==typeof e)return 1;if("string"==typeof e)return 2;if(n.isBuffer(e))return 3;if("number"==typeof e)return Number.isInteger(e)?e>=0?4:5:6;if(Array.isArray(e))return 7;if("object"==typeof e)return 8;throw new Error("Unsupported type for "+e)}function J(e){return {preencode(t,r){e.preencode(t,m(r));},encode(t,r){e.encode(t,m(r));},decode(t){return 0===(r=e.decode(t))?r:0==(1&r)?r/2:-(r+1)/2;var r;}}}function m(e){return e<0?2*-e-1:0===e?0:2*e}function I(e){return {preencode(t,r){e.preencode(t,D(r));},encode(t,r){e.encode(t,D(r));},decode(t){return 0n===(r=e.decode(t))?r:0n===(1n&r)?r/2n:-(r+1n)/2n;var r;}}}function D(e){return e<0n?2n*-e-1n:0n===e?0n:2n*e}t.from=function(e){return "string"==typeof e?function(e){switch(e){case"ascii":return a.ascii;case"utf-8":case"utf8":return a.utf8;case"hex":return a.hex;case"base64":return a.base64;case"utf16-le":case"utf16le":case"ucs-2":case"ucs2":return a.ucs2;case"ndjson":return a.ndjson;case"json":return a.json;default:return a.binary}}(e):e.preencode?e:e.encodingLength?function(e){return {preencode(t,r){t.end+=e.encodingLength(r);},encode(t,r){e.encode(r,t.buffer,t.start),t.start+=e.encode.bytes;},decode(t){const r=e.decode(t.buffer,t.start,t.end);return t.start+=e.decode.bytes,r}}}(e):function(e){let t=null,r=null;return {preencode(n,o){t=o,r=e.encode(o),n.end+=r.byteLength;},encode(n,o){a.encode(n,o===t?r:e.encode(o)),t=r=null;},decode:t=>e.decode(a.decode(t))}}(e)},t.encode=function(e,r){const o=t.state();return e.preencode(o,r),o.buffer=n.allocUnsafe(o.end),e.encode(o,r),o.buffer},t.decode=function(e,r){return e.decode(t.state(0,r.byteLength,r))};}(t$g);t$g.array;t$g.arraybuffer;t$g.ascii;t$g.base64;t$g.bigint;t$g.bigint64;t$g.bigint64array;t$g.biguint64array;t$g.binary;t$g.bool;t$g.decode;t$g.encode;t$g.fixed32;t$g.fixed64;t$g.float32;t$g.float32array;t$g.float64;t$g.float64array;t$g.frame;t$g.from;t$g.hex;t$g.int;t$g.int16;t$g.int16array;t$g.int24;t$g.int32;t$g.int32array;t$g.int40;t$g.int48;t$g.int56;t$g.int64;t$g.int8;t$g.int8array;t$g.json;t$g.lexint;t$g.ndjson;t$g.none;t$g.state;t$g.ucs2;t$g.uint16array;t$g.uint32array;t$g.utf16le;

/**
 * Bundled by jsDelivr using Rollup v2.79.1 and Terser v5.19.2.
 * Original file: /npm/hypercore-crypto@3.4.2/index.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
var o$e={};const c$f=m$a,a$9=t$g,s$e=L$b,i$c=s$e.from([0]),f$b=s$e.from([1]),u$e=s$e.from([2]),y$b=s$e.from("hypercore");o$e.keyPair=function(e){const n=s$e.allocUnsafeSlow(c$f.crypto_sign_PUBLICKEYBYTES+c$f.crypto_sign_SECRETKEYBYTES),r=n.subarray(0,c$f.crypto_sign_PUBLICKEYBYTES),t=n.subarray(c$f.crypto_sign_PUBLICKEYBYTES);return e?c$f.crypto_sign_seed_keypair(r,t,e):c$f.crypto_sign_keypair(r,t),{publicKey:r,secretKey:t}};o$e.validateKeyPair=function(e){const n=s$e.allocUnsafe(c$f.crypto_sign_PUBLICKEYBYTES);return c$f.crypto_sign_ed25519_sk_to_pk(n,e.secretKey),s$e.equals(n,e.publicKey)};o$e.sign=function(e,n){const r=s$e.allocUnsafeSlow(c$f.crypto_sign_BYTES);return c$f.crypto_sign_detached(r,e,n),r};o$e.verify=function(e,n,r){return c$f.crypto_sign_verify_detached(n,e,r)};o$e.data=function(e){const n=s$e.allocUnsafe(32);return c$f.crypto_generichash_batch(n,[i$c,a$9.encode(a$9.uint64,e.byteLength),e]),n};o$e.parent=function(e,n){if(e.index>n.index){const r=e;e=n,n=r;}const r=s$e.allocUnsafe(32);return c$f.crypto_generichash_batch(r,[f$b,a$9.encode(a$9.uint64,e.size+n.size),e.hash,n.hash]),r};o$e.tree=function(e,n){const r=new Array(3*e.length+1);let t=0;r[t++]=u$e;for(let n=0;n<e.length;n++){const o=e[n];r[t++]=o.hash,r[t++]=a$9.encode(a$9.uint64,o.index),r[t++]=a$9.encode(a$9.uint64,o.size);}return n||(n=s$e.allocUnsafe(32)),c$f.crypto_generichash_batch(n,r),n};o$e.hash=function(e,n){return n||(n=s$e.allocUnsafe(32)),Array.isArray(e)||(e=[e]),c$f.crypto_generichash_batch(n,e),n};o$e.randomBytes=function(e){const n=s$e.allocUnsafe(e);return c$f.randombytes_buf(n),n};o$e.discoveryKey=function(e){const n=s$e.allocUnsafeSlow(32);return c$f.crypto_generichash(n,y$b,e),n};c$f.sodium_free?o$e.free=function(e){e.secure&&c$f.sodium_free(e);}:o$e.free=function(){};o$e.namespace=function(e,n){const r="number"==typeof n?function(e){const n=new Array(e);for(let r=0;r<e;r++)n[r]=r;return n}(n):n,t=s$e.allocUnsafeSlow(32*r.length),o=new Array(r.length),a=s$e.allocUnsafe(33);c$f.crypto_generichash(a.subarray(0,32),"string"==typeof e?s$e.from(e):e);for(let e=0;e<o.length;e++)o[e]=t.subarray(32*e,32*e+32),a[32]=r[e],c$f.crypto_generichash(o[e],a);return o};

/**
 * Bundled by jsDelivr using Rollup v2.79.1 and Terser v5.19.2.
 * Original file: /npm/xache@1.2.1/index.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
var t$f=class t{constructor({maxSize:t,maxAge:s,createMap:i,ongc:h}){if(this.maxSize=t,this.maxAge=s,this.ongc=h||null,this._createMap=i||e$a,this._latest=this._createMap(),this._oldest=this._createMap(),this._retained=this._createMap(),this._gced=!1,this._interval=null,this.maxAge>0&&this.maxAge<1/0){const t=Math.ceil(2/3*this.maxAge);this._interval=setInterval(this._gcAuto.bind(this),t),this._interval.unref&&this._interval.unref();}}*[Symbol.iterator](){for(const t of [this._latest,this._oldest,this._retained])yield*t;}*keys(){for(const t of [this._latest,this._oldest,this._retained])yield*t.keys();}*values(){for(const t of [this._latest,this._oldest,this._retained])yield*t.values();}destroy(){this.clear(),clearInterval(this._interval),this._interval=null;}clear(){this._gced=!0,this._latest.clear(),this._oldest.clear(),this._retained.clear();}set(t,e){return this._retained.has(t)||(this._latest.set(t,e),this._oldest.delete(t)||this._retained.delete(t),this._latest.size>=this.maxSize&&this._gc()),this}retain(t,e){return this._retained.set(t,e),this._latest.delete(t)||this._oldest.delete(t),this}delete(t){return this._latest.delete(t)||this._oldest.delete(t)||this._retained.delete(t)}has(t){return this._latest.has(t)||this._oldest.has(t)||this._retained.has(t)}get(t){if(this._latest.has(t))return this._latest.get(t);if(this._oldest.has(t)){const e=this._oldest.get(t);return this._latest.set(t,e),this._oldest.delete(t),e}return this._retained.has(t)?this._retained.get(t):null}_gcAuto(){this._gced||this._gc(),this._gced=!1;}_gc(){this._gced=!0,null!==this.ongc&&this._oldest.size>0&&this.ongc(this._oldest),this._oldest=this._latest,this._latest=this._createMap();}};function e$a(){return new Map}

/**
 * Bundled by jsDelivr using Rollup v2.79.1 and Terser v5.19.2.
 * Original file: /npm/sodium-secretstream@1.1.0/index.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
const s$d=m$a,a$8=L$b,r$e=s$d.crypto_secretstream_xchacha20poly1305_ABYTES,c$e=s$d.crypto_secretstream_xchacha20poly1305_TAG_MESSAGE,o$d=s$d.crypto_secretstream_xchacha20poly1305_TAG_FINAL,h$9=s$d.crypto_secretstream_xchacha20poly1305_STATEBYTES,l$b=s$d.crypto_secretstream_xchacha20poly1305_HEADERBYTES,p$b=s$d.crypto_secretstream_xchacha20poly1305_KEYBYTES,_$9=a$8.isBuffer(o$d)?o$d[0]:o$d,n$f=a$8.alloc(0),i$b=a$8.alloc(1);var y$a={keygen:function(t=a$8.alloc(p$b)){return s$d.crypto_secretstream_xchacha20poly1305_keygen(t),t},KEYBYTES:p$b,ABYTES:r$e,STATEBYTES:h$9,HEADERBYTES:l$b,Push:class{constructor(t,e=a$8.allocUnsafe(h$9),r=a$8.allocUnsafe(l$b)){if(!o$d)throw new Error("JavaScript sodium version needs to support crypto_secretstream_xchacha20poly");this.key=t,this.state=e,this.header=r,s$d.crypto_secretstream_xchacha20poly1305_init_push(this.state,this.header,this.key);}next(t,e=a$8.allocUnsafe(t.byteLength+r$e)){return s$d.crypto_secretstream_xchacha20poly1305_push(this.state,e,t,null,c$e),e}final(t=n$f,e=a$8.allocUnsafe(r$e)){return s$d.crypto_secretstream_xchacha20poly1305_push(this.state,e,t,null,o$d),e}},Pull:class{constructor(t,e=a$8.allocUnsafe(h$9)){if(!o$d)throw new Error("JavaScript sodium version needs to support crypto_secretstream_xchacha20poly");this.key=t,this.state=e,this.final=!1;}init(t){s$d.crypto_secretstream_xchacha20poly1305_init_pull(this.state,t,this.key);}next(t,e=a$8.allocUnsafe(t.byteLength-r$e)){return s$d.crypto_secretstream_xchacha20poly1305_pull(this.state,e,i$b,t,null),this.final=i$b[0]===_$9,e}}};

/**
 * Bundled by jsDelivr using Rollup v2.79.1 and Terser v5.19.2.
 * Original file: /npm/text-decoder@1.1.0/index.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
const t$e=L$b;const s$c=L$b;const n$e=class n{constructor(e){this.encoding=e;}decode(e){return t$e.toString(e,this.encoding)}flush(){return ""}},i$a=class i{constructor(){this.codePoint=0,this.bytesSeen=0,this.bytesNeeded=0,this.lowerBoundary=128,this.upperBoundary=191;}decode(e){if(0===this.bytesNeeded){let t=!0;for(let s=Math.max(0,e.byteLength-4),n=e.byteLength;s<n&&t;s++)t=e[s]<=127;if(t)return s$c.toString(e,"utf8")}let t="";for(let s=0,n=e.byteLength;s<n;s++){const n=e[s];0!==this.bytesNeeded?n<this.lowerBoundary||n>this.upperBoundary?(this.codePoint=0,this.bytesNeeded=0,this.bytesSeen=0,this.lowerBoundary=128,this.upperBoundary=191,t+="�"):(this.lowerBoundary=128,this.upperBoundary=191,this.codePoint=this.codePoint<<6|63&n,this.bytesSeen++,this.bytesSeen===this.bytesNeeded&&(t+=String.fromCodePoint(this.codePoint),this.codePoint=0,this.bytesNeeded=0,this.bytesSeen=0)):n<=127?t+=String.fromCharCode(n):n>=194&&n<=223?(this.bytesNeeded=1,this.codePoint=31&n):n>=224&&n<=239?(224===n?this.lowerBoundary=160:237===n&&(this.upperBoundary=159),this.bytesNeeded=2,this.codePoint=15&n):n>=240&&n<=244?(240===n&&(this.lowerBoundary=144),244===n&&(this.upperBoundary=143),this.bytesNeeded=3,this.codePoint=7&n):t+="�";}return t}flush(){const e=this.bytesNeeded>0?"�":"";return this.codePoint=0,this.bytesNeeded=0,this.bytesSeen=0,this.lowerBoundary=128,this.upperBoundary=191,e}};var o$c=class o{constructor(e="utf8"){switch(this.encoding=function(e){switch(e=e.toLowerCase()){case"utf8":case"utf-8":return "utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return "utf16le";case"latin1":case"binary":return "latin1";case"base64":case"ascii":case"hex":return e;default:throw new Error("Unknown encoding: "+e)}}(e),this.encoding){case"utf8":this.decoder=new i$a;break;case"utf16le":case"base64":throw new Error("Unsupported encoding: "+this.encoding);default:this.decoder=new n$e(this.encoding);}}push(e){return "string"==typeof e?e:this.decoder.decode(e)}write(e){return this.push(e)}end(e){let t="";return e&&(t=this.push(e)),t+=this.decoder.flush(),t}};

/**
 * Bundled by jsDelivr using Rollup v2.79.1 and Terser v5.19.2.
 * Original file: /npm/streamx@2.18.0/index.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
function i$9(t){return t&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function n$d(){}function s$b(){s$b.init.call(this);}function a$7(t){return void 0===t._maxListeners?s$b.defaultMaxListeners:t._maxListeners}function l$a(t,e,r,i){var s,l,u,o;if("function"!=typeof r)throw new TypeError('"listener" argument must be a function');if((l=t._events)?(l.newListener&&(t.emit("newListener",e,r.listener?r.listener:r),l=t._events),u=l[e]):(l=t._events=new n$d,t._eventsCount=0),u){if("function"==typeof u?u=l[e]=i?[r,u]:[u,r]:i?u.unshift(r):u.push(r),!u.warned&&(s=a$7(t))&&s>0&&u.length>s){u.warned=!0;var h=new Error("Possible EventEmitter memory leak detected. "+u.length+" "+e+" listeners added. Use emitter.setMaxListeners() to increase limit");h.name="MaxListenersExceededWarning",h.emitter=t,h.type=e,h.count=u.length,o=h,"function"==typeof console.warn?console.warn(o):console.log(o);}}else u=l[e]=r,++t._eventsCount;return t}function u$d(t,e,r){var i=!1;function n(){t.removeListener(e,n),i||(i=!0,r.apply(t,arguments));}return n.listener=r,n}function o$b(t){var e=this._events;if(e){var r=e[t];if("function"==typeof r)return 1;if(r)return r.length}return 0}function h$8(t,e){for(var r=new Array(e);e--;)r[e]=t[e];return r}n$d.prototype=Object.create(null),s$b.EventEmitter=s$b,s$b.usingDomains=!1,s$b.prototype.domain=void 0,s$b.prototype._events=void 0,s$b.prototype._maxListeners=void 0,s$b.defaultMaxListeners=10,s$b.init=function(){this.domain=null,s$b.usingDomains&&undefined.active,this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=new n$d,this._eventsCount=0),this._maxListeners=this._maxListeners||void 0;},s$b.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||isNaN(t))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=t,this},s$b.prototype.getMaxListeners=function(){return a$7(this)},s$b.prototype.emit=function(t){var e,r,i,n,s,a,l,u="error"===t;if(a=this._events)u=u&&null==a.error;else if(!u)return !1;if(l=this.domain,u){if(e=arguments[1],!l){if(e instanceof Error)throw e;var o=new Error('Uncaught, unspecified "error" event. ('+e+")");throw o.context=e,o}return e||(e=new Error('Uncaught, unspecified "error" event')),e.domainEmitter=this,e.domain=l,e.domainThrown=!1,l.emit("error",e),!1}if(!(r=a[t]))return !1;var d="function"==typeof r;switch(i=arguments.length){case 1:!function(t,e,r){if(e)t.call(r);else for(var i=t.length,n=h$8(t,i),s=0;s<i;++s)n[s].call(r);}(r,d,this);break;case 2:!function(t,e,r,i){if(e)t.call(r,i);else for(var n=t.length,s=h$8(t,n),a=0;a<n;++a)s[a].call(r,i);}(r,d,this,arguments[1]);break;case 3:!function(t,e,r,i,n){if(e)t.call(r,i,n);else for(var s=t.length,a=h$8(t,s),l=0;l<s;++l)a[l].call(r,i,n);}(r,d,this,arguments[1],arguments[2]);break;case 4:!function(t,e,r,i,n,s){if(e)t.call(r,i,n,s);else for(var a=t.length,l=h$8(t,a),u=0;u<a;++u)l[u].call(r,i,n,s);}(r,d,this,arguments[1],arguments[2],arguments[3]);break;default:for(n=new Array(i-1),s=1;s<i;s++)n[s-1]=arguments[s];!function(t,e,r,i){if(e)t.apply(r,i);else for(var n=t.length,s=h$8(t,n),a=0;a<n;++a)s[a].apply(r,i);}(r,d,this,n);}return !0},s$b.prototype.addListener=function(t,e){return l$a(this,t,e,!1)},s$b.prototype.on=s$b.prototype.addListener,s$b.prototype.prependListener=function(t,e){return l$a(this,t,e,!0)},s$b.prototype.once=function(t,e){if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');return this.on(t,u$d(this,t,e)),this},s$b.prototype.prependOnceListener=function(t,e){if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');return this.prependListener(t,u$d(this,t,e)),this},s$b.prototype.removeListener=function(t,e){var r,i,s,a,l;if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');if(!(i=this._events))return this;if(!(r=i[t]))return this;if(r===e||r.listener&&r.listener===e)0==--this._eventsCount?this._events=new n$d:(delete i[t],i.removeListener&&this.emit("removeListener",t,r.listener||e));else if("function"!=typeof r){for(s=-1,a=r.length;a-- >0;)if(r[a]===e||r[a].listener&&r[a].listener===e){l=r[a].listener,s=a;break}if(s<0)return this;if(1===r.length){if(r[0]=void 0,0==--this._eventsCount)return this._events=new n$d,this;delete i[t];}else !function(t,e){for(var r=e,i=r+1,n=t.length;i<n;r+=1,i+=1)t[r]=t[i];t.pop();}(r,s);i.removeListener&&this.emit("removeListener",t,l||e);}return this},s$b.prototype.off=function(t,e){return this.removeListener(t,e)},s$b.prototype.removeAllListeners=function(t){var e,r;if(!(r=this._events))return this;if(!r.removeListener)return 0===arguments.length?(this._events=new n$d,this._eventsCount=0):r[t]&&(0==--this._eventsCount?this._events=new n$d:delete r[t]),this;if(0===arguments.length){for(var i,s=Object.keys(r),a=0;a<s.length;++a)"removeListener"!==(i=s[a])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=new n$d,this._eventsCount=0,this}if("function"==typeof(e=r[t]))this.removeListener(t,e);else if(e)do{this.removeListener(t,e[e.length-1]);}while(e[0]);return this},s$b.prototype.listeners=function(t){var e,r=this._events;return r&&(e=r[t])?"function"==typeof e?[e.listener||e]:function(t){for(var e=new Array(t.length),r=0;r<e.length;++r)e[r]=t[r].listener||t[r];return e}(e):[]},s$b.listenerCount=function(t,e){return "function"==typeof t.listenerCount?t.listenerCount(e):o$b.call(t,e)},s$b.prototype.listenerCount=o$b,s$b.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};var d$a=i$9(Object.freeze({__proto__:null,default:s$b,EventEmitter:s$b}));const{EventEmitter:p$a}=d$a,f$a=new Error("Stream was destroyed"),_$8=new Error("Premature close"),c$d=e$t,S$8=i$r,m$9=o$c,x$7=536870911,b$7=1^x$7,w$9=64,y$9=128,v$8=256,g$8=1024,k$7=2048,T$8=4096,L$8=8192,N$8=16384,E$9=32768,P$8=131072,W$8=131328,C$7=768^x$7,M$9=536838143,A$8=536739839,q$7=1<<18,U$8=2<<18,O$8=4<<18,R$7=8<<18,j$7=16<<18,D$8=32<<18,F$7=64<<18,B$8=128<<18,I$8=256<<18,z$7=512<<18,K$8=1024<<18,G$7=469499903,H$8=535822335,J$7=503316479,Q$7=268435455,V$7=262160,X$7=536608751,Y$8=8404992,Z$7=14,$$7=15,tt$4=8405006,et$4=33587200,rt$4=33587215,it$4=2359296,nt$3=270794767,st$4=Symbol.asyncIterator||Symbol("asyncIterator");let at$3 = class at{constructor(t,{highWaterMark:e=16384,map:r=null,mapWritable:i,byteLength:n,byteLengthWritable:s}={}){this.stream=t,this.queue=new S$8,this.highWaterMark=e,this.buffered=0,this.error=null,this.pipeline=null,this.drains=null,this.byteLength=s||n||Wt$3,this.map=i||r,this.afterWrite=ft$3.bind(this),this.afterUpdateNextTick=St$3.bind(this);}get ended(){return 0!=(this.stream._duplexState&D$8)}push(t){return null!==this.map&&(t=this.map(t)),this.buffered+=this.byteLength(t),this.queue.push(t),this.buffered<this.highWaterMark?(this.stream._duplexState|=R$7,!0):(this.stream._duplexState|=6291456,!1)}shift(){const t=this.queue.shift();return this.buffered-=this.byteLength(t),0===this.buffered&&(this.stream._duplexState&=534773759),t}end(t){"function"==typeof t?this.stream.once("finish",t):null!=t&&this.push(t),this.stream._duplexState=(this.stream._duplexState|z$7)&H$8;}autoBatch(t,e){const r=[],i=this.stream;for(r.push(t);(i._duplexState&nt$3)===it$4;)r.push(i._writableState.shift());if(0!=(i._duplexState&$$7))return e(null);i._writev(r,e);}update(){const t=this.stream;t._duplexState|=U$8;do{for(;(t._duplexState&nt$3)===R$7;){const e=this.shift();t._duplexState|=67371008,t._write(e,this.afterWrite);}0==(1310720&t._duplexState)&&this.updateNonPrimary();}while(!0===this.continueUpdate());t._duplexState&=536346623;}updateNonPrimary(){const t=this.stream;if((144965647&t._duplexState)===z$7)return t._duplexState=402653183&(t._duplexState|q$7),void t._final(dt$3.bind(this));4!=(t._duplexState&Z$7)?1==(t._duplexState&rt$4)&&(t._duplexState=(t._duplexState|V$7)&b$7,t._open(mt$3.bind(this))):0==(t._duplexState&et$4)&&(t._duplexState|=V$7,t._destroy(pt$3.bind(this)));}continueUpdate(){return 0!=(this.stream._duplexState&B$8)&&(this.stream._duplexState&=J$7,!0)}updateCallback(){(35127311&this.stream._duplexState)===O$8?this.update():this.updateNextTick();}updateNextTick(){0==(this.stream._duplexState&B$8)&&(this.stream._duplexState|=B$8,0==(this.stream._duplexState&U$8)&&c$d(this.afterUpdateNextTick));}};let lt$3 = class lt{constructor(t,{highWaterMark:e=16384,map:r=null,mapReadable:i,byteLength:n,byteLengthReadable:s}={}){this.stream=t,this.queue=new S$8,this.highWaterMark=0===e?1:e,this.buffered=0,this.readAhead=e>0,this.error=null,this.pipeline=null,this.byteLength=s||n||Wt$3,this.map=i||r,this.pipeTo=null,this.afterRead=_t$3.bind(this),this.afterUpdateNextTick=ct$3.bind(this);}get ended(){return 0!=(this.stream._duplexState&N$8)}pipe(t,e){if(null!==this.pipeTo)throw new Error("Can only pipe to one destination");if("function"!=typeof e&&(e=null),this.stream._duplexState|=512,this.pipeTo=t,this.pipeline=new ot$3(this.stream,t,e),e&&this.stream.on("error",Ct$3),Pt$3(t))t._writableState.pipeline=this.pipeline,e&&t.on("error",Ct$3),t.on("finish",this.pipeline.finished.bind(this.pipeline));else {const e=this.pipeline.done.bind(this.pipeline,t),r=this.pipeline.done.bind(this.pipeline,t,null);t.on("error",e),t.on("close",r),t.on("finish",this.pipeline.finished.bind(this.pipeline));}t.on("drain",ht$4.bind(this)),this.stream.emit("piping",t),t.emit("pipe",this.stream);}push(t){const e=this.stream;return null===t?(this.highWaterMark=0,e._duplexState=536805311&(e._duplexState|g$8),!1):(null!==this.map&&null===(t=this.map(t))||(this.buffered+=this.byteLength(t),this.queue.push(t),e._duplexState=536805375&(e._duplexState|y$9)),this.buffered<this.highWaterMark)}shift(){const t=this.queue.shift();return this.buffered-=this.byteLength(t),0===this.buffered&&(this.stream._duplexState&=536862591),t}unshift(t){const e=[null!==this.map?this.map(t):t];for(;this.buffered>0;)e.push(this.shift());for(let t=0;t<e.length-1;t++){const r=e[t];this.buffered+=this.byteLength(r),this.queue.push(r);}this.push(e[e.length-1]);}read(){const t=this.stream;if((16527&t._duplexState)===y$9){const e=this.shift();return null!==this.pipeTo&&!1===this.pipeTo.write(e)&&(t._duplexState&=C$7),0!=(t._duplexState&k$7)&&t.emit("data",e),e}return !1===this.readAhead&&(t._duplexState|=P$8,this.updateNextTick()),null}drain(){const t=this.stream;for(;(16527&t._duplexState)===y$9&&0!=(768&t._duplexState);){const e=this.shift();null!==this.pipeTo&&!1===this.pipeTo.write(e)&&(t._duplexState&=C$7),0!=(t._duplexState&k$7)&&t.emit("data",e);}}update(){const t=this.stream;t._duplexState|=32;do{for(this.drain();this.buffered<this.highWaterMark&&(214047&t._duplexState)===P$8;)t._duplexState|=65552,t._read(this.afterRead),this.drain();4224==(12431&t._duplexState)&&(t._duplexState|=L$8,t.emit("readable")),0==(80&t._duplexState)&&this.updateNonPrimary();}while(!0===this.continueUpdate());t._duplexState&=536870879;}updateNonPrimary(){const t=this.stream;(1167&t._duplexState)===g$8&&(t._duplexState=536869887&(t._duplexState|N$8),t.emit("end"),(t._duplexState&tt$4)===Y$8&&(t._duplexState|=4),null!==this.pipeTo&&this.pipeTo.end()),4!=(t._duplexState&Z$7)?1==(t._duplexState&rt$4)&&(t._duplexState=(t._duplexState|V$7)&b$7,t._open(mt$3.bind(this))):0==(t._duplexState&et$4)&&(t._duplexState|=V$7,t._destroy(pt$3.bind(this)));}continueUpdate(){return 0!=(this.stream._duplexState&E$9)&&(this.stream._duplexState&=M$9,!0)}updateCallback(){(32879&this.stream._duplexState)===w$9?this.update():this.updateNextTick();}updateNextTick(){0==(this.stream._duplexState&E$9)&&(this.stream._duplexState|=E$9,0==(32&this.stream._duplexState)&&c$d(this.afterUpdateNextTick));}};let ut$3 = class ut{constructor(t){this.data=null,this.afterTransform=xt$3.bind(t),this.afterFinal=null;}};let ot$3 = class ot{constructor(t,e,r){this.from=t,this.to=e,this.afterPipe=r,this.error=null,this.pipeToFinished=!1;}finished(){this.pipeToFinished=!0;}done(t,e){e&&(this.error=e),t!==this.to||(this.to=null,null===this.from)?t!==this.from||(this.from=null,null===this.to)?(null!==this.afterPipe&&this.afterPipe(this.error),this.to=this.from=this.afterPipe=null):0==(t._duplexState&N$8)&&this.to.destroy(this.error||new Error("Readable stream closed before ending")):0!=(this.from._duplexState&N$8)&&this.pipeToFinished||this.from.destroy(this.error||new Error("Writable stream closed prematurely"));}};function ht$4(){this.stream._duplexState|=512,this.updateCallback();}function dt$3(t){const e=this.stream;t&&e.destroy(t),0==(e._duplexState&Z$7)&&(e._duplexState|=D$8,e.emit("finish")),(e._duplexState&tt$4)===Y$8&&(e._duplexState|=4),e._duplexState&=G$7,0==(e._duplexState&U$8)?this.update():this.updateNextTick();}function pt$3(t){const e=this.stream;t||this.error===f$a||(t=this.error),t&&e.emit("error",t),e._duplexState|=8,e.emit("close");const r=e._readableState,i=e._writableState;if(null!==r&&null!==r.pipeline&&r.pipeline.done(e,t),null!==i){for(;null!==i.drains&&i.drains.length>0;)i.drains.shift().resolve(!1);null!==i.pipeline&&i.pipeline.done(e,t);}}function ft$3(t){const e=this.stream;t&&e.destroy(t),e._duplexState&=G$7,null!==this.drains&&function(t){for(let e=0;e<t.length;e++)0==--t[e].writes&&(t.shift().resolve(!0),e--);}(this.drains),(6553615&e._duplexState)===j$7&&(e._duplexState&=532676607,(e._duplexState&F$7)===F$7&&e.emit("drain")),this.updateCallback();}function _t$3(t){t&&this.stream.destroy(t),this.stream._duplexState&=536870895,!1===this.readAhead&&0==(this.stream._duplexState&v$8)&&(this.stream._duplexState&=A$8),this.updateCallback();}function ct$3(){0==(32&this.stream._duplexState)&&(this.stream._duplexState&=M$9,this.update());}function St$3(){0==(this.stream._duplexState&U$8)&&(this.stream._duplexState&=J$7,this.update());}function mt$3(t){const e=this.stream;t&&e.destroy(t),0==(4&e._duplexState)&&(0==(17423&e._duplexState)&&(e._duplexState|=w$9),0==(142606351&e._duplexState)&&(e._duplexState|=O$8),e.emit("open")),e._duplexState&=X$7,null!==e._writableState&&e._writableState.updateCallback(),null!==e._readableState&&e._readableState.updateCallback();}function xt$3(t,e){null!=e&&this.push(e),this._writableState.afterWrite(t);}function bt$3(t){null!==this._readableState&&("data"===t&&(this._duplexState|=133376,this._readableState.updateNextTick()),"readable"===t&&(this._duplexState|=T$8,this._readableState.updateNextTick())),null!==this._writableState&&"drain"===t&&(this._duplexState|=F$7,this._writableState.updateNextTick());}let wt$3 = class wt extends p$a{constructor(t){super(),this._duplexState=0,this._readableState=null,this._writableState=null,t&&(t.open&&(this._open=t.open),t.destroy&&(this._destroy=t.destroy),t.predestroy&&(this._predestroy=t.predestroy),t.signal&&t.signal.addEventListener("abort",Mt$3.bind(this))),this.on("newListener",bt$3);}_open(t){t(null);}_destroy(t){t(null);}_predestroy(){}get readable(){return null!==this._readableState||void 0}get writable(){return null!==this._writableState||void 0}get destroyed(){return 0!=(8&this._duplexState)}get destroying(){return 0!=(this._duplexState&Z$7)}destroy(t){0==(this._duplexState&Z$7)&&(t||(t=f$a),this._duplexState=535822271&(4|this._duplexState),null!==this._readableState&&(this._readableState.highWaterMark=0,this._readableState.error=t),null!==this._writableState&&(this._writableState.highWaterMark=0,this._writableState.error=t),this._duplexState|=2,this._predestroy(),this._duplexState&=536870909,null!==this._readableState&&this._readableState.updateNextTick(),null!==this._writableState&&this._writableState.updateNextTick());}};let yt$3 = class yt extends wt$3{constructor(t){super(t),this._duplexState|=8519681,this._readableState=new lt$3(this,t),t&&(!1===this._readableState.readAhead&&(this._duplexState&=A$8),t.read&&(this._read=t.read),t.eagerOpen&&this._readableState.updateNextTick(),t.encoding&&this.setEncoding(t.encoding));}setEncoding(t){const e=new m$9(t),r=this._readableState.map||Nt$3;return this._readableState.map=function(t){const i=e.push(t);return ""===i?null:r(i)},this}_read(t){t(null);}pipe(t,e){return this._readableState.updateNextTick(),this._readableState.pipe(t,e),t}read(){return this._readableState.updateNextTick(),this._readableState.read()}push(t){return this._readableState.updateNextTick(),this._readableState.push(t)}unshift(t){return this._readableState.updateNextTick(),this._readableState.unshift(t)}resume(){return this._duplexState|=W$8,this._readableState.updateNextTick(),this}pause(){return this._duplexState&=!1===this._readableState.readAhead?536739583:536870655,this}static _fromAsyncIterator(t,e){let r;const i=new yt({...e,read(e){t.next().then(n).then(e.bind(null,null)).catch(e);},predestroy(){r=t.return();},destroy(t){if(!r)return t(null);r.then(t.bind(null,null)).catch(t);}});return i;function n(t){t.done?i.push(null):i.push(t.value);}}static from(t,e){if(Pt$3(r=t)&&r.readable)return t;var r;if(t[st$4])return this._fromAsyncIterator(t[st$4](),e);Array.isArray(t)||(t=void 0===t?[]:[t]);let i=0;return new yt({...e,read(e){this.push(i===t.length?null:t[i++]),e(null);}})}static isBackpressured(t){return 0!=(17422&t._duplexState)||t._readableState.buffered>=t._readableState.highWaterMark}static isPaused(t){return 0==(t._duplexState&v$8)}[st$4](){const t=this;let e=null,r=null,i=null;return this.on("error",(t=>{e=t;})),this.on("readable",(function(){null!==r&&n(t.read());})),this.on("close",(function(){null!==r&&n(null);})),{[st$4](){return this},next:()=>new Promise((function(e,s){r=e,i=s;const a=t.read();null!==a?n(a):0!=(8&t._duplexState)&&n(null);})),return:()=>s(null),throw:t=>s(t)};function n(n){null!==i&&(e?i(e):null===n&&0==(t._duplexState&N$8)?i(f$a):r({value:n,done:null===n}),i=r=null);}function s(e){return t.destroy(e),new Promise(((r,i)=>{if(8&t._duplexState)return r({value:void 0,done:!0});t.once("close",(function(){e?i(e):r({value:void 0,done:!0});}));}))}}};let vt$3 = class vt extends wt$3{constructor(t){super(t),this._duplexState|=16385,this._writableState=new at$3(this,t),t&&(t.writev&&(this._writev=t.writev),t.write&&(this._write=t.write),t.final&&(this._final=t.final),t.eagerOpen&&this._writableState.updateNextTick());}cork(){this._duplexState|=K$8;}uncork(){this._duplexState&=Q$7,this._writableState.updateNextTick();}_writev(t,e){e(null);}_write(t,e){this._writableState.autoBatch(t,e);}_final(t){t(null);}static isBackpressured(t){return 0!=(146800654&t._duplexState)}static drained(t){if(t.destroyed)return Promise.resolve(!1);const e=t._writableState;var r;const i=((r=t)._writev!==vt.prototype._writev&&r._writev!==gt$3.prototype._writev?Math.min(1,e.queue.length):e.queue.length)+(t._duplexState&I$8?1:0);return 0===i?Promise.resolve(!0):(null===e.drains&&(e.drains=[]),new Promise((t=>{e.drains.push({writes:i,resolve:t});})))}write(t){return this._writableState.updateNextTick(),this._writableState.push(t)}end(t){return this._writableState.updateNextTick(),this._writableState.end(t),this}};let gt$3 = class gt extends yt$3{constructor(t){super(t),this._duplexState=1|this._duplexState&P$8,this._writableState=new at$3(this,t),t&&(t.writev&&(this._writev=t.writev),t.write&&(this._write=t.write),t.final&&(this._final=t.final));}cork(){this._duplexState|=K$8;}uncork(){this._duplexState&=Q$7,this._writableState.updateNextTick();}_writev(t,e){e(null);}_write(t,e){this._writableState.autoBatch(t,e);}_final(t){t(null);}write(t){return this._writableState.updateNextTick(),this._writableState.push(t)}end(t){return this._writableState.updateNextTick(),this._writableState.end(t),this}};let kt$3 = class kt extends gt$3{constructor(t){super(t),this._transformState=new ut$3(this),t&&(t.transform&&(this._transform=t.transform),t.flush&&(this._flush=t.flush));}_write(t,e){this._readableState.buffered>=this._readableState.highWaterMark?this._transformState.data=t:this._transform(t,this._transformState.afterTransform);}_read(t){if(null!==this._transformState.data){const e=this._transformState.data;this._transformState.data=null,t(null),this._transform(e,this._transformState.afterTransform);}else t(null);}destroy(t){super.destroy(t),null!==this._transformState.data&&(this._transformState.data=null,this._transformState.afterTransform());}_transform(t,e){e(null,t);}_flush(t){t(null);}_final(t){this._transformState.afterFinal=t,this._flush(Tt$3.bind(this));}};function Tt$3(t,e){const r=this._transformState.afterFinal;if(t)return r(t);null!=e&&this.push(e),this.push(null),r(null);}function Lt$3(t,...e){const r=Array.isArray(t)?[...t,...e]:[t,...e],i=r.length&&"function"==typeof r[r.length-1]?r.pop():null;if(r.length<2)throw new Error("Pipeline requires at least 2 streams");let n=r[0],s=null,a=null;for(let t=1;t<r.length;t++)s=r[t],Pt$3(n)?n.pipe(s,u):(l(n,!0,t>1,u),n.pipe(s)),n=s;if(i){let t=!1;const e=Pt$3(s)||!(!s._writableState||!s._writableState.autoDestroy);s.on("error",(t=>{null===a&&(a=t);})),s.on("finish",(()=>{t=!0,e||i(a);})),e&&s.on("close",(()=>i(a||(t?null:_$8))));}return s;function l(t,e,r,i){t.on("error",i),t.on("close",(function(){if(t._readableState&&!t._readableState.ended)return i(_$8);if(r&&t._writableState&&!t._writableState.ended)return i(_$8)}));}function u(t){if(t&&!a){a=t;for(const e of r)e.destroy(t);}}}function Nt$3(t){return t}function Et$3(t){return !!t._readableState||!!t._writableState}function Pt$3(t){return "number"==typeof t._duplexState&&Et$3(t)}function Wt$3(t){return function(t){return "object"==typeof t&&null!==t&&"number"==typeof t.byteLength}(t)?t.byteLength:1024}function Ct$3(){}function Mt$3(){this.destroy(new Error("Stream aborted."));}var At$3={pipeline:Lt$3,pipelinePromise:function(...t){return new Promise(((e,r)=>Lt$3(...t,(t=>{if(t)return r(t);e();}))))},isStream:Et$3,isStreamx:Pt$3,getStreamError:function(t){const e=t._readableState&&t._readableState.error||t._writableState&&t._writableState.error;return e===f$a?null:e},Stream:wt$3,Writable:vt$3,Readable:yt$3,Duplex:gt$3,Transform:kt$3,PassThrough:class extends kt$3{}};

/**
 * Bundled by jsDelivr using Rollup v2.79.1 and Terser v5.19.2.
 * Original file: /npm/timeout-refresh@2.0.1/browser.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
var t$d=class t{constructor(t,s,n=null,r=!1){this.ms=t,this.ontimeout=s,this.context=n||null,this.interval=r,this.done=!1,this._timer=r?setInterval(i$8,t,this):setTimeout(e$9,t,this);}unref(){}ref(){}refresh(){this.done||(this.interval?(clearInterval(this._timer),this._timer=setInterval(i$8,this.ms,this)):(clearTimeout(this._timer),this._timer=setTimeout(e$9,this.ms,this)));}destroy(){this.done=!0,this.ontimeout=null,this.interval?clearInterval(this._timer):clearTimeout(this._timer);}static once(t,e,i){return new this(t,e,i,!1)}static on(t,e,i){return new this(t,e,i,!0)}};function e$9(t){t.done=!0,t.ontimeout.call(t.context);}function i$8(t){t.ontimeout.call(t.context);}

/**
 * Bundled by jsDelivr using Rollup v2.79.1 and Terser v5.19.2.
 * Original file: /npm/sodium-universal@4.0.0/index.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
var m$8=$r;

/**
 * Bundled by jsDelivr using Rollup v2.79.1 and Terser v5.19.2.
 * Original file: /npm/noise-curve-ed@2.0.1/index.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
const t$c=m$8,s$a=r$s,c$c=L$a,n$c=t$c.crypto_scalarmult_ed25519_BYTES,o$a=t$c.crypto_scalarmult_ed25519_BYTES,l$9=t$c.crypto_scalarmult_ed25519_BYTES,y$8=t$c.crypto_sign_SECRETKEYBYTES,i$7="Ed25519";var p$9={DHLEN:n$c,PKLEN:o$a,SCALARLEN:l$9,SKLEN:y$8,ALG:i$7,name:i$7,generateKeyPair:function(e){if(e)return function(e){const r={};return r.secretKey=c$c.alloc(y$8),r.publicKey=c$c.alloc(o$a),t$c.crypto_sign_seed_keypair(r.publicKey,r.secretKey,e),r}(e.subarray(0,32));const r={};return r.secretKey=c$c.alloc(y$8),r.publicKey=c$c.alloc(o$a),t$c.crypto_sign_keypair(r.publicKey,r.secretKey),r},dh:function(e,{scalar:r,secretKey:a}){if(!r){s$a(a.byteLength===y$8);const e=c$c.alloc(64);t$c.crypto_hash_sha512(e,a.subarray(0,32)),e[0]&=248,e[31]&=127,e[31]|=64,r=e.subarray(0,32);}s$a(r.byteLength===l$9),s$a(e.byteLength===o$a);const i=c$c.alloc(n$c);return t$c.crypto_scalarmult_ed25519_noclamp(i,r,e),i}};p$9.ALG;p$9.DHLEN;p$9.PKLEN;p$9.SCALARLEN;p$9.SKLEN;p$9.dh;p$9.generateKeyPair;p$9.name;

/**
 * Bundled by jsDelivr using Rollup v2.79.1 and Terser v5.19.2.
 * Original file: /npm/noise-handshake@3.1.0/noise.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
const i$6=m$8,r$d=L$a;const{crypto_kx_SEEDBYTES:h$7,crypto_kx_keypair:n$b,crypto_kx_seed_keypair:a$6,crypto_scalarmult_BYTES:c$b,crypto_scalarmult_SCALARBYTES:o$9,crypto_scalarmult:l$8,crypto_scalarmult_base:u$c}=m$8,y$7=r$s,f$9=L$a,p$8=c$b,m$7=c$b,b$6=o$9;var d$9={DHLEN:p$8,PKLEN:m$7,SKLEN:b$6,SEEDLEN:h$7,ALG:"25519",generateKeyPair:function(t){const e={};e.secretKey=t||f$9.alloc(b$6),e.publicKey=f$9.alloc(m$7),t?u$c(e.publicKey,e.secretKey):n$b(e.publicKey,e.secretKey);return e},generateSeedKeyPair:function(t){y$7(t.byteLength===b$6);const e={};return e.secretKey=f$9.alloc(b$6),e.publicKey=f$9.alloc(m$7),a$6(e.publicKey,e.secretKey,t),e},dh:function(t,{secretKey:e}){y$7(e.byteLength===b$6),y$7(t.byteLength===m$7);const s=f$9.alloc(p$8);return l$8(s,e,t),s}};var g$7={exports:{}};const K$7=L$a,{sodium_memzero:_$7,crypto_generichash:k$6,crypto_generichash_batch:x$6}=m$8,E$8=128,H$7=K$7.alloc(384),L$7=H$7.subarray(0,128),A$7=H$7.subarray(128,256),S$7=H$7.subarray(256,384);g$7.exports=function(t,e,s){s.byteLength>E$8?(k$6(L$7.subarray(0,64),s),_$7(L$7.subarray(64))):(L$7.set(s),_$7(L$7.subarray(s.byteLength)));for(let t=0;t<L$7.byteLength;t++)A$7[t]=92^L$7[t],S$7[t]=54^L$7[t];_$7(L$7),x$6(t,[S$7].concat(e)),_$7(S$7),x$6(t,[A$7].concat(t)),_$7(A$7);},g$7.exports.BYTES=64,g$7.exports.KEYBYTES=E$8;const N$7=g$7.exports,B$7=r$s,v$7=L$a,P$7=64;var w$8={hkdf:function(t,e,s="",i=2*P$7){const r=function(t,e,s){const i=[v$7.from(e)],r=s/P$7;for(let s=0;s<r;s++){const r=v$7.from(e),h=v$7.concat([i[s],r,v$7.from([s+1])]);i[s+1]=Y$7(t,h);}const h=v$7.concat(i.slice(1));return B$7(h.byteLength===s,"key expansion failed, length not as expected"),h}(function(t,e){return Y$7(t,e)}(t,e),s,i),h=[];let n=0;for(;n<r.length;)h.push(r.subarray(n,n+P$7)),n+=P$7;return h},HASHLEN:P$7};function Y$7(t,e){const s=v$7.alloc(P$7);return N$7(s,e,t),s}const T$7=m$8,z$6=r$s,C$6=L$a,D$7=class D{constructor(t){this.key=t||null,this.nonce=0,this.CIPHER_ALG="ChaChaPoly";}initialiseKey(t){this.key=t,this.nonce=0;}setNonce(t){this.nonce=t;}encrypt(t,e){if(!this.hasKey)return t;e||(e=r$d.alloc(0));const s=function(t,e,s,h){r$d.isBuffer(s)||(s=r$d.from(s,"hex"));r$d.isBuffer(h)||(h=r$d.from(h,"hex"));const n=r$d.alloc(i$6.crypto_aead_chacha20poly1305_ietf_NPUBBYTES);new DataView(n.buffer,n.byteOffset,n.byteLength).setUint32(4,e,!0);const a=r$d.alloc(h.byteLength+i$6.crypto_aead_chacha20poly1305_ietf_ABYTES);return i$6.crypto_aead_chacha20poly1305_ietf_encrypt(a,h,s,null,n,t),a}(this.key,this.nonce,e,t);return this.nonce++,s}decrypt(t,e){if(!this.hasKey)return t;e||(e=r$d.alloc(0));const s=function(t,e,s,h){r$d.isBuffer(s)||(s=r$d.from(s,"hex"));r$d.isBuffer(h)||(h=r$d.from(h,"hex"));const n=r$d.alloc(i$6.crypto_aead_chacha20poly1305_ietf_NPUBBYTES);new DataView(n.buffer,n.byteOffset,n.byteLength).setUint32(4,e,!0);const a=r$d.alloc(h.byteLength-i$6.crypto_aead_chacha20poly1305_ietf_ABYTES);return i$6.crypto_aead_chacha20poly1305_ietf_decrypt(a,null,h,s,n,t),a}(this.key,this.nonce,e,t);return this.nonce++,s}get hasKey(){return null!==this.key}_clear(){i$6.sodium_memzero(this.key),this.key=null,this.nonce=null;}static get MACBYTES(){return 16}static get NONCEBYTES(){return 8}static get KEYBYTES(){return 32}},U$7=d$9,{HASHLEN:G$6,hkdf:O$7}=w$8;function I$7(t,e){const s=C$6.concat([t,e]);T$7.crypto_generichash(t,s);}const R$6=r$s,X$6=L$a,j$6=class j extends D$7{constructor(t={}){super(),this.curve=t.curve||U$7,this.digest=C$6.alloc(G$6),this.chainingKey=null,this.offset=0,this.DH_ALG=this.curve.ALG;}mixHash(t){I$7(this.digest,t);}mixKeyAndHash(t){const[e,s,i]=O$7(this.chainingKey,t,"",3*G$6);this.chainingKey=e,this.mixHash(s),this.initialiseKey(i.subarray(0,32));}mixKeyNormal(t){const[e,s]=O$7(this.chainingKey,t);this.chainingKey=e,this.initialiseKey(s.subarray(0,32));}mixKey(t,e){const s=this.curve.dh(t,e),i=O$7(this.chainingKey,s);this.chainingKey=i[0],this.initialiseKey(i[1].subarray(0,32));}encryptAndHash(t){const e=this.encrypt(t,this.digest);return I$7(this.digest,e),e}decryptAndHash(t){const e=this.decrypt(t,this.digest);return I$7(this.digest,t),e}getHandshakeHash(t){return t?(z$6(t.byteLength===G$6,`output must be ${G$6} bytes`),t.set(this.digest),t):this.getHandshakeHash(C$6.alloc(G$6))}split(){return O$7(this.chainingKey,C$6.alloc(0)).map((t=>t.subarray(0,32)))}_clear(){super._clear(),T$7.sodium_memzero(this.digest),T$7.sodium_memzero(this.chainingKey),this.digest=null,this.chainingKey=null,this.offset=null,this.curve=null;}static get alg(){return D$7.alg+"_BLAKE2b"}},{HASHLEN:V$6}=w$8,q$6=Symbol("initiator static key preshared"),M$8=Symbol("responder static key preshared"),$$6=Symbol("psk"),F$6=Symbol("s"),J$6=Symbol("e"),Q$6=Symbol("es"),W$7=Symbol("se"),Z$6=Symbol("ee"),tt$3=Symbol("ss"),et$3=Object.freeze({NN:[[J$6],[J$6,Z$6]],NNpsk0:[[$$6,J$6],[J$6,Z$6]],XX:[[J$6],[J$6,Z$6,F$6,Q$6],[F$6,W$7]],XXpsk0:[[$$6,J$6],[J$6,Z$6,F$6,Q$6],[F$6,W$7]],IK:[M$8,[J$6,Q$6,F$6,tt$3],[J$6,Z$6,W$7]]});let st$3 = class st{constructor(){this.size=0,this.buffers=[];}push(t){this.size+=t.byteLength,this.buffers.push(t);}end(){const t=X$6.alloc(this.size);let e=0;for(const s of this.buffers)t.set(s,e),e+=s.byteLength;return t}};let it$3 = class it{constructor(t){this.offset=0,this.buffer=t;}shift(t){const e=this.offset,s=this.offset+=t;if(s>this.buffer.byteLength)throw new Error("Insufficient bytes");return this.buffer.subarray(e,s)}end(){return this.shift(this.buffer.byteLength-this.offset)}};var rt$3=class rt extends j$6{constructor(t,e,s,i={}){super(i),this.s=s||this.curve.generateKeyPair(),this.e=null,this.psk=null,i&&i.psk&&(this.psk=i.psk),this.re=null,this.rs=null,this.pattern=t,this.handshake=et$3[this.pattern].slice(),this.isPskHandshake=!!this.psk&&this.handshake.some((t=>Array.isArray(t)&&-1!==t.indexOf($$6))),this.protocol=X$6.from(["Noise",this.pattern,this.DH_ALG,this.CIPHER_ALG,"BLAKE2b"].join("_")),this.initiator=e,this.complete=!1,this.rx=null,this.tx=null,this.hash=null;}initialise(t,e){for(this.protocol.byteLength<=V$6?this.digest.set(this.protocol):this.mixHash(this.protocol),this.chainingKey=X$6.from(this.digest),this.mixHash(t);!Array.isArray(this.handshake[0]);){const t=this.handshake.shift();R$6(t===M$8||t===q$6,"Unexpected pattern");const s=this.initiator?t===M$8:t===q$6;s&&(this.rs=e);const i=s?this.rs:this.s.publicKey;R$6(null!=i,"Remote pubkey required"),this.mixHash(i);}}final(){const[t,e]=this.split();this.tx=this.initiator?t:e,this.rx=this.initiator?e:t,this.complete=!0,this.hash=this.getHandshakeHash(),this._clear();}recv(t){const e=new it$3(t);for(const t of this.handshake.shift())switch(t){case $$6:this.mixKeyAndHash(this.psk);break;case J$6:this.re=e.shift(this.curve.PKLEN),this.mixHash(this.re),this.isPskHandshake&&this.mixKeyNormal(this.re);break;case F$6:{const t=this.hasKey?this.curve.PKLEN+16:this.curve.PKLEN;this.rs=this.decryptAndHash(e.shift(t));break}case Z$6:case Q$6:case W$7:case tt$3:{const e=ht$3(t,this.initiator),s=e.local?this.s:this.e,i=e.remote?this.rs:this.re;this.mixKey(i,s);break}default:throw new Error("Unexpected message")}const s=this.decryptAndHash(e.end());return this.handshake.length||this.final(),s}send(t=X$6.alloc(0)){const e=new st$3;for(const t of this.handshake.shift())switch(t){case $$6:this.mixKeyAndHash(this.psk);break;case J$6:null===this.e&&(this.e=this.curve.generateKeyPair()),this.mixHash(this.e.publicKey),this.isPskHandshake&&this.mixKeyNormal(this.e.publicKey),e.push(this.e.publicKey);break;case F$6:e.push(this.encryptAndHash(this.s.publicKey));break;case Q$6:case W$7:case Z$6:case tt$3:{const e=ht$3(t,this.initiator),s=e.local?this.s:this.e,i=e.remote?this.rs:this.re;this.mixKey(i,s);break}default:throw new Error("Unexpected message")}e.push(this.encryptAndHash(t));const s=e.end();return this.handshake.length||this.final(),s}_clear(){super._clear(),this.e.secretKey.fill(0),this.e.publicKey.fill(0),this.re.fill(0),this.e=null,this.re=null;}};function ht$3(t,e){const s={local:!1,remote:!1};switch(t){case Z$6:return s;case Q$6:return s.local^=!e,s.remote^=e,s;case W$7:return s.local^=e,s.remote^=!e,s;case tt$3:return s.local^=1,s.remote^=1,s}}

/**
 * Bundled by jsDelivr using Rollup v2.79.1 and Terser v5.19.2.
 * Original file: /npm/@hyperswarm/secret-stream@6.6.3/index.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
const{Duplex:o$8,Writable:l$7}=At$3;let u$b = class u extends o$8{constructor(t){super(),this._stream=t,this._ondrain=null;}_write(t,e){!1===this._stream.push(t)?this._stream._ondrain=e:e(null);}_final(t){this._stream.push(null),t(null);}_read(t){const e=this._ondrain;this._ondrain=null,e&&e(),t(null);}};const _$6=m$a,d$8=p$9,m$6=rt$3,c$a=L$b,p$7=c$a.alloc(0);const{Pull:y$6,Push:w$7,HEADERBYTES:f$8,KEYBYTES:k$5,ABYTES:g$6}=y$a,b$5=m$a,S$6=o$e,{Duplex:v$6,Writable:K$6,getStreamError:D$6}=At$3,P$6=L$b,T$6=t$d,A$6=class A extends o$8{constructor(t){super(),this.noiseStream=t,this._ondrain=null,this.reverse=new u$b(this);}get publicKey(){return this.noiseStream.publicKey}get remotePublicKey(){return this.noiseStream.remotePublicKey}get handshakeHash(){return this.noiseStream.handshakeHash}flush(){return l$7.drained(this)}_read(t){const e=this._ondrain;this._ondrain=null,e&&e(),t(null);}_write(t,e){!1===this.reverse.push(t)?this.reverse._ondrain=e:e(null);}_final(t){this.reverse.push(null),t(null);}},x$5=class x{constructor(t,e,s,i){this.isInitiator=t,this.keyPair=e,this.noise=new m$6(i,t,e,{curve:d$8}),this.noise.initialise(p$7,s),this.destroyed=!1;}static keyPair(t){const e=c$a.alloc(32),s=c$a.alloc(64);return t?_$6.crypto_sign_seed_keypair(e,s,t):_$6.crypto_sign_keypair(e,s),{publicKey:e,secretKey:s}}recv(t){try{return this.noise.recv(t),this.noise.complete?this._return(null):this.send()}catch{return this.destroy(),null}}send(){try{const s=this.noise.send(),i=c$a.allocUnsafe(s.byteLength+3);return t=s.byteLength,(e=i)[0]=255&t,e[1]=t>>>8&255,e[2]=t>>>16&255,i.set(s,3),this._return(i)}catch{return this.destroy(),null}var t,e;}destroy(){this.destroyed||(this.destroyed=!0);}_return(t){const e=this.noise.complete?c$a.toBuffer(this.noise.tx):null,s=this.noise.complete?c$a.toBuffer(this.noise.rx):null,i=this.noise.complete?c$a.toBuffer(this.noise.hash):null;return {data:t,remotePublicKey:this.noise.complete?c$a.toBuffer(this.noise.rs):null,hash:i,tx:e,rx:s}}},E$7=f$8+32,[L$6,I$6]=S$6.namespace("hyperswarm/secret-stream",2),B$6=16777215;var O$6=class O extends v$6{constructor(t,e,s={}){if(super({mapWritable:U$6}),"boolean"!=typeof t)throw new Error("isInitiator should be a boolean");this.noiseStream=this,this.isInitiator=t,this.rawStream=null,this.publicKey=s.publicKey||null,this.remotePublicKey=s.remotePublicKey||null,this.handshakeHash=null,this.connected=!1,this.keepAlive=s.keepAlive||0,this.timeout=0,this.userData=null;let i=null;this.opened=new Promise((t=>{i=t;})),this.rawBytesWritten=0,this.rawBytesRead=0,this.relay=null,this.puncher=null,this._rawStream=null,this._handshake=null,this._handshakePattern=s.pattern||null,this._handshakeDone=null,this._state=0,this._len=0,this._tmp=1,this._message=null,this._openedDone=i,this._startDone=null,this._drainDone=null,this._outgoingPlain=null,this._outgoingWrapped=null,this._utp=null,this._setup=!0,this._ended=2,this._encrypt=null,this._decrypt=null,this._timeoutTimer=null,this._keepAliveTimer=null,!1!==s.autoStart&&this.start(e,s),this.resume(),this.pause();}static keyPair(t){return x$5.keyPair(t)}static id(t,e,s){return H$6(t,e,s)}setTimeout(t){t||(t=0),this._clearTimeout(),this.timeout=t,t&&null!==this.rawStream&&(this._timeoutTimer=T$6.once(t,N$6,this),this._timeoutTimer.unref());}setKeepAlive(t){t||(t=0),this._clearKeepAlive(),this.keepAlive=t,t&&null!==this.rawStream&&(this._keepAliveTimer=T$6.on(t,Y$6,this),this._keepAliveTimer.unref());}sendKeepAlive(){const t=this.alloc(0);this.write(t);}start(t,e={}){t?(this.rawStream=t,this._rawStream=t,"function"==typeof this.rawStream.setContentSize&&(this._utp=t)):(this.rawStream=new A$6(this),this._rawStream=this.rawStream.reverse),this.rawStream.on("error",this._onrawerror.bind(this)),this.rawStream.on("close",this._onrawclose.bind(this)),this._startHandshake(e.handshake,e.keyPair||null),this._continueOpen(null),this.destroying||(e.data&&this._onrawdata(e.data),e.ended&&this._onrawend(),this.keepAlive>0&&null===this._keepAliveTimer&&this.setKeepAlive(this.keepAlive),this.timeout>0&&null===this._timeoutTimer&&this.setTimeout(this.timeout));}async flush(){return !1!==await this.opened&&(!1!==await K$6.drained(this)&&(!this.destroying&&(null===this.rawStream||!this.rawStream.flush||await this.rawStream.flush())))}_continueOpen(t){if(t&&this.destroy(t),null===this._startDone)return;const e=this._startDone;this._startDone=null,this._open(e);}_onkeypairpromise(t){const e=this,s=this._continueOpen.bind(this);t.then((function(t){e._onkeypair(t),s(null);}),s);}_onkeypair(t){const e=this._handshakePattern||"XX",s=this.remotePublicKey;this._handshake=new x$5(this.isInitiator,t,s,e),this.publicKey=this._handshake.keyPair.publicKey;}_startHandshake(t,e){if(t){const{tx:e,rx:s,hash:i,publicKey:r,remotePublicKey:n}=t;this._setupSecretStream(e,s,i,r,n);}else e||(e=x$5.keyPair()),"function"==typeof e.then?this._onkeypairpromise(e):this._onkeypair(e);}_onrawerror(t){this.destroy(t);}_onrawclose(){0!==this._ended&&this.destroy();}_onrawdata(t){let e=0;null!==this._timeoutTimer&&this._timeoutTimer.refresh();do{switch(this._state){case 0:for(;16777216!==this._tmp&&e<t.length;){const s=t[e++];this._len+=this._tmp*s,this._tmp*=256;}if(16777216===this._tmp){this._tmp=0,this._state=1;const s=t.length-e;s<this._len&&null!==this._utp&&this._utp.setContentSize(this._len-s);}break;case 1:{const s=this._len-this._tmp,i=s+e;if(null===this._message&&i<=t.length){this._message=t.subarray(e,i),e+=s,this._incoming();break}const r=t.length-e;null===this._message&&(this._message=P$6.allocUnsafe(this._len)),P$6.copy(t,this._message,this._tmp,e),this._tmp+=r,i<=t.length?(e+=s,this._incoming()):e+=r;break}}}while(e<t.length&&!this.destroying)}_onrawend(){this._ended--,this.push(null);}_onrawdrain(){const t=this._drainDone;null!==t&&(this._drainDone=null,t());}_read(t){this.rawStream.resume(),t(null);}_incoming(){const t=this._message;if(this._state=0,this._len=0,this._tmp=1,this._message=null,!0===this._setup){if(this._handshake)this._onhandshakert(this._handshake.recv(t));else {if(t.byteLength!==E$7)return void this.destroy(new Error("Invalid header message received"));const e=t.subarray(0,32),s=H$6(this.handshakeHash,!this.isInitiator),i=t.subarray(32);if(!P$6.equals(s,e))return void this.destroy(new Error("Invalid header received"));this._decrypt.init(i),this._setup=!1;}return}if(t.byteLength<g$6)return void this.destroy(new Error("Invalid message received"));this.rawBytesRead+=t.byteLength;const e=t.subarray(1,t.byteLength-g$6+1);try{this._decrypt.next(t,e);}catch(t){return void this.destroy(t)}0===e.byteLength&&0!==this.keepAlive||!1===this.push(e)&&this.rawStream.pause();}_onhandshakert(t){if(null===this._handshakeDone)return;if(null!==t&&(t.data&&this._rawStream.write(t.data),!t.tx))return;const e=this._handshakeDone,s=this._handshake.keyPair.publicKey;if(this._handshakeDone=null,this._handshake=null,null===t)return e(new Error("Noise handshake failed"));this._setupSecretStream(t.tx,t.rx,t.hash,s,t.remotePublicKey),this._resolveOpened(!0),e(null);}_setupSecretStream(t,e,s,i,r){const n=P$6.allocUnsafe(3+E$7);W$6(E$7,n),this._encrypt=new w$7(t.subarray(0,k$5),void 0,n.subarray(35)),this._decrypt=new y$6(e.subarray(0,k$5)),this.publicKey=i,this.remotePublicKey=r,this.handshakeHash=s;const h=n.subarray(3,35);H$6(s,this.isInitiator,h),this.emit("handshake"),this.rawStream!==this._rawStream&&this.rawStream.emit("handshake"),this.destroying||this._rawStream.write(n);}_open(t){if(null===this._rawStream||null===this._handshake&&null===this._encrypt)this._startDone=t;else {if(this._rawStream.on("data",this._onrawdata.bind(this)),this._rawStream.on("end",this._onrawend.bind(this)),this._rawStream.on("drain",this._onrawdrain.bind(this)),null!==this._encrypt)return this._resolveOpened(!0),t(null);this._handshakeDone=t,this.isInitiator&&this._onhandshakert(this._handshake.send());}}_predestroy(){if(this.rawStream){const t=D$6(this);this.rawStream.destroy(t);}if(null!==this._startDone){const t=this._startDone;this._startDone=null,t(new Error("Stream destroyed"));}if(null!==this._handshakeDone){const t=this._handshakeDone;this._handshakeDone=null,t(new Error("Stream destroyed"));}if(null!==this._drainDone){const t=this._drainDone;this._drainDone=null,t(new Error("Stream destroyed"));}}_write(t,e){let s=this._outgoingWrapped;if(t!==this._outgoingPlain?(s=P$6.allocUnsafe(t.byteLength+3+g$6),s.set(t,4)):this._outgoingWrapped=this._outgoingPlain=null,s.byteLength-3>B$6)return e(new Error("Message is too large for an atomic write. Max size is "+B$6+" bytes."));this.rawBytesWritten+=s.byteLength,W$6(s.byteLength-3,s),this._encrypt.next(s.subarray(4,4+t.byteLength),s.subarray(3)),null!==this._keepAliveTimer&&this._keepAliveTimer.refresh(),!1===this._rawStream.write(s)?this._drainDone=e:e(null);}_final(t){this._clearKeepAlive(),this._ended--,this._rawStream.end(),t(null);}_resolveOpened(t){if(null===this._openedDone)return;const e=this._openedDone;this._openedDone=null,e(t),t&&(this.connected=!0,this.emit("connect"));}_clearTimeout(){null!==this._timeoutTimer&&(this._timeoutTimer.destroy(),this._timeoutTimer=null,this.timeout=0);}_clearKeepAlive(){null!==this._keepAliveTimer&&(this._keepAliveTimer.destroy(),this._keepAliveTimer=null,this.keepAlive=0);}_destroy(t){this._clearKeepAlive(),this._clearTimeout(),this._resolveOpened(!1),t(null);}alloc(t){const e=P$6.allocUnsafe(t+3+g$6);return this._outgoingWrapped=e,this._outgoingPlain=e.subarray(4,e.byteLength-g$6+1),this._outgoingPlain}toJSON(){return {isInitiator:this.isInitiator,publicKey:this.publicKey&&P$6.toString(this.publicKey,"hex"),remotePublicKey:this.remotePublicKey&&P$6.toString(this.remotePublicKey,"hex"),connected:this.connected,destroying:this.destroying,destroyed:this.destroyed,rawStream:this.rawStream&&this.rawStream.toJSON?this.rawStream.toJSON():null}}};function W$6(t,e){e[0]=255&t,e[1]=t>>>8&255,e[2]=t>>>16&255;}function H$6(t,e,s=P$6.allocUnsafe(32)){return b$5.crypto_generichash(s,e?L$6:I$6,t),s}function U$6(t){return "string"==typeof t?P$6.from(t):t}function N$6(){this.destroy(new Error("Stream timed out"));}function Y$6(){const t=this.alloc(0);this.write(t);}

/**
 * Bundled by jsDelivr using Rollup v2.79.1 and Terser v5.19.2.
 * Original file: /npm/hypertrace@1.4.2/index.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
const t$b=new Map,e$8=Symbol.for("hypertrace.traceFunction");let s$9 = class s{constructor(e,s={}){if(!e)throw new Error("Context required, see hypertrace documentation");const{parent:c,props:r}=s;this.enabled=!0,this.ctx=e,this.className=e.constructor.name,this.props=r||null,this.parentObject=c?{className:c.className,id:c.objectId,props:{...c.props},ctx:c.ctx}:null;const a=t$b.get(e.constructor)||{id:0,stacktraceCache:new Map};a.id+=1,this.objectId=a.id,t$b.set(e.constructor,a);}setParent(t){this.parentObject=t?{className:t.className,id:t.objectId,props:{...t.props},ctx:t.ctx}:null;}trace(s,c){const r=globalThis[e$8];if(!r)return;"string"==typeof s||(c=s,s=null);const a=t$b.get(this.ctx.constructor);let n=s&&a.stacktraceCache.get(s);if(!!!n){n=(new Error).stack,a.stacktraceCache.set(s,n);}const o=n.split("\n")[2],[,l,i,p,h]=o.match(/.*at (.+) \((?:file:\/:\/)?(.+):(\d+):(\d+)\)/),u=l.split(".")[0]===this.className?l.substr(l.indexOf(".")+1):l,b={className:this.className,id:this.objectId,props:this.props&&{...this.props},ctx:this.ctx},d={functionName:u,filename:i,line:Number(p),column:Number(h),props:c&&{...c}};r({id:s||null,object:b,parentObject:this.parentObject,caller:d});}};const c$9=new class{constructor(){this.enabled=!1,this.ctx=null,this.className=null,this.props=null,this.parentObject=null,this.objectId=null;}trace(){}setParent(){}};var r$c={setTraceFunction:t=>{globalThis[e$8]=t;},clearTraceFunction:()=>{globalThis[e$8]=void 0;},createTracer:(t,r)=>!!globalThis[e$8]?new s$9(t,r):c$9};

/**
 * Bundled by jsDelivr using Rollup v2.79.1 and Terser v5.19.2.
 * Original file: /npm/unslab@1.3.0/index.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
const t$a=L$b;l$6.all=function(e){let n=0;for(let t=0;t<e.length;t++){const l=e[t];n+=null===l||l.buffer.byteLength===l.byteLength?0:l.byteLength;}const l=t$a.allocUnsafeSlow(n),r=new Array(e.length);let f=0;for(let t=0;t<e.length;t++){let n=e[t];null!==n&&n.buffer.byteLength!==n.byteLength&&(l.set(n,f),n=l.subarray(f,f+=n.byteLength)),r[t]=n;}return r},l$6.is=function(e){return e.buffer.byteLength!==e.byteLength};var n$a=l$6;function l$6(e){if(null===e||e.buffer.byteLength===e.byteLength)return e;const n=t$a.allocUnsafeSlow(e.byteLength);return n.set(e,0),n}

/**
 * Bundled by jsDelivr using Rollup v2.79.1 and Terser v5.19.2.
 * Original file: /npm/protomux@3.9.2/index.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
const r$b=L$b,h$6=t$g,l$5=e$t,a$5=r$u,{createTracer:d$7}=r$c,c$8=n$a;let u$a = class u{constructor(e,t,s,n,i,o,r,h,l,a,c,u){this.tracer=d$7(this),this.userData=s,this.protocol=n,this.aliases=i,this.id=o,this.handshake=null,this.messages=[],this.opened=!1,this.closed=!1,this.destroyed=!1,this.onopen=l,this.onclose=a,this.ondestroy=c,this.ondrain=u,this._handshake=r,this._mux=e,this._info=t,this._localId=0,this._remoteId=0,this._active=0,this._extensions=null,this._decBound=this._dec.bind(this),this._decAndDestroyBound=this._decAndDestroy.bind(this),this._openedPromise=null,this._openedResolve=null;for(const e of h)this.addMessage(e);}get drained(){return this._mux.drained}fullyOpened(){return this.opened?Promise.resolve(!0):this.closed?Promise.resolve(!1):(this._openedPromise||(this._openedPromise=new Promise((e=>{this._openedResolve=e;}))),this._openedPromise)}open(e){const t=this._mux._free.length>0?this._mux._free.pop():this._mux._local.push(null)-1;this._info.opened++,this._info.lastChannel=this,this._localId=t+1,this._mux._local[t]=this,0===this._remoteId&&this._info.outgoing.push(this._localId);const s={buffer:null,start:2,end:2};h$6.uint.preencode(s,this._localId),h$6.string.preencode(s,this.protocol),h$6.buffer.preencode(s,this.id),this._handshake&&this._handshake.preencode(s,e),s.buffer=this._mux._alloc(s.end),s.buffer[0]=0,s.buffer[1]=1,h$6.uint.encode(s,this._localId),h$6.string.encode(s,this.protocol),h$6.buffer.encode(s,this.id),this._handshake&&this._handshake.encode(s,e),this._mux._write0(s.buffer);}_dec(){0==--this._active&&!0===this.closed&&this._destroy();}_decAndDestroy(e){this._dec(),this._mux._safeDestroy(e);}_fullyOpenSoon(){this._mux._remote[this._remoteId-1].session=this,l$5(this._fullyOpen.bind(this));}_fullyOpen(){if(!0===this.opened||!0===this.closed)return;const e=this._mux._remote[this._remoteId-1];this.opened=!0,this.handshake=this._handshake?this._handshake.decode(e.state):null,this._track(this.onopen(this.handshake,this)),e.session=this,e.state=null,null!==e.pending&&this._drain(e),this._resolveOpen(!0);}_resolveOpen(e){null!==this._openedResolve&&(this._openedResolve(e),this._openedResolve=this._openedPromise=null);}_drain(e){for(let t=0;t<e.pending.length;t++){const s=e.pending[t];this._mux._buffered-=p$6(s.state),this._recv(s.type,s.state);}e.pending=null,this._mux._resumeMaybe();}_track(e){return !0===function(e){return !(!e||"function"!=typeof e.then)}(e)?(this._active++,e.then(this._decBound,this._decAndDestroyBound)):null}_close(e){!0!==this.closed&&(this.closed=!0,this._info.opened--,this._info.lastChannel===this&&(this._info.lastChannel=null),this._remoteId>0&&(this._mux._remote[this._remoteId-1]=null,this._remoteId=0,this._mux._free.push(this._localId-1)),this._mux._local[this._localId-1]=null,this._localId=0,this._mux._gc(this._info),this._track(this.onclose(e,this)),0===this._active&&this._destroy(),this._resolveOpen(!1));}_destroy(){!0!==this.destroyed&&(this.destroyed=!0,this._track(this.ondestroy(this)));}_recv(e,t){return e<this.messages.length?this.messages[e].recv(t,this):null}cork(){this._mux.cork();}uncork(){this._mux.uncork();}close(){if(!0===this.closed)return;const e={buffer:null,start:2,end:2};h$6.uint.preencode(e,this._localId),e.buffer=this._mux._alloc(e.end),e.buffer[0]=0,e.buffer[1]=3,h$6.uint.encode(e,this._localId),this._close(!1),this._mux._write0(e.buffer);}addMessage(e){if(!e)return this._skipMessage();const t=this.messages.length,s=e.encoding||h$6.raw,n=e.onmessage||f$7,i=this,o=function(e,t){const s={buffer:null,start:0,end:0};return e.preencode(s,t),s.end}(h$6.uint,t),r={type:t,encoding:s,onmessage:n,recv:(e,n)=>(i.tracer.trace("recv",{protocol:i.protocol,id:i.id,type:t}),n._track(r.onmessage(s.decode(e),n))),send(e,n=i){if(!0===n.closed)return !1;i.tracer.trace("send",{protocol:i.protocol,id:i.id,type:t});const r=n._mux,l={buffer:null,start:0,end:o};return null!==r._batch?(s.preencode(l,e),l.buffer=r._alloc(l.end),h$6.uint.encode(l,t),s.encode(l,e),r._pushBatch(n._localId,l.buffer),!0):(h$6.uint.preencode(l,n._localId),s.preencode(l,e),l.buffer=r._alloc(l.end),h$6.uint.encode(l,n._localId),h$6.uint.encode(l,t),s.encode(l,e),r.drained=r.stream.write(l.buffer),r.drained)}};return this.messages.push(r),r}_skipMessage(){const e={type:this.messages.length,encoding:h$6.raw,onmessage:f$7,recv(e,t){},send(e,t){}};return this.messages.push(e),e}};var _$5=class _{constructor(e,{alloc:t}={}){null===e.userData&&(e.userData=this),this.isProtomux=!0,this.stream=e,this.corked=0,this.drained=!0,this._alloc=t||("function"==typeof e.alloc?e.alloc.bind(e):r$b.allocUnsafe),this._safeDestroyBound=this._safeDestroy.bind(this),this._uncorkBound=this.uncork.bind(this),this._remoteBacklog=0,this._buffered=0,this._paused=!1,this._remote=[],this._local=[],this._free=[],this._batch=null,this._batchState=null,this._infos=new Map,this._notify=new Map,this.stream.on("data",this._ondata.bind(this)),this.stream.on("drain",this._ondrain.bind(this)),this.stream.on("end",this._onend.bind(this)),this.stream.on("error",f$7),this.stream.on("close",this._shutdown.bind(this));}static from(e,t){return e.userData&&e.userData.isProtomux?e.userData:e.isProtomux?e:new this(e,t)}static isProtomux(e){return "object"==typeof e&&!0===e.isProtomux}*[Symbol.iterator](){for(const e of this._local)null!==e&&(yield e);}isIdle(){return this._local.length===this._free.length}cork(){1==++this.corked&&(this._batch=[],this._batchState={buffer:null,start:0,end:1});}uncork(){0==--this.corked&&(this._sendBatch(this._batch,this._batchState),this._batch=null,this._batchState=null);}getLastChannel({protocol:e,id:t=null}){const s=m$5(e,t),n=this._infos.get(s);return n?n.lastChannel:null}pair({protocol:e,id:t=null},s){this._notify.set(m$5(e,t),s);}unpair({protocol:e,id:t=null}){this._notify.delete(m$5(e,t));}opened({protocol:e,id:t=null}){const s=m$5(e,t),n=this._infos.get(s);return !!n&&n.opened>0}createChannel({userData:e=null,protocol:t,aliases:s=[],id:n=null,unique:i=!0,handshake:o=null,messages:r=[],onopen:h=f$7,onclose:l=f$7,ondestroy:a=f$7,ondrain:d=f$7}){if(this.stream.destroyed)return null;const c=this._get(t,n,s);if(i&&c.opened>0)return null;if(0===c.incoming.length)return new u$a(this,c,e,t,s,n,o,r,h,l,a,d);this._remoteBacklog--;const _=c.incoming.shift();if(null===this._remote[_-1])return null;const m=new u$a(this,c,e,t,s,n,o,r,h,l,a,d);return m._remoteId=_,m._fullyOpenSoon(),m}_pushBatch(e,t){this._batchState.end>=8388608&&(this._sendBatch(this._batch,this._batchState),this._batch=[],this._batchState={buffer:null,start:0,end:1}),0!==this._batch.length&&this._batch[this._batch.length-1].localId===e||(this._batchState.end++,h$6.uint.preencode(this._batchState,e)),h$6.buffer.preencode(this._batchState,t),this._batch.push({localId:e,buffer:t});}_sendBatch(e,t){if(0===e.length)return;let s=e[0].localId;t.buffer=this._alloc(t.end),t.buffer[t.start++]=0,t.buffer[t.start++]=0,h$6.uint.encode(t,s);for(let n=0;n<e.length;n++){const i=e[n];s!==i.localId&&(t.buffer[t.start++]=0,h$6.uint.encode(t,s=i.localId)),h$6.buffer.encode(t,i.buffer);}this.drained=this.stream.write(t.buffer);}_get(e,t,s=[]){const n=m$5(e,t);let i=this._infos.get(n);if(i)return i;i={key:n,protocol:e,aliases:[],id:t,pairing:0,opened:0,incoming:[],outgoing:[],lastChannel:null},this._infos.set(n,i);for(const e of s){const s=m$5(e,t);i.aliases.push(s),this._infos.set(s,i);}return i}_gc(e){if(0===e.opened&&0===e.outgoing.length&&0===e.incoming.length){this._infos.delete(e.key);for(const t of e.aliases)this._infos.delete(t);}}_ondata(e){if(0!==e.byteLength)try{const t={buffer:e,start:0,end:e.byteLength};this._decode(h$6.uint.decode(t),t);}catch(e){this._safeDestroy(e);}}_ondrain(){this.drained=!0;for(const e of this._local)null!==e&&e._track(e.ondrain(e));}_onend(){this.stream.end();}_decode(e,t){const s=h$6.uint.decode(t);if(0===e)return this._oncontrolsession(s,t);const n=e<=this._remote.length?this._remote[e-1]:null;if(null!==n){if(null===n.pending)return n.session._recv(s,t);this._bufferMessage(n,s,t);}}_oncontrolsession(e,t){switch(e){case 0:this._onbatch(t);break;case 1:return this._onopensession(t);case 2:this._onrejectsession(t);break;case 3:this._onclosesession(t);}return null}_bufferMessage(e,t,{buffer:s,start:n,end:i}){const o={buffer:s,start:n,end:i};e.pending.push({type:t,state:o}),this._buffered+=p$6(o),this._pauseMaybe();}_pauseMaybe(){!0===this._paused||this._buffered<=32768||(this._paused=!0,this.stream.pause());}_resumeMaybe(){!1===this._paused||this._buffered>32768||(this._paused=!1,this.stream.resume());}_onbatch(e){const t=e.end;let s=h$6.uint.decode(e),n=null;for(;e.end>e.start;){const i=h$6.uint.decode(e);if(0===i){s=h$6.uint.decode(e);continue}e.end=e.start+i,t!==e.end&&null===n&&(n=[],this.cork());const o=this._decode(s,e);null!==n&&null!==o&&n.push(o),e.start=e.end,e.end=t;}null!==n&&Promise.all(n).then(this._uncorkBound,this._safeDestroyBound);}_onopensession(e){const t=h$6.uint.decode(e),s=h$6.string.decode(e),n=c$8(h$6.buffer.decode(e));if(0===t)return this._rejectSession(0),null;const i=t-1,o=this._get(s,n);if(this._remote.length===i&&this._remote.push(null),i>=this._remote.length||null!==this._remote[i])throw new Error("Invalid open message");if(o.outgoing.length>0){const s=o.outgoing.shift(),n=this._local[s-1];return null===n?(this._free.push(s-1),null):(this._remote[i]={state:e,pending:null,session:null},n._remoteId=t,n._fullyOpen(),null)}const r={buffer:e.buffer,start:e.start,end:e.end};if(this._remote[i]={state:r,pending:[],session:null},++this._remoteBacklog>Infinity)throw new Error("Remote exceeded backlog");return o.pairing++,o.incoming.push(t),this._requestSession(s,n,o).catch(this._safeDestroyBound)}_onrejectsession(e){const t=h$6.uint.decode(e);for(const e of this._infos.values()){const s=e.outgoing.indexOf(t);if(-1===s)continue;e.outgoing.splice(s,1);const n=this._local[t-1];return this._free.push(t-1),null!==n&&n._close(!0),void this._gc(e)}throw new Error("Invalid reject message")}_onclosesession(e){const t=h$6.uint.decode(e);if(0===t)return;const s=t-1,n=s<this._remote.length?this._remote[s]:null;null!==n&&null!==n.session&&n.session._close(!0);}async _requestSession(e,t,s){const n=this._notify.get(m$5(e,t))||this._notify.get(m$5(e,null));if(n&&await n(t),!(--s.pairing>0)){for(;s.incoming.length>0;)this._rejectSession(s,s.incoming.shift());this._gc(s);}}_rejectSession(e,t){if(t>0){const e=this._remote[t-1];if(null!==e.pending)for(let t=0;t<e.pending.length;t++)this._buffered-=p$6(e.pending[t].state);this._remote[t-1]=null,this._resumeMaybe();}const s={buffer:null,start:2,end:2};h$6.uint.preencode(s,t),s.buffer=this._alloc(s.end),s.buffer[0]=0,s.buffer[1]=2,h$6.uint.encode(s,t),this._write0(s.buffer);}_write0(e){null===this._batch?this.drained=this.stream.write(e):this._pushBatch(0,e.subarray(1));}destroy(e){this.stream.destroy(e);}_safeDestroy(e){a$5(e),this.stream.destroy(e);}_shutdown(){for(const e of this._local)null!==e&&e._close(!0);}};function f$7(){}function m$5(e,t){return e+"##"+(t?r$b.toString(t,"hex"):"")}function p$6(e){return e.end-e.start+512}

/**
 * Bundled by jsDelivr using Rollup v2.79.1 and Terser v5.19.2.
 * Original file: /npm/random-array-iterator@1.0.0/index.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
var t$9=class t{constructor(t){this.values=t,this.start=0,this.length=this.values.length;}next(){if(0===this.length){if(0===this.start)return {done:!0,value:void 0};this.length=this.start,this.start=0;}const t=this.start+(Math.random()*this.length|0),s=this.start+--this.length,h=this.values[t];return this.values[t]=this.values[s],this.values[s]=h,{done:!1,value:h}}dequeue(){this.values[this.start+this.length]=this.values[this.values.length-1],this.values.pop();}requeue(){const t=this.start+this.length,s=this.values[t];this.values[t]=this.values[this.start],this.values[this.start++]=s;}restart(){return this.start=0,this.length=this.values.length,this}[Symbol.iterator](){return this}};

/**
 * Bundled by jsDelivr using Rollup v2.79.1 and Terser v5.19.2.
 * Original file: /npm/flat-tree@1.11.0/index.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
var t$8={};!function(t){function i(t){return t<31?1<<t:(1<<30)*(1<<t-30)}function n(t){return (t-(1&t))/2}function e(){this.index=0,this.offset=0,this.factor=0;}t.fullRoots=function(t,i){if(1&t)throw new Error("You can only look up roots for depth(0) blocks");i||(i=[]),t/=2;let n=0,e=1;for(;;){if(!t)return i;for(;2*e<=t;)e*=2;i.push(n+e-1),n+=2*e,t-=e,e=1;}},t.futureRoots=function(t,i){if(1&t)throw new Error("You can only look up future roots for depth(0) blocks");i||(i=[]);let n=1;for(;2*n<=t;)n*=2;if(2*n-2===t)return i;let e=n/2-1;for(;e+n/2-1!==t;){for(e+=n;e+n/2-1>t;)n/=2,e-=n/2;i.push(e-n/2);}return i},t.depth=function(t){let i=0;for(t+=1;!(1&t);)i++,t=n(t);return i},t.sibling=function(i,n){n||(n=t.depth(i));const e=t.offset(i,n);return t.index(n,1&e?e-1:e+1)},t.parent=function(i,e){e||(e=t.depth(i));const o=t.offset(i,e);return t.index(e+1,n(o))},t.leftChild=function(i,n){return 1&i?(n||(n=t.depth(i)),t.index(n-1,2*t.offset(i,n))):-1},t.rightChild=function(i,n){return 1&i?(n||(n=t.depth(i)),t.index(n-1,1+2*t.offset(i,n))):-1},t.children=function(i,n){if(!(1&i))return null;n||(n=t.depth(i));const e=2*t.offset(i,n);return [t.index(n-1,e),t.index(n-1,e+1)]},t.leftSpan=function(n,e){return 1&n?(e||(e=t.depth(n)),t.offset(n,e)*i(e+1)):n},t.rightSpan=function(n,e){return 1&n?(e||(e=t.depth(n)),(t.offset(n,e)+1)*i(e+1)-2):n},t.nextLeaf=function(t){let i=1,n=t;for(;1==(1&n);)n=(n-1)/2,i*=2;return t+i+1},t.count=function(n,e){return 1&n?(e||(e=t.depth(n)),i(e+1)-1):1},t.countLeaves=function(i){return (t.count(i)+1)/2},t.spans=function(n,e){if(!(1&n))return [n,n];e||(e=t.depth(n));const o=t.offset(n,e),r=i(e+1);return [o*r,(o+1)*r-2]},t.index=function(t,n){return (1+2*n)*i(t)-1},t.offset=function(n,e){return 1&n?(e||(e=t.depth(n)),((n+1)/i(e)-1)/2):n/2},t.iterator=function(t){const i=new e;return i.seek(t||0),i},e.prototype.seek=function(n){this.index=n,1&this.index?(this.offset=t.offset(n),this.factor=i(t.depth(n)+1)):(this.offset=n/2,this.factor=2);},e.prototype.isLeft=function(){return 0==(1&this.offset)},e.prototype.isRight=function(){return 1==(1&this.offset)},e.prototype.contains=function(t){return t>this.index?t<this.index+this.factor/2:!(t<this.index)||t>this.index-this.factor/2},e.prototype.prev=function(){return this.offset?(this.offset--,this.index-=this.factor,this.index):this.index},e.prototype.next=function(){return this.offset++,this.index+=this.factor,this.index},e.prototype.count=function(){return 1&this.index?this.factor-1:1},e.prototype.countLeaves=function(){return (this.count()+1)/2},e.prototype.sibling=function(){return this.isLeft()?this.next():this.prev()},e.prototype.parent=function(){return 1&this.offset?(this.index-=this.factor/2,this.offset=(this.offset-1)/2):(this.index+=this.factor/2,this.offset/=2),this.factor*=2,this.index},e.prototype.leftSpan=function(){return this.index=this.index-this.factor/2+1,this.offset=this.index/2,this.factor=2,this.index},e.prototype.rightSpan=function(){return this.index=this.index+this.factor/2-1,this.offset=this.index/2,this.factor=2,this.index},e.prototype.leftChild=function(){return 2===this.factor||(this.factor/=2,this.index-=this.factor/2,this.offset*=2),this.index},e.prototype.rightChild=function(){return 2===this.factor||(this.factor/=2,this.index+=this.factor/2,this.offset=2*this.offset+1),this.index},e.prototype.nextTree=function(){return this.index=this.index+this.factor/2+1,this.offset=this.index/2,this.factor=2,this.index},e.prototype.prevTree=function(){return this.offset?(this.index=this.index-this.factor/2-1,this.offset=this.index/2,this.factor=2):(this.index=0,this.factor=2),this.index},e.prototype.fullRoot=function(t){if(t<=this.index||(1&this.index)>0)return !1;for(;t>this.index+this.factor+this.factor/2;)this.index+=this.factor/2,this.factor*=2,this.offset/=2;return !0};}(t$8);t$8.children;t$8.count;t$8.countLeaves;t$8.depth;t$8.fullRoots;t$8.futureRoots;t$8.index;t$8.iterator;t$8.leftChild;t$8.leftSpan;t$8.nextLeaf;t$8.offset;t$8.parent;t$8.rightChild;t$8.rightSpan;t$8.sibling;t$8.spans;

/**
 * Bundled by jsDelivr using Rollup v2.79.1 and Terser v5.19.2.
 * Original file: /npm/big-sparse-array@1.0.3/index.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
const t$7=new Uint16Array(8);function s$8(s,i){for(;i>0;){const h=4095&s;t$7[--i]=h,s=(s-h)/4096;}return t$7}var i$5=class i{constructor(){this.tiny=new h$5,this.maxLength=4096,this.factor=1;}set(t,i){if(void 0!==i)for(;t>=this.maxLength;)if(this.maxLength*=4096,this.factor++,!this.tiny.isEmptyish()){const t=new h$5;t.set(0,this.tiny),this.tiny=t;}const n=s$8(t,this.factor),r=this.factor-1;let e=this.tiny;for(let t=0;t<r;t++){const s=e.get(n[t]);if(void 0===s){if(void 0===i)return;e=e.set(n[t],new h$5);}else e=s;}return e.set(n[r],i)}get(t){if(t>=this.maxLength)return;const i=s$8(t,this.factor),h=this.factor-1;let n=this.tiny;for(let t=0;t<h;t++)if(n=n.get(i[t]),void 0===n)return;return n.get(i[h])}};let h$5 = class h{constructor(){this.s=0,this.b=new Array(1),this.f=new Uint16Array(1);}isEmptyish(){return 1===this.b.length&&void 0===this.b[0]}get(t){if(12===this.s)return this.b[t];const s=t>>>this.s,i=t&this.b.length-1;return this.f[i]===s?this.b[i]:void 0}set(t,s){for(;12!==this.s;){const i=t>>>this.s,h=t&this.b.length-1;if(void 0===this.b[h]||i===this.f[h])return this.b[h]=s,this.f[h]=i,s;this.grow();}return this.b[t]=s,s}grow(){const t=this.s,s=this.b,i=this.f;this.s+=4,this.b=new Array(this.b.length<<4),this.f=12===this.s?null:new Uint8Array(this.b.length);const h=this.b.length-1;for(let n=0;n<s.length;n++){if(void 0===s[n])continue;const r=i[n]<<t|n,e=r>>>this.s,o=r&h;this.b[o]=s[n],12!==this.s&&(this.f[o]=e);}}};

/**
 * Bundled by jsDelivr using Rollup v2.79.1 and Terser v5.19.2.
 * Original file: /npm/simdle-universal@1.1.2/fallback.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
var e$7={},n$9={};const r$a=n$9.clz=function(t){return Math.clz32(t)};n$9.clo=function(t){return r$a(~t)};const l$4=n$9.ctz=function(t){return 32-(0===t?0:r$a(t&-t)+1)};n$9.cto=function(t){return l$4(~t)},n$9.cnt=function(t){return t=16843009*(t=(t=(858993459&(t-=t>>>1&1431655765))+(t>>>2&858993459))+(t>>>4)&252645135)>>>24};const o$7=L$b,f$6=n$9;function h$4(t,e){if(e===t.BYTES_PER_ELEMENT)return t;let n;return n=1===e?Uint8Array:2===e?Uint16Array:Uint32Array,new n(t.buffer,t.byteOffset,t.byteLength/e)}function u$9(t,e=t,n=e){return function(r,l=o$7.allocUnsafe(r.byteLength)){if(r.byteLength%16!=0)throw new Error("Buffer length must be a multiple of 16");if(r.byteLength!==l.byteLength)throw new Error("Length of result buffer is insufficient");const f=r.BYTES_PER_ELEMENT;return 1===f?t(r,h$4(l,f)):2===f?e(r,h$4(l,f)):n(r,h$4(l,f)),l}}function c$7(t,e=t,n=e){return function(r,l,f=o$7.allocUnsafe(r.byteLength)){if(r.byteLength%16!=0)throw new Error("Buffer length must be a multiple of 16");if(r.byteLength!==l.byteLength||r.byteLength!==f.byteLength)throw new Error("Buffers must be the same length");const u=r.BYTES_PER_ELEMENT;return 1===u?t(r,l,h$4(f,u)):2===u?e(r,l,h$4(f,u)):n(r,l,h$4(f,u)),f}}e$7.allo=function(t){if(t.byteLength%16!=0)throw new Error("Buffer length must be a multiple of 16");const e=2**(8*t.BYTES_PER_ELEMENT)-1;for(let n=0,r=t.length;n<r;n++)if(t[n]!==e)return !1;return !0};e$7.allz=function(t){if(t.byteLength%16!=0)throw new Error("Buffer length must be a multiple of 16");for(let e=0,n=t.length;e<n;e++)if(0!==t[e])return !1;return !0};e$7.and=c$7(((t,e,n)=>{for(let r=0,l=n.length;r<l;r++)n[r]=t[r]&e[r];}));e$7.clear=c$7(((t,e,n)=>{for(let r=0,l=n.length;r<l;r++)n[r]=t[r]&~e[r];}));e$7.clo=u$9(((t,e)=>{for(let n=0,r=t.length;n<r;n++)e[n]=24-f$6.clo(t[n]);}),((t,e)=>{for(let n=0,r=t.length;n<r;n++)e[n]=16-f$6.clo(t[n]);}),((t,e)=>{for(let n=0,r=t.length;n<r;n++)e[n]=f$6.clo(t[n]);}));e$7.clz=u$9(((t,e)=>{for(let n=0,r=t.length;n<r;n++)e[n]=24-f$6.clz(t[n]);}),((t,e)=>{for(let n=0,r=t.length;n<r;n++)e[n]=16-f$6.clz(t[n]);}),((t,e)=>{for(let n=0,r=t.length;n<r;n++)e[n]=f$6.clz(t[n]);}));e$7.cnt=u$9(((t,e)=>{for(let n=0,r=t.length;n<r;n++)e[n]=255&f$6.cnt(t[n]);}),((t,e)=>{for(let n=0,r=t.length;n<r;n++)e[n]=65535&f$6.cnt(t[n]);}),((t,e)=>{for(let n=0,r=t.length;n<r;n++)e[n]=f$6.cnt(t[n]);}));e$7.cto=u$9(((t,e)=>{for(let n=0,r=t.length;n<r;n++)e[n]=Math.min(f$6.cto(t[n]),8);}),((t,e)=>{for(let n=0,r=t.length;n<r;n++)e[n]=Math.min(f$6.cto(t[n]),16);}),((t,e)=>{for(let n=0,r=t.length;n<r;n++)e[n]=f$6.cto(t[n]);}));e$7.ctz=u$9(((t,e)=>{for(let n=0,r=t.length;n<r;n++)e[n]=Math.min(f$6.ctz(t[n]),8);}),((t,e)=>{for(let n=0,r=t.length;n<r;n++)e[n]=Math.min(f$6.ctz(t[n]),16);}),((t,e)=>{for(let n=0,r=t.length;n<r;n++)e[n]=f$6.ctz(t[n]);}));e$7.not=u$9(((t,e)=>{for(let n=0,r=t.length;n<r;n++)e[n]=~t[n];}));e$7.or=c$7(((t,e,n)=>{for(let r=0,l=n.length;r<l;r++)n[r]=t[r]|e[r];}));e$7.sum=function(t,e=t,n=e){return function(r){if(r.byteLength%16!=0)throw new Error("Buffer length must be a multiple of 16");const l=r.BYTES_PER_ELEMENT;return 1===l?t(r):2===l?e(r):n(r)}}((t=>{let e=0n;for(let n=0,r=t.length;n<r;n++)e+=BigInt(t[n]);return e}));e$7.xor=c$7(((t,e,n)=>{for(let r=0,l=n.length;r<l;r++)n[r]=t[r]^e[r];}));

/**
 * Bundled by jsDelivr using Rollup v2.79.1 and Terser v5.19.2.
 * Original file: /npm/quickbit-universal@2.2.0/fallback.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
var e$6={};const n$8=e$7,s$7=e$6.get=function(t,e){const n=8*t.byteLength;if(e<0&&(e+=n),e<0||e>=n)return !1;const s=8*t.BYTES_PER_ELEMENT,r=e&s-1;return 0!=(t[(e-r)/s]&1<<r)},r$9=e$6.set=function(t,e,n=!0){const s=8*t.byteLength;if(e<0&&(e+=s),e<0||e>=s)return !1;const r=8*t.BYTES_PER_ELEMENT,i=e&r-1,h=(e-i)/r,l=1<<i;if(n){if(0!=(t[h]&l))return !1}else if(0==(t[h]&l))return !1;return t[h]^=l,!0};e$6.fill=function(t,e,n=0,s=8*t.byteLength){const r=8*t.byteLength;if(n<0&&(n+=r),s<0&&(s+=r),n<0||n>=8*t.byteLength||n>=s)return t;const i=8*t.BYTES_PER_ELEMENT;let h,l;{const r=n&i-1;if(h=(n-r)/i,0!==r){let l=i-r;s-n<l&&(l=s-n);const o=(1<<l)-1<<r;e?t[h]|=o:t[h]&=~o,h++;}}{const n=s&i-1;if(l=(s-n)/i,0!==n&&l>=h){const s=(1<<n)-1;e?t[l]|=s:t[l]&=~s;}}return h<l&&t.fill(e?2**i-1:0,h,l),t};e$6.clear=function(t,...e){const s=t.byteLength;for(const r of e){if(r.offset>=s)continue;const e=r.field.byteLength;let i=r.offset,h=0;for(;(0!=(15&i)||0!=(15&h))&&i<s&&h<e;)t[i]=t[i]&~r.field[h],i++,h++;if(i+15<s&&h+15<e){const l=Math.min(s-(15&s)-i,e-(15&e)-h);n$8.clear(t.subarray(i,i+l),r.field.subarray(h,h+l),t.subarray(i,i+l));}for(;i<s&&h<e;)t[i]=t[i]&~r.field[h],i++,h++;}};function l$3(t,e){return t?16512+e:e}function o$6(t,e){return t?2064+e:e}e$6.findFirst=function(t,e,n=0){const r=8*t.byteLength;if(n<0&&(n+=r),n<0&&(n=0),n>=r)return -1;e=!!e;for(let i=n;i<r;i++)if(s$7(t,i)===e)return i;return -1};e$6.findLast=function(t,e,n=8*t.byteLength-1){const r=8*t.byteLength;if(n<0&&(n+=r),n<0)return -1;n>=r&&(n=r-1),e=!!e;for(let r=n;r>=0;r--)if(s$7(t,r)===e)return r;return -1};const u$8=e$6.Index=class{static from(t,e=-1){return Array.isArray(t)?new y$5(t,e):new c$6(t,e)}constructor(t){this._byteLength=t,this.handle=new Uint32Array(1032);}get byteLength(){return this._byteLength}skipFirst(t,e=0){const n=8*this.byteLength;if(e<0&&(e+=n),e<0&&(e=0),e>=n)return n-1;let r=Math.floor(e/16384);if(r>127)return e;for(;r<=127&&s$7(this.handle,l$3(t,r));)r++;if(128===r)return n-1;let i=16384*r,h=0;for(e>i&&(h=Math.floor((e-i)/128));h<=127&&s$7(this.handle,l$3(t,128*r+h+128));)h++,i+=128;return 128===h&&127!==r?this.skipFirst(t,16384*(r+1)):(i>e&&(e=i),e<n?e:n-1)}skipLast(t,e=8*this.byteLength-1){const n=8*this.byteLength;if(e<0&&(e+=n),e<0)return 0;e>=n&&(e=n-1);let r=Math.floor(e/16384);if(r>127)return e;for(;r>=0&&s$7(this.handle,l$3(t,r));)r--;if(-1===r)return 0;let i=16384*(r+1)-1,h=127;for(e<i&&(h=128-Math.ceil((i-e)/128));h>=0&&s$7(this.handle,l$3(t,128*r+h+128));)h--,i-=128;return -1===h&&0!==r?this.skipLast(t,16384*r-1):(i<e&&(e=i),e)}};let c$6 = class c extends u$8{constructor(t,e){super(e),this.field=t;const s=t.BYTES_PER_ELEMENT;for(let t=0;t<128;t++){for(let e=0;e<128;e++){const i=16*(128*t+e);let h=!0,o=!1;if(i+16<=this.field.byteLength){const t=this.field.subarray(i/s,(i+16)/s);h=n$8.allz(t),o=n$8.allo(t);}const a=128*t+128+e;r$9(this.handle,l$3(!1,a),h),r$9(this.handle,l$3(!0,a),o);}{const e=o$6(!1,16*t+16)/4,s=n$8.allo(this.handle.subarray(e,e+4));r$9(this.handle,l$3(!1,t),s);}{const e=o$6(!0,16*t+16)/4,s=n$8.allo(this.handle.subarray(e,e+4));r$9(this.handle,l$3(!0,t),s);}}}get byteLength(){return -1!==this._byteLength?this._byteLength:this.field.byteLength}update(t){const e=8*this.byteLength;if(t<0&&(t+=e),t<0||t>=e)return !1;const s=this.field.BYTES_PER_ELEMENT,i=Math.floor(t/16384),h=Math.floor(t/128),a=16*h/s,f=this.field.subarray(a,a+16/s),u=n$8.allz(f),c=n$8.allo(f);let d=!1;if(r$9(this.handle,l$3(!1,128+h),u)){d=!0;const t=o$6(!1,16*i+16)/4,e=n$8.allo(this.handle.subarray(t,t+4));r$9(this.handle,l$3(!1,i),e);}if(r$9(this.handle,l$3(!0,128+h),c)){d=!0;const t=o$6(!0,16*i+16)/4,e=n$8.allo(this.handle.subarray(t,t+4));r$9(this.handle,l$3(!0,i),e);}return d}};function d$6(t,e){for(let n=0;n<t.length;n++){const s=t[n],r=s.offset,i=s.offset+s.field.byteLength;if(e>=r&&e+16<=i)return s}return null}let y$5 = class y extends u$8{constructor(t,e){super(e),this.chunks=t;for(let t=0;t<128;t++){for(let e=0;e<128;e++){const s=16*(128*t+e);let i=!0,h=!1;const o=d$6(this.chunks,s);if(null!==o){const t=o.field.BYTES_PER_ELEMENT,e=o.field.subarray((s-o.offset)/t,(s-o.offset+16)/t);i=n$8.allz(e),h=n$8.allo(e);}const a=128*t+128+e;r$9(this.handle,l$3(!1,a),i),r$9(this.handle,l$3(!0,a),h);}{const e=o$6(!1,16*t+16)/4,s=n$8.allo(this.handle.subarray(e,e+4));r$9(this.handle,l$3(!1,t),s);}{const e=o$6(!0,16*t+16)/4,s=n$8.allo(this.handle.subarray(e,e+4));r$9(this.handle,l$3(!0,t),s);}}}get byteLength(){if(-1!==this._byteLength)return this._byteLength;const t=this.chunks[this.chunks.length-1];return t?t.offset+t.field.byteLength:0}update(t){const e=8*this.byteLength;if(t<0&&(t+=e),t<0||t>=e)return !1;const s=Math.floor(t/16384),i=Math.floor(t/128),h=16*i,a=d$6(this.chunks,h);if(null===a)return !1;const f=a.field.BYTES_PER_ELEMENT,u=a.field.subarray((h-a.offset)/f,(h-a.offset+16)/f),c=n$8.allz(u),y=n$8.allo(u);let b=!1;if(r$9(this.handle,l$3(!1,128+i),c)){b=!0;const t=o$6(!1,16*s+16)/4,e=n$8.allo(this.handle.subarray(t,t+4));r$9(this.handle,l$3(!1,s),e);}if(r$9(this.handle,l$3(!0,128+i),y)){b=!0;const t=o$6(!0,16*s+16)/4,e=n$8.allo(this.handle.subarray(t,t+4));r$9(this.handle,l$3(!0,s),e);}return b}};

/**
 * Bundled by jsDelivr using Rollup v2.79.1 and Terser v5.19.2.
 * Original file: /npm/quickbit-universal@2.2.0/fallback.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
var e$5={};const n$7=e$7,s$6=e$5.get=function(t,e){const n=8*t.byteLength;if(e<0&&(e+=n),e<0||e>=n)return !1;const s=8*t.BYTES_PER_ELEMENT,r=e&s-1;return 0!=(t[(e-r)/s]&1<<r)},r$8=e$5.set=function(t,e,n=!0){const s=8*t.byteLength;if(e<0&&(e+=s),e<0||e>=s)return !1;const r=8*t.BYTES_PER_ELEMENT,i=e&r-1,h=(e-i)/r,l=1<<i;if(n){if(0!=(t[h]&l))return !1}else if(0==(t[h]&l))return !1;return t[h]^=l,!0};e$5.fill=function(t,e,n=0,s=8*t.byteLength){const r=8*t.byteLength;if(n<0&&(n+=r),s<0&&(s+=r),n<0||n>=8*t.byteLength||n>=s)return t;const i=8*t.BYTES_PER_ELEMENT;let h,l;{const r=n&i-1;if(h=(n-r)/i,0!==r){let l=i-r;s-n<l&&(l=s-n);const o=(1<<l)-1<<r;e?t[h]|=o:t[h]&=~o,h++;}}{const n=s&i-1;if(l=(s-n)/i,0!==n&&l>=h){const s=(1<<n)-1;e?t[l]|=s:t[l]&=~s;}}return h<l&&t.fill(e?2**i-1:0,h,l),t};e$5.clear=function(t,...e){const s=t.byteLength;for(const r of e){if(r.offset>=s)continue;const e=r.field.byteLength;let i=r.offset,h=0;for(;(0!=(15&i)||0!=(15&h))&&i<s&&h<e;)t[i]=t[i]&~r.field[h],i++,h++;if(i+15<s&&h+15<e){const l=Math.min(s-(15&s)-i,e-(15&e)-h);n$7.clear(t.subarray(i,i+l),r.field.subarray(h,h+l),t.subarray(i,i+l));}for(;i<s&&h<e;)t[i]=t[i]&~r.field[h],i++,h++;}};function l$2(t,e){return t?16512+e:e}function o$5(t,e){return t?2064+e:e}e$5.findFirst=function(t,e,n=0){const r=8*t.byteLength;if(n<0&&(n+=r),n<0&&(n=0),n>=r)return -1;e=!!e;for(let i=n;i<r;i++)if(s$6(t,i)===e)return i;return -1};e$5.findLast=function(t,e,n=8*t.byteLength-1){const r=8*t.byteLength;if(n<0&&(n+=r),n<0)return -1;n>=r&&(n=r-1),e=!!e;for(let r=n;r>=0;r--)if(s$6(t,r)===e)return r;return -1};const u$7=e$5.Index=class{static from(t,e=-1){return Array.isArray(t)?new y$4(t,e):new c$5(t,e)}constructor(t){this._byteLength=t,this.handle=new Uint32Array(1032);}get byteLength(){return this._byteLength}skipFirst(t,e=0){const n=8*this.byteLength;if(e<0&&(e+=n),e<0&&(e=0),e>=n)return n-1;let r=Math.floor(e/16384);if(r>127)return e;for(;r<=127&&s$6(this.handle,l$2(t,r));)r++;if(128===r)return n-1;let i=16384*r,h=0;for(e>i&&(h=Math.floor((e-i)/128));h<=127&&s$6(this.handle,l$2(t,128*r+h+128));)h++,i+=128;return 128===h&&127!==r?this.skipFirst(t,16384*(r+1)):(i>e&&(e=i),e<n?e:n-1)}skipLast(t,e=8*this.byteLength-1){const n=8*this.byteLength;if(e<0&&(e+=n),e<0)return 0;e>=n&&(e=n-1);let r=Math.floor(e/16384);if(r>127)return e;for(;r>=0&&s$6(this.handle,l$2(t,r));)r--;if(-1===r)return 0;let i=16384*(r+1)-1,h=127;for(e<i&&(h=128-Math.ceil((i-e)/128));h>=0&&s$6(this.handle,l$2(t,128*r+h+128));)h--,i-=128;return -1===h&&0!==r?this.skipLast(t,16384*r-1):(i<e&&(e=i),e)}};let c$5 = class c extends u$7{constructor(t,e){super(e),this.field=t;const s=t.BYTES_PER_ELEMENT;for(let t=0;t<128;t++){for(let e=0;e<128;e++){const i=16*(128*t+e);let h=!0,o=!1;if(i+16<=this.field.byteLength){const t=this.field.subarray(i/s,(i+16)/s);h=n$7.allz(t),o=n$7.allo(t);}const a=128*t+128+e;r$8(this.handle,l$2(!1,a),h),r$8(this.handle,l$2(!0,a),o);}{const e=o$5(!1,16*t+16)/4,s=n$7.allo(this.handle.subarray(e,e+4));r$8(this.handle,l$2(!1,t),s);}{const e=o$5(!0,16*t+16)/4,s=n$7.allo(this.handle.subarray(e,e+4));r$8(this.handle,l$2(!0,t),s);}}}get byteLength(){return -1!==this._byteLength?this._byteLength:this.field.byteLength}update(t){const e=8*this.byteLength;if(t<0&&(t+=e),t<0||t>=e)return !1;const s=this.field.BYTES_PER_ELEMENT,i=Math.floor(t/16384),h=Math.floor(t/128),a=16*h/s,f=this.field.subarray(a,a+16/s),u=n$7.allz(f),c=n$7.allo(f);let d=!1;if(r$8(this.handle,l$2(!1,128+h),u)){d=!0;const t=o$5(!1,16*i+16)/4,e=n$7.allo(this.handle.subarray(t,t+4));r$8(this.handle,l$2(!1,i),e);}if(r$8(this.handle,l$2(!0,128+h),c)){d=!0;const t=o$5(!0,16*i+16)/4,e=n$7.allo(this.handle.subarray(t,t+4));r$8(this.handle,l$2(!0,i),e);}return d}};function d$5(t,e){for(let n=0;n<t.length;n++){const s=t[n],r=s.offset,i=s.offset+s.field.byteLength;if(e>=r&&e+16<=i)return s}return null}let y$4 = class y extends u$7{constructor(t,e){super(e),this.chunks=t;for(let t=0;t<128;t++){for(let e=0;e<128;e++){const s=16*(128*t+e);let i=!0,h=!1;const o=d$5(this.chunks,s);if(null!==o){const t=o.field.BYTES_PER_ELEMENT,e=o.field.subarray((s-o.offset)/t,(s-o.offset+16)/t);i=n$7.allz(e),h=n$7.allo(e);}const a=128*t+128+e;r$8(this.handle,l$2(!1,a),i),r$8(this.handle,l$2(!0,a),h);}{const e=o$5(!1,16*t+16)/4,s=n$7.allo(this.handle.subarray(e,e+4));r$8(this.handle,l$2(!1,t),s);}{const e=o$5(!0,16*t+16)/4,s=n$7.allo(this.handle.subarray(e,e+4));r$8(this.handle,l$2(!0,t),s);}}}get byteLength(){if(-1!==this._byteLength)return this._byteLength;const t=this.chunks[this.chunks.length-1];return t?t.offset+t.field.byteLength:0}update(t){const e=8*this.byteLength;if(t<0&&(t+=e),t<0||t>=e)return !1;const s=Math.floor(t/16384),i=Math.floor(t/128),h=16*i,a=d$5(this.chunks,h);if(null===a)return !1;const f=a.field.BYTES_PER_ELEMENT,u=a.field.subarray((h-a.offset)/f,(h-a.offset+16)/f),c=n$7.allz(u),y=n$7.allo(u);let b=!1;if(r$8(this.handle,l$2(!1,128+i),c)){b=!0;const t=o$5(!1,16*s+16)/4,e=n$7.allo(this.handle.subarray(t,t+4));r$8(this.handle,l$2(!1,s),e);}if(r$8(this.handle,l$2(!0,128+i),y)){b=!0;const t=o$5(!0,16*s+16)/4,e=n$7.allo(this.handle.subarray(t,t+4));r$8(this.handle,l$2(!0,s),e);}return b}};

/**
 * Bundled by jsDelivr using Rollup v2.79.1 and Terser v5.19.2.
 * Original file: /npm/hypercore-errors@1.3.0/index.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
var E$6=class E extends Error{constructor(A,I,O=E){super(`${I}: ${A}`),this.code=I,Error.captureStackTrace&&Error.captureStackTrace(this,O);}get name(){return "HypercoreError"}static ASSERTION(A){return new E(A,"ERR_ASSERTION",E.ASSERT)}static BAD_ARGUMENT(A){return new E(A,"BAD_ARGUMENT",E.BAD_ARGUMENT)}static STORAGE_EMPTY(A){return new E(A,"STORAGE_EMPTY",E.STORAGE_EMPTY)}static STORAGE_CONFLICT(A){return new E(A,"STORAGE_CONFLICT",E.STORAGE_CONFLICT)}static INVALID_SIGNATURE(A){return new E(A,"INVALID_SIGNATURE",E.INVALID_SIGNATURE)}static INVALID_CAPABILITY(A){return new E(A,"INVALID_CAPABILITY",E.INVALID_CAPABILITY)}static INVALID_CHECKSUM(A="Invalid checksum"){return new E(A,"INVALID_CHECKSUM",E.INVALID_CHECKSUM)}static INVALID_OPERATION(A){return new E(A,"INVALID_OPERATION",E.INVALID_OPERATION)}static INVALID_PROOF(A="Proof not verifiable"){return new E(A,"INVALID_PROOF",E.INVALID_PROOF)}static BLOCK_NOT_AVAILABLE(A="Block is not available"){return new E(A,"BLOCK_NOT_AVAILABLE",E.BLOCK_NOT_AVAILABLE)}static SNAPSHOT_NOT_AVAILABLE(A="Snapshot is not available"){return new E(A,"SNAPSHOT_NOT_AVAILABLE",E.SNAPSHOT_NOT_AVAILABLE)}static REQUEST_CANCELLED(A="Request was cancelled"){return new E(A,"REQUEST_CANCELLED",E.REQUEST_CANCELLED)}static REQUEST_TIMEOUT(A="Request timed out"){return new E(A,"REQUEST_TIMEOUT",E.REQUEST_TIMEOUT)}static SESSION_NOT_WRITABLE(A="Session is not writable"){return new E(A,"SESSION_NOT_WRITABLE",E.SESSION_NOT_WRITABLE)}static SESSION_CLOSED(A="Session is closed"){return new E(A,"SESSION_CLOSED",E.SESSION_CLOSED)}static BATCH_UNFLUSHED(A="Batch not yet flushed"){return new E(A,"BATCH_UNFLUSHED",E.BATCH_UNFLUSHED)}static BATCH_ALREADY_EXISTS(A="Batch already exists"){return new E(A,"BATCH_ALREADY_EXISTS",E.BATCH_ALREADY_EXISTS)}static BATCH_ALREADY_FLUSHED(A="Batch has already been flushed"){return new E(A,"BATCH_ALREADY_FLUSHED",E.BATCH_ALREADY_FLUSHED)}static OPLOG_CORRUPT(A="Oplog file appears corrupt or out of date"){return new E(A,"OPLOG_CORRUPT",E.OPLOG_CORRUPT)}static OPLOG_HEADER_OVERFLOW(A="Oplog header exceeds page size"){return new E(A,"OPLOG_HEADER_OVERFLOW",E.OPLOG_HEADER_OVERFLOW)}static INVALID_OPLOG_VERSION(A="Invalid header version"){return new E(A,"INVALID_OPLOG_VERSION",E.INVALID_OPLOG_VERSION)}static WRITE_FAILED(A="Write to storage failed"){return new E(A,"WRITE_FAILED",E.WRITE_FAILED)}static DECODING_ERROR(A="Decoding error"){return new E(A,"DECODING_ERROR",E.DECODING_ERROR)}};E$6.ASSERTION;E$6.BAD_ARGUMENT;E$6.BATCH_ALREADY_EXISTS;E$6.BATCH_ALREADY_FLUSHED;E$6.BATCH_UNFLUSHED;E$6.BLOCK_NOT_AVAILABLE;E$6.DECODING_ERROR;E$6.INVALID_CAPABILITY;E$6.INVALID_CHECKSUM;E$6.INVALID_OPERATION;E$6.INVALID_OPLOG_VERSION;E$6.INVALID_PROOF;E$6.INVALID_SIGNATURE;E$6.OPLOG_CORRUPT;E$6.OPLOG_HEADER_OVERFLOW;E$6.REQUEST_CANCELLED;E$6.REQUEST_TIMEOUT;E$6.SESSION_CLOSED;E$6.SESSION_NOT_WRITABLE;E$6.SNAPSHOT_NOT_AVAILABLE;E$6.STORAGE_CONFLICT;E$6.STORAGE_EMPTY;E$6.WRITE_FAILED;

/**
 * Bundled by jsDelivr using Rollup v2.79.1 and Terser v5.19.2.
 * Original file: /npm/crc-universal@1.0.4/fallback.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
var r$7={};const t$6=new Array(16);for(let r=0;r<16;r++)t$6[r]=new Uint32Array(256);for(let r=0;r<=255;r++){let e=r;for(let r=0;r<8;r++)e=e>>>1^3988292384*(1&e);t$6[0][r]=e;}for(let r=0;r<=255;r++)for(let e=1;e<16;e++)t$6[e][r]=t$6[e-1][r]>>>8^t$6[0][255&t$6[e-1][r]];const e$4=t$6;r$7.crc32=function(r){let t=-1,o=0,f=r.byteLength;for(;f>=16;)t=e$4[15][r[o++]^255&t]^e$4[14][r[o++]^t>>>8&255]^e$4[13][r[o++]^t>>>16&255]^e$4[12][r[o++]^t>>>24]^e$4[11][r[o++]]^e$4[10][r[o++]]^e$4[9][r[o++]]^e$4[8][r[o++]]^e$4[7][r[o++]]^e$4[6][r[o++]]^e$4[5][r[o++]]^e$4[4][r[o++]]^e$4[3][r[o++]]^e$4[2][r[o++]]^e$4[1][r[o++]]^e$4[0][r[o++]],f-=16;for(;f-- >0;)t=t>>>8^e$4[0][255&t^r[o++]];return ~t>>>0};

/**
 * Bundled by jsDelivr using Rollup v2.79.1 and Terser v5.19.2.
 * Original file: /npm/streamx@2.20.1/index.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
function r$6(t){return t&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function n$6(){}function s$5(){s$5.init.call(this);}function a$4(t){return void 0===t._maxListeners?s$5.defaultMaxListeners:t._maxListeners}function l$1(t,e,i,r){var s,l,u,h;if("function"!=typeof i)throw new TypeError('"listener" argument must be a function');if((l=t._events)?(l.newListener&&(t.emit("newListener",e,i.listener?i.listener:i),l=t._events),u=l[e]):(l=t._events=new n$6,t._eventsCount=0),u){if("function"==typeof u?u=l[e]=r?[i,u]:[u,i]:r?u.unshift(i):u.push(i),!u.warned&&(s=a$4(t))&&s>0&&u.length>s){u.warned=!0;var o=new Error("Possible EventEmitter memory leak detected. "+u.length+" "+e+" listeners added. Use emitter.setMaxListeners() to increase limit");o.name="MaxListenersExceededWarning",o.emitter=t,o.type=e,o.count=u.length,h=o,"function"==typeof console.warn?console.warn(h):console.log(h);}}else u=l[e]=i,++t._eventsCount;return t}function u$6(t,e,i){var r=!1;function n(){t.removeListener(e,n),r||(r=!0,i.apply(t,arguments));}return n.listener=i,n}function h$3(t){var e=this._events;if(e){var i=e[t];if("function"==typeof i)return 1;if(i)return i.length}return 0}function o$4(t,e){for(var i=new Array(e);e--;)i[e]=t[e];return i}n$6.prototype=Object.create(null),s$5.EventEmitter=s$5,s$5.usingDomains=!1,s$5.prototype.domain=void 0,s$5.prototype._events=void 0,s$5.prototype._maxListeners=void 0,s$5.defaultMaxListeners=10,s$5.init=function(){this.domain=null,s$5.usingDomains&&undefined.active,this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=new n$6,this._eventsCount=0),this._maxListeners=this._maxListeners||void 0;},s$5.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||isNaN(t))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=t,this},s$5.prototype.getMaxListeners=function(){return a$4(this)},s$5.prototype.emit=function(t){var e,i,r,n,s,a,l,u="error"===t;if(a=this._events)u=u&&null==a.error;else if(!u)return !1;if(l=this.domain,u){if(e=arguments[1],!l){if(e instanceof Error)throw e;var h=new Error('Uncaught, unspecified "error" event. ('+e+")");throw h.context=e,h}return e||(e=new Error('Uncaught, unspecified "error" event')),e.domainEmitter=this,e.domain=l,e.domainThrown=!1,l.emit("error",e),!1}if(!(i=a[t]))return !1;var d="function"==typeof i;switch(r=arguments.length){case 1:!function(t,e,i){if(e)t.call(i);else for(var r=t.length,n=o$4(t,r),s=0;s<r;++s)n[s].call(i);}(i,d,this);break;case 2:!function(t,e,i,r){if(e)t.call(i,r);else for(var n=t.length,s=o$4(t,n),a=0;a<n;++a)s[a].call(i,r);}(i,d,this,arguments[1]);break;case 3:!function(t,e,i,r,n){if(e)t.call(i,r,n);else for(var s=t.length,a=o$4(t,s),l=0;l<s;++l)a[l].call(i,r,n);}(i,d,this,arguments[1],arguments[2]);break;case 4:!function(t,e,i,r,n,s){if(e)t.call(i,r,n,s);else for(var a=t.length,l=o$4(t,a),u=0;u<a;++u)l[u].call(i,r,n,s);}(i,d,this,arguments[1],arguments[2],arguments[3]);break;default:for(n=new Array(r-1),s=1;s<r;s++)n[s-1]=arguments[s];!function(t,e,i,r){if(e)t.apply(i,r);else for(var n=t.length,s=o$4(t,n),a=0;a<n;++a)s[a].apply(i,r);}(i,d,this,n);}return !0},s$5.prototype.addListener=function(t,e){return l$1(this,t,e,!1)},s$5.prototype.on=s$5.prototype.addListener,s$5.prototype.prependListener=function(t,e){return l$1(this,t,e,!0)},s$5.prototype.once=function(t,e){if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');return this.on(t,u$6(this,t,e)),this},s$5.prototype.prependOnceListener=function(t,e){if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');return this.prependListener(t,u$6(this,t,e)),this},s$5.prototype.removeListener=function(t,e){var i,r,s,a,l;if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');if(!(r=this._events))return this;if(!(i=r[t]))return this;if(i===e||i.listener&&i.listener===e)0==--this._eventsCount?this._events=new n$6:(delete r[t],r.removeListener&&this.emit("removeListener",t,i.listener||e));else if("function"!=typeof i){for(s=-1,a=i.length;a-- >0;)if(i[a]===e||i[a].listener&&i[a].listener===e){l=i[a].listener,s=a;break}if(s<0)return this;if(1===i.length){if(i[0]=void 0,0==--this._eventsCount)return this._events=new n$6,this;delete r[t];}else !function(t,e){for(var i=e,r=i+1,n=t.length;r<n;i+=1,r+=1)t[i]=t[r];t.pop();}(i,s);r.removeListener&&this.emit("removeListener",t,l||e);}return this},s$5.prototype.off=function(t,e){return this.removeListener(t,e)},s$5.prototype.removeAllListeners=function(t){var e,i;if(!(i=this._events))return this;if(!i.removeListener)return 0===arguments.length?(this._events=new n$6,this._eventsCount=0):i[t]&&(0==--this._eventsCount?this._events=new n$6:delete i[t]),this;if(0===arguments.length){for(var r,s=Object.keys(i),a=0;a<s.length;++a)"removeListener"!==(r=s[a])&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=new n$6,this._eventsCount=0,this}if("function"==typeof(e=i[t]))this.removeListener(t,e);else if(e)do{this.removeListener(t,e[e.length-1]);}while(e[0]);return this},s$5.prototype.listeners=function(t){var e,i=this._events;return i&&(e=i[t])?"function"==typeof e?[e.listener||e]:function(t){for(var e=new Array(t.length),i=0;i<e.length;++i)e[i]=t[i].listener||t[i];return e}(e):[]},s$5.listenerCount=function(t,e){return "function"==typeof t.listenerCount?t.listenerCount(e):h$3.call(t,e)},s$5.prototype.listenerCount=h$3,s$5.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};var d$4=r$6(Object.freeze({__proto__:null,default:s$5,EventEmitter:s$5}));const{EventEmitter:p$5}=d$4,f$5=new Error("Stream was destroyed"),_$4=new Error("Premature close"),c$4=e$t,S$5=i$r,m$4=s$x,x$4=536870911,b$4=1^x$4,w$6=64,y$3=128,v$5=256,g$5=1024,k$4=2048,T$5=4096,L$5=8192,E$5=16384,N$5=32768,P$5=131072,W$5=131328,C$5=536805375,M$7=768^x$4,A$5=536838143,q$5=536739839,U$5=1<<18,O$5=2<<18,F$5=4<<18,R$5=8<<18,j$5=16<<18,D$5=32<<18,B$5=64<<18,I$5=128<<18,z$5=256<<18,K$5=512<<18,G$5=1024<<18,H$5=469499903,J$5=535822335,Q$5=503316479,V$5=268435455,X$5=262160,Y$5=536608751,Z$5=8404992,$$5=14,tt$2=15,et$2=8405006,it$2=33587200,rt$2=33587215,nt$2=2359296,st$2=270794767,at$2=Symbol.asyncIterator||Symbol("asyncIterator");let lt$2 = class lt{constructor(t,{highWaterMark:e=16384,map:i=null,mapWritable:r,byteLength:n,byteLengthWritable:s}={}){this.stream=t,this.queue=new S$5,this.highWaterMark=e,this.buffered=0,this.error=null,this.pipeline=null,this.drains=null,this.byteLength=s||n||Ct$2,this.map=r||i,this.afterWrite=_t$2.bind(this),this.afterUpdateNextTick=mt$2.bind(this);}get ended(){return 0!=(this.stream._duplexState&D$5)}push(t){return null!==this.map&&(t=this.map(t)),this.buffered+=this.byteLength(t),this.queue.push(t),this.buffered<this.highWaterMark?(this.stream._duplexState|=R$5,!0):(this.stream._duplexState|=6291456,!1)}shift(){const t=this.queue.shift();return this.buffered-=this.byteLength(t),0===this.buffered&&(this.stream._duplexState&=534773759),t}end(t){"function"==typeof t?this.stream.once("finish",t):null!=t&&this.push(t),this.stream._duplexState=(this.stream._duplexState|K$5)&J$5;}autoBatch(t,e){const i=[],r=this.stream;for(i.push(t);(r._duplexState&st$2)===nt$2;)i.push(r._writableState.shift());if(0!=(r._duplexState&tt$2))return e(null);r._writev(i,e);}update(){const t=this.stream;t._duplexState|=O$5;do{for(;(t._duplexState&st$2)===R$5;){const e=this.shift();t._duplexState|=67371008,t._write(e,this.afterWrite);}0==(1310720&t._duplexState)&&this.updateNonPrimary();}while(!0===this.continueUpdate());t._duplexState&=536346623;}updateNonPrimary(){const t=this.stream;if((144965647&t._duplexState)===K$5)return t._duplexState=402653183&(t._duplexState|U$5),void t._final(pt$2.bind(this));4!=(t._duplexState&$$5)?1==(t._duplexState&rt$2)&&(t._duplexState=(t._duplexState|X$5)&b$4,t._open(xt$2.bind(this))):0==(t._duplexState&it$2)&&(t._duplexState|=X$5,t._destroy(ft$2.bind(this)));}continueUpdate(){return 0!=(this.stream._duplexState&I$5)&&(this.stream._duplexState&=Q$5,!0)}updateCallback(){(35127311&this.stream._duplexState)===F$5?this.update():this.updateNextTick();}updateNextTick(){0==(this.stream._duplexState&I$5)&&(this.stream._duplexState|=I$5,0==(this.stream._duplexState&O$5)&&c$4(this.afterUpdateNextTick));}};let ut$2 = class ut{constructor(t,{highWaterMark:e=16384,map:i=null,mapReadable:r,byteLength:n,byteLengthReadable:s}={}){this.stream=t,this.queue=new S$5,this.highWaterMark=0===e?1:e,this.buffered=0,this.readAhead=e>0,this.error=null,this.pipeline=null,this.byteLength=s||n||Ct$2,this.map=r||i,this.pipeTo=null,this.afterRead=ct$2.bind(this),this.afterUpdateNextTick=St$2.bind(this);}get ended(){return 0!=(this.stream._duplexState&E$5)}pipe(t,e){if(null!==this.pipeTo)throw new Error("Can only pipe to one destination");if("function"!=typeof e&&(e=null),this.stream._duplexState|=512,this.pipeTo=t,this.pipeline=new ot$2(this.stream,t,e),e&&this.stream.on("error",Mt$2),Wt$2(t))t._writableState.pipeline=this.pipeline,e&&t.on("error",Mt$2),t.on("finish",this.pipeline.finished.bind(this.pipeline));else {const e=this.pipeline.done.bind(this.pipeline,t),i=this.pipeline.done.bind(this.pipeline,t,null);t.on("error",e),t.on("close",i),t.on("finish",this.pipeline.finished.bind(this.pipeline));}t.on("drain",dt$2.bind(this)),this.stream.emit("piping",t),t.emit("pipe",this.stream);}push(t){const e=this.stream;return null===t?(this.highWaterMark=0,e._duplexState=536805311&(e._duplexState|g$5),!1):null!==this.map&&null===(t=this.map(t))?(e._duplexState&=C$5,this.buffered<this.highWaterMark):(this.buffered+=this.byteLength(t),this.queue.push(t),e._duplexState=(e._duplexState|y$3)&C$5,this.buffered<this.highWaterMark)}shift(){const t=this.queue.shift();return this.buffered-=this.byteLength(t),0===this.buffered&&(this.stream._duplexState&=536862591),t}unshift(t){const e=[null!==this.map?this.map(t):t];for(;this.buffered>0;)e.push(this.shift());for(let t=0;t<e.length-1;t++){const i=e[t];this.buffered+=this.byteLength(i),this.queue.push(i);}this.push(e[e.length-1]);}read(){const t=this.stream;if((16527&t._duplexState)===y$3){const e=this.shift();return null!==this.pipeTo&&!1===this.pipeTo.write(e)&&(t._duplexState&=M$7),0!=(t._duplexState&k$4)&&t.emit("data",e),e}return !1===this.readAhead&&(t._duplexState|=P$5,this.updateNextTick()),null}drain(){const t=this.stream;for(;(16527&t._duplexState)===y$3&&0!=(768&t._duplexState);){const e=this.shift();null!==this.pipeTo&&!1===this.pipeTo.write(e)&&(t._duplexState&=M$7),0!=(t._duplexState&k$4)&&t.emit("data",e);}}update(){const t=this.stream;t._duplexState|=32;do{for(this.drain();this.buffered<this.highWaterMark&&(214047&t._duplexState)===P$5;)t._duplexState|=65552,t._read(this.afterRead),this.drain();4224==(12431&t._duplexState)&&(t._duplexState|=L$5,t.emit("readable")),0==(80&t._duplexState)&&this.updateNonPrimary();}while(!0===this.continueUpdate());t._duplexState&=536870879;}updateNonPrimary(){const t=this.stream;(1167&t._duplexState)===g$5&&(t._duplexState=536869887&(t._duplexState|E$5),t.emit("end"),(t._duplexState&et$2)===Z$5&&(t._duplexState|=4),null!==this.pipeTo&&this.pipeTo.end()),4!=(t._duplexState&$$5)?1==(t._duplexState&rt$2)&&(t._duplexState=(t._duplexState|X$5)&b$4,t._open(xt$2.bind(this))):0==(t._duplexState&it$2)&&(t._duplexState|=X$5,t._destroy(ft$2.bind(this)));}continueUpdate(){return 0!=(this.stream._duplexState&N$5)&&(this.stream._duplexState&=A$5,!0)}updateCallback(){(32879&this.stream._duplexState)===w$6?this.update():this.updateNextTick();}updateNextTick(){0==(this.stream._duplexState&N$5)&&(this.stream._duplexState|=N$5,0==(32&this.stream._duplexState)&&c$4(this.afterUpdateNextTick));}};let ht$2 = class ht{constructor(t){this.data=null,this.afterTransform=bt$2.bind(t),this.afterFinal=null;}};let ot$2 = class ot{constructor(t,e,i){this.from=t,this.to=e,this.afterPipe=i,this.error=null,this.pipeToFinished=!1;}finished(){this.pipeToFinished=!0;}done(t,e){e&&(this.error=e),t!==this.to||(this.to=null,null===this.from)?t!==this.from||(this.from=null,null===this.to)?(null!==this.afterPipe&&this.afterPipe(this.error),this.to=this.from=this.afterPipe=null):0==(t._duplexState&E$5)&&this.to.destroy(this.error||new Error("Readable stream closed before ending")):0!=(this.from._duplexState&E$5)&&this.pipeToFinished||this.from.destroy(this.error||new Error("Writable stream closed prematurely"));}};function dt$2(){this.stream._duplexState|=512,this.updateCallback();}function pt$2(t){const e=this.stream;t&&e.destroy(t),0==(e._duplexState&$$5)&&(e._duplexState|=D$5,e.emit("finish")),(e._duplexState&et$2)===Z$5&&(e._duplexState|=4),e._duplexState&=H$5,0==(e._duplexState&O$5)?this.update():this.updateNextTick();}function ft$2(t){const e=this.stream;t||this.error===f$5||(t=this.error),t&&e.emit("error",t),e._duplexState|=8,e.emit("close");const i=e._readableState,r=e._writableState;if(null!==i&&null!==i.pipeline&&i.pipeline.done(e,t),null!==r){for(;null!==r.drains&&r.drains.length>0;)r.drains.shift().resolve(!1);null!==r.pipeline&&r.pipeline.done(e,t);}}function _t$2(t){const e=this.stream;t&&e.destroy(t),e._duplexState&=H$5,null!==this.drains&&function(t){for(let e=0;e<t.length;e++)0==--t[e].writes&&(t.shift().resolve(!0),e--);}(this.drains),(6553615&e._duplexState)===j$5&&(e._duplexState&=532676607,(e._duplexState&B$5)===B$5&&e.emit("drain")),this.updateCallback();}function ct$2(t){t&&this.stream.destroy(t),this.stream._duplexState&=536870895,!1===this.readAhead&&0==(this.stream._duplexState&v$5)&&(this.stream._duplexState&=q$5),this.updateCallback();}function St$2(){0==(32&this.stream._duplexState)&&(this.stream._duplexState&=A$5,this.update());}function mt$2(){0==(this.stream._duplexState&O$5)&&(this.stream._duplexState&=Q$5,this.update());}function xt$2(t){const e=this.stream;t&&e.destroy(t),0==(4&e._duplexState)&&(0==(17423&e._duplexState)&&(e._duplexState|=w$6),0==(142606351&e._duplexState)&&(e._duplexState|=F$5),e.emit("open")),e._duplexState&=Y$5,null!==e._writableState&&e._writableState.updateCallback(),null!==e._readableState&&e._readableState.updateCallback();}function bt$2(t,e){null!=e&&this.push(e),this._writableState.afterWrite(t);}function wt$2(t){null!==this._readableState&&("data"===t&&(this._duplexState|=133376,this._readableState.updateNextTick()),"readable"===t&&(this._duplexState|=T$5,this._readableState.updateNextTick())),null!==this._writableState&&"drain"===t&&(this._duplexState|=B$5,this._writableState.updateNextTick());}let yt$2 = class yt extends p$5{constructor(t){super(),this._duplexState=0,this._readableState=null,this._writableState=null,t&&(t.open&&(this._open=t.open),t.destroy&&(this._destroy=t.destroy),t.predestroy&&(this._predestroy=t.predestroy),t.signal&&t.signal.addEventListener("abort",At$2.bind(this))),this.on("newListener",wt$2);}_open(t){t(null);}_destroy(t){t(null);}_predestroy(){}get readable(){return null!==this._readableState||void 0}get writable(){return null!==this._writableState||void 0}get destroyed(){return 0!=(8&this._duplexState)}get destroying(){return 0!=(this._duplexState&$$5)}destroy(t){0==(this._duplexState&$$5)&&(t||(t=f$5),this._duplexState=535822271&(4|this._duplexState),null!==this._readableState&&(this._readableState.highWaterMark=0,this._readableState.error=t),null!==this._writableState&&(this._writableState.highWaterMark=0,this._writableState.error=t),this._duplexState|=2,this._predestroy(),this._duplexState&=536870909,null!==this._readableState&&this._readableState.updateNextTick(),null!==this._writableState&&this._writableState.updateNextTick());}};let vt$2 = class vt extends yt$2{constructor(t){super(t),this._duplexState|=8519681,this._readableState=new ut$2(this,t),t&&(!1===this._readableState.readAhead&&(this._duplexState&=q$5),t.read&&(this._read=t.read),t.eagerOpen&&this._readableState.updateNextTick(),t.encoding&&this.setEncoding(t.encoding));}setEncoding(t){const e=new m$4(t),i=this._readableState.map||Nt$2;return this._readableState.map=function(t){const r=e.push(t);return ""===r&&(0!==t.byteLength||e.remaining>0)?null:i(r)},this}_read(t){t(null);}pipe(t,e){return this._readableState.updateNextTick(),this._readableState.pipe(t,e),t}read(){return this._readableState.updateNextTick(),this._readableState.read()}push(t){return this._readableState.updateNextTick(),this._readableState.push(t)}unshift(t){return this._readableState.updateNextTick(),this._readableState.unshift(t)}resume(){return this._duplexState|=W$5,this._readableState.updateNextTick(),this}pause(){return this._duplexState&=!1===this._readableState.readAhead?536739583:536870655,this}static _fromAsyncIterator(t,e){let i;const r=new vt({...e,read(e){t.next().then(n).then(e.bind(null,null)).catch(e);},predestroy(){i=t.return();},destroy(t){if(!i)return t(null);i.then(t.bind(null,null)).catch(t);}});return r;function n(t){t.done?r.push(null):r.push(t.value);}}static from(t,e){if(Wt$2(i=t)&&i.readable)return t;var i;if(t[at$2])return this._fromAsyncIterator(t[at$2](),e);Array.isArray(t)||(t=void 0===t?[]:[t]);let r=0;return new vt({...e,read(e){this.push(r===t.length?null:t[r++]),e(null);}})}static isBackpressured(t){return 0!=(17422&t._duplexState)||t._readableState.buffered>=t._readableState.highWaterMark}static isPaused(t){return 0==(t._duplexState&v$5)}[at$2](){const t=this;let e=null,i=null,r=null;return this.on("error",(t=>{e=t;})),this.on("readable",(function(){null!==i&&n(t.read());})),this.on("close",(function(){null!==i&&n(null);})),{[at$2](){return this},next:()=>new Promise((function(e,s){i=e,r=s;const a=t.read();null!==a?n(a):0!=(8&t._duplexState)&&n(null);})),return:()=>s(null),throw:t=>s(t)};function n(n){null!==r&&(e?r(e):null===n&&0==(t._duplexState&E$5)?r(f$5):i({value:n,done:null===n}),r=i=null);}function s(e){return t.destroy(e),new Promise(((i,r)=>{if(8&t._duplexState)return i({value:void 0,done:!0});t.once("close",(function(){e?r(e):i({value:void 0,done:!0});}));}))}}};let gt$2 = class gt extends yt$2{constructor(t){super(t),this._duplexState|=16385,this._writableState=new lt$2(this,t),t&&(t.writev&&(this._writev=t.writev),t.write&&(this._write=t.write),t.final&&(this._final=t.final),t.eagerOpen&&this._writableState.updateNextTick());}cork(){this._duplexState|=G$5;}uncork(){this._duplexState&=V$5,this._writableState.updateNextTick();}_writev(t,e){e(null);}_write(t,e){this._writableState.autoBatch(t,e);}_final(t){t(null);}static isBackpressured(t){return 0!=(146800654&t._duplexState)}static drained(t){if(t.destroyed)return Promise.resolve(!1);const e=t._writableState;var i;const r=((i=t)._writev!==gt.prototype._writev&&i._writev!==kt$2.prototype._writev?Math.min(1,e.queue.length):e.queue.length)+(t._duplexState&z$5?1:0);return 0===r?Promise.resolve(!0):(null===e.drains&&(e.drains=[]),new Promise((t=>{e.drains.push({writes:r,resolve:t});})))}write(t){return this._writableState.updateNextTick(),this._writableState.push(t)}end(t){return this._writableState.updateNextTick(),this._writableState.end(t),this}};let kt$2 = class kt extends vt$2{constructor(t){super(t),this._duplexState=1|this._duplexState&P$5,this._writableState=new lt$2(this,t),t&&(t.writev&&(this._writev=t.writev),t.write&&(this._write=t.write),t.final&&(this._final=t.final));}cork(){this._duplexState|=G$5;}uncork(){this._duplexState&=V$5,this._writableState.updateNextTick();}_writev(t,e){e(null);}_write(t,e){this._writableState.autoBatch(t,e);}_final(t){t(null);}write(t){return this._writableState.updateNextTick(),this._writableState.push(t)}end(t){return this._writableState.updateNextTick(),this._writableState.end(t),this}};let Tt$2 = class Tt extends kt$2{constructor(t){super(t),this._transformState=new ht$2(this),t&&(t.transform&&(this._transform=t.transform),t.flush&&(this._flush=t.flush));}_write(t,e){this._readableState.buffered>=this._readableState.highWaterMark?this._transformState.data=t:this._transform(t,this._transformState.afterTransform);}_read(t){if(null!==this._transformState.data){const e=this._transformState.data;this._transformState.data=null,t(null),this._transform(e,this._transformState.afterTransform);}else t(null);}destroy(t){super.destroy(t),null!==this._transformState.data&&(this._transformState.data=null,this._transformState.afterTransform());}_transform(t,e){e(null,t);}_flush(t){t(null);}_final(t){this._transformState.afterFinal=t,this._flush(Lt$2.bind(this));}};function Lt$2(t,e){const i=this._transformState.afterFinal;if(t)return i(t);null!=e&&this.push(e),this.push(null),i(null);}function Et$2(t,...e){const i=Array.isArray(t)?[...t,...e]:[t,...e],r=i.length&&"function"==typeof i[i.length-1]?i.pop():null;if(i.length<2)throw new Error("Pipeline requires at least 2 streams");let n=i[0],s=null,a=null;for(let t=1;t<i.length;t++)s=i[t],Wt$2(n)?n.pipe(s,u):(l(n,!0,t>1,u),n.pipe(s)),n=s;if(r){let t=!1;const e=Wt$2(s)||!(!s._writableState||!s._writableState.autoDestroy);s.on("error",(t=>{null===a&&(a=t);})),s.on("finish",(()=>{t=!0,e||r(a);})),e&&s.on("close",(()=>r(a||(t?null:_$4))));}return s;function l(t,e,i,r){t.on("error",r),t.on("close",(function(){if(t._readableState&&!t._readableState.ended)return r(_$4);if(i&&t._writableState&&!t._writableState.ended)return r(_$4)}));}function u(t){if(t&&!a){a=t;for(const e of i)e.destroy(t);}}}function Nt$2(t){return t}function Pt$2(t){return !!t._readableState||!!t._writableState}function Wt$2(t){return "number"==typeof t._duplexState&&Pt$2(t)}function Ct$2(t){return function(t){return "object"==typeof t&&null!==t&&"number"==typeof t.byteLength}(t)?t.byteLength:1024}function Mt$2(){}function At$2(){this.destroy(new Error("Stream aborted."));}var qt$2={pipeline:Et$2,pipelinePromise:function(...t){return new Promise(((e,i)=>Et$2(...t,(t=>{if(t)return i(t);e();}))))},isStream:Pt$2,isStreamx:Wt$2,isEnded:function(t){return !!t._readableState&&t._readableState.ended},isFinished:function(t){return !!t._writableState&&t._writableState.ended},getStreamError:function(t,e={}){const i=t._readableState&&t._readableState.error||t._writableState&&t._writableState.error;return e.all||i!==f$5?i:null},Stream:yt$2,Writable:gt$2,Readable:vt$2,Duplex:kt$2,Transform:Tt$2,PassThrough:class extends Tt$2{}};

/**
 * Bundled by jsDelivr using Rollup v2.79.1 and Terser v5.19.2.
 * Original file: /npm/hypercore@10.37.23/index.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
function v$4(e){return e&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function L$4(){}function P$4(){P$4.init.call(this);}function R$4(e){return void 0===e._maxListeners?P$4.defaultMaxListeners:e._maxListeners}function S$4(e,t,s,i){var n,r,o,h;if("function"!=typeof s)throw new TypeError('"listener" argument must be a function');if((r=e._events)?(r.newListener&&(e.emit("newListener",t,s.listener?s.listener:s),r=e._events),o=r[t]):(r=e._events=new L$4,e._eventsCount=0),o){if("function"==typeof o?o=r[t]=i?[s,o]:[o,s]:i?o.unshift(s):o.push(s),!o.warned&&(n=R$4(e))&&n>0&&o.length>n){o.warned=!0;var a=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+t+" listeners added. Use emitter.setMaxListeners() to increase limit");a.name="MaxListenersExceededWarning",a.emitter=e,a.type=t,a.count=o.length,h=a,"function"==typeof console.warn?console.warn(h):console.log(h);}}else o=r[t]=s,++e._eventsCount;return e}function q$4(e,t,s){var i=!1;function n(){e.removeListener(t,n),i||(i=!0,s.apply(e,arguments));}return n.listener=s,n}function B$4(e){var t=this._events;if(t){var s=t[e];if("function"==typeof s)return 1;if(s)return s.length}return 0}function U$4(e,t){for(var s=new Array(t);t--;)s[t]=e[t];return s}L$4.prototype=Object.create(null),P$4.EventEmitter=P$4,P$4.usingDomains=!1,P$4.prototype.domain=void 0,P$4.prototype._events=void 0,P$4.prototype._maxListeners=void 0,P$4.defaultMaxListeners=10,P$4.init=function(){this.domain=null,P$4.usingDomains&&undefined.active,this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=new L$4,this._eventsCount=0),this._maxListeners=this._maxListeners||void 0;},P$4.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=e,this},P$4.prototype.getMaxListeners=function(){return R$4(this)},P$4.prototype.emit=function(e){var t,s,i,n,r,o,h,a="error"===e;if(o=this._events)a=a&&null==o.error;else if(!a)return !1;if(h=this.domain,a){if(t=arguments[1],!h){if(t instanceof Error)throw t;var l=new Error('Uncaught, unspecified "error" event. ('+t+")");throw l.context=t,l}return t||(t=new Error('Uncaught, unspecified "error" event')),t.domainEmitter=this,t.domain=h,t.domainThrown=!1,h.emit("error",t),!1}if(!(s=o[e]))return !1;var c="function"==typeof s;switch(i=arguments.length){case 1:!function(e,t,s){if(t)e.call(s);else for(var i=e.length,n=U$4(e,i),r=0;r<i;++r)n[r].call(s);}(s,c,this);break;case 2:!function(e,t,s,i){if(t)e.call(s,i);else for(var n=e.length,r=U$4(e,n),o=0;o<n;++o)r[o].call(s,i);}(s,c,this,arguments[1]);break;case 3:!function(e,t,s,i,n){if(t)e.call(s,i,n);else for(var r=e.length,o=U$4(e,r),h=0;h<r;++h)o[h].call(s,i,n);}(s,c,this,arguments[1],arguments[2]);break;case 4:!function(e,t,s,i,n,r){if(t)e.call(s,i,n,r);else for(var o=e.length,h=U$4(e,o),a=0;a<o;++a)h[a].call(s,i,n,r);}(s,c,this,arguments[1],arguments[2],arguments[3]);break;default:for(n=new Array(i-1),r=1;r<i;r++)n[r-1]=arguments[r];!function(e,t,s,i){if(t)e.apply(s,i);else for(var n=e.length,r=U$4(e,n),o=0;o<n;++o)r[o].apply(s,i);}(s,c,this,n);}return !0},P$4.prototype.addListener=function(e,t){return S$4(this,e,t,!1)},P$4.prototype.on=P$4.prototype.addListener,P$4.prototype.prependListener=function(e,t){return S$4(this,e,t,!0)},P$4.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.on(e,q$4(this,e,t)),this},P$4.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.prependListener(e,q$4(this,e,t)),this},P$4.prototype.removeListener=function(e,t){var s,i,n,r,o;if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');if(!(i=this._events))return this;if(!(s=i[e]))return this;if(s===t||s.listener&&s.listener===t)0==--this._eventsCount?this._events=new L$4:(delete i[e],i.removeListener&&this.emit("removeListener",e,s.listener||t));else if("function"!=typeof s){for(n=-1,r=s.length;r-- >0;)if(s[r]===t||s[r].listener&&s[r].listener===t){o=s[r].listener,n=r;break}if(n<0)return this;if(1===s.length){if(s[0]=void 0,0==--this._eventsCount)return this._events=new L$4,this;delete i[e];}else !function(e,t){for(var s=t,i=s+1,n=e.length;i<n;s+=1,i+=1)e[s]=e[i];e.pop();}(s,n);i.removeListener&&this.emit("removeListener",e,o||t);}return this},P$4.prototype.off=function(e,t){return this.removeListener(e,t)},P$4.prototype.removeAllListeners=function(e){var t,s;if(!(s=this._events))return this;if(!s.removeListener)return 0===arguments.length?(this._events=new L$4,this._eventsCount=0):s[e]&&(0==--this._eventsCount?this._events=new L$4:delete s[e]),this;if(0===arguments.length){for(var i,n=Object.keys(s),r=0;r<n.length;++r)"removeListener"!==(i=n[r])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=new L$4,this._eventsCount=0,this}if("function"==typeof(t=s[e]))this.removeListener(e,t);else if(t)do{this.removeListener(e,t[t.length-1]);}while(t[0]);return this},P$4.prototype.listeners=function(e){var t,s=this._events;return s&&(t=s[e])?"function"==typeof t?[t.listener||t]:function(e){for(var t=new Array(e.length),s=0;s<t.length;++s)t[s]=e[s].listener||e[s];return t}(t):[]},P$4.listenerCount=function(e,t){return "function"==typeof e.listenerCount?e.listenerCount(t):B$4.call(e,t)},P$4.prototype.listenerCount=B$4,P$4.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};var E$4=v$4(Object.freeze({__proto__:null,default:P$4,EventEmitter:P$4}));const A$4=i$r;var M$6={};let D$4=e$6;"function"==typeof D$4.findFirst&&"function"==typeof D$4.findLast&&"function"==typeof D$4.clear||(D$4=e$5),M$6.quickbit=D$4;const C$4=i$5,O$4=M$6.quickbit,N$4=32768,I$4=1024,F$4=2097152,T$4=262144,K$4=64;let z$4 = class z{constructor(e,t,s){this.index=e,this.offset=4096*e-s.offset,this.bitfield=t,this.segment=s,s.add(this);}get tree(){return this.segment.tree}get(e){return O$4.get(this.bitfield,e)}set(e,t){O$4.set(this.bitfield,e,t)&&this.tree.update(8*this.offset+e);}setRange(e,t,s){O$4.fill(this.bitfield,s,e,e+t);let i=Math.floor(e/128);const n=i+Math.ceil(t/128);for(;i<=n;)this.tree.update(8*this.offset+128*i++);}findFirst(e,t){return O$4.findFirst(this.bitfield,e,t)}findLast(e,t){return O$4.findLast(this.bitfield,e,t)}insert(e,t){this.bitfield.set(t,e/32),this.segment.refresh();}clear(e,t){O$4.clear(this.bitfield,{field:t,offset:e});}};let H$4 = class H{constructor(e){this.index=e,this.offset=e*T$4,this.tree=O$4.Index.from([],T$4),this.pages=new Array(K$4),this.pagesLength=0;}get chunks(){return this.tree.chunks}refresh(){this.tree=O$4.Index.from(this.tree.chunks,T$4);}add(e){const t=e.index-this.index*K$4;t>=this.pagesLength&&(this.pagesLength=t+1),this.pages[t]=e;const s={field:e.bitfield,offset:e.offset};this.chunks.push(s);for(let e=this.chunks.length-2;e>=0;e--){const t=this.chunks[e];if(t.offset<=s.offset)break;this.chunks[e]=s,this.chunks[e+1]=t;}}findFirst(e,t){let s=32767&(t=this.tree.skipFirst(!e,t)),i=(t-s)/N$4;if(i>=K$4)return -1;for(;i<this.pagesLength;){const t=this.pages[i];let n=-1;if(t?n=t.findFirst(e,s):e||(n=s),-1!==n)return i*N$4+n;s=0,i++;}return e||this.pagesLength===K$4?-1:this.pagesLength*N$4}findLast(e,t){let s=32767&(t=this.tree.skipLast(!e,t)),i=(t-s)/N$4;if(i>=K$4)return -1;for(;i>=0;){const t=this.pages[i];let n=-1;if(t?n=t.findLast(e,s):e||(n=s),-1!==n)return i*N$4+n;s=32767,i--;}return -1}};var W$4=class W{static BITS_PER_PAGE=N$4;constructor(){this._pages=new C$4,this._segments=new C$4,this._maxSegments=0;}getBitfield(e){const t=(e-(32767&e))/N$4;return this._pages.get(t)||null}get(e){const t=32767&e,s=(e-t)/N$4,i=this._pages.get(s);return !!i&&i.get(t)}set(e,t){const s=32767&e,i=(e-s)/N$4;let n=this._pages.get(i);if(!n&&t){const e=Math.floor(i/K$4),t=this._segments.get(e)||this._segments.set(e,new H$4(e));this._maxSegments<=e&&(this._maxSegments=e+1),n=this._pages.set(i,new z$4(i,new Uint32Array(I$4),t));}n&&n.set(s,t);}setRange(e,t,s){let i=32767&e,n=(e-i)/N$4;for(;t>0;){let e=this._pages.get(n);if(!e&&s){const t=Math.floor(n/K$4),s=this._segments.get(t)||this._segments.set(t,new H$4(t));this._maxSegments<=t&&(this._maxSegments=t+1),e=this._pages.set(n,new z$4(n,new Uint32Array(I$4),s));}const r=Math.min(i+t,N$4)-i;e&&e.setRange(i,r,s),i=0,n++,t-=r;}}findFirst(e,t){let s=2097151&t,i=(t-s)/F$4;for(;i<this._maxSegments;){const t=this._segments.get(i);let n=-1;if(t?n=t.findFirst(e,s):e||(n=s),-1!==n)return i*F$4+n;s=0,i++;}return e?-1:Math.max(t,this._maxSegments*F$4)}firstSet(e){return this.findFirst(!0,e)}firstUnset(e){return this.findFirst(!1,e)}findLast(e,t){let s=2097151&t,i=(t-s)/F$4;for(;i>=0;){const t=this._segments.get(i);let n=-1;if(t?n=t.findLast(e,s):e||(n=s),-1!==n)return i*F$4+n;s=2097151,i--;}return -1}lastSet(e){return this.findLast(!0,e)}lastUnset(e){return this.findLast(!1,e)}insert(e,t){if(e%32!=0)return !1;let s=8*t.byteLength,i=32767&e,n=(e-i)/N$4;for(;s>0;){let e=this._pages.get(n);if(!e){const t=Math.floor(n/K$4),s=this._segments.get(t)||this._segments.set(t,new H$4(t));this._maxSegments<=t&&(this._maxSegments=t+1),e=this._pages.set(n,new z$4(n,new Uint32Array(I$4),s));}const r=Math.min(i+s,N$4)-i;e.insert(i,t.subarray(0,r/32)),t=t.subarray(r/32),i=0,n++,s-=r;}return !0}clear(e,t){if(e%32!=0)return !1;let s=8*t.byteLength,i=32767&e,n=(e-i)/N$4;for(;s>0;){let e=this._pages.get(n);if(!e){const t=Math.floor(n/K$4),s=this._segments.get(t)||this._segments.set(t,new H$4(t));this._maxSegments<=t&&(this._maxSegments=t+1),e=this._pages.set(n,new z$4(n,new Uint32Array(I$4),s));}const r=Math.min(i+s,N$4)-i;e.clear(i,t.subarray(0,r/32)),t=t.subarray(r/32),i=0,n++,s-=r;}return !0}},V$4={},G$4={};const Q$4=o$e,j$4=m$a,Y$4=L$c,X$4=t$g,[Z$4,J$4,$$4,ee$4,te$4,se$4]=Q$4.namespace("hypercore",6);G$4.MANIFEST=ee$4,G$4.DEFAULT_NAMESPACE=te$4,G$4.BLOCK_ENCRYPTION=se$4,G$4.replicate=function(e,t,s){const i=Y$4.allocUnsafe(32);return j$4.crypto_generichash_batch(i,[e?J$4:$$4,t],s),i},G$4.treeSignable=function(e,t,s,i){const n={start:0,end:112,buffer:Y$4.allocUnsafe(112)};return X$4.fixed32.encode(n,Z$4),X$4.fixed32.encode(n,e),X$4.fixed32.encode(n,t),X$4.uint64.encode(n,s),X$4.uint64.encode(n,i),n.buffer},G$4.treeSignableCompat=function(e,t,s,i){const n=i?48:80,r={start:0,end:n,buffer:Y$4.allocUnsafe(n)};return i||X$4.fixed32.encode(r,Z$4),X$4.fixed32.encode(r,e),X$4.uint64.encode(r,t),X$4.uint64.encode(r,s),r.buffer};const ie$4=t$g,ne$4=L$c,{DEFAULT_NAMESPACE:re$4}=G$4,{INVALID_OPLOG_VERSION:oe$4}=E$6,he$4=n$a,ae$4=ne$4.alloc(0),le$4={preencode(e,t){e.end++;},encode(e,t){if("blake2b"!==t)throw new Error("Unknown hash: "+t);ie$4.uint.encode(e,0);},decode(e){const t=ie$4.uint.decode(e);if(0===t)return "blake2b";throw new Error("Unknown hash id: "+t)}},ce$4={preencode(e,t){e.end++;},encode(e,t){if("ed25519"!==t)throw new Error("Unknown signature: "+t);ie$4.uint.encode(e,0);},decode(e){const t=ie$4.uint.decode(e);if(0===t)return "ed25519";throw new Error("Unknown signature id: "+t)}},ue$4={preencode(e,t){ce$4.preencode(e,t.signature),ie$4.fixed32.preencode(e,t.namespace),ie$4.fixed32.preencode(e,t.publicKey);},encode(e,t){ce$4.encode(e,t.signature),ie$4.fixed32.encode(e,t.namespace),ie$4.fixed32.encode(e,t.publicKey);},decode:e=>({signature:ce$4.decode(e),namespace:ie$4.fixed32.decode(e),publicKey:ie$4.fixed32.decode(e)})},de$4=ie$4.array(ue$4),fe$4={preencode(e,t){ie$4.fixed32.preencode(e,t.hash),ie$4.uint.preencode(e,t.length);},encode(e,t){ie$4.fixed32.encode(e,t.hash),ie$4.uint.encode(e,t.length);},decode:e=>({hash:ie$4.fixed32.decode(e),length:ie$4.uint.decode(e)})},ge$4={preencode(e,t){le$4.preencode(e,t.hash),e.end++,t.prologue&&0===t.signers.length?ie$4.fixed32.preencode(e,t.prologue.hash):1!==t.quorum||1!==t.signers.length||t.allowPatch?(e.end++,ie$4.uint.preencode(e,t.quorum),de$4.preencode(e,t.signers)):ue$4.preencode(e,t.signers[0]);},encode(e,t){if(le$4.encode(e,t.hash),t.prologue&&0===t.signers.length)return ie$4.uint.encode(e,0),void ie$4.fixed32.encode(e,t.prologue.hash);1!==t.quorum||1!==t.signers.length||t.allowPatch?(ie$4.uint.encode(e,2),ie$4.uint.encode(e,t.allowPatch?1:0),ie$4.uint.encode(e,t.quorum),de$4.encode(e,t.signers)):(ie$4.uint.encode(e,1),ue$4.encode(e,t.signers[0]));},decode(e){const t=le$4.decode(e),s=ie$4.uint.decode(e);if(s>2)throw new Error("Unknown type: "+s);if(0===s)return {version:0,hash:t,allowPatch:!1,quorum:0,signers:[],prologue:{hash:ie$4.fixed32.decode(e),length:0}};if(1===s)return {version:0,hash:t,allowPatch:!1,quorum:1,signers:[ue$4.decode(e)],prologue:null};return {version:0,hash:t,allowPatch:0!=(1&ie$4.uint.decode(e)),quorum:ie$4.uint.decode(e),signers:de$4.decode(e),prologue:null}}},pe$4=V$4.manifest={preencode(e,t){if(e.end++,0===t.version)return ge$4.preencode(e,t);e.end++,le$4.preencode(e,t.hash),ie$4.uint.preencode(e,t.quorum),de$4.preencode(e,t.signers),t.prologue&&fe$4.preencode(e,t.prologue);},encode(e,t){if(ie$4.uint.encode(e,t.version),0===t.version)return ge$4.encode(e,t);ie$4.uint.encode(e,(t.allowPatch?1:0)|(t.prologue?2:0)),le$4.encode(e,t.hash),ie$4.uint.encode(e,t.quorum),de$4.encode(e,t.signers),t.prologue&&fe$4.encode(e,t.prologue);},decode(e){const t=ie$4.uint.decode(e);if(0===t)return ge$4.decode(e);if(1!==t)throw new Error("Unknown version: "+t);const s=ie$4.uint.decode(e);return {version:1,hash:le$4.decode(e),allowPatch:0!=(1&s),quorum:ie$4.uint.decode(e),signers:de$4.decode(e),prologue:0==(2&s)?null:fe$4.decode(e)}}},_e$3={preencode(e,t){ie$4.uint.preencode(e,t.index),ie$4.uint.preencode(e,t.size),ie$4.fixed32.preencode(e,t.hash);},encode(e,t){ie$4.uint.encode(e,t.index),ie$4.uint.encode(e,t.size),ie$4.fixed32.encode(e,t.hash);},decode:e=>({index:ie$4.uint.decode(e),size:ie$4.uint.decode(e),hash:ie$4.fixed32.decode(e)})},ye$3=ie$4.array(_e$3),me$3=V$4.wire={};me$3.handshake={preencode(e,t){ie$4.uint.preencode(e,1),ie$4.fixed32.preencode(e,t.capability);},encode(e,t){ie$4.uint.encode(e,t.seeks?1:0),ie$4.fixed32.encode(e,t.capability);},decode:e=>({seeks:0!=(1&ie$4.uint.decode(e)),capability:he$4(ie$4.fixed32.decode(e))})};const be$3={preencode(e,t){ie$4.uint.preencode(e,t.index),ie$4.uint.preencode(e,t.nodes);},encode(e,t){ie$4.uint.encode(e,t.index),ie$4.uint.encode(e,t.nodes);},decode:e=>({index:ie$4.uint.decode(e),nodes:ie$4.uint.decode(e)})},ke$3={preencode(e,t){ie$4.uint.preencode(e,t.bytes),ie$4.uint.preencode(e,t.padding);},encode(e,t){ie$4.uint.encode(e,t.bytes),ie$4.uint.encode(e,t.padding);},decode:e=>({bytes:ie$4.uint.decode(e),padding:ie$4.uint.decode(e)})},we$3={preencode(e,t){ie$4.uint.preencode(e,t.start),ie$4.uint.preencode(e,t.length);},encode(e,t){ie$4.uint.encode(e,t.start),ie$4.uint.encode(e,t.length);},decode:e=>({start:ie$4.uint.decode(e),length:ie$4.uint.decode(e)})};me$3.request={preencode(e,t){e.end++,ie$4.uint.preencode(e,t.id),ie$4.uint.preencode(e,t.fork),t.block&&be$3.preencode(e,t.block),t.hash&&be$3.preencode(e,t.hash),t.seek&&ke$3.preencode(e,t.seek),t.upgrade&&we$3.preencode(e,t.upgrade),t.priority&&ie$4.uint.preencode(e,t.priority);},encode(e,t){const s=(t.block?1:0)|(t.hash?2:0)|(t.seek?4:0)|(t.upgrade?8:0)|(t.manifest?16:0)|(t.priority?32:0);ie$4.uint.encode(e,s),ie$4.uint.encode(e,t.id),ie$4.uint.encode(e,t.fork),t.block&&be$3.encode(e,t.block),t.hash&&be$3.encode(e,t.hash),t.seek&&ke$3.encode(e,t.seek),t.upgrade&&we$3.encode(e,t.upgrade),t.priority&&ie$4.uint.encode(e,t.priority);},decode(e){const t=ie$4.uint.decode(e);return {id:ie$4.uint.decode(e),fork:ie$4.uint.decode(e),block:1&t?be$3.decode(e):null,hash:2&t?be$3.decode(e):null,seek:4&t?ke$3.decode(e):null,upgrade:8&t?we$3.decode(e):null,manifest:0!=(16&t),priority:32&t?ie$4.uint.decode(e):0}}},me$3.cancel={preencode(e,t){ie$4.uint.preencode(e,t.request);},encode(e,t){ie$4.uint.encode(e,t.request);},decode:(e,t)=>({request:ie$4.uint.decode(e)})};const xe$3={preencode(e,t){ie$4.uint.preencode(e,t.start),ie$4.uint.preencode(e,t.length),ye$3.preencode(e,t.nodes),ye$3.preencode(e,t.additionalNodes),ie$4.buffer.preencode(e,t.signature);},encode(e,t){ie$4.uint.encode(e,t.start),ie$4.uint.encode(e,t.length),ye$3.encode(e,t.nodes),ye$3.encode(e,t.additionalNodes),ie$4.buffer.encode(e,t.signature);},decode:e=>({start:ie$4.uint.decode(e),length:ie$4.uint.decode(e),nodes:ye$3.decode(e),additionalNodes:ye$3.decode(e),signature:ie$4.buffer.decode(e)})},ve$3={preencode(e,t){ie$4.uint.preencode(e,t.bytes),ye$3.preencode(e,t.nodes);},encode(e,t){ie$4.uint.encode(e,t.bytes),ye$3.encode(e,t.nodes);},decode:e=>({bytes:ie$4.uint.decode(e),nodes:ye$3.decode(e)})},Le$1={preencode(e,t){ie$4.uint.preencode(e,t.index),ie$4.buffer.preencode(e,t.value),ye$3.preencode(e,t.nodes);},encode(e,t){ie$4.uint.encode(e,t.index),ie$4.buffer.encode(e,t.value),ye$3.encode(e,t.nodes);},decode:e=>({index:ie$4.uint.decode(e),value:ie$4.buffer.decode(e)||ae$4,nodes:ye$3.decode(e)})},Pe$1={preencode(e,t){ie$4.uint.preencode(e,t.index),ye$3.preencode(e,t.nodes);},encode(e,t){ie$4.uint.encode(e,t.index),ye$3.encode(e,t.nodes);},decode:e=>({index:ie$4.uint.decode(e),nodes:ye$3.decode(e)})};me$3.data={preencode(e,t){e.end++,ie$4.uint.preencode(e,t.request),ie$4.uint.preencode(e,t.fork),t.block&&Le$1.preencode(e,t.block),t.hash&&Pe$1.preencode(e,t.hash),t.seek&&ve$3.preencode(e,t.seek),t.upgrade&&xe$3.preencode(e,t.upgrade),t.manifest&&pe$4.preencode(e,t.manifest);},encode(e,t){const s=(t.block?1:0)|(t.hash?2:0)|(t.seek?4:0)|(t.upgrade?8:0)|(t.manifest?16:0);ie$4.uint.encode(e,s),ie$4.uint.encode(e,t.request),ie$4.uint.encode(e,t.fork),t.block&&Le$1.encode(e,t.block),t.hash&&Pe$1.encode(e,t.hash),t.seek&&ve$3.encode(e,t.seek),t.upgrade&&xe$3.encode(e,t.upgrade),t.manifest&&pe$4.encode(e,t.manifest);},decode(e){const t=ie$4.uint.decode(e);return {request:ie$4.uint.decode(e),fork:ie$4.uint.decode(e),block:1&t?Le$1.decode(e):null,hash:2&t?Pe$1.decode(e):null,seek:4&t?ve$3.decode(e):null,upgrade:8&t?xe$3.decode(e):null,manifest:16&t?pe$4.decode(e):null}}},me$3.noData={preencode(e,t){ie$4.uint.preencode(e,t.request);},encode(e,t){ie$4.uint.encode(e,t.request);},decode:(e,t)=>({request:ie$4.uint.decode(e)})},me$3.want={preencode(e,t){ie$4.uint.preencode(e,t.start),ie$4.uint.preencode(e,t.length);},encode(e,t){ie$4.uint.encode(e,t.start),ie$4.uint.encode(e,t.length);},decode:e=>({start:ie$4.uint.decode(e),length:ie$4.uint.decode(e)})},me$3.unwant={preencode(e,t){ie$4.uint.preencode(e,t.start),ie$4.uint.preencode(e,t.length);},encode(e,t){ie$4.uint.encode(e,t.start),ie$4.uint.encode(e,t.length);},decode:(e,t)=>({start:ie$4.uint.decode(e),length:ie$4.uint.decode(e)})},me$3.range={preencode(e,t){e.end++,ie$4.uint.preencode(e,t.start),1!==t.length&&ie$4.uint.preencode(e,t.length);},encode(e,t){ie$4.uint.encode(e,(t.drop?1:0)|(1===t.length?2:0)),ie$4.uint.encode(e,t.start),1!==t.length&&ie$4.uint.encode(e,t.length);},decode(e){const t=ie$4.uint.decode(e);return {drop:0!=(1&t),start:ie$4.uint.decode(e),length:0!=(2&t)?1:ie$4.uint.decode(e)}}},me$3.bitfield={preencode(e,t){ie$4.uint.preencode(e,t.start),ie$4.uint32array.preencode(e,t.bitfield);},encode(e,t){ie$4.uint.encode(e,t.start),ie$4.uint32array.encode(e,t.bitfield);},decode:(e,t)=>({start:ie$4.uint.decode(e),bitfield:ie$4.uint32array.decode(e)})},me$3.sync={preencode(e,t){e.end++,ie$4.uint.preencode(e,t.fork),ie$4.uint.preencode(e,t.length),ie$4.uint.preencode(e,t.remoteLength);},encode(e,t){ie$4.uint.encode(e,(t.canUpgrade?1:0)|(t.uploading?2:0)|(t.downloading?4:0)|(t.hasManifest?8:0)),ie$4.uint.encode(e,t.fork),ie$4.uint.encode(e,t.length),ie$4.uint.encode(e,t.remoteLength);},decode(e){const t=ie$4.uint.decode(e);return {fork:ie$4.uint.decode(e),length:ie$4.uint.decode(e),remoteLength:ie$4.uint.decode(e),canUpgrade:0!=(1&t),uploading:0!=(2&t),downloading:0!=(4&t),hasManifest:0!=(8&t)}}},me$3.reorgHint={preencode(e,t){ie$4.uint.preencode(e,t.from),ie$4.uint.preencode(e,t.to),ie$4.uint.preencode(e,t.ancestors);},encode(e,t){ie$4.uint.encode(e,t.from),ie$4.uint.encode(e,t.to),ie$4.uint.encode(e,t.ancestors);},decode:e=>({from:ie$4.uint.encode(e),to:ie$4.uint.encode(e),ancestors:ie$4.uint.encode(e)})},me$3.extension={preencode(e,t){ie$4.string.preencode(e,t.name),ie$4.raw.preencode(e,t.message);},encode(e,t){ie$4.string.encode(e,t.name),ie$4.raw.encode(e,t.message);},decode:e=>({name:ie$4.string.decode(e),message:ie$4.raw.decode(e)})};const Re$1={preencode(e,t){ie$4.string.preencode(e,t.key),ie$4.buffer.preencode(e,t.value);},encode(e,t){ie$4.string.encode(e,t.key),ie$4.buffer.encode(e,t.value);},decode:e=>({key:ie$4.string.decode(e),value:ie$4.buffer.decode(e)})},Se$1={preencode(e,t){ie$4.uint.preencode(e,t.fork),ie$4.uint.preencode(e,t.ancestors),ie$4.uint.preencode(e,t.length),ie$4.buffer.preencode(e,t.signature);},encode(e,t){ie$4.uint.encode(e,t.fork),ie$4.uint.encode(e,t.ancestors),ie$4.uint.encode(e,t.length),ie$4.buffer.encode(e,t.signature);},decode:e=>({fork:ie$4.uint.decode(e),ancestors:ie$4.uint.decode(e),length:ie$4.uint.decode(e),signature:ie$4.buffer.decode(e)})},qe$1={preencode(e,t){e.end++,ie$4.uint.preencode(e,t.start),ie$4.uint.preencode(e,t.length);},encode(e,t){e.buffer[e.start++]=t.drop?1:0,ie$4.uint.encode(e,t.start),ie$4.uint.encode(e,t.length);},decode:e=>({drop:0!=(1&ie$4.uint.decode(e)),start:ie$4.uint.decode(e),length:ie$4.uint.decode(e)})},Be$1=V$4.oplog={};Be$1.entry={preencode(e,t){e.end++,t.userData&&Re$1.preencode(e,t.userData),t.treeNodes&&ye$3.preencode(e,t.treeNodes),t.treeUpgrade&&Se$1.preencode(e,t.treeUpgrade),t.bitfield&&qe$1.preencode(e,t.bitfield);},encode(e,t){const s=e.start++;let i=0;t.userData&&(i|=1,Re$1.encode(e,t.userData)),t.treeNodes&&(i|=2,ye$3.encode(e,t.treeNodes)),t.treeUpgrade&&(i|=4,Se$1.encode(e,t.treeUpgrade)),t.bitfield&&(i|=8,qe$1.encode(e,t.bitfield)),e.buffer[s]=i;},decode(e){const t=ie$4.uint.decode(e);return {userData:0!=(1&t)?Re$1.decode(e):null,treeNodes:0!=(2&t)?ye$3.decode(e):null,treeUpgrade:0!=(4&t)?Se$1.decode(e):null,bitfield:0!=(8&t)?qe$1.decode(e):null}}};const Ue$1={preencode(e,t){ie$4.buffer.preencode(e,t.publicKey),ie$4.buffer.preencode(e,t.secretKey);},encode(e,t){ie$4.buffer.encode(e,t.publicKey),ie$4.buffer.encode(e,t.secretKey);},decode:e=>({publicKey:ie$4.buffer.decode(e),secretKey:ie$4.buffer.decode(e)})},Ee$3={preencode(e,t){ie$4.uint.preencode(e,t.from),ie$4.uint.preencode(e,t.to),ie$4.uint.preencode(e,t.ancestors);},encode(e,t){ie$4.uint.encode(e,t.from),ie$4.uint.encode(e,t.to),ie$4.uint.encode(e,t.ancestors);},decode:e=>({from:ie$4.uint.decode(e),to:ie$4.uint.decode(e),ancestors:ie$4.uint.decode(e)})},Ae$1=ie$4.array(Ee$3),Me$1={preencode(e,t){Ae$1.preencode(e,t.reorgs),ie$4.uint.preencode(e,t.contiguousLength);},encode(e,t){Ae$1.encode(e,t.reorgs),ie$4.uint.encode(e,t.contiguousLength);},decode:e=>({reorgs:Ae$1.decode(e),contiguousLength:e.start<e.end?ie$4.uint.decode(e):0})},De$1={preencode(e,t){ie$4.uint.preencode(e,t.fork),ie$4.uint.preencode(e,t.length),ie$4.buffer.preencode(e,t.rootHash),ie$4.buffer.preencode(e,t.signature);},encode(e,t){ie$4.uint.encode(e,t.fork),ie$4.uint.encode(e,t.length),ie$4.buffer.encode(e,t.rootHash),ie$4.buffer.encode(e,t.signature);},decode:e=>({fork:ie$4.uint.decode(e),length:ie$4.uint.decode(e),rootHash:ie$4.buffer.decode(e),signature:ie$4.buffer.decode(e)})},Ce$1={preencode(e,t){ie$4.string.preencode(e,t.tree),ie$4.string.preencode(e,t.bitfield),ie$4.string.preencode(e,t.signer);},encode(e,t){ie$4.string.encode(e,t.tree),ie$4.string.encode(e,t.bitfield),ie$4.string.encode(e,t.signer);},decode:e=>({tree:ie$4.string.decode(e),bitfield:ie$4.string.decode(e),signer:ie$4.string.decode(e)})},Oe$1={preencode(e,t){ie$4.uint.preencode(e,t.start),ie$4.uint.preencode(e,t.length);},encode(e,t){ie$4.uint.encode(e,t.start),ie$4.uint.encode(e,t.length);},decode:e=>({start:ie$4.uint.decode(e),length:ie$4.uint.decode(e)})},Ne$1=ie$4.array(Re$1);Be$1.header={preencode(e,t){e.end+=2,t.external?Oe$1.preencode(e,t.external):(ie$4.fixed32.preencode(e,t.key),t.manifest&&pe$4.preencode(e,t.manifest),t.keyPair&&Ue$1.preencode(e,t.keyPair),Ne$1.preencode(e,t.userData),De$1.preencode(e,t.tree),Me$1.preencode(e,t.hints));},encode(e,t){if(ie$4.uint.encode(e,1),t.external)return ie$4.uint.encode(e,1),void Oe$1.encode(e,t.external);ie$4.uint.encode(e,(t.manifest?2:0)|(t.keyPair?4:0)),ie$4.fixed32.encode(e,t.key),t.manifest&&pe$4.encode(e,t.manifest),t.keyPair&&Ue$1.encode(e,t.keyPair),Ne$1.encode(e,t.userData),De$1.encode(e,t.tree),Me$1.encode(e,t.hints);},decode(e){const t=ie$4.uint.decode(e);if(t>1)throw oe$4("Invalid header version. Expected <= 1, got "+t);if(0===t){const t={types:Ce$1.decode(e),userData:Ne$1.decode(e),tree:De$1.decode(e),signer:Ue$1.decode(e),hints:Me$1.decode(e)};return {external:null,key:t.signer.publicKey,manifest:{version:0,hash:t.types.tree,allowPatch:!1,quorum:1,signers:[{signature:t.types.signer,namespace:re$4,publicKey:t.signer.publicKey}],prologue:null},keyPair:t.signer.secretKey?t.signer:null,userData:t.userData,tree:t.tree,hints:t.hints}}const s=ie$4.uint.decode(e);return 1&s?{external:Oe$1.decode(e),key:null,manifest:null,keyPair:null,userData:null,tree:null,hints:null}:{external:null,key:ie$4.fixed32.decode(e),manifest:0!=(2&s)?pe$4.decode(e):null,keyPair:0!=(4&s)?Ue$1.decode(e):null,userData:Ne$1.decode(e),tree:De$1.decode(e),hints:Me$1.decode(e)}}};const Ie$1=ie$4.array(ie$4.uint),Fe$1={preencode(e,t){ie$4.uint.preencode(e,t.signer),ie$4.fixed64.preencode(e,t.signature),ie$4.uint.preencode(e,t.patch);},encode(e,t){ie$4.uint.encode(e,t.signer),ie$4.fixed64.encode(e,t.signature),ie$4.uint.encode(e,t.patch);},decode:e=>({signer:ie$4.uint.decode(e),signature:ie$4.fixed64.decode(e),patch:ie$4.uint.decode(e)})},Te$1={preencode(e,t){ie$4.uint.preencode(e,t.start),ie$4.uint.preencode(e,t.length),Ie$1.preencode(e,t.nodes);},encode(e,t){ie$4.uint.encode(e,t.start),ie$4.uint.encode(e,t.length),Ie$1.encode(e,t.nodes);},decode:e=>({start:ie$4.uint.decode(e),length:ie$4.uint.decode(e),nodes:Ie$1.decode(e)})},Ke$1={preencode(e,t){e.end++,ie$4.uint.preencode(e,t.signer),ie$4.fixed64.preencode(e,t.signature),t.patch&&Te$1.preencode(e,t.patch);},encode(e,t){ie$4.uint.encode(e,t.patch?1:0),ie$4.uint.encode(e,t.signer),ie$4.fixed64.encode(e,t.signature),t.patch&&Te$1.encode(e,t.patch);},decode(e){const t=ie$4.uint.decode(e);return {signer:ie$4.uint.decode(e),signature:ie$4.fixed64.decode(e),patch:1&t?Te$1.decode(e):null}}},ze$1=ie$4.array(Ke$1),He$1=ie$4.array(Fe$1),We$1={preencode(e,t){ie$4.uint.preencode(e,t.index),ie$4.uint.preencode(e,t.size),ie$4.fixed32.preencode(e,t.hash);},encode(e,t){ie$4.uint.encode(e,t.index),ie$4.uint.encode(e,t.size),ie$4.fixed32.encode(e,t.hash);},decode:e=>({index:ie$4.uint.decode(e),size:ie$4.uint.decode(e),hash:ie$4.fixed32.decode(e)})},Ve$1=ie$4.array(We$1);V$4.multiSignaturev0={preencode(e,t){ze$1.preencode(e,t.proofs),Ve$1.preencode(e,t.patch);},encode(e,t){ze$1.encode(e,t.proofs),Ve$1.encode(e,t.patch);},decode:e=>({proofs:ze$1.decode(e),patch:Ve$1.decode(e)})},V$4.multiSignature={preencode(e,t){He$1.preencode(e,t.proofs),Ve$1.preencode(e,t.patch);},encode(e,t){He$1.encode(e,t.proofs),Ve$1.encode(e,t.patch);},decode:e=>({proofs:He$1.decode(e),patch:Ve$1.decode(e)})};const Ge$1=L$c,Qe$1=r$u,je$1=t$9,Ye$1=t$8,Xe$1=class Xe{constructor(){this.queue=new A$4,this.priority=[],this.requests=new Map,this.length=0;}push(e){e.priority>0?this.priority.push(e):this.queue.push(e),this.requests.set(e.id,e),this.length++;}shift(){for(;this.priority.length>0;){const e=this.priority.pop(),t=this._processRequest(e);if(null!==t)return t}for(;this.queue.length>0;){const e=this.queue.shift(),t=this._processRequest(e);if(null!==t)return t}return null}_processRequest(e){return e.block||e.hash||e.seek||e.upgrade||e.manifest?(this.requests.delete(e.id),this.length--,e):null}clear(){this.queue.clear(),this.priority=[],this.length=0,this.requests.clear();}delete(e){const t=this.requests.get(e);t&&(t.block=null,t.hash=null,t.seek=null,t.upgrade=null,t.manifest=!1,this.requests.delete(e),this.length--,0===this.length&&(this.queue.clear(),this.priority=[]));}},Ze$1=W$4,{REQUEST_CANCELLED:Je$1,REQUEST_TIMEOUT:$e$1,INVALID_CAPABILITY:et$1,SNAPSHOT_NOT_AVAILABLE:tt$1}=E$6,st$1=V$4,it$1=G$4,{createTracer:nt$1}=r$c,rt$1=[16,512],ot$1=2097152,ht$1=2e4+2e4*Math.random()|0,at$1=0,lt$1=1,ct$1=255;let ut$1 = class ut{constructor(){this.resolved=!1,this.refs=[];}attach(e){const t={context:this,session:e,sindex:0,rindex:0,snapshot:!0,resolve:null,reject:null,promise:null,timeout:null};return t.sindex=e.push(t)-1,t.rindex=this.refs.push(t)-1,t.promise=new Promise(((e,s)=>{t.resolve=e,t.reject=s;})),t}detach(e,t=null){return e.context===this&&(this._detach(e),this._cancel(e,t),this.gc(),!0)}_detach(e){const t=this.refs.pop(),s=e.session.pop();return e.rindex<this.refs.length&&(this.refs[t.rindex=e.rindex]=t),e.sindex<e.session.length&&(e.session[s.sindex=e.sindex]=s),Pt$1(e),e.context=null,e}gc(){0===this.refs.length&&this._unref();}_cancel(e,t){e.reject(t||Je$1());}_unref(){}resolve(e){for(this.resolved=!0;this.refs.length>0;)this._detach(this.refs[this.refs.length-1]).resolve(e);}reject(e){for(this.resolved=!0;this.refs.length>0;)this._detach(this.refs[this.refs.length-1]).reject(e);}setTimeout(e,t){Pt$1(e),e.timeout=setTimeout(Lt$1,t,e);}};let dt$1 = class dt extends ut$1{constructor(e,t,s){super(),this.index=t,this.priority=s,this.inflight=[],this.queued=!1,this.tracker=e;}_unref(){this.queued=!1;for(const e of this.inflight)e.peer._cancelRequest(e);this.tracker.remove(this.index);}};let ft$1 = class ft extends ut$1{constructor(e,t,s,i,n,r){super(),this.start=t,this.end=s,this.linear=i,this.ifAvailable=n,this.blocks=r,this.ranges=e,this.userStart=t,this.userEnd=s;}_unref(){const e=this.ranges.indexOf(this);if(-1===e)return;const t=this.ranges.pop();e<this.ranges.length&&(this.ranges[e]=t);}_cancel(e){e.resolve(!1);}};let gt$1 = class gt extends ut$1{constructor(e,t,s){super(),this.fork=t,this.length=s,this.inflight=[],this.replicator=e;}_unref(){!0===this.replicator.eagerUpgrade||this.inflight.length>0||(this.replicator._upgrade=null);}_cancel(e){e.resolve(!1);}};let pt$1 = class pt extends ut$1{constructor(e,t){super(),this.seeker=t,this.inflight=[],this.seeks=e;}_unref(){if(this.inflight.length>0)return;const e=this.seeks.indexOf(this);if(-1===e)return;const t=this.seeks.pop();e<this.seeks.length&&(this.seeks[e]=t);}};let _t$1 = class _t{constructor(){this._requests=[],this._free=[];}get idle(){return this._requests.length===this._free.length}*[Symbol.iterator](){for(const e of this._requests)null!==e&&(yield e);}add(e){const t=this._free.length?this._free.pop():this._requests.push(null);return e.id=t,this._requests[t-1]=e,e}get(e){return e<=this._requests.length?this._requests[e-1]:null}remove(e,t){e>this._requests.length||(this._requests[e-1]=null,!0===t&&this._free.push(e));}reusable(e){this._free.push(e);}};let yt$1 = class yt{constructor(){this._map=new Map;}[Symbol.iterator](){return this._map.values()}isEmpty(){return 0===this._map.size}has(e){return this._map.has(e)}get(e){return this._map.get(e)||null}add(e,t){let s=this._map.get(e);return s||(s=new dt$1(this,e,t),this._map.set(e,s),s)}remove(e){const t=this.get(e);return this._map.delete(e),t}};let mt$1 = class mt{constructor(){this.queue=[],this.tick=0;}clear(){const e=new Array(this.queue.length);for(let t=0;t<e.length;t++)e[t]=this.queue[t][1];return this.queue=[],e}add(e){this.queue.push([++this.tick,e]);}flush(e){let t=null;for(let s=0;s<this.queue.length&&!(this.queue[s][0]>e);s++)null===t&&(t=[]),t.push(this.queue[s][1]);return null!==t&&this.queue.splice(0,t.length),t}};let bt$1 = class bt{constructor(e,t,s,i,n){this.tracer=nt$1(this,{parent:e.core.tracer}),this.core=e.core,this.replicator=e,this.stream=t.stream,this.protomux=t,this.remotePublicKey=this.stream.remotePublicKey,this.remoteSupportsSeeks=!1,this.inflightRange=n,this.paused=!1,this.removed=!1,this.useSession=i,this.channel=s,this.channel.userData=this,this.wireSync=this.channel.messages[0],this.wireRequest=this.channel.messages[1],this.wireCancel=this.channel.messages[2],this.wireData=this.channel.messages[3],this.wireNoData=this.channel.messages[4],this.wireWant=this.channel.messages[5],this.wireUnwant=this.channel.messages[6],this.wireBitfield=this.channel.messages[7],this.wireRange=this.channel.messages[8],this.wireExtension=this.channel.messages[9],this.stats={wireSync:{tx:0,rx:0},wireRequest:{tx:0,rx:0},wireCancel:{tx:0,rx:0},wireData:{tx:0,rx:0},wireWant:{tx:0,rx:0},wireBitfield:{tx:0,rx:0},wireRange:{tx:0,rx:0},wireExtension:{tx:0,rx:0}},this.receiverQueue=new Xe$1,this.receiverBusy=!1,this.roundtripQueue=null,this.inflight=0,this.dataProcessing=0,this.canUpgrade=!0,this.needsSync=!1,this.syncsProcessing=0,this._remoteContiguousLength=0,this.remoteOpened=!1,this.remoteBitfield=new Ze$1,this.missingBlocks=new Ze$1,this.remoteFork=0,this.remoteLength=0,this.remoteCanUpgrade=!1,this.remoteUploading=!0,this.remoteDownloading=!0,this.remoteSynced=!1,this.remoteHasManifest=!1,this.remoteRequests=new Map,this.segmentsWanted=new Set,this.broadcastedNonSparse=!1,this.lengthAcked=0,this.extensions=new Map,this.lastExtensionSent="",this.lastExtensionRecv="",e._ifAvailable++;}get remoteContiguousLength(){return this.remoteBitfield.findFirst(!1,this._remoteContiguousLength)}getMaxInflight(){const e=this.stream.rawStream;if(!e.udx)return Math.min(this.inflightRange[1],3*this.inflightRange[0]);const t=e.rtt<=50?1:e.rtt/50*Math.min(1,2/this.replicator.peers.length);return Math.max(this.inflightRange[0],Math.round(Math.min(this.inflightRange[1],this.inflightRange[0]*t)))}signalUpgrade(){!0===this._shouldUpdateCanUpgrade()?this._updateCanUpgradeAndSync():this.sendSync();}_markInflight(e){this.missingBlocks.set(e,!1);}broadcastRange(e,t,s){if(s?this._unclearLocalRange(e,t):this._clearLocalRange(e,t),!s){if(this._remoteContiguousLength>=e+t)return;if(1===t){if(this.remoteBitfield.get(e))return}else if(this.remoteBitfield.firstUnset(e)>=e+t)return}this.wireRange.send({drop:s,start:e,length:t}),zt$1(this.stats.wireRange,this.replicator.stats.wireRange);}extension(e,t){this.wireExtension.send({name:e===this.lastExtensionSent?"":e,message:t}),zt$1(this.stats.wireExtension,this.replicator.stats.wireExtension),this.lastExtensionSent=e;}onextension(e){const t=e.name||this.lastExtensionRecv;this.lastExtensionRecv=t;const s=this.extensions.get(t);s&&s._onmessage({start:0,end:e.message.byteLength,buffer:e.message},this);}sendSync(){0===this.syncsProcessing?(this.core.tree.fork!==this.remoteFork&&(this.canUpgrade=!1),this.needsSync=!1,this.wireSync.send({fork:this.core.tree.fork,length:this.core.tree.length,remoteLength:this.core.tree.fork===this.remoteFork?this.remoteLength:0,canUpgrade:this.canUpgrade,uploading:!0,downloading:this.replicator.isDownloading(),hasManifest:!!this.core.header.manifest&&!1===this.core.compat}),zt$1(this.stats.wireSync,this.replicator.stats.wireSync)):this.needsSync=!0;}onopen({seeks:e,capability:t}){const s=it$1.replicate(!1===this.stream.isInitiator,this.replicator.key,this.stream.handshakeHash);if(!0!==Ge$1.equals(t,s))throw et$1("Remote sent an invalid replication capability");if(!0===this.remoteOpened)return;this.remoteOpened=!0,this.remoteSupportsSeeks=e,this.protomux.cork(),this.sendSync();const i=Math.min(this.core.tree.length,this.core.header.hints.contiguousLength);i>0&&(this.broadcastRange(0,i,!1),i===this.core.tree.length&&(this.broadcastedNonSparse=!0)),this.replicator._ifAvailable--,this.replicator._addPeer(this),this.protomux.uncork();}onclose(e){this.tracer.trace("onclose");const t=!0===e&&!0===this.remoteOpened&&!1===this.remoteDownloading&&!0===this.remoteUploading&&!0===this.replicator.downloading;if(!1===this.remoteOpened)return this.useSession&&(this.replicator._peerSessions--,this.replicator._closeSessionMaybe()),this.replicator._ifAvailable--,void this.replicator.updateAll();if(this.remoteOpened=!1,this.removed=!0,this.remoteRequests.clear(),this.receiverQueue.clear(),null!==this.roundtripQueue)for(const e of this.roundtripQueue.clear())this.replicator._inflight.reusable(e);this.replicator._removePeer(this),t&&this.replicator._makePeer(this.protomux,this.useSession),this.useSession&&(this.replicator._peerSessions--,this.replicator._closeSessionMaybe());}closeIfIdle(){return !1===this.remoteDownloading&&!1===this.replicator.isDownloading()&&(this.channel.close(),!0)}async onsync({fork:e,length:t,remoteLength:s,canUpgrade:i,uploading:n,downloading:r,hasManifest:o}){const h=t!==this.remoteLength,a=e===this.core.tree.fork;if(this.remoteSynced=!0,this.remoteFork=e,this.remoteLength=t,this.remoteCanUpgrade=i,this.remoteUploading=n,this.remoteDownloading=r,this.remoteHasManifest=o,this.closeIfIdle())return;this.lengthAcked=a?s:0,this.syncsProcessing++,this.replicator._updateFork(this),this.remoteLength>this.core.tree.length&&this.lengthAcked===this.core.tree.length&&null!==this.replicator._addUpgradeMaybe()&&this._update();const l=!1===h||!1===a?this.canUpgrade&&a:await this._canUpgrade(t,e);t===this.remoteLength&&e===this.core.tree.fork&&(this.canUpgrade=l),0==--this.syncsProcessing&&((!0===this.needsSync||this.core.tree.fork===this.remoteFork&&this.core.tree.length>this.remoteLength)&&this.signalUpgrade(),this._update());}_shouldUpdateCanUpgrade(){return this.core.tree.fork===this.remoteFork&&this.core.tree.length>this.remoteLength&&!1===this.canUpgrade&&0===this.syncsProcessing}async _updateCanUpgradeAndSync(){const{length:e,fork:t}=this.core.tree,s=await this._canUpgrade(this.remoteLength,this.remoteFork);this.syncsProcessing>0||e!==this.core.tree.length||t!==this.core.tree.fork||s!==this.canUpgrade&&(this.canUpgrade=s,this.sendSync());}async _canUpgrade(e,t){if(t!==this.core.tree.fork)return !1;if(0===e)return !0;if(e>=this.core.tree.length)return !1;try{const s=await this.core.tree.upgradeable(e);return t===this.core.tree.fork&&s}catch{return !1}}async _getProof(e){const t=await this.core.tree.proof(e);if(t.block){const s=e.block.index;if(e.fork!==this.core.tree.fork||!this.core.bitfield.get(s))return null;t.block.value=await this.core.blocks.get(s);}return e.manifest&&!this.core.compat&&(t.manifest=this.core.header.manifest),t}async onrequest(e){this.tracer.trace("onrequest",e);const t=this.remoteRequests.size;this.remoteRequests.set(e.id,e),t===this.remoteRequests.size&&(this._cancel(e.id),this.remoteRequests.set(e.id,e)),this.protomux.drained&&!this.receiverQueue.length?await this._handleRequest(e):this.receiverQueue.push(e);}oncancel(e){this._cancel(e.request);}_cancel(e){this.remoteRequests.delete(e),this.receiverQueue.delete(e);}ondrain(){return this._handleRequests()}async _handleRequests(){if(!this.receiverBusy){for(this.receiverBusy=!0,this.protomux.cork();this.remoteOpened&&this.protomux.drained&&this.receiverQueue.length>0&&!this.removed;){const e=this.receiverQueue.shift();await this._handleRequest(e);}this.protomux.uncork(),this.receiverBusy=!1;}}async _handleRequest(e){let t=null;if(e.fork===this.core.tree.fork)try{t=await this._getProof(e);}catch(t){if(Qe$1(t),e.fork===this.core.tree.fork&&Rt$1(t))throw t}if(this.remoteRequests.get(e.id)===e)if(this.remoteRequests.delete(e.id),null!==t)null!==t.block&&this.replicator.onupload(t.block.index,t.block.value,this),this.wireData.send({request:e.id,fork:e.fork,block:t.block,hash:t.hash,seek:t.seek,upgrade:t.upgrade,manifest:t.manifest}),zt$1(this.stats.wireData,this.replicator.stats.wireData);else {if(e.manifest&&this.core.header.manifest){const t=this.core.header.manifest;return this.wireData.send({request:e.id,fork:this.core.tree.fork,block:null,hash:null,seek:null,upgrade:null,manifest:t}),void zt$1(this.stats.wireData,this.replicator.stats.wireData)}this.wireNoData.send({request:e.id});}}_cancelRequest(e){e.priority!==ct$1&&(e.priority=ct$1,this.inflight--,this.replicator._requestDone(e.id,!1),Kt$1(e)&&this.replicator._unmarkInflight(e.block.index),function(e){return null!==e&&null!==e.upgrade}(e)&&this.replicator._clearInflightUpgrade(e),null===this.roundtripQueue&&(this.roundtripQueue=new mt$1),this.roundtripQueue.add(e.id),this.wireCancel.send({request:e.id}),zt$1(this.stats.wireCancel,this.replicator.stats.wireCancel));}_checkIfConflict(){this.paused=!0;const e=Math.min(this.core.tree.length,this.remoteLength);0!==e&&(this.wireRequest.send({id:0,fork:this.remoteFork,block:null,hash:null,seek:null,upgrade:{start:0,length:e}}),zt$1(this.stats.wireRequest,this.replicator.stats.wireRequest));}async ondata(e){if(this.tracer.trace("ondata",e),0===e.request&&e.upgrade&&0===e.upgrade.start){if(await this.core.checkConflict(e,this))return;this.paused=!1;}const t=e.request>0?this.replicator._inflight.get(e.request):null,s=e.fork>this.core.tree.fork;if(null!==t||!1!==s){if(null!==t){if(t.peer!==this)return;this._onrequestroundtrip(t);}try{if(!0===s)return await this.replicator._onreorgdata(this,t,e)}catch(s){return Qe$1(s),Kt$1(t)&&this.replicator._unmarkInflight(t.block.index),this.paused=!0,void this.replicator.oninvalid(s,t,e,this)}this.dataProcessing++;try{if(!function(e,t){return (null===t.block||null!==e.block&&e.block.index===t.block.index)&&((null===t.hash||null!==e.hash&&e.hash.index===t.hash.index)&&((null===t.seek||null!==e.seek&&e.seek.bytes===t.seek.bytes)&&((null===t.upgrade||null!==e.upgrade)&&e.fork===t.fork)))}(t,e)||!await this.core.verify(e,this))return void this.replicator._onnodata(this,t)}catch(s){if(Qe$1(s),Kt$1(t)&&this.replicator._unmarkInflight(t.block.index),"WRITE_FAILED"===s.code)return void(this.paused=!0);if(this.core.closed&&!Rt$1(s))return;return "INVALID_OPERATION"!==s.code&&this._checkIfConflict(),this.replicator._onnodata(this,t),void this.replicator.oninvalid(s,t,e,this)}finally{this.dataProcessing--;}this.replicator._ondata(this,t,e),!0===this._shouldUpdateCanUpgrade()&&this._updateCanUpgradeAndSync();}}onnodata({request:e}){this.tracer.trace("onnodata",{request:e});const t=e>0?this.replicator._inflight.get(e):null;null!==t&&t.peer===this&&(this._onrequestroundtrip(t),this.replicator._onnodata(this,t));}_onrequestroundtrip(e){if(e.priority===ct$1)return;if(e.priority=ct$1,this.inflight--,this.replicator._requestDone(e.id,!0),null===this.roundtripQueue)return;const t=this.roundtripQueue.flush(e.rt);if(null!==t)for(const e of t)this.replicator._inflight.reusable(e);}onwant({start:e,length:t}){this.replicator._onwant(this,e,t);}onunwant(){}onbitfield({start:e,bitfield:t}){e<this._remoteContiguousLength&&(this._remoteContiguousLength=e),this.remoteBitfield.insert(e,t),this.missingBlocks.insert(e,t),this._clearLocalRange(e,8*t.byteLength),this._update();}_clearLocalRange(e,t){const s=null===this.core.skipBitfield?this.core.bitfield:this.core.skipBitfield;if(1===t)return void this.missingBlocks.set(e,this._remoteHasBlock(e)&&!s.get(e));const i=Math.min(this.core.tree.length,this.core.header.hints.contiguousLength);if(e+t<i){const t=i-e;return void this.missingBlocks.setRange(e,t,!1)}const n=32767&e;n>0&&(e-=n,t+=n);const r=e+Math.min(t,this.core.tree.length);for(;e<r;){const t=s.getBitfield(e);t&&t.bitfield&&this.missingBlocks.clear(e,t.bitfield),e+=32768;}}_resetMissingBlock(e){const t=null===this.core.skipBitfield?this.core.bitfield:this.core.skipBitfield;this.missingBlocks.set(e,this._remoteHasBlock(e)&&!t.get(e));}_unclearLocalRange(e,t){if(1===t)return void this._resetMissingBlock(e);const s=2097151&e;s>0&&(e-=s,t+=s);const i=e,n=e+Math.min(t,this.remoteLength);for(;e<n;){const t=this.remoteBitfield.getBitfield(e);t&&t.bitfield&&this.missingBlocks.insert(e,t.bitfield),e+=2097152;}this._clearLocalRange(i,t);}onrange({drop:e,start:t,length:s}){const i=!1===e;if(!0===e&&t<this._remoteContiguousLength&&(this._remoteContiguousLength=t),0===t&&!1===e)s>this._remoteContiguousLength&&(this._remoteContiguousLength=s);else if(1===s){const e=null===this.core.skipBitfield?this.core.bitfield:this.core.skipBitfield;this.remoteBitfield.set(t,i),this.missingBlocks.set(t,i&&!e.get(t));}else {const e=this.remoteBitfield.findFirst(!i,t),n=s-(e-t);n>0&&(this.remoteBitfield.setRange(e,n,i),this.missingBlocks.setRange(e,n,i),i&&this._clearLocalRange(e,n));}!1===e&&this._update();}onreorghint(){}_update(){this.replicator.updatePeer(this);}async _onconflict(){this.protomux.cork(),this.remoteLength>0&&this.core.tree.fork===this.remoteFork&&await this.onrequest({id:0,fork:this.core.tree.fork,block:null,hash:null,seek:null,upgrade:{start:0,length:Math.min(this.core.tree.length,this.remoteLength)}}),this.channel.close(),this.protomux.uncork();}_makeRequest(e,t,s){return !0===e&&!1===this.replicator._shouldUpgrade(this)||this.remoteLength<s?null:(!1===e&&!0===this.replicator._autoUpgrade(this)&&(e=!0),{peer:this,rt:null===this.roundtripQueue?0:this.roundtripQueue.tick,id:0,fork:this.remoteFork,block:null,hash:null,seek:null,upgrade:!1===e?null:{start:this.core.tree.length,length:this.remoteLength-this.core.tree.length},manifest:null===this.core.header.manifest&&!0===this.remoteHasManifest,priority:t})}_requestManifest(){const e=this._makeRequest(!1,0,0);this._send(e);}_requestUpgrade(e){const t=this._makeRequest(!0,0,0);return null!==t&&(this._send(t),!0)}_requestSeek(e){if(this.replicator._updatesPending>0)return !1;const{length:t,fork:s}=this.core.tree;if(s!==this.remoteFork)return !1;if(e.seeker.start>=t){const t=this._makeRequest(!0,0,0);return null!==t&&(t.seek=this.remoteSupportsSeeks?{bytes:e.seeker.bytes,padding:e.seeker.padding}:null,e.inflight.push(t),this._send(t),!0)}const i=e.seeker.end-e.seeker.start,n=e.seeker.start+Math.floor(Math.random()*i);for(let t=0;t<i;t++){let s=n+t;if(s>e.seeker.end&&(s-=i),!1===this._remoteHasBlock(s))continue;if(!0===this.core.bitfield.get(s))continue;if(!this._hasTreeParent(s))continue;const r=this.replicator._blocks.get(s);if(null!==r&&r.inflight.length>0)continue;const o=this.replicator._hashes.add(s,at$1);if(o.inflight.length>0)continue;const h=this._makeRequest(!1,o.priority,s+1);if(null===h)continue;const a=Ye$1.depth(e.seeker.start+e.seeker.end-1);return h.hash={index:2*s,nodes:a},h.seek=this.remoteSupportsSeeks?{bytes:e.seeker.bytes,padding:e.seeker.padding}:null,e.inflight.push(h),o.inflight.push(h),this._send(h),!0}return this._maybeWant(e.seeker.start,i),!1}_hasTreeParent(e){if(this.remoteLength>=this.core.tree.length)return !0;const t=Ye$1.iterator(2*e);let s=2,i=0;for(;;){t.parent();const e=(t.index-t.factor/2+1)/2;if(i=e+s,i>this.core.tree.length){if(i>this.remoteLength)return !0;break}if(i>this.remoteLength)break;s*=2;const n=this.core.bitfield.findFirst(!0,e);if(n>-1&&n<i)return !0}return !1}_remoteHasBlock(e){return e<this._remoteContiguousLength||!0===this.remoteBitfield.get(e)}_sendBlockRequest(e,t){e.block={index:t.index,nodes:0},this.replicator._markInflight(t.index),t.inflight.push(e),this._send(e);}_requestBlock(e){const{length:t,fork:s}=this.core.tree;if(!1===this._remoteHasBlock(e.index)||s!==this.remoteFork)return this._maybeWant(e.index),!1;if(!this._hasTreeParent(e.index))return !1;const i=this._makeRequest(e.index>=t,e.priority,e.index+1);return null!==i&&(this._sendBlockRequest(i,e),!0)}_requestRangeBlock(e,t){if(!0===this.core.bitfield.get(e)||!this._hasTreeParent(e))return !1;const s=this.replicator._blocks.add(e,at$1);if(s.inflight.length>0)return this.missingBlocks.set(e,!1),!1;const i=this._makeRequest(e>=t,s.priority,e+1);return null===i?(s.gc(),!1):(this._sendBlockRequest(i,s),s.queued&&(s.queued=!1),!0)}_findNext(e){if(e<this._remoteContiguousLength){if(null===this.core.skipBitfield&&this.replicator._openSkipBitfield(),(e=this.core.skipBitfield.findFirst(!1,e))<this._remoteContiguousLength&&e>-1)return e;e=this._remoteContiguousLength;}return this.missingBlocks.findFirst(!0,e)}_requestRange(e){const{length:t,fork:s}=this.core.tree;if(e.blocks){let s=-1,i=-1;for(let n=e.start;n<e.end;n++){const r=e.blocks[n];(-1===s||r<s)&&(s=r),(-1===i||r>i)&&(i=r);if(!0===(r<this._remoteContiguousLength||!0===this.missingBlocks.get(r))&&this._requestRangeBlock(r,t))return !0}return s>-1&&this._maybeWant(s,i-s),!1}const i=Math.min(this.core.tree.length,Math.min(-1===e.end?this.remoteLength:e.end,this.remoteLength));if(i<=e.start||s!==this.remoteFork)return !1;const n=i-e.start,r=e.start+(e.linear?0:Math.floor(Math.random()*n));let o=r;for(;o=this._findNext(o),!(-1===o||o>=i);){if(this._requestRangeBlock(o,t))return !0;o++;}for(o=e.start;o=this._findNext(o),!(-1===o||o>=r);){if(this._requestRangeBlock(o,t))return !0;o++;}return this._maybeWant(e.start,n),!1}_requestForkProof(e){const t=this._makeRequest(!1,0,0);t.upgrade={start:0,length:this.remoteLength},t.manifest=!this.core.header.manifest,e.inflight.push(t),this._send(t);}_requestForkRange(e){if(e.fork!==this.remoteFork||null===e.batch.want)return !1;const t=Math.min(e.batch.want.end,this.remoteLength);if(t<e.batch.want.start)return !1;const s=t-e.batch.want.start,i=e.batch.want.start+Math.floor(Math.random()*s);for(let n=0;n<s;n++){let r=i+n;if(r>=t&&(r-=s),!1===this._remoteHasBlock(r))continue;const o=this._makeRequest(!1,0,0);return o.hash={index:2*r,nodes:e.batch.want.nodes},e.inflight.push(o),this._send(o),!0}return this._maybeWant(e.batch.want.start,s),!1}_maybeWant(e,t=1){if(e+t<=this.remoteContiguousLength)return;let s=Math.floor(e/ot$1);const i=Math.ceil((e+t)/ot$1);for(;s<i;s++)this.segmentsWanted.has(s)||(this.segmentsWanted.add(s),this.wireWant.send({start:s*ot$1,length:ot$1}),zt$1(this.stats.wireWant,this.replicator.stats.wireWant));}isActive(){return !this.paused&&!this.removed}async _send(e){const t=this.core.tree.fork;if(this.inflight++,this.replicator._inflight.add(e),null!==e.upgrade&&e.fork===t){this.replicator._addUpgrade().inflight.push(e);}try{if(null!==e.block&&e.fork===t&&(e.block.nodes=await this.core.tree.missingNodes(2*e.block.index),e.priority===ct$1))return;if(null!==e.hash&&e.fork===t&&0===e.hash.nodes){if(e.hash.nodes=await this.core.tree.missingNodes(e.hash.index),e.priority===ct$1)return;if(0===e.hash.nodes&&0==(1&e.hash.index))return this.inflight--,void this.replicator._resolveHashLocally(this,e)}}catch(e){return void this.stream.destroy(e)}this.tracer.trace("send",e),this.wireRequest.send(e),zt$1(this.stats.wireRequest,this.replicator.stats.wireRequest);}};function kt$1(e,t){const s=e.indexOf(t);return -1!==s&&(s<e.length-1?e[s]=e.pop():e.pop(),!0)}function wt$1(){}function xt$1(e,t){return -1===t?-1:t<e?0:t-e}function vt$1(e,t){if(null===t.blocks){const s=e.bitfield.firstUnset(t.start);if(-1===t.end)t.start=-1===s?e.tree.length:s;else if(-1===s||s>=t.end)t.start=t.end;else {t.start=s;const i=e.bitfield.lastUnset(t.end-1);t.end=-1===i||s>=i+1?t.start:i+1;}}else {for(;t.start<t.end&&e.bitfield.get(t.blocks[t.start]);)t.start++;for(;t.start<t.end&&e.bitfield.get(t.blocks[t.end-1]);)t.end--;}}function Lt$1(e){e.context&&e.context.detach(e,$e$1());}function Pt$1(e){null!==e.timeout&&(clearTimeout(e.timeout),e.timeout=null);}function Rt$1(e){return "HypercoreError"===e.name}function St$1(e,t){return t.userData.onopen(e)}function qt$1(e,t){return t.userData.onclose(e)}function Bt$1(e){return e.userData.ondrain()}function Ut$1(e,t){return Ht$1(t.userData.stats.wireSync,t.userData.replicator.stats.wireSync),t.userData.onsync(e)}function Et$1(e,t){return Ht$1(t.userData.stats.wireRequest,t.userData.replicator.stats.wireRequest),t.userData.onrequest(e)}function At$1(e,t){return Ht$1(t.userData.stats.wireCancel,t.userData.replicator.stats.wireCancel),t.userData.oncancel(e)}function Mt$1(e,t){return Ht$1(t.userData.stats.wireData,t.userData.replicator.stats.wireData),t.userData.ondata(e)}function Dt$1(e,t){return t.userData.onnodata(e)}function Ct$1(e,t){return Ht$1(t.userData.stats.wireWant,t.userData.replicator.stats.wireWant),t.userData.onwant(e)}function Ot$1(e,t){return t.userData.onunwant(e)}function Nt$1(e,t){return Ht$1(t.userData.stats.wireBitfield,t.userData.replicator.stats.wireBitfield),t.userData.onbitfield(e)}function It$1(e,t){return Ht$1(t.userData.stats.wireRange,t.userData.replicator.stats.wireRange),t.userData.onrange(e)}function Ft$1(e,t){return Ht$1(t.userData.stats.wireExtension,t.userData.replicator.stats.wireExtension),t.userData.onextension(e)}function Tt$1(e,t,s){e.setDownloadingNow(t,s);}function Kt$1(e){return null!==e&&null!==e.block}function zt$1(e,t){e.tx++,t.tx++;}function Ht$1(e,t){e.rx++,t.rx++;}const Wt$1=t$g,Vt$1=L$c,{crc32:Gt$1}=r$7,{OPLOG_CORRUPT:Qt$1,OPLOG_HEADER_OVERFLOW:jt$1,WRITE_FAILED:Yt$1}=E$6;const Xt$1=t$g,{oplog:Zt$1}=V$4;const Jt$1=t$8,$t$1=o$e,es$1=t$g,ts$1=t$f,ss$1=L$c,is=n$a,ns=G$4,{INVALID_PROOF:rs,INVALID_CHECKSUM:os,INVALID_OPERATION:hs,BAD_ARGUMENT:as,ASSERTION:ls}=E$6,cs=ss$1.alloc(32),us=ss$1.from([5,2,87,2,0,0,40,7,66,76,65,75,69,50,98]);class ds{constructor(e,t=null){this.i=0,this.nodes=e,this.extra=t,this.length=e.length+(null===this.extra?0:1);}shift(e){if(null!==this.extra&&this.extra.index===e){const e=this.extra;return this.extra=null,this.length--,e}if(this.i>=this.nodes.length)throw hs("Expected node "+e+", got (nil)");const t=this.nodes[this.i++];if(t.index!==e)throw hs("Expected node "+e+", got node "+t.index);return this.length--,t}}class fs{constructor(e){this.fork=e.fork,this.roots=[...e.roots],this.length=e.length,this.ancestors=e.length,this.byteLength=e.byteLength,this.signature=null,this.hashCached=null,this.treeLength=e.length,this.treeFork=e.fork,this.tree=e,this.nodes=[],this.upgraded=!1;}checkout(e,t){const s=[];let i=0;const n=2*e-2,r=new Set,o=new Map;if(t)for(const e of t)o.set(e.index,e);for(const e of this.nodes)o.set(e.index,e);for(const e of Jt$1.fullRoots(n+2)){const t=Jt$1.leftSpan(e);if(0!==t&&r.add(t-1),i<this.roots.length&&this.roots[i].index===e){s.push(this.roots[i++]);continue}const n=o.get(e);if(!n)throw new as("root missing for given length");s.push(n);}this.roots=s,this.length=e,this.byteLength=vs(s),this.hashCached=null,this.signature=null;for(let e=0;e<this.nodes.length;e++){const t=this.nodes[e].index;if(t<=n&&!r.has(t))continue;const s=this.nodes.pop();e<this.nodes.length&&(this.nodes[e--]=s);}}prune(e){if(0===e)return;const t=2*e-2,s=new Set;for(const e of Jt$1.fullRoots(t+2)){const t=Jt$1.leftSpan(e);0!==t&&s.add(t-1);}for(let e=0;e<this.nodes.length;e++){const i=this.nodes[e].index;if(i>t||s.has(i))continue;const n=this.nodes.pop();e<this.nodes.length&&(this.nodes[e--]=n);}}clone(){const e=new fs(this.tree);return e.fork=this.fork,e.roots=[...this.roots],e.length=this.length,e.byteLength=this.byteLength,e.signature=this.signature,e.treeLength=this.treeLength,e.treeFork=this.treeFork,e.tree=this.tree,e.nodes=[...this.nodes],e.upgraded=this.upgraded,e}hash(){return null===this.hashCached&&(this.hashCached=is(this.tree.crypto.tree(this.roots))),this.hashCached}signable(e){return ns.treeSignable(e,this.hash(),this.length,this.fork)}signableCompat(e){return ns.treeSignableCompat(this.hash(),this.length,this.fork,e)}get(e,t){if(e>=2*this.length)return null;for(const t of this.nodes)if(t.index===e)return t;return this.tree.get(e,t)}proof({block:e,hash:t,seek:s,upgrade:i}){return Bs(this,e,t,s,i)}verifyUpgrade(e){const t=ms(e,this.tree.crypto,this.nodes);if(!e.upgrade)throw hs("Expected upgrade proof");return bs(e,t,this)}append(e){const t=2*this.length,s=Jt$1.iterator(t),i=Ls(this.tree.crypto,t,e);this.appendRoot(i,s);}appendRoot(e,t){for(e=Es(e),this.hashCached=null,this.upgraded=!0,this.length+=t.factor/2,this.byteLength+=e.size,this.roots.push(e),this.nodes.push(e);this.roots.length>1;){const e=this.roots[this.roots.length-1],s=this.roots[this.roots.length-2];if(t.sibling()!==s.index){t.sibling();break}const i=Es(Ps(this.tree.crypto,t.parent(),e,s));this.nodes.push(i),this.roots.pop(),this.roots.pop(),this.roots.push(i);}}commitable(){return this.treeFork===this.tree.fork&&(this.upgraded?this.treeLength===this.tree.length:this.treeLength<=this.tree.length)}commit(){if(!this.commitable())throw hs("Tree was modified during batch, refusing to commit");this.upgraded&&this._commitUpgrade();for(let e=0;e<this.nodes.length;e++){const t=this.nodes[e];this.tree.unflushed.set(t.index,t);}}_commitUpgrade(){if(this.ancestors<this.treeLength){if(this.ancestors>0){const e=2*this.ancestors,t=Jt$1.iterator(e-2);for(;t.contains(e)&&t.index<e&&this.tree.unflushed.set(t.index,Rs(t.index)),0!==t.offset;)t.parent();}this.tree.truncateTo=this.tree.truncated?Math.min(this.tree.truncateTo,this.ancestors):this.ancestors,this.tree.truncated=!0,this.tree.cache=new ts$1({maxSize:this.tree.cache.maxSize}),qs(this.tree.unflushed,this.ancestors),null!==this.tree.flushing&&qs(this.tree.flushing,this.ancestors);}this.tree.roots=this.roots,this.tree.length=this.length,this.tree.byteLength=this.byteLength,this.tree.fork=this.fork,this.tree.signature=this.signature;}seek(e,t){return new ps(this,e,t)}byteRange(e){return _s(this,e)}byteOffset(e){return e===2*this.tree.length?this.tree.byteLength:ys(this,e)}}class gs extends fs{constructor(e){super(e),this.roots=[],this.length=0,this.byteLength=0,this.diff=null,this.ancestors=0,this.upgraded=!0,this.want={nodes:0,start:0,end:0};}get finished(){return null===this.want}update(e){if(null===this.want)return !0;const t=[],s=ms(e,this.tree.crypto,t);return !(null===s||!ss$1.equals(s.hash,this.diff.hash))&&(this.nodes.push(...t),this._update(t))}async _update(e){const t=new Map;for(const s of e)t.set(s.index,s);let s=null;const i=Jt$1.iterator(this.diff.index),n=this.diff;for(;0!=(1&i.index);){const e=t.get(i.leftChild());if(!e)break;const n=await this.tree.get(e.index,!1);s=n&&ss$1.equals(n.hash,e.hash)?t.get(i.sibling()):e;}return 0==(1&this.diff.index)||null!==s&&(n===this.diff&&this._updateDiffRoot(s))}_updateDiffRoot(e){if(null===this.want)return !0;const t=Jt$1.spans(e.index),s=t[0]/2,i=Math.min(this.treeLength,t[1]/2+1),n=i-s;return this.ancestors=s,this.diff=e,0==(1&e.index)||this.want.start>=this.treeLength||n<=0?(this.want=null,!0):(this.want.start=s,this.want.end=i,this.want.nodes=function(e){let t=1;for(;e>2;)e/=2,t++;return t}(t[1]-t[0]+2)-1,!1)}}class ps{constructor(e,t,s=0){this.tree=e,this.bytes=t,this.padding=s;const i=e.byteLength-e.length*s;this.start=t>=i?e.length:0,this.end=t<i?e.length:0;}async _seek(e){if(!e)return [0,0];for(const t of this.tree.roots){const s=Us(t,this.padding,null);if(e===s)return [Jt$1.rightSpan(t.index)+2,0];if(e>s){e-=s;continue}const i=Jt$1.iterator(t.index);for(;0!=(1&i.index);){const t=await this.tree.get(i.leftChild(),!1);if(!t)return i.parent(),[i.index,e];{const s=Us(t,this.padding,i);if(s===e)return [i.rightSpan()+2,0];if(s>e)continue;e-=s,i.sibling();}}return [i.index,e]}return null}async update(){const e=await this._seek(this.bytes);if(!e)return null;if(0==(1&e[0]))return [e[0]/2,e[1]];const t=Jt$1.spans(e[0]);return this.start=t[0]/2,this.end=t[1]/2+1,null}}async function _s(e,t){const s=2*e.length;if((0==(1&t)?t:Jt$1.rightSpan(t))>=s)throw as("Index is out of bounds");return [await e.byteOffset(t),(await e.get(t)).size]}async function ys(e,t){if(t===2*e.length)return e.byteLength;1==(1&t)&&(t=Jt$1.leftSpan(t));let s=0,i=0;for(const n of e.roots){if(s+=2*(n.index-s+1),t>=s){i+=n.size;continue}const r=Jt$1.iterator(n.index);for(;r.index!==t;)t<r.index?r.leftChild():(i+=(await e.get(r.leftChild())).size,r.sibling());return i}throw ls("Failed to find offset")}function ms({block:e,hash:t,seek:s},i,n){const r=e?{index:2*e.index,value:e.value,nodes:e.nodes}:t?{index:t.index,value:null,nodes:t.nodes}:null;if(!(null!==r||s&&s.nodes.length))return null;let o=null;if(s&&s.nodes.length){const e=Jt$1.iterator(s.nodes[0].index),t=new ds(s.nodes);for(o=t.shift(e.index),n.push(o);t.length>0;){const s=t.shift(e.sibling());o=Ps(i,e.parent(),o,s),n.push(s),n.push(o);}}if(null===r)return o;const h=Jt$1.iterator(r.index),a=r.value&&Ls(i,h.index,r.value),l=new ds(r.nodes,o);for(o=a||l.shift(h.index),n.push(o);l.length>0;){const e=l.shift(h.sibling());o=Ps(i,h.parent(),o,e),n.push(e),n.push(o);}return o}function bs({fork:e,upgrade:t},s,i){const n=i.tree.prologue;if(n){const{start:e,length:s}=t;if(e<n.length&&(0!==e||s<n.length))throw rs("Upgrade does not satisfy prologue")}const r=new ds(t.nodes,s);let o=i.roots.length>0,h=0;const a=2*(t.start+t.length),l=Jt$1.iterator(0);for(;l.fullRoot(a);l.nextTree())if(h<i.roots.length&&i.roots[h].index===l.index)h++;else {if(o){o=!1;const e=l.index;if(h<i.roots.length){for(l.seek(i.roots[i.roots.length-1].index);l.index!==e;)i.appendRoot(r.shift(l.sibling()),l);continue}}i.appendRoot(r.shift(l.index),l);}if(n&&i.length===n.length&&!ss$1.equals(n.hash,i.hash()))throw rs("Invalid hash");const c=t.additionalNodes;for(l.seek(i.roots[i.roots.length-1].index),h=0;h<c.length&&c[h].index===l.sibling();)i.appendRoot(c[h++],l);for(;h<c.length;){const e=c[h++];for(;e.index!==l.index;){if(2===l.factor)throw hs("Unexpected node: "+e.index);l.leftChild();}i.appendRoot(e,l),l.sibling();}return i.signature=is(t.signature),i.fork=e,null===r.extra}async function ks(e,t,s,i){if(!s)return t;const n=Jt$1.iterator(t);for(;0!=(1&n.index);){const t=await e.get(n.leftChild(),!1);if(!t)return n.parent(),n.index;{const e=Us(t,i,n);if(e===s)return n.index;if(e>s)continue;s-=e,n.sibling();}}return n.index}function ws(e,t,s,i){const n=Jt$1.iterator(t);for(i.seek=[],i.seek.push(e.get(n.index));n.index!==s;)n.sibling(),i.seek.push(e.get(n.index)),n.parent();}function xs(e,t,s,i,n,r){if(!t)return ws(e,i,n,r);const o=Jt$1.iterator(t.index);for(r.node=[],t.value||r.node.push(e.get(o.index));o.index!==n;)o.sibling(),s&&o.contains(i)&&o.index!==i?ws(e,i,o.index,r):r.node.push(e.get(o.index)),o.parent();}function vs(e){let t=0;for(const s of e)t+=s.size;return t}function Ls(e,t,s){return {index:t,size:s.byteLength,hash:e.data(s)}}function Ps(e,t,s,i){return {index:t,size:s.size+i.size,hash:e.parent(s,i)}}function Rs(e){return {index:e,size:0,hash:cs}}function Ss(e,t,s,i){return new Promise(((n,r)=>{e.read(40*t,40,((e,o)=>{if(e)return i?r(e):void n(null);const h=o.subarray(8),a=es$1.decode(es$1.uint64,o);if(0===a&&0===ss$1.compare(h,cs))return void(i?r(new Error("Could not load node: "+t)):n(null));const l={index:t,size:a,hash:h};null!==s&&(l.hash=is(h),s.set(t,l)),n(l);}));}))}function qs(e,t){for(const s of e.values())s.index>=2*t&&e.delete(s.index);}async function Bs(e,t,s,i,n){e.prologue&&n&&(n.start=n.start<e.prologue.length?0:n.start,n.length=n.start<e.prologue.length?e.prologue.length:n.length);const r=e.fork,o=e.signature,h=2*e.length,a=n?2*n.start:0,l=n?a+2*n.length:h,c=function(e,t){return e?{value:!0,index:2*e.index,nodes:e.nodes,lastIndex:e.index}:t?{value:!1,index:t.index,nodes:t.nodes,lastIndex:Jt$1.rightSpan(t.index)/2}:null}(t,s),u={fork:r,block:null,hash:null,seek:null,upgrade:null,manifest:null};if(0===h)return u;if(a>=l||l>h)throw hs("Invalid upgrade");if(i&&n&&null!==c&&c.index>=a)throw hs("Cannot both do a seek and block/hash request when upgrading");let d=h;const f={node:null,seek:null,upgrade:null,additionalUpgrade:null};if(null!==c&&(!n||c.lastIndex<n.start)){d=function(e,t,s){const i=Jt$1.iterator(e);for(let e=0;e<t;e++)if(i.parent(),i.contains(s))throw as("Nodes is out of bounds");return i.index}(c.index,c.nodes,l);const t=i?await async function(e,t,s,i){const n=await e.byteOffset(t)-(i?i*Jt$1.leftSpan(t)/2:0);if(n>s)throw hs("Invalid seek");if(n===s)return t;if(s-=n,Us(await e.get(t),i,null)<=s)throw hs("Invalid seek");return ks(e,t,s,i)}(e,d,i.bytes,i.padding):h;xs(e,c,i,t,d,f);}else (c||i)&&n&&(d=i?await async function(e,t,s,i){const n=Jt$1.fullRoots(t);for(let t=0;t<n.length;t++){const r=n[t],o=Us(await e.get(r),i,null);if(s===o)return r;if(!(s>o))return ks(e,r,s,i);s-=o;}return t}(e,l,i.bytes,i.padding):c.index);n&&(function(e,t,s,i,n,r,o){0===i&&(o.upgrade=[]);for(const h=Jt$1.iterator(0);h.fullRoot(n);h.nextTree())if(!(h.index+h.factor/2<i))if(null===o.upgrade&&h.contains(i-2)){o.upgrade=[];const n=h.index,a=i-2;for(h.seek(a);h.index!==n;)h.sibling(),h.index>a&&(null===o.node&&null===o.seek&&h.contains(r)?xs(e,t,s,r,h.index,o):o.upgrade.push(e.get(h.index))),h.parent();}else null===o.upgrade&&(o.upgrade=[]),null===o.node&&null===o.seek&&h.contains(r)?xs(e,t,s,r,h.index,o):o.upgrade.push(e.get(h.index));}(e,c,i,a,l,d,f),h>l&&function(e,t,s,i){0===t&&(i.additionalUpgrade=[]);for(const n=Jt$1.iterator(0);n.fullRoot(s);n.nextTree())if(!(n.index+n.factor/2<t))if(null===i.additionalUpgrade&&n.contains(t-2)){i.additionalUpgrade=[];const s=n.index,r=t-2;for(n.seek(r);n.index!==s;)n.sibling(),n.index>r&&i.additionalUpgrade.push(e.get(n.index)),n.parent();}else null===i.additionalUpgrade&&(i.additionalUpgrade=[]),i.additionalUpgrade.push(e.get(n.index));}(e,l,h,f));const[g,p,_,y]=await async function(e){const t=[e.node&&Promise.all(e.node),e.seek&&Promise.all(e.seek),e.upgrade&&Promise.all(e.upgrade),e.additionalUpgrade&&Promise.all(e.additionalUpgrade)];try{return await Promise.all(t)}catch(t){throw e.node&&await Promise.allSettled(e.node),e.seek&&await Promise.allSettled(e.seek),e.upgrade&&await Promise.allSettled(e.upgrade),e.additionalUpgrade&&await Promise.allSettled(e.additionalUpgrade),t}}(f);if(t){if(null===g)throw hs("Invalid block request");u.block={index:t.index,value:null,nodes:g};}else if(s){if(null===g)throw hs("Invalid hash request");u.hash={index:s.index,nodes:g};}return i&&null!==p&&(u.seek={bytes:i.bytes,nodes:p}),n&&(u.upgrade={start:n.start,length:n.length,nodes:_,additionalNodes:y||[],signature:o}),u}function Us(e,t,s){return 0===t?e.size:e.size-t*(s?s.countLeaves():Jt$1.countLeaves(e.index))}function Es(e){return null===e||(e.hash=is(e.hash)),e}const As=L$c,{WRITE_FAILED:Ms}=E$6;const Ds=i$5,Cs=L$c,Os=M$6.quickbit,Ns=32768,Is=4096,Fs=1024,Ts=2097152,Ks=262144,zs=65536,Hs=1024,Ws=64;class Vs{constructor(e,t){this.dirty=!1,this.index=e,this.offset=e*Is-t.offset,this.bitfield=null,this.segment=t,t.add(this);}get tree(){return this.segment.tree}get(e){return Os.get(this.bitfield,e)}set(e,t){Os.set(this.bitfield,e,t)&&this.tree.update(8*this.offset+e);}setRange(e,t,s){Os.fill(this.bitfield,s,e,e+t);let i=Math.floor(e/128);const n=i+Math.ceil(t/128);for(;i<=n;)this.tree.update(8*this.offset+128*i++);}findFirst(e,t){return Os.findFirst(this.bitfield,e,t)}findLast(e,t){return Os.findLast(this.bitfield,e,t)}count(e,t,s){const i=e+t;let n=e,r=0;for(;t>0;){const e=this.findFirst(s,n);if(-1===e||e>=i)return r;const o=this.findFirst(!s,e+1);if(-1===o||o>=i)return r+i-e;r+=o-e,t-=o-n,n=o;}return r}}class Gs{constructor(e,t){this.index=e,this.offset=e*Ks,this.tree=Os.Index.from(t,Ks),this.pages=new Array(Ws);}get bitfield(){return this.tree.field}add(e){const t=e.index-this.index*Ws;this.pages[t]=e;const s=t*Fs,i=s+Fs;i>=this.bitfield.length&&this.reallocate(i),e.bitfield=this.bitfield.subarray(s,i);}reallocate(e){let t=this.bitfield.length;for(;t<e;)t*=4;const s=new Uint32Array(t);s.set(this.bitfield),this.tree=Os.Index.from(s,Ks);for(let e=0;e<this.pages.length;e++){const t=this.pages[e];if(!t)continue;const i=e*Fs,n=i+Fs;t.bitfield=s.subarray(i,n);}}findFirst(e,t){let s=32767&(t=this.tree.skipFirst(!e,t)),i=(t-s)/Ns;if(i>=Ws)return -1;for(;i<this.pages.length;){const t=this.pages[i];let n=-1;if(t?n=t.findFirst(e,s):e||(n=s),-1!==n)return i*Ns+n;s=0,i++;}return -1}findLast(e,t){let s=32767&(t=this.tree.skipLast(!e,t)),i=(t-s)/Ns;if(i>=Ws)return -1;for(;i>=0;){const t=this.pages[i];let n=-1;if(t?n=t.findLast(e,s):e||(n=s),-1!==n)return i*Ns+n;s=32767,i--;}return -1}}function Qs(e,t=1){const s=e%t;return 0===s?e:e+t-s}var js=class e{constructor(e={}){this.key=e.key,this.discoveryKey=e.discoveryKey,this.length=e.length||0,this.contiguousLength=e.contiguousLength||0,this.byteLength=e.byteLength||0,this.fork=e.fork||0,this.padding=e.padding||0,this.storage=e.storage||null;}static async from(t,s={}){return new e({key:t.key,discoveryKey:t.discoveryKey,length:t.length,contiguousLength:t.contiguousLength,byteLength:t.byteLength,fork:t.fork,padding:t.padding,storage:s.storage?await this.storage(t):null})}static async storage(t){const{oplog:s,tree:i,blocks:n,bitfield:r}=t.core;try{return {oplog:await e.bytesUsed(s.storage),tree:await e.bytesUsed(i.storage),blocks:await e.bytesUsed(n.storage),bitfield:await e.bytesUsed(r.storage)}}catch{return null}}static bytesUsed(e){return new Promise(((t,s)=>{e.stat(((e,i)=>{e?t(0):"number"!=typeof i.blocks?s(new Error("cannot determine bytes used")):t(512*i.blocks);}));}))}};const Ys=t$g,Xs=L$c,Zs=t$8,{multiSignature:Js,multiSignaturev0:$s}=V$4;var ei={assemblev0:function(e){const t=[],s=[];for(const r of e)t.push((n=s,{signer:(i=r).signer,signature:i.signature,patch:i.patch?si(i,n):null}));var i,n;return Ys.encode($s,{proofs:t,patch:s})},assemble:function(e){const t=[],s=[],i=new Set;for(const n of e){if(n.nodes)for(const e of n.nodes)i.has(e.index)||(i.add(e.index),s.push(e));t.push({signer:n.signer,signature:n.signature,patch:n.patch});}return Ys.encode(Js,{proofs:t,patch:s})},inflatev0:function(e){return Ys.decode($s,e)},inflate:function(e){return Ys.decode(Js,e)},partialSignature:async function(e,t,s,i=e.length,n=e.signature){if(s>e.length)return null;const r=i<=s?null:await async function(e,t,s){const i=await e.proof({upgrade:{start:t,length:s-t}});return i.upgrade.nodes}(e,s,i);64!==n.byteLength&&(n=Ys.decode(Js,n).proofs[0].signature);return {signer:t,signature:n,patch:r?i-s:0,nodes:r}},signableLength:function(e,t){t<=0&&(t=1);return t>e.length?0:e.sort(ti)[t-1]}};function ti(e,t){return t-e}function si(e,t){const s={start:Zs.rightSpan(e.nodes[e.nodes.length-1].index)/2+1,length:e.patch,nodes:[]};for(const r of e.nodes){let e=!1;for(let o=0;o<t.length;o++)if(i=t[o],n=r,i.index===n.index&&i.size===n.size&&Xs.equals(i.hash,n.hash)){s.nodes.push(o),e=!0;break}e||s.nodes.push(t.push(r)-1);}var i,n;return s}const ii=o$e,ni=L$c,ri=t$g,oi=t$8,{BAD_ARGUMENT:hi}=E$6,ai=n$a,li=V$4,ci=ei,ui=G$4;class di{constructor(e,t,s,i,{signature:n="ed25519",publicKey:r,namespace:o=ui.DEFAULT_NAMESPACE}={}){if(!r)throw hi("public key is required for a signer");if("ed25519"!==n)throw hi("Only Ed25519 signatures are supported");this.crypto=e,this.manifestHash=t,this.version=s,this.signer=i,this.signature=n,this.publicKey=r,this.namespace=o;}_ctx(){return 0===this.version?this.namespace:this.manifestHash}verify(e,t){return this.crypto.verify(e.signable(this._ctx()),t,this.publicKey)}sign(e,t){return this.crypto.sign(e.signable(this._ctx()),t.secretKey)}}class fi extends di{constructor(e,t,s,i){super(e,null,0,t,s),this.legacy=i;}verify(e,t){return this.crypto.verify(e.signableCompat(this.legacy),t,this.publicKey)}sign(e,t){return this.crypto.sign(e.signableCompat(this.legacy),t.secretKey)}}var gi=class e{constructor(e,t,{compat:s=pi(e,t),crypto:i=ii,legacy:n=!1}={}){const r=this;this.manifestHash=e,this.compat=s||null===t,this.version=this.compat?0:"number"==typeof t.version?t.version:1,this.hash=t.hash||"blake2b",this.allowPatch=!this.compat&&!!t.allowPatch,this.quorum=this.compat?1:_i(t),this.signers=t.signers?t.signers.map((function(t,s){return r.compat?new fi(i,s,t,n):new di(i,e,r.version,s,t)})):[],this.prologue=this.compat?null:t.prologue||null;}_verifyCompat(e,t){return !!t&&(this.compat||!this.allowPatch&&1===this.signers.length?!!t&&this.signers[0].verify(e,t):this._verifyMulti(e,t))}_inflate(e){if(this.version>=1)return ci.inflate(e);const{proofs:t,patch:s}=ci.inflatev0(e);return {proofs:t.map(ki),patch:s}}_verifyMulti(e,t){if(!t||0===this.quorum)return !1;const{proofs:s,patch:i}=this._inflate(t);if(s.length<this.quorum)return !1;const n=new Uint8Array(this.signers.length),r=this.allowPatch&&i.length?function(e){const t=new Map;for(const s of e)t.set(s.index,s);return t}(i):null;for(let t=0;t<this.quorum;t++){const i=s[t];let o=e;if(i.patch&&this.allowPatch){o=e.clone();const t=yi(r,e.length,i.patch),s={fork:o.fork,block:null,hash:null,seek:null,upgrade:t,manifest:null};try{if(!o.verifyUpgrade(s))return !1}catch{return !1}}if(i.signer>=this.signers.length||n[i.signer])return !1;n[i.signer]=1;if(!this.signers[i.signer].verify(o,i.signature))return !1}return !0}verify(e,t){return 1!==this.version?this._verifyCompat(e,t):null!==this.prologue&&e.length<=this.prologue.length?e.length===this.prologue.length&&ni.equals(e.hash(),this.prologue.hash):this._verifyMulti(e,t)}sign(e,t){if(!t||!t.secretKey)throw hi("No key pair was passed");for(const s of this.signers)if(ni.equals(s.publicKey,t.publicKey)){const i=s.sign(e,t);return 1!==this.signers.length||0===this.version?i:this.assemble([{signer:0,signature:i,patch:0,nodes:null}])}throw new hi("Public key is not a declared signer")}assemble(e){return 0===this.version?ci.assemblev0(e):ci.assemble(e)}static manifestHash(e){return bi(e)}static defaultSignerManifest(e){return {version:1,hash:"blake2b",allowPatch:!1,quorum:1,signers:[{signature:"ed25519",namespace:ui.DEFAULT_NAMESPACE,publicKey:e}],prologue:null}}static fromManifest(e,t){const s=this.createManifest(e);return new this(bi(s),s,t)}static createManifest(e){if(!e)return null;const t={version:"number"==typeof e.version?e.version:1,hash:"blake2b",allowPatch:!!e.allowPatch,quorum:_i(e),signers:e.signers?e.signers.map(mi):[],prologue:null};if(e.hash&&"blake2b"!==e.hash)throw hi("Only Blake2b hashes are supported");if(e.prologue){if(!(ni.isBuffer(e.prologue.hash)&&32===e.prologue.hash.byteLength&&e.prologue.length>=0))throw hi("Invalid prologue");t.prologue=e.prologue,t.prologue.hash=ai(t.prologue.hash);}return t}static isValidManifest(e,t){return ni.equals(e,bi(t))}static isCompat(e,t){return pi(e,t)}static sign(t,s,i,n){return e.fromManifest(t,n).sign(s,i)}};function pi(e,t){return !(!t||1!==t.signers.length||!ni.equals(e,t.signers[0].publicKey))}function _i(e){return "number"==typeof e.quorum?e.quorum:e.signers&&e.signers.length?1+(e.signers.length>>1):0}function yi(e,t,s){const i={start:t,length:s,nodes:null,additionalNodes:[],signature:null},n=2*t,r=n+2*s;for(const t=oi.iterator(0);t.fullRoot(r);t.nextTree())if(!(t.index+t.factor/2<n))if(null===i.nodes&&t.contains(n-2)){i.nodes=[];const s=t.index,r=n-2;for(t.seek(r);t.index!==s;)t.sibling(),t.index>r&&i.nodes.push(e.get(t.index)),t.parent();}else null===i.nodes&&(i.nodes=[]),i.nodes.push(e.get(t.index));return null===i.nodes&&(i.nodes=[]),i}function mi(e){return function(e){if(!e||!e.publicKey)throw hi("Signer missing public key");if(e.signature&&"ed25519"!==e.signature)throw hi("Only Ed25519 signatures are supported")}(e),{signature:"ed25519",namespace:ai(e.namespace||ui.DEFAULT_NAMESPACE),publicKey:ai(e.publicKey)}}function bi(e){const t={start:0,end:32,buffer:null};return li.manifest.preencode(t,e),t.buffer=ni.allocUnsafe(t.end),ri.raw.encode(t,ui.MANIFEST),li.manifest.encode(t,e),ii.hash(t.buffer)}function ki(e){return {signer:e.signer,signature:e.signature,patch:e.patch?e.patch.length:0}}const wi=o$e,xi=t$8,vi=t$g,Li=L$c;function Pi(e){return new Promise(((t,s)=>{e.stat(((i,n)=>{if(!n)return t(Li.alloc(0));e.read(0,n.size,((e,i)=>{e?s(e):t(i);}));}));}))}const Ri=o$e,Si=L$c,qi=n$a,Bi=class{constructor(e,{pageSize:t=4096,headerEncoding:s=Wt$1.raw,entryEncoding:i=Wt$1.raw,readonly:n=!1}={}){this.storage=e,this.headerEncoding=s,this.entryEncoding=i,this.readonly=n,this.flushed=!1,this.byteLength=0,this.length=0,this._headers=[1,0],this._pageSize=t,this._entryOffset=2*t;}_addHeader(e,t,s,i){e.start=e.start-t-4,Wt$1.uint32.encode(e,t<<2|s|i),e.start-=8,Wt$1.uint32.encode(e,Gt$1(e.buffer.subarray(e.start+4,e.start+8+t))),e.start+=t+4;}_decodeEntry(e,t){if(e.end-e.start<8)return null;const s=Wt$1.uint32.decode(e),i=Wt$1.uint32.decode(e),n=i>>>2,r=1&i,o=2&i;if(e.end-e.start<n)return null;const h=e.start+n;if(Gt$1(e.buffer.subarray(e.start-4,h))!==s)return null;const a={header:r,partial:0!==o,byteLength:n+8,message:null};try{a.message=t.decode({start:e.start,end:h,buffer:e.buffer});}catch{return null}return e.start=h,a}async open(){const e=await this._readAll(),t={start:0,end:e.byteLength,buffer:e},s={header:null,entries:[]};this.byteLength=0,this.length=0;const i=this._decodeEntry(t,this.headerEncoding);t.start=this._pageSize;const n=this._decodeEntry(t,this.headerEncoding);if(t.start=this._entryOffset,!i&&!n){if(this.flushed=!1,this._headers[0]=1,this._headers[1]=0,e.byteLength>=this._entryOffset)throw Qt$1();return s}this.flushed=!0,i&&!n?(this._headers[0]=i.header,this._headers[1]=i.header):!i&&n?(this._headers[0]=n.header+1&1,this._headers[1]=n.header):(this._headers[0]=i.header,this._headers[1]=n.header);const r=this._headers[0]+this._headers[1]&1,o=[];for(s.header=r?n.message:i.message;;){const e=this._decodeEntry(t,this.entryEncoding);if(!e)break;if(e.header!==r)break;o.push(e);}for(;o.length>0&&o[o.length-1].partial;)o.pop();for(const e of o)s.entries.push(e.message),this.byteLength+=e.byteLength,this.length++;const h=this.byteLength+this._entryOffset;return h===e.byteLength||await new Promise(((e,t)=>{if(this.readonly)return e();this.storage.truncate(h,(s=>{if(s)return t(s);e();}));})),s}_readAll(){return new Promise(((e,t)=>{this.storage.open((s=>s&&"ENOENT"!==s.code?t(s):s?e(Vt$1.alloc(0)):void this.storage.stat(((s,i)=>{if(s&&"ENOENT"!==s.code)return t(s);this.storage.read(0,i.size,((s,i)=>{if(s)return t(s);e(i);}));}))));}))}flush(e){const t={start:8,end:8,buffer:null},s=this._headers[0]===this._headers[1]?1:0,i=this._headers[s]+1&1;if(this.headerEncoding.preencode(t,e),t.end>this._pageSize)throw jt$1();return t.buffer=Vt$1.allocUnsafe(t.end),this.headerEncoding.encode(t,e),this._addHeader(t,t.end-8,i,0),this._writeHeaderAndTruncate(s,i,t.buffer)}_writeHeaderAndTruncate(e,t,s){return new Promise(((i,n)=>{this.storage.write(0===e?0:this._pageSize,s,(s=>{if(s)return n(s);this.storage.truncate(this._entryOffset,(s=>{if(s)return n(s);this._headers[e]=t,this.byteLength=0,this.length=0,this.flushed=!0,i();}));}));}))}append(e,t=!0){Array.isArray(e)||(e=[e]);const s={start:0,end:8*e.length,buffer:null},i=this._headers[0]+this._headers[1]&1;for(let t=0;t<e.length;t++)this.entryEncoding.preencode(s,e[t]);s.buffer=Vt$1.allocUnsafe(s.end);for(let n=0;n<e.length;n++){const r=s.start+=8,o=t&&n<e.length-1?2:0;this.entryEncoding.encode(s,e[n]),this._addHeader(s,s.start-r,i,o);}return this._append(s.buffer,e.length)}close(){return new Promise(((e,t)=>{this.storage.close((s=>{if(s)return t(s);e();}));}))}_append(e,t){return new Promise(((s,i)=>{this.storage.write(this._entryOffset+this.byteLength,e,(n=>{if(n)return i(Yt$1(n.message));this.byteLength+=e.byteLength,this.length+=t,s();}));}))}},Ui=class{constructor(e){this.storage=e;}async load(e){const t=await new Promise(((t,s)=>{this.storage.read(e.start,e.length,((e,i)=>{if(e)return s(e);t(i);}));})),s=Xt$1.decode(Zt$1.header,t);return s.external=e,s}async flush(e){const t=e.external||{start:0,length:0};e.external=null;const s=Xt$1.encode(Zt$1.header,e);let i=0;if(s.byteLength>t.start){i=t.start+t.length;const e=4095&i;e>0&&(i+=4096-e);}return e.external={start:i,length:s.byteLength},await new Promise(((e,t)=>{this.storage.write(i,s,(s=>{if(s)return t(s);e();}));})),e}close(){return new Promise(((e,t)=>{this.storage.close((s=>{if(s)return t(s);e();}));}))}},Ei=class{constructor(){this.locked=!1,this.destroyed=!1,this._destroying=null,this._destroyError=null,this._queue=[],this._enqueue=(e,t)=>this._queue.push([e,t]);}lock(){return this.destroyed?Promise.reject(this._destroyError||new Error("Mutex has been destroyed")):this.locked?new Promise(this._enqueue):(this.locked=!0,Promise.resolve())}unlock(){this._queue.length?this._queue.shift()[0]():this.locked=!1;}destroy(e){if(this._destroying||(this._destroying=this.locked?this.lock().catch((()=>{})):Promise.resolve()),this.destroyed=!0,e&&(this._destroyError=e),e)for(;this._queue.length;)this._queue.shift()[1](e);return this._destroying}},Ai=class e{constructor(e,t,s,i,n){this.crypto=$t$1,this.fork=s,this.roots=t,this.length=t.length?function(e){let t=0;for(const s of e)t+=2*(s.index-t+1);return t}(t)/2:0,this.byteLength=vs(t),this.signature=i,this.prologue=n,this.storage=e,this.unflushed=new Map,this.cache=new ts$1({maxSize:128}),this.flushing=null,this.truncated=!1,this.truncateTo=0;}addNode(e){0===e.size&&ss$1.equals(e.hash,cs)&&(e=Rs(e.index)),this.unflushed.set(e.index,e);}batch(){return new fs(this)}async restoreBatch(e){const t=new fs(this);if(e===this.length)return t;const s=function(e){for(const t of e)Es(t);return e}(await this.getRoots(e));t.roots=s,t.length=e,t.byteLength=0,t.ancestors=e;for(const e of s)t.byteLength+=e.size;return t}seek(e,t){return new ps(this,e,t)}hash(){return is(this.crypto.tree(this.roots))}signable(e){return ns.treeSignable(e,this.hash(),this.length,this.fork)}getRoots(e){const t=Jt$1.fullRoots(2*e),s=new Array(t.length);for(let e=0;e<t.length;e++)s[e]=this.get(t[e],!0);return Promise.all(s)}setPrologue({hash:e,length:t}){this.prologue={hash:e,length:t};}addNodes(e){for(let t=0;t<e.length;t++){const s=e[t];this.unflushed.set(s.index,s);}}getNeededNodes(e,t,s){const i=new Map,n=2*e;for(let e=t;e<s;e++){const t=Jt$1.iterator(2*e);for(;!i.has(t.index);){i.set(t.index,this.get(t.index,!0));const e=t.sibling();if(t.parent(),t.contains(n))break;if(i.has(e))break;i.set(e,this.get(e,!0));}}return Promise.all([...i.values()])}async upgradeable(e){const t=Jt$1.fullRoots(2*e),s=new Array(t.length);for(let e=0;e<t.length;e++)s[e]=this.get(t[e],!1);for(const e of await Promise.all(s))if(null===e)return !1;return !0}blankNode(e){return Rs(e)}get(e,t=!0){const s=this.cache.get(e);if(s)return s;let i=this.unflushed.get(e);if(null!==this.flushing&&void 0===i&&(i=this.flushing.get(e)),this.truncated&&void 0!==i&&i.index>=2*this.truncateTo&&(i=Rs(e)),void 0!==i){if(i.hash===cs){if(t)throw hs("Could not load node: "+e);return Promise.resolve(null)}return Promise.resolve(i)}return Ss(this.storage,e,this.cache,t)}async flush(){this.flushing=this.unflushed,this.unflushed=new Map;try{this.truncated&&await this._flushTruncation(),await this._flushNodes();}catch(e){for(const e of this.flushing.values())this.unflushed.has(e.index)||this.unflushed.set(e.index,e);throw e}finally{this.flushing=null;}}_flushTruncation(){return new Promise(((e,t)=>{const s=this.truncateTo,i=0===s?0:80*(s-1)+40;this.storage.truncate(i,(i=>{if(i)return t(i);this.truncateTo===s&&(this.truncateTo=0,this.truncated=!1),e();}));}))}_flushNodes(){return new Promise(((e,t)=>{const s=ss$1.allocUnsafe(40*this.flushing.size);let i=null,n=this.flushing.size+1,r=0;for(const e of this.flushing.values()){const t={start:0,end:40,buffer:s.subarray(r,r+=40)};es$1.uint64.encode(t,e.size),es$1.raw.encode(t,e.hash),this.storage.write(40*e.index,t.buffer,o);}function o(s){s&&(i=s),--n>0||(i?t(i):e());}o(null);}))}clear(){return this.cache=new ts$1({maxSize:this.cache.maxSize}),this.truncated=!0,this.truncateTo=0,this.roots=[],this.length=0,this.byteLength=0,this.fork=0,this.signature=null,null!==this.flushing&&this.flushing.clear(),this.unflushed.clear(),this.flush()}close(){return new Promise(((e,t)=>{this.storage.close((s=>{s?t(s):e();}));}))}async truncate(e,t=this.fork){const s=2*e,i=new fs(this),n=Jt$1.fullRoots(s);for(let e=0;e<n.length;e++){const t=n[e];if(!(e<i.roots.length&&i.roots[e].index===t)){for(;i.roots.length>e;)i.roots.pop();i.roots.push(Es(await this.get(t)));}}for(;i.roots.length>n.length;)i.roots.pop();return i.fork=t,i.length=e,i.ancestors=e,i.byteLength=vs(i.roots),i.upgraded=!0,i}async reorg(e){const t=new gs(this);let s=null;if((e.block||e.hash||e.seek)&&(s=ms(e,this.crypto,t.nodes)),!bs(e,s,t))throw rs("Fork proof not verifiable");for(const e of t.roots){const s=await this.get(e.index,!1);if(!s||!ss$1.equals(s.hash,e.hash)){t._updateDiffRoot(e);break}}return null!==t.diff?await t._update(t.nodes):(t.want=null,t.ancestors=t.length),t}verifyFullyRemote(e){const t=new fs(this);t.fork=e.fork,t.roots=[],t.length=0,t.ancestors=0,t.byteLength=0;let s=ms(e,this.crypto,t.nodes);return e.upgrade&&bs(e,s,t)&&(s=null),t}async verify(e){const t=new fs(this);let s=ms(e,this.crypto,t.nodes);if(e.upgrade&&bs(e,s,t)&&(s=null),s){const e=await this.get(s.index);if(!ss$1.equals(e.hash,s.hash))throw os("Invalid checksum at node "+s.index)}return t}proof({block:e,hash:t,seek:s,upgrade:i}){return Bs(this,e,t,s,i)}async missingNodes(e){const t=2*this.length,s=Jt$1.iterator(e);if(s.index+s.factor/2-1>=t)return 0;let i=0;for(;!s.contains(t)&&null===await this.get(s.index,!1);)i++,s.parent();return i}async nodes(e){const t=2*this.length,s=Jt$1.iterator(e);let i=0;for(;!s.contains(t)&&null===await this.get(s.index,!1);)i++,s.parent();return i}byteRange(e){return _s(this,e)}byteOffset(e){return ys(this,e)}static async open(t,s={}){await new Promise(((e,s)=>{t.read(0,us.length,((t,i)=>t?e():ss$1.equals(i,us)?s(new Error("Storage contains an incompatible merkle tree")):void e()));}));const i="number"==typeof s.length?s.length:await async function(e){const t=await function(e){return new Promise((t=>{e.stat(((e,s)=>{if(!s)return t(0);t((s.size-s.size%40)/40);}));}))}(e);if(!t)return 0;const s=Jt$1.iterator(t-1);let i=t-1;for(;await Ss(e,s.parent(),null,!1);)i=s.index;return Jt$1.rightSpan(i)/2+1}(t),n=[];for(const e of Jt$1.fullRoots(2*i))n.push(Es(await Ss(t,e,null,!0)));return new e(t,n,s.fork||0,s.signature||null,s.prologue||null)}},Mi=class{constructor(e,t){this.storage=e,this.tree=t;}async get(e,t){t||(t=this.tree);const[s,i]=await t.byteRange(2*e);return this._read(s,i)}async put(e,t,s){return this._write(s,t)}putBatch(e,t,s){return 0===t.length?Promise.resolve():this.put(e,1===t.length?t[0]:As.concat(t),s)}clear(e=0,t=-1){return new Promise(((s,i)=>{function n(e){e?i(e):s();}-1===t?this.storage.truncate(e,n):this.storage.del(e,t,n);}))}close(){return new Promise(((e,t)=>{this.storage.close((s=>{s?t(s):e();}));}))}_read(e,t){return new Promise(((s,i)=>{this.storage.read(e,t,((e,t)=>{e?i(e):s(t);}));}))}_write(e,t){return new Promise(((s,i)=>{this.storage.write(e,t,(n=>{n?i(Ms(n.message)):s(e+t.byteLength);}));}))}},Di=class e{constructor(e,t){this.unflushed=[],this.storage=e,this.resumed=!!(t&&t.byteLength>=4),this._pages=new Ds,this._segments=new Ds;const s=this.resumed?new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4)):new Uint32Array(Hs);for(let e=0;e<s.length;e+=zs){let t=s.subarray(e,e+zs),i=zs;if(0===e)for(i=Hs;i<t.length;)i*=4;if(t.length!==i){const e=new Uint32Array(i);e.set(t,0),t=e;}const n=new Gs(e/zs,t);this._segments.set(n.index,n);for(let s=0;s<t.length;s+=Fs){const t=new Vs((e+s)/Fs,n);this._pages.set(t.index,t);}}}toBuffer(e){const t=Math.ceil(e/Ns),s=Cs.allocUnsafe(t*Is);for(let e=0;e<t;e++){const t=this._pages.get(e),i=e*Is;if(t){const e=Cs.from(t.bitfield.buffer,t.bitfield.byteOffset,t.bitfield.byteLength);s.set(e,i);}else s.fill(0,i,i+Is);}return s}getBitfield(e){const t=(e-(32767&e))/Ns;return this._pages.get(t)||null}get(e){const t=32767&e,s=(e-t)/Ns,i=this._pages.get(s);return !!i&&i.get(t)}set(e,t){const s=32767&e,i=(e-s)/Ns;let n=this._pages.get(i);if(!n&&t){const e=Math.floor(i/Ws),t=this._segments.get(e)||this._segments.set(e,new Gs(e,new Uint32Array(0===e?Hs:zs)));n=this._pages.set(i,new Vs(i,t));}n&&(n.set(s,t),n.dirty||(n.dirty=!0,this.unflushed.push(n)));}setRange(e,t,s){let i=32767&e,n=(e-i)/Ns;for(;t>0;){let e=this._pages.get(n);if(!e&&s){const t=Math.floor(n/Ws),s=this._segments.get(t)||this._segments.set(t,new Gs(t,new Uint32Array(0===t?Hs:zs)));e=this._pages.set(n,new Vs(n,s));}const r=Math.min(i+t,Ns)-i;e&&(e.setRange(i,r,s),e.dirty||(e.dirty=!0,this.unflushed.push(e))),i=0,n++,t-=r;}}findFirst(e,t){let s=2097151&t,i=(t-s)/Ts;for(;i<this._segments.maxLength;){const t=this._segments.get(i);let n=-1;if(t?n=t.findFirst(e,s):e||(n=s),-1!==n)return i*Ts+n;s=0,i++;}return e?-1:this._segments.maxLength*Ts}firstSet(e){return this.findFirst(!0,e)}firstUnset(e){return this.findFirst(!1,e)}findLast(e,t){let s=2097151&t,i=(t-s)/Ts;for(;i>=0;){const t=this._segments.get(i);let n=-1;if(t?n=t.findLast(e,s):e||(n=s),-1!==n)return i*Ts+n;s=2097151,i--;}return -1}lastSet(e){return this.findLast(!0,e)}lastUnset(e){return this.findLast(!1,e)}count(e,t,s){let i=32767&e,n=(e-i)/Ns,r=0;for(;t>0;){const e=this._pages.get(n),o=Math.min(i+t,Ns)-i;e?r+=e.count(i,o,s):s||(r+=o),i=0,n++,t-=o;}return r}countSet(e,t){return this.count(e,t,!0)}countUnset(e,t){return this.count(e,t,!1)}*want(e,t){let s=(e-(2097151&e))/Ts;for(;t>0;){const e=this._segments.get(s);if(e){const o=Qs((i=t/8,n=4096,r=Ks,Math.min(Math.max(i,n),r)),4096);yield {start:s*Ts,bitfield:e.bitfield.subarray(0,o/4)};}s++,t-=Ts;}var i,n,r;}clear(){return new Promise(((e,t)=>{this.storage.truncate(0,(s=>{if(s)return t(s);this._pages=new Ds,this.unflushed=[],e();}));}))}close(){return new Promise(((e,t)=>{this.storage.close((s=>{s?t(s):e();}));}))}flush(){return new Promise(((e,t)=>{if(!this.unflushed.length)return e();const s=this;let i=this.unflushed.length,n=null;for(const e of this.unflushed){const t=Cs.from(e.bitfield.buffer,e.bitfield.byteOffset,e.bitfield.byteLength);e.dirty=!1,this.storage.write(e.index*Is,t,r);}function r(r){if(r&&(n=r),! --i){if(n)return t(n);s.unflushed=[],e();}}}))}static open(t,s=null){return new Promise(((i,n)=>{t.stat(((r,o)=>{if(r)return i(new e(t,null));let h=o.size-(3&o.size);if(!h)return i(new e(t,null));s&&(h=Math.min(h,Qs(s.length/8,4096))),t.read(0,h,((s,r)=>{if(s)return n(s);i(new e(t,r));}));}));}))}},Ci=W$4,Oi=js,{BAD_ARGUMENT:Ni,STORAGE_EMPTY:Ii,STORAGE_CONFLICT:Fi,INVALID_OPERATION:Ti,INVALID_SIGNATURE:Ki,INVALID_CHECKSUM:zi}=E$6,Hi=V$4,Wi=gi,Vi=async function(e){const t={tree:0,blocks:0},s=e.header.tree.length,i=await Pi(e.blocks.storage),n=await Pi(e.tree.storage),r=new Uint8Array(Math.ceil(n.byteLength/40)),o=[];for(const t of e.tree.roots)r[t.index]=1,o.push(t);for(;o.length>0;){const e=o.pop();if(0==(1&e.index))continue;const[t,s]=xi.children(e.index),i=l(t),n=l(s);if(o.push(i,n),r[e.index]){const t=wi.parent(i,n);if(Li.equals(t,e.hash)&&e.size===i.size+n.size){r[i.index]=1,r[n.index]=1;continue}}i.size&&c(i),n.size&&c(n);}t.tree&&e.tree.cache.clear();let h=0,a=-1;for(;h<s;){if(!e.bitfield.get(h)){if(h+1===s)break;if(h=e.bitfield.findFirst(!0,h+1),h<0)break;a=-1;continue}if(-1===a)try{a=await e.tree.byteOffset(2*h);}catch{e._setBitfield(h,!1),t.blocks++,h++;continue}const n=l(2*h),r=i.subarray(a,a+n.size),o=wi.data(r);a+=r.byteLength,Li.equals(o,n.hash)||(e._setBitfield(h,!1),t.blocks++),h++;}return t;function l(e){const t={start:40*e,end:40*e+40,buffer:n};return {index:e,size:vi.uint64.decode(t),hash:vi.fixed32.decode(t)}}function c(s){r[s.index]=0,s.size&&(Li.fill(n,0,40*s.index,40*s.index+40),e.tree.unflushed.set(s.index,e.tree.blankNode(s.index)),t.tree++);}},{createTracer:Gi}=r$c;function Qi(e,t,s){const i=t.start+t.length;let n=e.hints.contiguousLength;if(t.drop)n<=i&&n>t.start&&(n=t.start);else if(n<=i&&n>=t.start)for(n=i;s.get(n);)n++;return n===e.hints.contiguousLength?0:n>e.hints.contiguousLength?(e.hints.contiguousLength=n,4):(e.hints.contiguousLength=n,8)}function ji(e,t,s){if(0!==t.length&&t.fork!==s.fork){for(;e.length>=4;)e.shift();for(;e.length>0&&e[e.length-1].ancestors>s.ancestors;)e.pop();e.push({from:t.fork,to:s.fork,ancestors:s.ancestors});}}function Yi(e,t,s){s=qi(s);for(let i=0;i<e.length;i++)if(e[i].key===t)return void(s?e[i].value=s:e.splice(i,1));s&&e.push({key:t,value:s});}async function Xi(e,t,s){s.external&&await t.flush(s);try{await e.flush(s);}catch(i){if("OPLOG_HEADER_OVERFLOW"!==i.code)throw i;await t.flush(s),await e.flush(s);}}function Zi(){}function Ji(e,t,s){for(;;){const i=t.firstSet(e),n=s.firstUnset(e);if(-1===i)return -1;if(-1===n)return i;if(!(i<n))return i;e=n;}}function $i(e,t,s){const i=t.firstUnset(e),n=s.firstSet(e);return -1===i?-1:-1===n||i<n?i:n}const en=m$a,tn=t$g,sn=L$c,{BLOCK_ENCRYPTION:nn}=G$4,rn=sn.alloc(en.crypto_stream_NONCEBYTES);function on(){}const{BLOCK_NOT_AVAILABLE:hn,SESSION_CLOSED:an}=E$6,ln=E$4,cn=t$g,un=L$c,dn=r$u;var fn={};const{Writable:gn,Readable:pn}=qt$2;fn.ReadStream=class extends pn{constructor(e,t={}){super(),this.core=e,this.start=t.start||0,this.end="number"==typeof t.end?t.end:-1,this.snapshot=!t.live&&!1!==t.snapshot,this.live=!!t.live;}_open(e){this._openP().then(e,e);}_read(e){this._readP().then(e,e);}async _openP(){-1===this.end?await this.core.update():await this.core.ready(),this.snapshot&&-1===this.end&&(this.end=this.core.length);}async _readP(){const e=this.live?-1:-1===this.end?this.core.length:this.end;e>=0&&this.start>=e?this.push(null):this.push(await this.core.get(this.start++));}};fn.WriteStream=class extends gn{constructor(e){super(),this.core=e;}_writev(e,t){this._writevP(e).then(t,t);}async _writevP(e){await this.core.append(e);}};fn.ByteStream=class extends pn{constructor(e,t={}){super(),this._core=e,this._index=0,this._range=null,this._byteOffset=t.byteOffset||0,this._byteLength="number"==typeof t.byteLength?t.byteLength:-1,this._prefetch="number"==typeof t.prefetch?t.prefetch:32,this._applyOffset=this._byteOffset>0;}_open(e){this._openp().then(e,e);}_read(e){this._readp().then(e,e);}async _openp(){-1===this._byteLength&&(await this._core.update(),this._byteLength=Math.max(this._core.byteLength-this._byteOffset,0));}async _readp(){let e=null;if(0===this._byteLength)return void this.push(null);let t=0;if(this._applyOffset){this._applyOffset=!1;const[e,s]=await this._core.seek(this._byteOffset);this._index=e,t=s;}this._predownload(this._index+1),e=await this._core.get(this._index++,{valueEncoding:"binary"}),t>0&&(e=e.subarray(t)),e.byteLength>this._byteLength&&(e=e.subarray(0,this._byteLength)),this._byteLength-=e.byteLength,this.push(e),0===this._byteLength&&this.push(null);}_predownload(e){this._range&&this._range.destroy(),this._range=this._core.download({start:e,end:e+this._prefetch,linear:!0});}_destroy(e){this._range&&this._range.destroy(),e(null);}};const{EventEmitter:_n}=E$4,yn=r$q,mn=o$o,bn=o$e,kn=t$g,wn=L$c,xn=t$f,vn=O$6,Ln=_$5,Pn=r$t,Rn=o$q,Sn=r$u,{createTracer:qn}=r$c,Bn=n$a,Un=class{static Peer=bt$1;constructor(e,t,{notDownloadingLinger:s=ht$1,eagerUpgrade:i=!0,allowFork:n=!0,inflightRange:r=null,onpeerupdate:o=wt$1,onupload:h=wt$1,oninvalid:a=wt$1}={}){this.tracer=nt$1(this),this.key=t,this.discoveryKey=e.crypto.discoveryKey(t),this.core=e,this.eagerUpgrade=i,this.allowFork=n,this.onpeerupdate=o,this.onupload=h,this.oninvalid=a,this.ondownloading=null,this.peers=[],this.findingPeers=0,this.destroyed=!1,this.downloading=!1,this.activeSessions=0,this.inflightRange=r||rt$1,this.stats={wireSync:{tx:0,rx:0},wireRequest:{tx:0,rx:0},wireCancel:{tx:0,rx:0},wireData:{tx:0,rx:0},wireWant:{tx:0,rx:0},wireBitfield:{tx:0,rx:0},wireRange:{tx:0,rx:0},wireExtension:{tx:0,rx:0}},this._attached=new Set,this._inflight=new _t$1,this._blocks=new yt$1,this._hashes=new yt$1,this._queued=[],this._seeks=[],this._upgrade=null,this._reorgs=[],this._ranges=[],this._hadPeers=!1,this._ifAvailable=0,this._updatesPending=0,this._applyingReorg=null,this._manifestPeer=null,this._hasSession=!1,this._peerSessions=0,this._notDownloadingLinger=s,this._downloadingTimer=null;const l=this;this._onstreamclose=function(){l.detachFrom(this.userData);};}updateActivity(e,t){this.activeSessions+=e,this.setDownloading(0!==this.activeSessions,t);}isDownloading(){return this.downloading||!this._inflight.idle}setDownloading(e){clearTimeout(this._downloadingTimer),this.destroyed||(e||0===this._notDownloadingLinger?this.setDownloadingNow(e):this._downloadingTimer=setTimeout(Tt$1,this._notDownloadingLinger,this,e));}setDownloadingNow(e){if(this._downloadingTimer=null,this.downloading!==e&&(this.downloading=e,e||!this.isDownloading())){for(const e of this.peers)e.signalUpgrade();if(e)for(const e of this._attached)e.stream.handshakeHash&&(e.opened({protocol:"hypercore/alpha",id:this.discoveryKey})||this._makePeer(e,!0));else for(const e of this.peers)e.closeIfIdle();null!==this.ondownloading&&e&&this.ondownloading();}}cork(){for(const e of this.peers)e.protomux.cork();}uncork(){for(const e of this.peers)e.protomux.uncork();}onhave(e,t,s=!1){for(const i of this.peers)i.broadcastRange(e,t,s);}ontruncate(e,t){const s=[];for(const t of this._blocks)t.index<e||s.push(t);for(const e of s)for(const t of e.refs)!1!==t.snapshot&&e.detach(t,tt$1());for(const s of this.peers)s._unclearLocalRange(e,t);}onupgrade(){for(const e of this.peers)e.signalUpgrade();!1===this._blocks.isEmpty()&&this._resolveBlocksLocally(),null!==this._upgrade&&this._resolveUpgradeRequest(null),0===this._ranges.length&&0===this._seeks.length||this._updateNonPrimary(!0);}async onconflict(e){const t=[];for(const e of this.peers)t.push(e._onconflict());await Promise.allSettled(t);}async applyPendingReorg(){if(null!==this._applyingReorg)return await this._applyingReorg,!0;for(let e=this._reorgs.length-1;e>=0;e--){const t=this._reorgs[e];if(null!==t.batch&&t.batch.finished)return await this._applyReorg(t),!0}return !1}addUpgrade(e){if(null!==this._upgrade){const t=this._upgrade.attach(e);return this._checkUpgradeIfAvailable(),t}const t=this._addUpgrade().attach(e);return this.updateAll(),t}addBlock(e,t){const s=this._blocks.add(t,lt$1),i=s.attach(e);return this._queueBlock(s),this.updateAll(),i}addSeek(e,t){const s=new pt$1(this._seeks,t),i=s.attach(e);return this._seeks.push(s),this.updateAll(),i}addRange(e,{start:t=0,end:s=-1,length:i=xt$1(t,s),blocks:n=null,linear:r=!1,ifAvailable:o=!1}={}){null!==n&&(t=0,s=i=n.length);const h=new ft$1(this._ranges,t,-1===i?-1:t+i,r,o,n),a=h.attach(e);return this._ranges.push(h),this._updateNonPrimary(!0),a}cancel(e){e.context.detach(e,null);}clearRequests(e,t=null){let s=!1;for(;e.length>0;){const i=e[e.length-1];i.context.detach(i,t),s=!0;}s&&this.updateAll();}_addUpgradeMaybe(){return !0===this.eagerUpgrade?this._addUpgrade():this._upgrade}_checkUpgradeIfAvailable(){if(this._ifAvailable>0&&this.peers.length<3)return;if(null===this._upgrade||0===this._upgrade.refs.length)return;if(!1===this._hadPeers&&this.findingPeers>0)return;const e=Math.min(this.peers.length,3);for(let t=0;t<e;t++){const e=this.peers[t];if(!1===e.remoteSynced)return;if(0===this.core.tree.length&&e.remoteLength>0)return;if(!(e.remoteLength<=this._upgrade.length||e.remoteFork!==this._upgrade.fork)){if(e.syncsProcessing>0)return;if(e.lengthAcked!==this.core.tree.length&&e.remoteFork===this.core.tree.fork)return;if(!0===e.remoteCanUpgrade)return}}if(null!==this._applyingReorg)return;for(let e=0;e<this._reorgs.length;e++){if(this._reorgs[e].inflight.length>0)return}if(this._upgrade.inflight.length>0)return;const t=this._upgrade;this._upgrade=null,t.resolve(!1);}_addUpgrade(){return null!==this._upgrade||(this._upgrade=new gt$1(this,this.core.tree.fork,this.core.tree.length)),this._upgrade}_addReorg(e,t){if(!1===this.allowFork)return null;for(const t of this._reorgs){if(t.fork>e&&null!==t.batch)return null;if(t.fork===e)return t}const s={fork:e,inflight:[],batch:null};this._reorgs.push(s);let i=this._reorgs.length-1;for(;i>0&&this._reorgs[i-1].fork>e;)this._reorgs[i]=this._reorgs[i-1],this._reorgs[--i]=s;return s}_shouldUpgrade(e){return !(null!==this._upgrade&&this._upgrade.inflight.length>0)&&(!0===e.remoteCanUpgrade&&e.remoteLength>this.core.tree.length&&e.lengthAcked===this.core.tree.length)}_autoUpgrade(e){return null!==this._upgrade&&e.remoteFork===this.core.tree.fork&&this._shouldUpgrade(e)}_addPeer(e){this._hadPeers=!0,this.peers.push(e),this.updatePeer(e),this.onpeerupdate(!0,e);}_requestDone(e,t){if(this._inflight.remove(e,t),!0!==this.isDownloading())for(const e of this.peers)e.signalUpgrade();}_removePeer(e){this.peers.splice(this.peers.indexOf(e),1),this._manifestPeer===e&&(this._manifestPeer=null);for(const t of this._inflight)t.peer===e&&(this._inflight.remove(t.id,!0),this._clearRequest(e,t));e.useSession&&this._closeSessionMaybe(),this.onpeerupdate(!1,e),this.updateAll();}_queueBlock(e){e.inflight.length>0||!0===e.queued||(e.queued=!0,this._queued.push(e));}_resolveHashLocally(e,t){this._requestDone(t.id,!1),this._resolveBlockRequest(this._hashes,t.hash.index/2,null,t),this.updatePeer(e);}async _resolveBlocksLocally(){let e=null;for(const t of this._blocks)if(!1!==this.core.bitfield.get(t.index)){try{t.resolve(await this.core.blocks.get(t.index));}catch(e){t.reject(e);}null===e&&(e=[]),e.push(t);}if(null!==e)for(const t of e)this._blocks.remove(t.index);}_resolveBlockRequest(e,t,s,i){const n=e.remove(t);return null!==n&&(kt$1(n.inflight,i),n.queued=!1,n.resolve(s),!0)}_resolveUpgradeRequest(e){if(null!==e&&kt$1(this._upgrade.inflight,e),this.core.tree.length===this._upgrade.length&&this.core.tree.fork===this._upgrade.fork)return !1;const t=this._upgrade;return this._upgrade=null,t.resolve(!0),!0}_resolveRangeRequest(e,t){const s=this._ranges.pop();t<this._ranges.length&&(this._ranges[t]=s),e.resolve(!0);}_clearInflightBlock(e,t){const s=e===this._blocks,i=!0===s?t.block.index:t.hash.index/2,n=e.get(i);null!==n&&!1!==kt$1(n.inflight,t)&&(n.refs.length>0&&!0===s?this._queueBlock(n):n.gc());}_clearInflightUpgrade(e){!1!==kt$1(this._upgrade.inflight,e)&&this._upgrade.gc();}_clearInflightSeeks(e){for(const t of this._seeks)!1!==kt$1(t.inflight,e)&&t.gc();}_clearInflightReorgs(e){for(const t of this._reorgs)kt$1(t.inflight,e);}_clearOldReorgs(e){for(let t=0;t<this._reorgs.length;t++){this._reorgs[t].fork>=e||(t===this._reorgs.length-1?this._reorgs.pop():this._reorgs[t]=this._reorgs.pop(),t--);}}async _updateNonPrimary(e){for(;1==++this._updatesPending;){for(let e=0;e<this._ranges.length;e++){const t=this._ranges[e];vt$1(this.core,t),-1!==t.end&&t.start>=t.end&&this._resolveRangeRequest(t,e--);}for(let e=0;e<this._seeks.length;e++){const t=this._seeks[e];let s=null,i=null;try{i=await t.seeker.update();}catch(e){s=e;}(i||s)&&(e<this._seeks.length-1?this._seeks[e]=this._seeks.pop():this._seeks.pop(),e--,s?t.reject(s):t.resolve(i));}if(0==--this._updatesPending)break;this._updatesPending=0;}(this._inflight.idle||e)&&this.updateAll();}_maybeResolveIfAvailableRanges(){if(!(this._ifAvailable>0)&&this._inflight.idle&&this._ranges.length){for(let e=0;e<this.peers.length;e++)if(this.peers[e].dataProcessing>0)return;for(let e=0;e<this._ranges.length;e++){const t=this._ranges[e];t.ifAvailable&&this._resolveRangeRequest(t,e--);}}}_clearRequest(e,t){null!==t.block&&(this._clearInflightBlock(this._blocks,t),this._unmarkInflight(t.block.index)),null!==t.hash&&this._clearInflightBlock(this._hashes,t),null!==t.upgrade&&null!==this._upgrade&&this._clearInflightUpgrade(t),this._seeks.length>0&&this._clearInflightSeeks(t),this._reorgs.length>0&&this._clearInflightReorgs(t);}_onnodata(e,t){this._clearRequest(e,t),this.updateAll();}_openSkipBitfield(){const e=this.core.openSkipBitfield();for(const t of this._inflight)t.block&&e.set(t.block.index,!0);}_markInflight(e){null!==this.core.skipBitfield&&this.core.skipBitfield.set(e,!0);for(const t of this.peers)t._markInflight(e);}_unmarkInflight(e){null!==this.core.skipBitfield&&this.core.skipBitfield.set(e,this.core.bitfield.get(e));for(const t of this.peers)t._resetMissingBlock(e);}_ondata(e,t,s){null!==s.block&&this._resolveBlockRequest(this._blocks,s.block.index,s.block.value,t),null!==s.hash&&0==(1&s.hash.index)&&this._resolveBlockRequest(this._hashes,s.hash.index/2,null,t),null!==this._upgrade&&this._resolveUpgradeRequest(t),this._seeks.length>0&&this._clearInflightSeeks(t),this._reorgs.length>0&&this._clearInflightReorgs(t),this._manifestPeer===e&&null!==this.core.header.manifest&&(this._manifestPeer=null),(this._seeks.length>0||this._ranges.length>0)&&this._updateNonPrimary(this._seeks.length>0),this.updatePeer(e);}_onwant(e,t,s){const i=Math.min(this.core.tree.length,this.core.header.hints.contiguousLength);if(t+s<i||this.core.tree.length===i)return e.wireRange.send({drop:!1,start:0,length:i}),void zt$1(e.stats.wireRange,this.stats.wireRange);s=Math.min(s,this.core.tree.length-t),e.protomux.cork();for(const i of this.core.bitfield.want(t,s))e.wireBitfield.send(i),zt$1(e.stats.wireBitfield,this.stats.wireBitfield);e.protomux.uncork();}async _onreorgdata(e,t,s){const i=s.upgrade&&await this.core.verifyReorg(s),n=this._addReorg(s.fork,e);null!==n?(kt$1(n.inflight,t),n.batch?await n.batch.update(s):s.upgrade&&(n.batch=i,this._clearOldReorgs(n.fork)),n.batch&&n.batch.finished&&null!==this._addUpgradeMaybe()&&await this._applyReorg(n),this.updateAll()):this.updateAll();}async _applyReorg(e){const t=this._upgrade;this._reorgs=[],this._applyingReorg=this.core.reorg(e.batch,null);try{await this._applyingReorg;}catch(e){this._upgrade=null,t.reject(e);}this._applyingReorg=null,null!==this._upgrade&&this._resolveUpgradeRequest(null);for(const e of this.peers)this._updateFork(e);for(const e of this._ranges)e.start=e.userStart,e.end=e.userEnd;this.updateAll();}_maybeUpdate(){return null!==this._upgrade&&0===this._upgrade.inflight.length}_maybeRequestManifest(){return null===this.core.header.manifest&&null===this._manifestPeer}_updateFork(e){if(null!==this._applyingReorg||!1===this.allowFork||e.remoteFork<=this.core.tree.fork)return !1;const t=this._addReorg(e.remoteFork,e);return null!==t&&null===t.batch&&0===t.inflight.length&&e._requestForkProof(t)}_updatePeer(e){if(!e.isActive()||e.inflight>=e.getMaxInflight())return !1;!0===this._maybeRequestManifest()&&0===e.remoteLength&&!0===e.remoteHasManifest&&(this._manifestPeer=e,e._requestManifest());for(const t of this._seeks)if(!(t.inflight.length>0)&&!0===e._requestSeek(t))return !0;const t=new je$1(this._queued);for(const s of t)if(!1===s.queued||!0===e._requestBlock(s))return s.queued=!1,t.dequeue(),!0;return !1}_updatePeerNonPrimary(e){if(!e.isActive()||e.inflight>=e.getMaxInflight())return !1;const t=new je$1(this._ranges);for(const s of t)if(!0===e._requestRange(s))return !0;for(let t=this._reorgs.length-1;t>=0;t--){const s=this._reorgs[t];if(null!==s.batch&&0===s.inflight.length&&!0===e._requestForkRange(s))return !0}return !0===this._maybeUpdate()&&!0===e._requestUpgrade(this._upgrade)}updatePeer(e){if(null===this._applyingReorg){for(;!0===this._updatePeer(e););for(;!0===this._updatePeerNonPrimary(e););this._checkUpgradeIfAvailable(),this._maybeResolveIfAvailableRanges();}}updateAll(){if(null!==this._applyingReorg)return;const e=new je$1(this.peers);for(const t of e)!0===this._updatePeer(t)&&e.requeue();if(!1!==this._maybeUpdate()||0!==this._ranges.length||0!==this._reorgs.length){for(const t of e.restart())!0===this._updatePeerNonPrimary(t)&&e.requeue();this._checkUpgradeIfAvailable(),this._maybeResolveIfAvailableRanges();}else this._checkUpgradeIfAvailable();}_closeSessionMaybe(){if(this._hasSession&&0===this._peerSessions&&(this._hasSession=!1,this.core.active--),0===this.core.active&&0===this.core.sessions.length)return this.destroy(),void this.core.close().catch(Qe$1);1===this.core.sessions.length&&1===this.core.active&&this.core.sessions[0].autoClose&&this.core.sessions[0].close().catch(Qe$1);}attached(e){return this._attached.has(e)}ensureSession(){this._hasSession||(this._hasSession=!0,this.core.active++);}attachTo(e,t){if(this.core.closed)return;t&&this.ensureSession();const s=this._makePeer.bind(this,e,t);this._attached.add(e),e.pair({protocol:"hypercore/alpha",id:this.discoveryKey},s),e.stream.setMaxListeners(0),e.stream.on("close",this._onstreamclose),t&&this._peerSessions++,this._ifAvailable++,e.stream.opened.then((e=>{t&&this._peerSessions--,this._ifAvailable--,e&&!this.destroyed?s():t&&this._closeSessionMaybe(),this._checkUpgradeIfAvailable();}));}detachFrom(e){this._attached.delete(e)&&(e.stream.removeListener("close",this._onstreamclose),e.unpair({protocol:"hypercore/alpha",id:this.discoveryKey}));}destroy(){this.destroyed=!0,this._downloadingTimer&&(clearTimeout(this._downloadingTimer),this._downloadingTimer=null);for(const e of this.peers)this.detachFrom(e.protomux),e.channel.close();for(const e of this._attached)this.detachFrom(e);}_makePeer(e,t){const s=this;if(e.opened({protocol:"hypercore/alpha",id:this.discoveryKey}))return o();const i=e.createChannel({userData:null,protocol:"hypercore/alpha",aliases:["hypercore"],id:this.discoveryKey,handshake:st$1.wire.handshake,messages:[{encoding:st$1.wire.sync,onmessage:Ut$1},{encoding:st$1.wire.request,onmessage:Et$1},{encoding:st$1.wire.cancel,onmessage:At$1},{encoding:st$1.wire.data,onmessage:Mt$1},{encoding:st$1.wire.noData,onmessage:Dt$1},{encoding:st$1.wire.want,onmessage:Ct$1},{encoding:st$1.wire.unwant,onmessage:Ot$1},{encoding:st$1.wire.bitfield,onmessage:Nt$1},{encoding:st$1.wire.range,onmessage:It$1},{encoding:st$1.wire.extension,onmessage:Ft$1}],onopen:St$1,onclose:qt$1,ondrain:Bt$1});if(null===i)return o();const n=new bt$1(s,e,i,t,this.inflightRange),r=e.stream;return t&&(s.ensureSession(),s._peerSessions++),n.channel.open({seeks:!0,capability:it$1.replicate(r.isInitiator,this.key,r.handshakeHash)}),!0;function o(){return t&&s._closeSessionMaybe(),!1}}},En=class{constructor(e,t,s,i,n,r,o,h,a,l,c,u,d,f){this.tracer=Gi(this),this.onupdate=d,this.onconflict=f,this.preupdate=null,this.header=e,this.compat=t,this.crypto=s,this.oplog=i,this.bigHeader=n,this.tree=r,this.blocks=o,this.bitfield=h,this.verifier=a,this.truncating=0,this.updating=!1,this.closed=!1,this.skipBitfield=null,this.active=l.length,this.sessions=l,this.globalCache=u,this._manifestFlushed=!!e.manifest,this._maxOplogSize=65536,this._autoFlush=1,this._verifies=null,this._verifiesFlushed=null,this._mutex=new Ei,this._legacy=c;}static async open(e,t={}){const s=e("oplog"),i=e("tree"),n=e("bitfield"),r=e("data"),o=e("header");try{return await this.resume(s,i,n,r,o,t)}catch(e){throw await function(...e){let t=1,s=null;return new Promise(((i,n)=>{for(const s of e)t++,s.close(r);function r(e){e&&(s=e),--t||(s?n(s):i());}r(null);}))}(s,i,n,r,o),e}}static async resume(e,t,s,i,n,r){let o=!0===r.overwrite;const h=!0===r.force,a=!1!==r.createIfMissing,l=r.crypto||Ri,c=!!r.legacy,u=new Bi(e,{headerEncoding:Hi.oplog.header,entryEncoding:Hi.oplog.entry,readonly:r.readonly});let d=!0===r.compat||!1!==r.compat&&!r.manifest,{header:f,entries:g}=await u.open();h&&r.key&&f&&!Si.equals(f.key,r.key)&&(o=!0);const p=new Ui(n);if(!f||o){if(!a)throw Ii("No Hypercore is stored here");if(d&&r.key&&r.keyPair&&!Si.equals(r.key,r.keyPair.publicKey))throw Ni("Key must match publicKey when in compat mode");const e=r.keyPair||(r.key?null:l.keyPair()),t=!(r.manifest||!r.compat&&r.key&&(!e||!Si.equals(r.key,e.publicKey)))?Wi.defaultSignerManifest(r.key||e.publicKey):Wi.createManifest(r.manifest);f={external:null,key:r.key||(d?t.signers[0].publicKey:Wi.manifestHash(t)),manifest:t,keyPair:e?{publicKey:e.publicKey,secretKey:e.secretKey||null}:null,userData:[],tree:{fork:0,length:0,rootHash:null,signature:null},hints:{reorgs:[],contiguousLength:0}},await Xi(u,p,f);}else f.external&&(f=await p.load(f.external));if(f.key=qi(f.key),f.tree.rootHash=qi(f.tree.rootHash),f.tree.signature=qi(f.tree.signature),f.keyPair&&(f.keyPair.publicKey=qi(f.keyPair.publicKey),f.keyPair.secretKey=qi(f.keyPair.secretKey)),r.manifest){if(!r.key&&!Wi.isValidManifest(f.key,Wi.createManifest(r.manifest)))throw Fi("Manifest does not hash to provided key");f.manifest||(f.manifest=r.manifest);}if(r.key&&!Si.equals(f.key,r.key))throw Fi("Another Hypercore is stored here");d&&f.manifest&&!Wi.isCompat(f.key,f.manifest)?d=!1:!d&&f.manifest&&Wi.isCompat(f.key,f.manifest)&&(d=!0);const _=f.manifest?f.manifest.prologue:null,y=await Ai.open(t,{crypto:l,prologue:_,...f.tree}),m=await Di.open(s),b=new Mi(i,y);if(o&&(await y.clear(),await b.clear(),await m.clear(),g=[]),0===f.hints.contiguousLength)for(;m.get(f.hints.contiguousLength);)f.hints.contiguousLength++;f.manifest&&(f.manifest=Wi.createManifest(f.manifest));const k=f.manifest?new Wi(f.key,f.manifest,{crypto:l,legacy:c}):null;for(const e of g){if(e.userData&&Yi(f.userData,e.userData.key,e.userData.value),e.treeNodes)for(const t of e.treeNodes)y.addNode(t);if(e.bitfield&&(m.setRange(e.bitfield.start,e.bitfield.length,!e.bitfield.drop),Qi(f,e.bitfield,m)),e.treeUpgrade){const t=await y.truncate(e.treeUpgrade.length,e.treeUpgrade.fork);t.ancestors=e.treeUpgrade.ancestors,t.signature=qi(e.treeUpgrade.signature),ji(f.hints.reorgs,y,t),t.commit(),f.tree.length=y.length,f.tree.fork=y.fork,f.tree.rootHash=y.hash(),f.tree.signature=y.signature;}}for(const e of f.userData)e.value=qi(e.value);return new this(f,d,l,u,p,y,b,m,k,r.sessions||[],c,r.globalCache||null,r.onupdate||Zi,r.onconflict||Zi)}async audit(){await this._mutex.lock();try{await this._flushOplog();const e=await Vi(this);return (e.blocks||e.tree)&&await this._flushOplog(),e}finally{await this._mutex.unlock();}}async setManifest(e){await this._mutex.lock();try{if(e&&null===this.header.manifest){if(!Wi.isValidManifest(this.header.key,e))throw zi("Manifest hash does not match");this._setManifest(Wi.createManifest(e),null),await this._flushOplog();}}finally{this._mutex.unlock();}}_setManifest(e,t){if(!e&&Si.equals(t.publicKey,this.header.key)&&(e=Wi.defaultSignerManifest(this.header.key)),!e)return;const s=new Wi(this.header.key,e,{crypto:this.crypto,legacy:this._legacy});s.prologue&&this.tree.setPrologue(s.prologue),this.header.manifest=e,this.compat=s.compat,this.verifier=s,this._manifestFlushed=!1,this.onupdate(16,null,null,null);}_shouldFlush(){return --this._autoFlush<=0||this.oplog.byteLength>=this._maxOplogSize?(this._autoFlush=4,!0):!(this._manifestFlushed||!this.header.manifest)&&(this._manifestFlushed=!0,!0)}async copyPrologue(e,{additional:t=[]}={}){await this._mutex.lock();try{await e._mutex.lock();}catch(e){throw this._mutex.unlock(),e}try{const s=this.header.manifest&&this.header.manifest.prologue;if(!s)throw Ti("No prologue present");const i=s.length-t.length,n=i!==e.tree.length?await e.tree.truncate(i):e.tree.batch(),r=n.roots.slice(0),o=n.byteLength;for(const e of t)n.append(e);if(!Si.equals(n.hash(),s.hash))throw Ti("Source tree is conflicting");const h={userData:null,treeNodes:r,treeUpgrade:null,bitfield:null};t.length&&(await this.blocks.putBatch(i,t,o),h.treeNodes=h.treeNodes.concat(n.nodes),h.bitfield={drop:!1,start:i,length:t.length}),await this.oplog.append([h],!1),this.tree.addNodes(h.treeNodes),this.header.tree.length<n.length&&(this.header.tree.length=n.length,this.header.tree.rootHash=n.hash(),this.tree.length=n.length,this.tree.byteLength=n.byteLength,this.tree.roots=n.roots,this.onupdate(1,null,null,null)),h.bitfield&&(this._setBitfieldRange(h.bitfield.start,h.bitfield.length,!0),this.onupdate(0,h.bitfield,null,null)),await this._flushOplog();let a=0;for(;a<i;){const t=Ji(a,e.bitfield,this.bitfield);if(t>=i||t<0)break;a=Math.min(t+65536,i,$i(t,e.bitfield,this.bitfield));const s=await e.tree.getNeededNodes(i,t,a),n={drop:!1,start:t,length:a-t},r=[];for(let s=t;s<a;s++){const t=await e.blocks.get(s);r.push(t);}const o=await e.tree.byteOffset(2*t);await this.blocks.putBatch(t,r,o);const h={userData:null,treeNodes:s,treeUpgrade:null,bitfield:n};await this.oplog.append([h],!1),this.tree.addNodes(s),this._setBitfieldRange(n.start,n.length,!0),this.onupdate(0,n,null,null),await this._flushOplog();}this.header.userData=e.header.userData.slice(0);const l=Math.min(e.header.hints.contiguousLength,n.length);this.header.hints.contiguousLength<l&&(this.header.hints.contiguousLength=l),await this._flushOplog();}finally{e._mutex.unlock(),this._mutex.unlock();}}async flush(){await this._mutex.lock();try{this._manifestFlushed=!0,this._autoFlush=4,await this._flushOplog();}finally{this._mutex.unlock();}}async _flushOplog(){return await this.bitfield.flush(),await this.tree.flush(),Xi(this.oplog,this.bigHeader,this.header)}_appendBlocks(e){return this.blocks.putBatch(this.tree.length,e,this.tree.byteLength)}async _writeBlock(e,t,s){const i=await e.byteOffset(2*t);await this.blocks.put(t,s,i);}async userData(e,t,s){await this._mutex.lock();try{let i=!0;for(const s of this.header.userData)if(s.key===e){if(t&&Si.equals(s.value,t))return;i=!1;break}if(i&&!t)return;const n={userData:{key:e,value:t},treeNodes:null,treeUpgrade:null,bitfield:null};await this.oplog.append([n],!1),Yi(this.header.userData,e,t),(this._shouldFlush()||s)&&await this._flushOplog();}finally{this._mutex.unlock();}}async truncate(e,t,{signature:s,keyPair:i=this.header.keyPair}={}){if(this.tree.prologue&&e<this.tree.prologue.length)throw Ti("Truncation breaks prologue");this.truncating++,await this._mutex.lock(),null===this.verifier&&i&&this._setManifest(null,i);try{const n=await this.tree.truncate(e,t);e>0&&(n.signature=s||this.verifier.sign(n,i)),await this._truncate(n,null);}finally{this.truncating--,this._mutex.unlock();}}async clearBatch(){await this._mutex.lock();try{const e=this.bitfield.findFirst(!1,this.tree.length);if(e<=this.tree.length)return;const t=await this.tree.truncate(this.tree.length,this.tree.fork);t.signature=this.tree.signature;const s={userData:null,treeNodes:t.nodes,treeUpgrade:t,bitfield:{drop:!0,start:t.ancestors,length:e-t.ancestors}};await this.oplog.append([s],!1),this._setBitfieldRange(t.ancestors,e-t.ancestors,!1),t.commit(),await this._flushOplog();}finally{this._mutex.unlock();}}async clear(e,t,s){await this._mutex.lock();try{const i={userData:null,treeNodes:null,treeUpgrade:null,bitfield:{start:e,length:t-e,drop:!0}};if(await this.oplog.append([i],!1),this._setBitfieldRange(e,t-e,!1),e<this.header.hints.contiguousLength&&(this.header.hints.contiguousLength=e),e=this.bitfield.lastSet(e)+1,-1===(t=this.bitfield.firstSet(t))&&(t=this.tree.length),e>=t||e>=this.tree.length)return;const n=await this.tree.byteOffset(2*e),r=await this.tree.byteOffset(2*t)-n,o=s?await Oi.bytesUsed(this.blocks.storage):null;await this.blocks.clear(n,r);const h=s?await Oi.bytesUsed(this.blocks.storage):null;s&&(s.blocks=Math.max(o-h,0)),this.onupdate(0,i.bitfield,null,null),this._shouldFlush()&&await this._flushOplog();}finally{this._mutex.unlock();}}async purge(){return new Promise(((e,t)=>{let s=4,i=null;function n(n){n&&(i=n),--s||(i?t(i):e());}this.oplog.storage.unlink(n),this.tree.storage.unlink(n),this.bitfield.storage.unlink(n),this.blocks.storage.unlink(n);}))}async insertBatch(e,t,{signature:s,keyPair:i=this.header.keyPair,pending:n=!1,treeLength:r=e.treeLength}={}){await this._mutex.lock();try{if(null===this.verifier&&i&&this._setManifest(null,i),this.tree.fork!==e.fork)return null;if(this.tree.length>e.treeLength){if(this.tree.length>e.length)return null;for(const t of this.tree.roots){const s=await e.get(t.index);if(s.size!==t.size||!Si.equals(s.hash,t.hash))return null}}const o=e.length-r;e.upgraded=!n&&e.length>this.tree.length,e.treeLength=this.tree.length,e.ancestors=this.tree.length,e.upgraded&&!n&&(e.signature=s||this.verifier.sign(e,i));let h=e.byteLength;for(let e=0;e<o;e++)h-=t[e].byteLength;!0===n&&(e.upgraded=!1);const a={userData:null,treeNodes:e.nodes,treeUpgrade:e.upgraded?e:null,bitfield:{drop:!1,start:r,length:o}};await this.blocks.putBatch(r,o<t.length?t.slice(0,o):t,h),await this.oplog.append([a],!1),this._setBitfieldRange(a.bitfield.start,a.bitfield.length,!0),e.commit(),e.upgraded&&(this.header.tree.length=e.length,this.header.tree.rootHash=e.hash(),this.header.tree.signature=e.signature);const l=(e.upgraded?1:0)|Qi(this.header,a.bitfield,this.bitfield);n||(a.treeUpgrade&&r>e.treeLength&&(a.bitfield.start=e.treeLength,a.bitfield.length=r-e.treeLength),this.onupdate(l,a.bitfield,null,null)),this._shouldFlush()&&await this._flushOplog();}finally{this._mutex.unlock();}return {length:e.length,byteLength:e.byteLength}}async append(e,{signature:t,keyPair:s=this.header.keyPair,preappend:i}={}){await this._mutex.lock();try{if(null===this.verifier&&s&&this._setManifest(null,s),i&&await i(e),!e.length)return {length:this.tree.length,byteLength:this.tree.byteLength};const n=this.tree.batch();for(const t of e)n.append(t);if(this.tree.prologue&&n.length<this.tree.prologue.length)throw Ti("Append is not consistent with prologue");n.signature=t||this.verifier.sign(n,s);const r={userData:null,treeNodes:n.nodes,treeUpgrade:n,bitfield:{drop:!1,start:n.ancestors,length:e.length}},o=await this._appendBlocks(e);await this.oplog.append([r],!1),this._setBitfieldRange(n.ancestors,n.length-n.ancestors,!0),n.commit(),this.header.tree.length=n.length,this.header.tree.rootHash=n.hash(),this.header.tree.signature=n.signature;const h=1|Qi(this.header,r.bitfield,this.bitfield);return this.onupdate(h,r.bitfield,null,null),this._shouldFlush()&&await this._flushOplog(),{length:n.length,byteLength:o}}finally{this._mutex.unlock();}}_verifyBatchUpgrade(e,t){if(!this.header.manifest&&(!t&&this.compat&&(t=Wi.defaultSignerManifest(this.header.key)),!t||!(Wi.isValidManifest(this.header.key,t)||this.compat&&Wi.isCompat(this.header.key,t))))throw Ki("Proof contains an invalid manifest");t=Wi.createManifest(t);const s=this.verifier||new Wi(this.header.key,t,{crypto:this.crypto,legacy:this._legacy});if(!s.verify(e,e.signature))throw Ki("Proof contains an invalid signature");this.header.manifest||(this.header.manifest=t,this.compat=s.compat,this.verifier=s,this.onupdate(16,null,null,null));}async _verifyExclusive({batch:e,bitfield:t,value:s,manifest:i,from:n}){this._verifyBatchUpgrade(e,i),await this._mutex.lock();try{if(!e.commitable())return !1;this.updating=!0;const i={userData:null,treeNodes:e.nodes,treeUpgrade:e,bitfield:t};null!==this.preupdate&&await this.preupdate(e,this.header.key),t&&await this._writeBlock(e,t.start,s),await this.oplog.append([i],!1);let r=1;t&&(this._setBitfield(t.start,!0),r|=Qi(this.header,t,this.bitfield)),e.commit(),this.header.tree.fork=e.fork,this.header.tree.length=e.length,this.header.tree.rootHash=e.hash(),this.header.tree.signature=e.signature,this.onupdate(r,t,s,n),this._shouldFlush()&&await this._flushOplog();}finally{this.updating=!1,this._mutex.unlock();}return !0}async _verifyShared(){if(!this._verifies.length)return !1;await this._mutex.lock();const e=this._verifies;this._verifies=null,this._verified=null;try{const t=[];for(const{batch:s,bitfield:i,value:n}of e)s.commitable()&&(i&&await this._writeBlock(s,i.start,n),t.push({userData:null,treeNodes:s.nodes,treeUpgrade:null,bitfield:i}));await this.oplog.append(t,!1);for(let t=0;t<e.length;t++){const{batch:s,bitfield:i,value:n,manifest:r,from:o}=e[t];if(!s.commitable()){e[t]=null;continue}let h=0;if(i&&(this._setBitfield(i.start,!0),h=Qi(this.header,i,this.bitfield)),r&&null===this.header.manifest){if(!Wi.isValidManifest(this.header.key,r))throw zi("Manifest hash does not match");this._setManifest(r,null);}s.commit(),this.onupdate(h,i,n,o);}this._shouldFlush()&&await this._flushOplog();}finally{this._mutex.unlock();}return null!==e[0]}async checkConflict(e,t){if(this.tree.length<e.upgrade.length||e.fork!==this.tree.fork)return !1;const s=this.tree.verifyFullyRemote(e);try{this._verifyBatchUpgrade(s,e.manifest);}catch{return !0}const i=this.crypto.tree(e.upgrade.nodes),n=this.crypto.tree(await this.tree.getRoots(e.upgrade.length));return !Si.equals(n,i)&&(await this.onconflict(e),!0)}async verifyReorg(e){const t=await this.tree.reorg(e);return this._verifyBatchUpgrade(t,e.manifest),t}async verify(e,t){if(e.fork!==this.tree.fork)return !1;const s=await this.tree.verify(e);if(!s.commitable())return !1;const i=e.block&&e.block.value||null,n={batch:s,bitfield:i&&{drop:!1,start:e.block.index,length:1},value:i,manifest:e.manifest,from:t};if(s.upgraded)return this._verifyExclusive(n);if(null!==this._verifies){const e=this._verifies,t=e.push(n);return await this._verified,null!==e[t]}return this._verifies=[n],this._verified=this._verifyShared(),this._verified}async reorg(e,t){if(!e.commitable())return !1;this.truncating++,await this._mutex.lock();try{if(!e.commitable())return !1;await this._truncate(e,t);}finally{this.truncating--,this._mutex.unlock();}return !0}async _truncate(e,t){const s={userData:null,treeNodes:e.nodes,treeUpgrade:e,bitfield:{drop:!0,start:e.ancestors,length:this.tree.length-e.ancestors}};await this.oplog.append([s],!1),this._setBitfieldRange(e.ancestors,this.tree.length-e.ancestors,!1),ji(this.header.hints.reorgs,this.tree,e),e.commit();const i=Qi(this.header,s.bitfield,this.bitfield),n=(e.length>e.ancestors?3:2)|i;this.header.tree.fork=e.fork,this.header.tree.length=e.length,this.header.tree.rootHash=e.hash(),this.header.tree.signature=e.signature,this.onupdate(n,s.bitfield,null,t),await this._flushOplog();}openSkipBitfield(){if(null!==this.skipBitfield)return this.skipBitfield;this.skipBitfield=new Ci;const e=this.bitfield.toBuffer(this.tree.length),t=new Uint32Array(e.buffer,e.byteOffset,e.byteLength/4);return this.skipBitfield.insert(0,t),this.skipBitfield}_setBitfield(e,t){this.bitfield.set(e,t),null!==this.skipBitfield&&this.skipBitfield.set(e,t);}_setBitfieldRange(e,t,s){this.bitfield.setRange(e,t,s),null!==this.skipBitfield&&this.skipBitfield.setRange(e,t,s);}async close(){this.closed=!0,await this._mutex.destroy(),await Promise.allSettled([this.oplog.close(),this.bitfield.close(),this.tree.close(),this.blocks.close(),this.bigHeader.close()]);}},An=class{constructor(e,t,{isBlockKey:s=!1,compat:i=!0}={}){const n=sn.alloc(2*en.crypto_stream_KEYBYTES);this.key=e,this.blockKey=s?e:n.subarray(0,en.crypto_stream_KEYBYTES),this.blindingKey=n.subarray(en.crypto_stream_KEYBYTES),this.padding=8,this.compat=i,this.isBlockKey=s,s||(i?en.crypto_generichash_batch(this.blockKey,[e],t):en.crypto_generichash_batch(this.blockKey,[nn,t,e])),en.crypto_generichash(this.blindingKey,this.blockKey);}encrypt(e,t,s){const i=t.subarray(0,this.padding);t=t.subarray(this.padding),tn.uint64.encode({start:0,end:8,buffer:i},s),tn.uint64.encode({start:0,end:8,buffer:rn},e),rn.fill(0,8,8+i.byteLength),en.crypto_stream_xor(i,i,rn,this.blindingKey),rn.set(i,8),en.crypto_stream_xor(t,t,rn,this.blockKey);}decrypt(e,t){const s=t.subarray(0,this.padding);t=t.subarray(this.padding),tn.uint64.encode({start:0,end:8,buffer:rn},e),rn.set(s,8),en.crypto_stream_xor(t,t,rn,this.blockKey);}},Mn=js,Dn=class{constructor(e){this.req=e;}async done(){return (await this.req).promise}downloaded(){return this.done()}destroy(){this.req.then((e=>e.context&&e.context.detach(e)),on);}},Cn=class extends ln{constructor(e,t,s,i,n){super(),this.session=e,this.opened=!1,this.closed=!1,this.opening=null,this.closing=null,this.writable=!0,this.autoClose=s,this.restore=i,this.fork=0,this._appends=[],this._appendsActual=null,this._checkoutLength=t,this._byteLength=0,this._sessionLength=0,this._sessionByteLength=0,this._sessionBatch=null,this._cachedBatch=null,this._flushing=null,this._clear=n,this.opening=this._open(),this.opening.catch(dn);}get id(){return this.session.id}get key(){return this.session.key}get discoveryKey(){return this.session.discoveryKey}get indexedLength(){return Math.min(this._sessionLength,null===this.session.core?0:this.session.core.tree.length)}get flushedLength(){return this._sessionLength}get indexedByteLength(){return this._sessionByteLength}get length(){return this._sessionLength+this._appends.length}get byteLength(){return this._sessionByteLength+this._byteLength}get core(){return this.session.core}get manifest(){return this.session.manifest}ready(){return this.opening}async _open(){if(await this.session.ready(),this._clear&&(this._checkoutLength=this.core.tree.length),-1!==this._checkoutLength){const e=await this.session.core.tree.restoreBatch(this._checkoutLength);e.treeLength=this._checkoutLength,this._sessionLength=e.length,this._sessionByteLength=e.byteLength,this._sessionBatch=e,this._clear&&await this.core.clearBatch();}else {const e=this.restore?this.session.core.bitfield.findFirst(!1,this.session.length):0;if(e>this.session.length){const t=await this.session.core.tree.restoreBatch(e);this._sessionLength=t.length,this._sessionByteLength=t.byteLength-this.session.padding*t.length,this._sessionBatch=t;}else this._sessionLength=this.session.length,this._sessionByteLength=this.session.byteLength,this._sessionBatch=this.session.createTreeBatch();}this._appendsActual=this.session.encryption?[]:this._appends,this.fork=this.session.fork,this.opened=!0,this.emit("ready");}async has(e){return !1===this.opened&&await this.ready(),e>=this._sessionLength?e<this.length:this.session.has(e)}async update(e){!1===this.opened&&await this.ready(),await this.session.update(e);}treeHash(){return this._sessionBatch.hash()}setUserData(e,t,s){return this.session.setUserData(e,t,s)}getUserData(e,t){return this.session.getUserData(e,t)}async info(e){const t=this.session,s=await t.info(e);return s.length=this._sessionLength,s.contiguousLength>=s.length?s.contiguousLength=s.length+=this._appends.length:s.length+=this._appends.length,s.byteLength=this._sessionByteLength+this._byteLength,s}async seek(e,t={}){if(!1===this.opened&&await this.opening,this.closing)throw an();if(e<this._sessionByteLength)return await this.session.seek(e,{...t,tree:this._sessionBatch});e-=this._sessionByteLength;let s=0;for(const t of this._appends){if(e<t.byteLength)return [this._sessionLength+s,e];s++,e-=t.byteLength;}if(0===e)return [this._sessionLength+s,0];throw hn()}async get(e,t={}){if(!1===this.opened&&await this.opening,this.closing)throw an();const s=this._sessionLength;if(e<s)return this.session.get(e,{...t,tree:this._sessionBatch});if(t&&t.raw)return this._appendsActual[e-s]||null;const i=this._appends[e-s]||null;if(!i)throw hn();const n=t&&t.valueEncoding&&cn.from(t.valueEncoding)||this.session.valueEncoding;return n?cn.decode(n,i):i}async _waitForFlush(){for(;this._flushing;)await this._flushing,await Promise.resolve();}async restoreBatch(e,t){return !1===this.opened&&await this.opening,e>=this._sessionLength?this.createTreeBatch(e,t):this.session.core.tree.restoreBatch(e)}_catchupBatch(e){if(null===this._cachedBatch&&(this._cachedBatch=this._sessionBatch.clone()),this.length>this._cachedBatch.length){for(let e=this._cachedBatch.length-this._sessionBatch.length;e<this._appendsActual.length;e++)this._cachedBatch.append(this._appendsActual[e]);}return e?this._cachedBatch.clone():this._cachedBatch}createTreeBatch(e,t={}){Array.isArray(t)&&(t={blocks:t});const{blocks:s=[],clone:i=!0}=t;e||0===e||(e=this.length+s.length);const n=this.length+s.length,r=this._catchupBatch(i||s.length>0||e!==this.length),o=Math.min(e,this.length);if(o<this._sessionLength||e>n)return null;o<r.length&&r.checkout(o,this._sessionBatch.roots);for(let t=0;t<e-o;t++)r.append(this._appendsActual===this._appends?s[t]:this._encrypt(r.length,s[t]));return r}async truncate(e=0,t={}){if(!1===this.opened&&await this.opening,this.closing)throw an();await this._waitForFlush(),"number"==typeof t&&(t={fork:t});const{fork:s=this.fork+1,force:i=!1}=t;this._cachedBatch=null;const n=this._sessionLength;if(e<n){if(!i)throw new Error("Cannot truncate committed blocks");this._appends.length=0,this._byteLength=0,await this.session.truncate(e,{fork:s,force:!0,...t}),this._sessionLength=this.session.length,this._sessionByteLength=this.session.byteLength,this._sessionBatch=this.session.createTreeBatch();}else {for(let t=e-n;t<this._appends.length;t++)this._byteLength-=this._appends[t].byteLength;this._appends.length=e-n;}this.fork=s,this.emit("truncate",e,this.fork);}async append(e){const t=this.session;if(!1===this.opened&&await this.opening,this.closing)throw an();await this._waitForFlush(),e=Array.isArray(e)?e:[e];const s=null!==t.encodeBatch?t.encodeBatch(e):new Array(e.length);if(null===t.encodeBatch)for(let i=0;i<e.length;i++){const n=this._encode(t.valueEncoding,e[i]);s[i]=n,this._byteLength+=n.byteLength;}if(this._appends!==this._appendsActual)for(let e=0;e<s.length;e++)this._appendsActual.push(this._encrypt(this._sessionLength+this._appendsActual.length,s[e]));for(const e of s)this._appends.push(e);const i={length:this.length,byteLength:this.byteLength};return this.emit("append"),i}_encode(e,t){const s={start:0,end:0,buffer:null};if(un.isBuffer(t)){if(0===s.start)return t;s.end+=t.byteLength;}else if(e)e.preencode(s,t);else {if(t=un.from(t),0===s.start)return t;s.end+=t.byteLength;}return s.buffer=un.allocUnsafe(s.end),e?e.encode(s,t):s.buffer.set(t,s.start),s.buffer}_encrypt(e,t){const s=un.allocUnsafe(t.byteLength+8);return s.set(t,8),this.session.encryption.encrypt(e,s,this.fork),s}async flush(e={}){if(!1===this.opened&&await this.opening,this.closing)throw an();const{length:t=this.length,keyPair:s=this.session.keyPair,signature:i=null,pending:n=!i&&!s}=e;for(;this._flushing;)await this._flushing;this._flushing=this._flush(t,s,i,n);let r=!1;try{r=await this._flushing;}finally{this._flushing=null;}return this.autoClose&&await this.close(),r}async _flush(e,t,s,i){if(this._sessionBatch.fork!==this.session.fork)return !1;if(this.session.replicator._upgrade)for(const t of this.session.replicator._upgrade.inflight)if(t.upgrade&&t.upgrade.start+t.upgrade.length>e)return !1;const n=Math.min(e-this._sessionLength,this._appends.length);if(n<=0){if(this._sessionLength>this.core.tree.length&&e>this.core.tree.length&&!i){const n=await this.restoreBatch(e);return null!==await this.core.insertBatch(n,[],{keyPair:t,signature:s,pending:i,treeLength:e})}return !0}const r=this.createTreeBatch(this._sessionLength+n);if(null===r)return !1;const o=await this.core.insertBatch(r,this._appendsActual,{keyPair:t,signature:s,pending:i,treeLength:this._sessionLength});if(null===o)return !1;const h=o.byteLength-this._sessionByteLength,a=o.length!==this.session.length?await this.session.core.tree.restoreBatch(o.length):this.session.createTreeBatch();this._sessionLength=o.length,this._sessionByteLength=o.byteLength,this._sessionBatch=a,null!==this._cachedBatch&&this._cachedBatch.prune(o.length);const l=this._appends===this._appendsActual;return this._appends=this._appends.slice(n),this._appendsActual=l?this._appends:this._appendsActual.slice(n),this._byteLength-=h,this.emit("flush"),!0}close(){return this.closing||(this.closing=this._close()),this.closing}async _close(){this._clearAppends(),await this.session.close(),this.closed=!0,this.emit("close");}_clearAppends(){this._appends=[],this._appendsActual=[],this._byteLength=0,this.fork=0;}},{manifestHash:On,createManifest:Nn}=gi,{ReadStream:In,WriteStream:Fn,ByteStream:Tn}=fn,{ASSERTION:Kn,BAD_ARGUMENT:zn,SESSION_CLOSED:Hn,SESSION_NOT_WRITABLE:Wn,SNAPSHOT_NOT_AVAILABLE:Vn,DECODING_ERROR:Gn}=E$6,Qn=Symbol.for("hypercore.promises"),jn=Symbol.for("nodejs.util.inspect.custom"),Yn=15728640;var Xn=class e extends _n{constructor(e,t,s){super(),mn(e)?(s=e,e=null,t=s.key||null):mn(t)&&(t=(s=t).key||null),t&&"string"==typeof t&&(t=Rn.decode(t)),s||(s={}),e||(e=s.storage),this[Qn]=!0,this.tracer=qn(this),this.storage=null,this.crypto=s.crypto||bn,this.core=null,this.replicator=null,this.encryption=null,this.extensions=new Map,this.cache=tr(s.cache),this.valueEncoding=null,this.encodeBatch=null,this.activeRequests=[],this.id=null,this.key=t||null,this.keyPair=s.keyPair||null,this.readable=!0,this.writable=!1,this.opened=!1,this.closed=!1,this.snapshotted=!!s.snapshot,this.sparse=!1!==s.sparse,this.sessions=s._sessions||[this],this.autoClose=!!s.autoClose,this.onwait=s.onwait||null,this.wait=!1!==s.wait,this.timeout=s.timeout||0,this.closing=null,this.opening=null,this._readonly=!1===s.writable,this._preappend=$n.bind(this),this._snapshot=null,this._findingPeers=0,this._active=!1!==s.active,this.opening=this._openSession(t,e,s),this.opening.catch(Sn);}[jn](e,t){let s="";if("number"==typeof t.indentationLvl)for(;s.length<t.indentationLvl;)s+=" ";let i="";const n=Math.min(this.peers.length,5);for(let e=0;e<n;e++){const n=this.peers[e];i+=s+"    Peer(\n",i+=s+"      remotePublicKey: "+t.stylize(Jn(n.remotePublicKey),"string")+"\n",i+=s+"      remoteLength: "+t.stylize(n.remoteLength,"number")+"\n",i+=s+"      remoteFork: "+t.stylize(n.remoteFork,"number")+"\n",i+=s+"      remoteCanUpgrade: "+t.stylize(n.remoteCanUpgrade,"boolean")+"\n",i+=s+"    )\n";}return this.peers.length>5&&(i+=s+"  ... and "+(this.peers.length-5)+" more\n"),i=i?"[\n"+i+s+"  ]":"[ "+t.stylize(0,"number")+" ]",this.constructor.name+"(\n"+s+"  id: "+t.stylize(this.id,"string")+"\n"+s+"  key: "+t.stylize(Jn(this.key),"string")+"\n"+s+"  discoveryKey: "+t.stylize(Jn(this.discoveryKey),"string")+"\n"+s+"  opened: "+t.stylize(this.opened,"boolean")+"\n"+s+"  closed: "+t.stylize(this.closed,"boolean")+"\n"+s+"  snapshotted: "+t.stylize(this.snapshotted,"boolean")+"\n"+s+"  sparse: "+t.stylize(this.sparse,"boolean")+"\n"+s+"  writable: "+t.stylize(this.writable,"boolean")+"\n"+s+"  length: "+t.stylize(this.length,"number")+"\n"+s+"  fork: "+t.stylize(this.fork,"number")+"\n"+s+"  sessions: [ "+t.stylize(this.sessions.length,"number")+" ]\n"+s+"  activeRequests: [ "+t.stylize(this.activeRequests.length,"number")+" ]\n"+s+"  peers: "+i+"\n"+s+")"}static MAX_SUGGESTED_BLOCK_SIZE=Yn;static key(e,{compat:t,version:s,namespace:i}={}){return wn.isBuffer(e)&&(e={version:s,signers:[{publicKey:e,namespace:i}]}),t?e.signers[0].publicKey:On(Nn(e))}static discoveryKey(e){return bn.discoveryKey(e)}static getProtocolMuxer(e){return e.noiseStream.userData}static createProtocolStream(e,t={}){let s=Ln.isProtomux(e)?e.stream:Zn(e)?e:t.stream,i=null;if(s?i=s.noiseStream:(i=new vn(e,null,t),s=i.rawStream),!i)throw zn("Invalid stream");if(!i.userData){const e=Ln.from(i);!1!==t.keepAlive&&i.setKeepAlive(5e3),i.userData=e;}return t.ondiscoverykey&&i.userData.pair({protocol:"hypercore/alpha"},t.ondiscoverykey),s}static defaultStorage(e,t={}){if("string"!=typeof e){if("function"!=typeof(s=e)||!s.prototype||"function"!=typeof s.prototype.open)return e;const t=e;return e=>new t(e)}var s;const n=t.unlocked?null:t.lock||"oplog";t.pool||(t.poolSize?yn.createPool(t.poolSize):null);!!t.rmdir;!1!==t.writable;return function(e){null!==n&&a(e,n);a(e,"data")||a(e,"bitfield")||a(e,"tree");return new yn()};function a(e,t){return e===t||e.endsWith("/"+t)}}snapshot(e){return this.session({...e,snapshot:!0})}session(t={}){if(this.closing)throw Hn("Cannot make sessions on a closing core");const s=!1!==t.sparse&&this.sparse,i=!1!==t.wait&&this.wait,n=!1!==t.writable&&!this._readonly,r=void 0===t.onwait?this.onwait:t.onwait,o=void 0===t.timeout?this.timeout:t.timeout,h=new(t.class||e)(this.storage,this.key,{...t,sparse:s,wait:i,onwait:r,timeout:o,writable:n,_opening:this.opening,_sessions:this.sessions});return h._passCapabilities(this),!1!==t.cache&&(h.cache=!0!==t.cache&&t.cache?t.cache:this.cache),this.opened&&er(h,t),this._addSession(h),h}_addSession(e){this.sessions.push(e),this.core&&this.core.active++;}async setEncryptionKey(e,t){this.opened||await this.opening,this.encryption=e?new An(e,this.key,{compat:this.core.compat,...t}):null;}setKeyPair(e){this.keyPair=e,this.writable=this._isWritable();}setActive(e){const t=!!e;t===this._active||this.closing||(this._active=t,this.opened&&this.replicator.updateActivity(this._active?1:-1));}_passCapabilities(e){this.keyPair||(this.keyPair=e.keyPair),this.crypto=e.crypto,this.id=e.id,this.key=e.key,this.core=e.core,this.replicator=e.replicator,this.encryption=e.encryption,this.writable=this._isWritable(),this.autoClose=e.autoClose,e.core&&this.tracer.setParent(e.core.tracer),this.snapshotted&&this.core&&!this._snapshot&&this._updateSnapshot();}async _openFromExisting(e,t){e.opened||await e.opening;const s=this.sessions;for(const t of s)t.sessions=e.sessions,t._passCapabilities(e),t._addSession(t);if(this.storage=e.storage,this.replicator.findingPeers+=this._findingPeers,er(this,t),this.encryption&&!e.encryption)for(const e of s)e.encryption=this.encryption;}async _openSession(e,t,s){const i=!s._opening;if(i||await s._opening,s.preload&&(s={...s,...await this._retryPreload(s.preload)}),null===this.cache&&s.cache&&(this.cache=tr(s.cache)),i){if(await this._openCapabilities(e,t,s),!s.from)for(let e=0;e<this.sessions.length;e++){const t=this.sessions[e];t!==this&&t._passCapabilities(this);}}else er(this,s);s.manifest&&!this.core.header.manifest&&await this.core.setManifest(s.manifest),this.writable=this._isWritable(),s.valueEncoding&&(this.valueEncoding=kn.from(s.valueEncoding)),s.encodeBatch&&(this.encodeBatch=s.encodeBatch),this.sparse||this.download({start:0,end:-1}),s._preready&&await s._preready(this),this.replicator.updateActivity(this._active?1:0),this.opened=!0,this.emit("ready");}async _retryPreload(e){for(;;){const t=await e(),s=t&&t.from;if(!s||(s.opened||await s.ready(),!s.closing))return t}}async _openCapabilities(t,s,i){if(i.from)return this._openFromExisting(i.from,i);const n=!!i.unlocked;if(this.storage=e.defaultStorage(i.storage||s,{unlocked:n,writable:!n}),this.core=await En.open(this.storage,{compat:i.compat,force:i.force,sessions:this.sessions,createIfMissing:i.createIfMissing,readonly:n,overwrite:i.overwrite,key:t,keyPair:i.keyPair,crypto:this.crypto,legacy:i.legacy,manifest:i.manifest,globalCache:i.globalCache||null,onupdate:this._oncoreupdate.bind(this),onconflict:this._oncoreconflict.bind(this)}),this.tracer.setParent(this.core.tracer),i.userData)for(const[e,t]of Object.entries(i.userData))await this.core.userData(e,t);this.key=this.core.header.key,this.keyPair=this.core.header.keyPair,this.id=Pn.encode(this.key),this.replicator=new Un(this.core,this.key,{eagerUpgrade:!0,notDownloadingLinger:i.notDownloadingLinger,allowFork:!1!==i.allowFork,inflightRange:i.inflightRange,onpeerupdate:this._onpeerupdate.bind(this),onupload:this._onupload.bind(this),oninvalid:this._oninvalid.bind(this)}),this.replicator.findingPeers+=this._findingPeers,!this.encryption&&i.encryptionKey&&(this.encryption=new An(i.encryptionKey,this.key,{compat:this.core.compat,isBlockKey:i.isBlockKey}));}_getSnapshot(){return this.sparse?{length:this.core.tree.length,byteLength:this.core.tree.byteLength,fork:this.core.tree.fork,compatLength:this.core.tree.length}:{length:this.core.header.hints.contiguousLength,byteLength:0,fork:this.core.tree.fork,compatLength:this.core.header.hints.contiguousLength}}_updateSnapshot(){const e=this._snapshot,t=this._snapshot=this._getSnapshot();return !e||(e.length!==t.length||e.fork!==t.fork)}_isWritable(){return !this._readonly&&!(!this.keyPair||!this.keyPair.secretKey)}close(e){return this.closing||(this.closing=this._close(e||null)),this.closing}async _close(e){!1===this.opened&&await this.opening;const t=this.sessions.indexOf(this);if(-1===t)return;this.sessions.splice(t,1),this.core.active--,this.readable=!1,this.writable=!1,this.closed=!0,this.opened=!1;const s=[];for(const e of this.extensions.values())e.session===this&&s.push(e);for(const e of s)e.destroy();if(null!==this.replicator&&(this.replicator.findingPeers-=this._findingPeers,this.replicator.clearRequests(this.activeRequests,e),this.replicator.updateActivity(this._active?-1:0)),this._findingPeers=0,this.sessions.length||this.core.active>0)return 1===this.sessions.length&&1===this.core.active&&this.autoClose&&await this.sessions[0].close(e),void this.emit("close",!1);null!==this.replicator&&this.replicator.destroy(),await this.core.close(),this.emit("close",!0);}replicate(t,s={}){if(Ln.isProtomux(t))return this._attachToMuxer(t,s);if(Zn(t)&&this._isAttached(t))return t;const i=e.createProtocolStream(t,s),n=i.noiseStream.userData,r=!!s.session;return this._attachToMuxer(n,r),i}_isAttached(e){return e.userData&&this.replicator&&this.replicator.attached(e.userData)}_attachToMuxer(e,t){return this.opened?this._attachToMuxerOpened(e,t):this.opening.then(this._attachToMuxerOpened.bind(this,e,t),e.destroy.bind(e)),e}_attachToMuxerOpened(e,t){this.replicator.attachTo(e,t);}get discoveryKey(){return null===this.replicator?null:this.replicator.discoveryKey}get manifest(){return null===this.core?null:this.core.header.manifest}get length(){return this._snapshot?this._snapshot.length:null===this.core?0:this.sparse?this.core.tree.length:this.contiguousLength}get indexedLength(){return this.length}get byteLength(){return this._snapshot?this._snapshot.byteLength:null===this.core?0:this.sparse?this.core.tree.byteLength-this.core.tree.length*this.padding:this.contiguousByteLength}get contiguousLength(){return null===this.core?0:Math.min(this.core.tree.length,this.core.header.hints.contiguousLength)}get contiguousByteLength(){return 0}get fork(){return null===this.core?0:this.core.tree.fork}get peers(){return null===this.replicator?[]:this.replicator.peers}get encryptionKey(){return this.encryption&&this.encryption.key}get padding(){return null===this.encryption?0:this.encryption.padding}get globalCache(){return this.core&&this.core.globalCache}ready(){return this.opening}_onupload(e,t,s){const i=t.byteLength-this.padding;for(let t=0;t<this.sessions.length;t++)this.sessions[t].emit("upload",e,i,s);}_oninvalid(e,t,s,i){for(let n=0;n<this.sessions.length;n++)this.sessions[n].emit("verification-error",e,t,s,i);}async _oncoreconflict(e,t){await this.replicator.onconflict(t);for(const t of this.sessions)t.emit("conflict",e.upgrade.length,e.fork,e);const s=new Error("Two conflicting signatures exist for length "+e.upgrade.length);await this._closeAllSessions(s);}async _closeAllSessions(e){const t=[...this.sessions],s=[];for(const i of t)s.push(i.close(e));await Promise.allSettled(s);}_oncoreupdate(e,t,s,i){if(0!==e){const s=0!=(8&e),i=0!=(4&e),n=0!=(2&e),r=0!=(1&e);if(n&&this.replicator.ontruncate(t.start,t.length),0!=(19&e)&&this.replicator.onupgrade(),16&e){for(let e=0;e<this.sessions.length;e++){const t=this.sessions[e];t.encryption&&t.encryption.compat!==this.core.compat&&(t.encryption=new An(t.encryption.key,this.key,{compat:this.core.compat,isBlockKey:t.encryption.isBlockKey}));}for(let e=0;e<this.sessions.length;e++)this.sessions[e].emit("manifest");}for(let e=0;e<this.sessions.length;e++){const o=this.sessions[e];n&&(o.cache&&o.cache.clear(),o._snapshot&&t.start<o._snapshot.compatLength&&(o._snapshot.compatLength=t.start)),(o.sparse?n:s)&&o.emit("truncate",t.start,this.core.tree.fork),(o.sparse?r:i)&&o.emit("append");}const o=this.core.header.hints.contiguousLength;if(i&&o===this.core.tree.length)for(const e of this.peers)e.broadcastedNonSparse||(e.broadcastRange(0,o),e.broadcastedNonSparse=!0);}if(t&&this.replicator.onhave(t.start,t.length,t.drop),s){const e=s.byteLength-this.padding;for(let s=0;s<this.sessions.length;s++)this.sessions[s].emit("download",t.start,e,i);}}_onpeerupdate(e,t){const s=e?"peer-add":"peer-remove";for(let i=0;i<this.sessions.length;i++)if(this.sessions[i].emit(s,t),e)for(const e of this.sessions[i].extensions.values())t.extensions.set(e.name,e);}async setUserData(e,t,{flush:s=!1}={}){return !1===this.opened&&await this.opening,this.core.userData(e,t,s)}async getUserData(e){!1===this.opened&&await this.opening;for(const{key:t,value:s}of this.core.header.userData)if(e===t)return s;return null}createTreeBatch(){return this.core.tree.batch()}findingPeers(){this._findingPeers++,null===this.replicator||this.closing||this.replicator.findingPeers++;let e=!0;return ()=>{!this.closing&&e&&(e=!1,this._findingPeers--,null!==this.replicator&&0==--this.replicator.findingPeers&&this.replicator.updateAll());}}async info(e){return !1===this.opened&&await this.opening,Mn.from(this,e)}async update(e){if(!1===this.opened&&await this.opening,null!==this.closing)return !1;if(this.writable&&(!e||!0!==e.force))return !!this.snapshotted&&this._updateSnapshot();const t=this._shouldWait(e,this.replicator.findingPeers>0);let s=!1;if(await this.replicator.applyPendingReorg()&&(s=!0),!s&&t){const t=e&&e.activeRequests||this.activeRequests,i=this.replicator.addUpgrade(t);s=await i.promise;}return !!s&&(!this.snapshotted||this._updateSnapshot())}batch({checkout:e=-1,autoClose:t=!0,session:s=!0,restore:i=!1,clear:n=!1}={}){return new Cn(s?this.session():this,e,t,i,n)}async seek(e,t){if(!1===this.opened&&await this.opening,!sr(e))throw Kn("seek is invalid");const s=(t&&t.tree||this.core.tree).seek(e,this.padding),i=await s.update();if(i)return i;if(null!==this.closing)throw Hn();if(!this._shouldWait(t,this.wait))return null;const n=t&&t.activeRequests||this.activeRequests,r=this.replicator.addSeek(n,s),o=t&&void 0!==t.timeout?t.timeout:this.timeout;return o&&r.context.setTimeout(r,o),r.promise}async has(e,t=e+1){if(!1===this.opened&&await this.opening,!sr(e)||!sr(t))throw Kn("has range is invalid");if(t===e+1)return this.core.bitfield.get(e);const s=this.core.bitfield.firstUnset(e);return -1===s||s>=t}async get(e,t){if(!1===this.opened&&await this.opening,!sr(e))throw Kn("block index is invalid");if(this.tracer.trace("get",{index:e}),null!==this.closing)throw Hn();if(null!==this._snapshot&&e>=this._snapshot.compatLength)throw Vn();const s=t&&t.valueEncoding&&kn.from(t.valueEncoding)||this.valueEncoding;let i=this.cache&&this.cache.get(e);i||(i=this._get(e,t));let n=await i;return n?t&&t.raw?n:(!this.encryption||t&&!1===t.decrypt||(n=wn.from(n),this.encryption.decrypt(e,n)),this._decode(s,n)):null}async clear(e,t=e+1,s){if(!1===this.opened&&await this.opening,null!==this.closing)throw Hn();if("object"==typeof t&&(s=t,t=e+1),!sr(e)||!sr(t))throw Kn("clear range is invalid");const i=s&&s.diff?{blocks:0}:null;return e>=t||e>=this.length||await this.core.clear(e,t,i),i}async purge(){await this._closeAllSessions(null),await this.core.purge();}async _get(e,t){let s;if(this.core.bitfield.get(e)){const i=t&&t.tree||this.core.tree;s=this.core.blocks.get(e,i),this.cache&&this.cache.set(e,s);}else {if(!this._shouldWait(t,this.wait))return null;t&&t.onwait&&t.onwait(e,this),this.onwait&&this.onwait(e,this);const i=t&&t.activeRequests||this.activeRequests,n=this.replicator.addBlock(i,e);n.snapshot=e<this.length;const r=t&&void 0!==t.timeout?t.timeout:this.timeout;r&&n.context.setTimeout(n,r),s=this._cacheOnResolve(e,n.promise,this.core.tree.fork);}return s}async _cacheOnResolve(e,t,s){const i=await t,n=null!==i&&2*i.byteLength<i.buffer.byteLength?Bn(i):i;return this.cache&&s===this.core.tree.fork&&this.cache.set(e,Promise.resolve(n)),n}_shouldWait(e,t){if(e){if(!1===e.wait)return !1;if(!0===e.wait)return !0}return t}createReadStream(e){return new In(this,e)}createWriteStream(e){return new Fn(this,e)}createByteStream(e){return new Tn(this,e)}download(e){const t=this._download(e);return t.catch(Sn),new Dn(t)}async _download(e){!1===this.opened&&await this.opening,this.tracer.trace("download",{range:e});const t=e&&e.activeRequests||this.activeRequests;return this.replicator.addRange(t,e)}undownload(e){e.destroy(null);}cancel(e){}async truncate(e=0,t={}){!1===this.opened&&await this.opening;const{fork:s=this.core.tree.fork+1,keyPair:i=this.keyPair,signature:n=null}="number"==typeof t?{fork:t}:t;if(!1===(!this._readonly&&!!(n||i&&i.secretKey))&&(e>0||s!==this.core.tree.fork))throw Wn();await this.core.truncate(e,s,{keyPair:i,signature:n}),this.replicator.updateAll();}async append(e,t={}){!1===this.opened&&await this.opening;const{keyPair:s=this.keyPair,signature:i=null}=t;if(!1===(!this._readonly&&!!(i||s&&s.secretKey)))throw Wn();e=Array.isArray(e)?e:[e],this.tracer.trace("append",{blocks:e});const n=this.encryption&&this._preappend,r=null!==this.encodeBatch?this.encodeBatch(e):new Array(e.length);if(null===this.encodeBatch)for(let t=0;t<e.length;t++)r[t]=this._encode(this.valueEncoding,e[t]);for(const e of r)if(e.byteLength>Yn)throw zn("Appended block exceeds the maximum suggested block size");return this.core.append(r,{keyPair:s,signature:i,preappend:n})}async treeHash(e){void 0===e&&(await this.ready(),e=this.core.tree.length);const t=await this.core.tree.getRoots(e);return this.crypto.tree(t)}registerExtension(e,t={}){if(this.extensions.has(e)){const s=this.extensions.get(e);return s.handlers=t,s.encoding=kn.from(t.encoding||kn.buffer),s.session=this,s}const s={name:e,handlers:t,encoding:kn.from(t.encoding||kn.buffer),session:this,send(t,s){const i=kn.encode(this.encoding,t);s.extension(e,i);},broadcast(t){const s=kn.encode(this.encoding,t);for(const t of this.session.peers)t.extension(e,s);},destroy(){for(const t of this.session.peers)t.extensions.get(e)===s&&t.extensions.delete(e);this.session.extensions.delete(e);},_onmessage(e,t){const s=this.encoding.decode(e);this.handlers.onmessage&&this.handlers.onmessage(s,t);}};this.extensions.set(e,s);for(const t of this.peers)t.extensions.set(e,s);return s}_encode(e,t){const s={start:this.padding,end:this.padding,buffer:null};if(wn.isBuffer(t)){if(0===s.start)return t;s.end+=t.byteLength;}else if(e)e.preencode(s,t);else {if(t=wn.from(t),0===s.start)return t;s.end+=t.byteLength;}return s.buffer=wn.allocUnsafe(s.end),e?e.encode(s,t):s.buffer.set(t,s.start),s.buffer}_decode(e,t){this.padding&&(t=t.subarray(this.padding));try{if(e)return kn.decode(e,t)}catch{throw Gn()}return t}};function Zn(e){return "object"==typeof e&&e&&"function"==typeof e.pipe}function Jn(e){return e&&wn.toString(e,"hex")}function $n(e){const t=this.core.tree.length,s=this.core.tree.fork;for(let i=0;i<e.length;i++)this.encryption.encrypt(t+i,e[i],s);}function er(e,t){t.encryptionKey&&(e.encryption&&wn.equals(e.encryption.key,t.encryptionKey)&&e.encryption.compat===e.core.compat||(e.encryption=new An(t.encryptionKey,e.key,{compat:!e.core||e.core.compat,isBlockKey:t.isBlockKey})));}function tr(e){return !0===e?new xn({maxSize:65536,maxAge:0}):e||null}function sr(e){return 0===e||e>0}

/**
 * Bundled by jsDelivr using Rollup v2.79.1 and Terser v5.19.2.
 * Original file: /npm/hypercore@10.37.23/lib/multisig.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
var i$4={},u$5={};const s$4=o$e,a$3=m$a,p$4=L$c,l=t$g,[f$4,g$4,h$2,b$3,m$3,y$2]=s$4.namespace("hypercore",6);u$5.MANIFEST=b$3,u$5.DEFAULT_NAMESPACE=m$3,u$5.BLOCK_ENCRYPTION=y$2,u$5.replicate=function(e,n,d){const o=p$4.allocUnsafe(32);return a$3.crypto_generichash_batch(o,[e?g$4:h$2,n],d),o},u$5.treeSignable=function(e,n,d,o){const t={start:0,end:112,buffer:p$4.allocUnsafe(112)};return l.fixed32.encode(t,f$4),l.fixed32.encode(t,e),l.fixed32.encode(t,n),l.uint64.encode(t,d),l.uint64.encode(t,o),t.buffer},u$5.treeSignableCompat=function(e,n,d,o){const t=o?48:80,c={start:0,end:t,buffer:p$4.allocUnsafe(t)};return o||l.fixed32.encode(c,f$4),l.fixed32.encode(c,e),l.uint64.encode(c,n),l.uint64.encode(c,d),c.buffer};const k$3=t$g,x$3=L$c,{DEFAULT_NAMESPACE:w$5}=u$5,{INVALID_OPLOG_VERSION:v$3}=E$6,q$3=n$a,P$3=x$3.alloc(0),U$3={preencode(e,n){e.end++;},encode(e,n){if("blake2b"!==n)throw new Error("Unknown hash: "+n);k$3.uint.encode(e,0);},decode(e){const n=k$3.uint.decode(e);if(0===n)return "blake2b";throw new Error("Unknown hash id: "+n)}},D$3={preencode(e,n){e.end++;},encode(e,n){if("ed25519"!==n)throw new Error("Unknown signature: "+n);k$3.uint.encode(e,0);},decode(e){const n=k$3.uint.decode(e);if(0===n)return "ed25519";throw new Error("Unknown signature id: "+n)}},E$3={preencode(e,n){D$3.preencode(e,n.signature),k$3.fixed32.preencode(e,n.namespace),k$3.fixed32.preencode(e,n.publicKey);},encode(e,n){D$3.encode(e,n.signature),k$3.fixed32.encode(e,n.namespace),k$3.fixed32.encode(e,n.publicKey);},decode:e=>({signature:D$3.decode(e),namespace:k$3.fixed32.decode(e),publicKey:k$3.fixed32.decode(e)})},L$3=k$3.array(E$3),N$3={preencode(e,n){k$3.fixed32.preencode(e,n.hash),k$3.uint.preencode(e,n.length);},encode(e,n){k$3.fixed32.encode(e,n.hash),k$3.uint.encode(e,n.length);},decode:e=>({hash:k$3.fixed32.decode(e),length:k$3.uint.decode(e)})},S$3={preencode(e,n){U$3.preencode(e,n.hash),e.end++,n.prologue&&0===n.signers.length?k$3.fixed32.preencode(e,n.prologue.hash):1!==n.quorum||1!==n.signers.length||n.allowPatch?(e.end++,k$3.uint.preencode(e,n.quorum),L$3.preencode(e,n.signers)):E$3.preencode(e,n.signers[0]);},encode(e,n){if(U$3.encode(e,n.hash),n.prologue&&0===n.signers.length)return k$3.uint.encode(e,0),void k$3.fixed32.encode(e,n.prologue.hash);1!==n.quorum||1!==n.signers.length||n.allowPatch?(k$3.uint.encode(e,2),k$3.uint.encode(e,n.allowPatch?1:0),k$3.uint.encode(e,n.quorum),L$3.encode(e,n.signers)):(k$3.uint.encode(e,1),E$3.encode(e,n.signers[0]));},decode(e){const n=U$3.decode(e),d=k$3.uint.decode(e);if(d>2)throw new Error("Unknown type: "+d);if(0===d)return {version:0,hash:n,allowPatch:!1,quorum:0,signers:[],prologue:{hash:k$3.fixed32.decode(e),length:0}};if(1===d)return {version:0,hash:n,allowPatch:!1,quorum:1,signers:[E$3.decode(e)],prologue:null};return {version:0,hash:n,allowPatch:0!=(1&k$3.uint.decode(e)),quorum:k$3.uint.decode(e),signers:L$3.decode(e),prologue:null}}},K$3=i$4.manifest={preencode(e,n){if(e.end++,0===n.version)return S$3.preencode(e,n);e.end++,U$3.preencode(e,n.hash),k$3.uint.preencode(e,n.quorum),L$3.preencode(e,n.signers),n.prologue&&N$3.preencode(e,n.prologue);},encode(e,n){if(k$3.uint.encode(e,n.version),0===n.version)return S$3.encode(e,n);k$3.uint.encode(e,(n.allowPatch?1:0)|(n.prologue?2:0)),U$3.encode(e,n.hash),k$3.uint.encode(e,n.quorum),L$3.encode(e,n.signers),n.prologue&&N$3.encode(e,n.prologue);},decode(e){const n=k$3.uint.decode(e);if(0===n)return S$3.decode(e);if(1!==n)throw new Error("Unknown version: "+n);const d=k$3.uint.decode(e);return {version:1,hash:U$3.decode(e),allowPatch:0!=(1&d),quorum:k$3.uint.decode(e),signers:L$3.decode(e),prologue:0==(2&d)?null:N$3.decode(e)}}},z$3={preencode(e,n){k$3.uint.preencode(e,n.index),k$3.uint.preencode(e,n.size),k$3.fixed32.preencode(e,n.hash);},encode(e,n){k$3.uint.encode(e,n.index),k$3.uint.encode(e,n.size),k$3.fixed32.encode(e,n.hash);},decode:e=>({index:k$3.uint.decode(e),size:k$3.uint.decode(e),hash:k$3.fixed32.decode(e)})},A$3=k$3.array(z$3),_$3=i$4.wire={};_$3.handshake={preencode(e,n){k$3.uint.preencode(e,1),k$3.fixed32.preencode(e,n.capability);},encode(e,n){k$3.uint.encode(e,n.seeks?1:0),k$3.fixed32.encode(e,n.capability);},decode:e=>({seeks:0!=(1&k$3.uint.decode(e)),capability:q$3(k$3.fixed32.decode(e))})};const I$3={preencode(e,n){k$3.uint.preencode(e,n.index),k$3.uint.preencode(e,n.nodes);},encode(e,n){k$3.uint.encode(e,n.index),k$3.uint.encode(e,n.nodes);},decode:e=>({index:k$3.uint.decode(e),nodes:k$3.uint.decode(e)})},C$3={preencode(e,n){k$3.uint.preencode(e,n.bytes),k$3.uint.preencode(e,n.padding);},encode(e,n){k$3.uint.encode(e,n.bytes),k$3.uint.encode(e,n.padding);},decode:e=>({bytes:k$3.uint.decode(e),padding:k$3.uint.decode(e)})},M$5={preencode(e,n){k$3.uint.preencode(e,n.start),k$3.uint.preencode(e,n.length);},encode(e,n){k$3.uint.encode(e,n.start),k$3.uint.encode(e,n.length);},decode:e=>({start:k$3.uint.decode(e),length:k$3.uint.decode(e)})};_$3.request={preencode(e,n){e.end++,k$3.uint.preencode(e,n.id),k$3.uint.preencode(e,n.fork),n.block&&I$3.preencode(e,n.block),n.hash&&I$3.preencode(e,n.hash),n.seek&&C$3.preencode(e,n.seek),n.upgrade&&M$5.preencode(e,n.upgrade),n.priority&&k$3.uint.preencode(e,n.priority);},encode(e,n){const d=(n.block?1:0)|(n.hash?2:0)|(n.seek?4:0)|(n.upgrade?8:0)|(n.manifest?16:0)|(n.priority?32:0);k$3.uint.encode(e,d),k$3.uint.encode(e,n.id),k$3.uint.encode(e,n.fork),n.block&&I$3.encode(e,n.block),n.hash&&I$3.encode(e,n.hash),n.seek&&C$3.encode(e,n.seek),n.upgrade&&M$5.encode(e,n.upgrade),n.priority&&k$3.uint.encode(e,n.priority);},decode(e){const n=k$3.uint.decode(e);return {id:k$3.uint.decode(e),fork:k$3.uint.decode(e),block:1&n?I$3.decode(e):null,hash:2&n?I$3.decode(e):null,seek:4&n?C$3.decode(e):null,upgrade:8&n?M$5.decode(e):null,manifest:0!=(16&n),priority:32&n?k$3.uint.decode(e):0}}},_$3.cancel={preencode(e,n){k$3.uint.preencode(e,n.request);},encode(e,n){k$3.uint.encode(e,n.request);},decode:(e,n)=>({request:k$3.uint.decode(e)})};const O$3={preencode(e,n){k$3.uint.preencode(e,n.start),k$3.uint.preencode(e,n.length),A$3.preencode(e,n.nodes),A$3.preencode(e,n.additionalNodes),k$3.buffer.preencode(e,n.signature);},encode(e,n){k$3.uint.encode(e,n.start),k$3.uint.encode(e,n.length),A$3.encode(e,n.nodes),A$3.encode(e,n.additionalNodes),k$3.buffer.encode(e,n.signature);},decode:e=>({start:k$3.uint.decode(e),length:k$3.uint.decode(e),nodes:A$3.decode(e),additionalNodes:A$3.decode(e),signature:k$3.buffer.decode(e)})},H$3={preencode(e,n){k$3.uint.preencode(e,n.bytes),A$3.preencode(e,n.nodes);},encode(e,n){k$3.uint.encode(e,n.bytes),A$3.encode(e,n.nodes);},decode:e=>({bytes:k$3.uint.decode(e),nodes:A$3.decode(e)})},T$3={preencode(e,n){k$3.uint.preencode(e,n.index),k$3.buffer.preencode(e,n.value),A$3.preencode(e,n.nodes);},encode(e,n){k$3.uint.encode(e,n.index),k$3.buffer.encode(e,n.value),A$3.encode(e,n.nodes);},decode:e=>({index:k$3.uint.decode(e),value:k$3.buffer.decode(e)||P$3,nodes:A$3.decode(e)})},F$3={preencode(e,n){k$3.uint.preencode(e,n.index),A$3.preencode(e,n.nodes);},encode(e,n){k$3.uint.encode(e,n.index),A$3.encode(e,n.nodes);},decode:e=>({index:k$3.uint.decode(e),nodes:A$3.decode(e)})};_$3.data={preencode(e,n){e.end++,k$3.uint.preencode(e,n.request),k$3.uint.preencode(e,n.fork),n.block&&T$3.preencode(e,n.block),n.hash&&F$3.preencode(e,n.hash),n.seek&&H$3.preencode(e,n.seek),n.upgrade&&O$3.preencode(e,n.upgrade),n.manifest&&K$3.preencode(e,n.manifest);},encode(e,n){const d=(n.block?1:0)|(n.hash?2:0)|(n.seek?4:0)|(n.upgrade?8:0)|(n.manifest?16:0);k$3.uint.encode(e,d),k$3.uint.encode(e,n.request),k$3.uint.encode(e,n.fork),n.block&&T$3.encode(e,n.block),n.hash&&F$3.encode(e,n.hash),n.seek&&H$3.encode(e,n.seek),n.upgrade&&O$3.encode(e,n.upgrade),n.manifest&&K$3.encode(e,n.manifest);},decode(e){const n=k$3.uint.decode(e);return {request:k$3.uint.decode(e),fork:k$3.uint.decode(e),block:1&n?T$3.decode(e):null,hash:2&n?F$3.decode(e):null,seek:4&n?H$3.decode(e):null,upgrade:8&n?O$3.decode(e):null,manifest:16&n?K$3.decode(e):null}}},_$3.noData={preencode(e,n){k$3.uint.preencode(e,n.request);},encode(e,n){k$3.uint.encode(e,n.request);},decode:(e,n)=>({request:k$3.uint.decode(e)})},_$3.want={preencode(e,n){k$3.uint.preencode(e,n.start),k$3.uint.preencode(e,n.length);},encode(e,n){k$3.uint.encode(e,n.start),k$3.uint.encode(e,n.length);},decode:e=>({start:k$3.uint.decode(e),length:k$3.uint.decode(e)})},_$3.unwant={preencode(e,n){k$3.uint.preencode(e,n.start),k$3.uint.preencode(e,n.length);},encode(e,n){k$3.uint.encode(e,n.start),k$3.uint.encode(e,n.length);},decode:(e,n)=>({start:k$3.uint.decode(e),length:k$3.uint.decode(e)})},_$3.range={preencode(e,n){e.end++,k$3.uint.preencode(e,n.start),1!==n.length&&k$3.uint.preencode(e,n.length);},encode(e,n){k$3.uint.encode(e,(n.drop?1:0)|(1===n.length?2:0)),k$3.uint.encode(e,n.start),1!==n.length&&k$3.uint.encode(e,n.length);},decode(e){const n=k$3.uint.decode(e);return {drop:0!=(1&n),start:k$3.uint.decode(e),length:0!=(2&n)?1:k$3.uint.decode(e)}}},_$3.bitfield={preencode(e,n){k$3.uint.preencode(e,n.start),k$3.uint32array.preencode(e,n.bitfield);},encode(e,n){k$3.uint.encode(e,n.start),k$3.uint32array.encode(e,n.bitfield);},decode:(e,n)=>({start:k$3.uint.decode(e),bitfield:k$3.uint32array.decode(e)})},_$3.sync={preencode(e,n){e.end++,k$3.uint.preencode(e,n.fork),k$3.uint.preencode(e,n.length),k$3.uint.preencode(e,n.remoteLength);},encode(e,n){k$3.uint.encode(e,(n.canUpgrade?1:0)|(n.uploading?2:0)|(n.downloading?4:0)|(n.hasManifest?8:0)),k$3.uint.encode(e,n.fork),k$3.uint.encode(e,n.length),k$3.uint.encode(e,n.remoteLength);},decode(e){const n=k$3.uint.decode(e);return {fork:k$3.uint.decode(e),length:k$3.uint.decode(e),remoteLength:k$3.uint.decode(e),canUpgrade:0!=(1&n),uploading:0!=(2&n),downloading:0!=(4&n),hasManifest:0!=(8&n)}}},_$3.reorgHint={preencode(e,n){k$3.uint.preencode(e,n.from),k$3.uint.preencode(e,n.to),k$3.uint.preencode(e,n.ancestors);},encode(e,n){k$3.uint.encode(e,n.from),k$3.uint.encode(e,n.to),k$3.uint.encode(e,n.ancestors);},decode:e=>({from:k$3.uint.encode(e),to:k$3.uint.encode(e),ancestors:k$3.uint.encode(e)})},_$3.extension={preencode(e,n){k$3.string.preencode(e,n.name),k$3.raw.preencode(e,n.message);},encode(e,n){k$3.string.encode(e,n.name),k$3.raw.encode(e,n.message);},decode:e=>({name:k$3.string.decode(e),message:k$3.raw.decode(e)})};const R$3={preencode(e,n){k$3.string.preencode(e,n.key),k$3.buffer.preencode(e,n.value);},encode(e,n){k$3.string.encode(e,n.key),k$3.buffer.encode(e,n.value);},decode:e=>({key:k$3.string.decode(e),value:k$3.buffer.decode(e)})},V$3={preencode(e,n){k$3.uint.preencode(e,n.fork),k$3.uint.preencode(e,n.ancestors),k$3.uint.preencode(e,n.length),k$3.buffer.preencode(e,n.signature);},encode(e,n){k$3.uint.encode(e,n.fork),k$3.uint.encode(e,n.ancestors),k$3.uint.encode(e,n.length),k$3.buffer.encode(e,n.signature);},decode:e=>({fork:k$3.uint.decode(e),ancestors:k$3.uint.decode(e),length:k$3.uint.decode(e),signature:k$3.buffer.decode(e)})},B$3={preencode(e,n){e.end++,k$3.uint.preencode(e,n.start),k$3.uint.preencode(e,n.length);},encode(e,n){e.buffer[e.start++]=n.drop?1:0,k$3.uint.encode(e,n.start),k$3.uint.encode(e,n.length);},decode:e=>({drop:0!=(1&k$3.uint.decode(e)),start:k$3.uint.decode(e),length:k$3.uint.decode(e)})},G$3=i$4.oplog={};G$3.entry={preencode(e,n){e.end++,n.userData&&R$3.preencode(e,n.userData),n.treeNodes&&A$3.preencode(e,n.treeNodes),n.treeUpgrade&&V$3.preencode(e,n.treeUpgrade),n.bitfield&&B$3.preencode(e,n.bitfield);},encode(e,n){const d=e.start++;let o=0;n.userData&&(o|=1,R$3.encode(e,n.userData)),n.treeNodes&&(o|=2,A$3.encode(e,n.treeNodes)),n.treeUpgrade&&(o|=4,V$3.encode(e,n.treeUpgrade)),n.bitfield&&(o|=8,B$3.encode(e,n.bitfield)),e.buffer[d]=o;},decode(e){const n=k$3.uint.decode(e);return {userData:0!=(1&n)?R$3.decode(e):null,treeNodes:0!=(2&n)?A$3.decode(e):null,treeUpgrade:0!=(4&n)?V$3.decode(e):null,bitfield:0!=(8&n)?B$3.decode(e):null}}};const Y$3={preencode(e,n){k$3.buffer.preencode(e,n.publicKey),k$3.buffer.preencode(e,n.secretKey);},encode(e,n){k$3.buffer.encode(e,n.publicKey),k$3.buffer.encode(e,n.secretKey);},decode:e=>({publicKey:k$3.buffer.decode(e),secretKey:k$3.buffer.decode(e)})},j$3={preencode(e,n){k$3.uint.preencode(e,n.from),k$3.uint.preencode(e,n.to),k$3.uint.preencode(e,n.ancestors);},encode(e,n){k$3.uint.encode(e,n.from),k$3.uint.encode(e,n.to),k$3.uint.encode(e,n.ancestors);},decode:e=>({from:k$3.uint.decode(e),to:k$3.uint.decode(e),ancestors:k$3.uint.decode(e)})},J$3=k$3.array(j$3),Q$3={preencode(e,n){J$3.preencode(e,n.reorgs),k$3.uint.preencode(e,n.contiguousLength);},encode(e,n){J$3.encode(e,n.reorgs),k$3.uint.encode(e,n.contiguousLength);},decode:e=>({reorgs:J$3.decode(e),contiguousLength:e.start<e.end?k$3.uint.decode(e):0})},W$3={preencode(e,n){k$3.uint.preencode(e,n.fork),k$3.uint.preencode(e,n.length),k$3.buffer.preencode(e,n.rootHash),k$3.buffer.preencode(e,n.signature);},encode(e,n){k$3.uint.encode(e,n.fork),k$3.uint.encode(e,n.length),k$3.buffer.encode(e,n.rootHash),k$3.buffer.encode(e,n.signature);},decode:e=>({fork:k$3.uint.decode(e),length:k$3.uint.decode(e),rootHash:k$3.buffer.decode(e),signature:k$3.buffer.decode(e)})},X$3={preencode(e,n){k$3.string.preencode(e,n.tree),k$3.string.preencode(e,n.bitfield),k$3.string.preencode(e,n.signer);},encode(e,n){k$3.string.encode(e,n.tree),k$3.string.encode(e,n.bitfield),k$3.string.encode(e,n.signer);},decode:e=>({tree:k$3.string.decode(e),bitfield:k$3.string.decode(e),signer:k$3.string.decode(e)})},Z$3={preencode(e,n){k$3.uint.preencode(e,n.start),k$3.uint.preencode(e,n.length);},encode(e,n){k$3.uint.encode(e,n.start),k$3.uint.encode(e,n.length);},decode:e=>({start:k$3.uint.decode(e),length:k$3.uint.decode(e)})},$$3=k$3.array(R$3);G$3.header={preencode(e,n){e.end+=2,n.external?Z$3.preencode(e,n.external):(k$3.fixed32.preencode(e,n.key),n.manifest&&K$3.preencode(e,n.manifest),n.keyPair&&Y$3.preencode(e,n.keyPair),$$3.preencode(e,n.userData),W$3.preencode(e,n.tree),Q$3.preencode(e,n.hints));},encode(e,n){if(k$3.uint.encode(e,1),n.external)return k$3.uint.encode(e,1),void Z$3.encode(e,n.external);k$3.uint.encode(e,(n.manifest?2:0)|(n.keyPair?4:0)),k$3.fixed32.encode(e,n.key),n.manifest&&K$3.encode(e,n.manifest),n.keyPair&&Y$3.encode(e,n.keyPair),$$3.encode(e,n.userData),W$3.encode(e,n.tree),Q$3.encode(e,n.hints);},decode(e){const n=k$3.uint.decode(e);if(n>1)throw v$3("Invalid header version. Expected <= 1, got "+n);if(0===n){const n={types:X$3.decode(e),userData:$$3.decode(e),tree:W$3.decode(e),signer:Y$3.decode(e),hints:Q$3.decode(e)};return {external:null,key:n.signer.publicKey,manifest:{version:0,hash:n.types.tree,allowPatch:!1,quorum:1,signers:[{signature:n.types.signer,namespace:w$5,publicKey:n.signer.publicKey}],prologue:null},keyPair:n.signer.secretKey?n.signer:null,userData:n.userData,tree:n.tree,hints:n.hints}}const d=k$3.uint.decode(e);return 1&d?{external:Z$3.decode(e),key:null,manifest:null,keyPair:null,userData:null,tree:null,hints:null}:{external:null,key:k$3.fixed32.decode(e),manifest:0!=(2&d)?K$3.decode(e):null,keyPair:0!=(4&d)?Y$3.decode(e):null,userData:$$3.decode(e),tree:W$3.decode(e),hints:Q$3.decode(e)}}};const ee$3=k$3.array(k$3.uint),ne$3={preencode(e,n){k$3.uint.preencode(e,n.signer),k$3.fixed64.preencode(e,n.signature),k$3.uint.preencode(e,n.patch);},encode(e,n){k$3.uint.encode(e,n.signer),k$3.fixed64.encode(e,n.signature),k$3.uint.encode(e,n.patch);},decode:e=>({signer:k$3.uint.decode(e),signature:k$3.fixed64.decode(e),patch:k$3.uint.decode(e)})},de$3={preencode(e,n){k$3.uint.preencode(e,n.start),k$3.uint.preencode(e,n.length),ee$3.preencode(e,n.nodes);},encode(e,n){k$3.uint.encode(e,n.start),k$3.uint.encode(e,n.length),ee$3.encode(e,n.nodes);},decode:e=>({start:k$3.uint.decode(e),length:k$3.uint.decode(e),nodes:ee$3.decode(e)})},oe$3={preencode(e,n){e.end++,k$3.uint.preencode(e,n.signer),k$3.fixed64.preencode(e,n.signature),n.patch&&de$3.preencode(e,n.patch);},encode(e,n){k$3.uint.encode(e,n.patch?1:0),k$3.uint.encode(e,n.signer),k$3.fixed64.encode(e,n.signature),n.patch&&de$3.encode(e,n.patch);},decode(e){const n=k$3.uint.decode(e);return {signer:k$3.uint.decode(e),signature:k$3.fixed64.decode(e),patch:1&n?de$3.decode(e):null}}},te$3=k$3.array(oe$3),ce$3=k$3.array(ne$3),re$3={preencode(e,n){k$3.uint.preencode(e,n.index),k$3.uint.preencode(e,n.size),k$3.fixed32.preencode(e,n.hash);},encode(e,n){k$3.uint.encode(e,n.index),k$3.uint.encode(e,n.size),k$3.fixed32.encode(e,n.hash);},decode:e=>({index:k$3.uint.decode(e),size:k$3.uint.decode(e),hash:k$3.fixed32.decode(e)})},ie$3=k$3.array(re$3);i$4.multiSignaturev0={preencode(e,n){te$3.preencode(e,n.proofs),ie$3.preencode(e,n.patch);},encode(e,n){te$3.encode(e,n.proofs),ie$3.encode(e,n.patch);},decode:e=>({proofs:te$3.decode(e),patch:ie$3.decode(e)})},i$4.multiSignature={preencode(e,n){ce$3.preencode(e,n.proofs),ie$3.preencode(e,n.patch);},encode(e,n){ce$3.encode(e,n.proofs),ie$3.encode(e,n.patch);},decode:e=>({proofs:ce$3.decode(e),patch:ie$3.decode(e)})};const ue$3=t$g,se$3=L$c,ae$3=t$8,{multiSignature:pe$3,multiSignaturev0:le$3}=i$4;var fe$3={assemblev0:function(e){const n=[],d=[];for(const c of e)n.push((t=d,{signer:(o=c).signer,signature:o.signature,patch:o.patch?he$3(o,t):null}));var o,t;return ue$3.encode(le$3,{proofs:n,patch:d})},assemble:function(e){const n=[],d=[],o=new Set;for(const t of e){if(t.nodes)for(const e of t.nodes)o.has(e.index)||(o.add(e.index),d.push(e));n.push({signer:t.signer,signature:t.signature,patch:t.patch});}return ue$3.encode(pe$3,{proofs:n,patch:d})},inflatev0:function(e){return ue$3.decode(le$3,e)},inflate:function(e){return ue$3.decode(pe$3,e)},partialSignature:async function(e,n,d,o=e.length,t=e.signature){if(d>e.length)return null;const c=o<=d?null:await async function(e,n,d){const o=await e.proof({upgrade:{start:n,length:d-n}});return o.upgrade.nodes}(e,d,o);64!==t.byteLength&&(t=ue$3.decode(pe$3,t).proofs[0].signature);return {signer:n,signature:t,patch:c?o-d:0,nodes:c}},signableLength:function(e,n){n<=0&&(n=1);return n>e.length?0:e.sort(ge$3)[n-1]}};function ge$3(e,n){return n-e}function he$3(e,n){const d={start:ae$3.rightSpan(e.nodes[e.nodes.length-1].index)/2+1,length:e.patch,nodes:[]};for(const c of e.nodes){let e=!1;for(let r=0;r<n.length;r++)if(o=n[r],t=c,o.index===t.index&&o.size===t.size&&se$3.equals(o.hash,t.hash)){d.nodes.push(r),e=!0;break}e||d.nodes.push(n.push(c)-1);}var o,t;return d}

/**
 * Bundled by jsDelivr using Rollup v2.79.1 and Terser v5.19.2.
 * Original file: /npm/hypercore@10.37.23/errors.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
var e$3=E$6;

/**
 * Bundled by jsDelivr using Rollup v2.79.1 and Terser v5.19.2.
 * Original file: /npm/codecs@3.1.0/index.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
const n$5=L$a;var t$5=r$5;function r$5(e,t){if("object"==typeof e&&e)return (u=e).encode&&u.decode&&u.preencode?function(e){return {name:"compact-encoding",encode:function(t){const r={start:0,end:0,buffer:null,cache:null};return e.preencode(r,t),r.buffer=n$5.allocUnsafe(r.end),e.encode(r,t),r.buffer},decode:function(n){return e.decode({start:0,end:n.byteLength,buffer:n,cache:null})}}}(e):e;var u;switch(e){case"ndjson":return r$5.ndjson;case"json":return r$5.json;case"ascii":return r$5.ascii;case"utf-8":case"utf8":return r$5.utf8;case"hex":return r$5.hex;case"base64":return r$5.base64;case"ucs-2":case"ucs2":return r$5.ucs2;case"utf16-le":case"utf16le":return r$5.utf16le}return void 0!==t?t:r$5.binary}function u$4(e){return {name:e?"ndjson":"json",encode:e?function(e){return n$5.from(JSON.stringify(e)+"\n")}:function(e){return n$5.from(JSON.stringify(e))},decode:function(e){return JSON.parse(n$5.toString(e))}}}function c$3(e){return {name:e,encode:function(t){return "string"!=typeof t&&(t=t.toString()),n$5.from(t,e)},decode:function(t){return n$5.toString(t,e)}}}r$5.ascii=c$3("ascii"),r$5.utf8=c$3("utf-8"),r$5.hex=c$3("hex"),r$5.base64=c$3("base64"),r$5.ucs2=c$3("ucs2"),r$5.utf16le=c$3("utf16le"),r$5.ndjson=u$4(!0),r$5.json=u$4(!1),r$5.binary={name:"binary",encode:function(e){return "string"==typeof e?n$5.from(e,"utf-8"):n$5.toBuffer(e)},decode:function(e){return n$5.toBuffer(e)}};

/**
 * Bundled by jsDelivr using Rollup v2.79.1 and Terser v5.19.2.
 * Original file: /npm/rache@1.0.0/index.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
let t$4 = class t{constructor(t,e,a){this.key=t,this.index=e,this.map=a;}};let e$2 = class e{constructor(t,e){this.entry=t,this.value=e;}};let a$2 = class a{constructor({maxSize:t=65536,parent:e=null}={}){this.maxSize=e?.maxSize||t,this._array=e?._array||[],this._map=new Map;}static from(t){return t?new this({parent:t}):new this}get globalSize(){return this._array.length}get size(){return this._map.size}sub(){return new a({parent:this})}set(a,r){const s=this._map.get(a);if(void 0!==s)return void(s.value=r);this._array.length>=this.maxSize&&this._gc();const i=new t$4(a,this._array.length,this._map);this._array.push(i);const n=new e$2(i,r);this._map.set(a,n);}delete(t){const e=this._map.get(t);return void 0!==e&&(this._delete(e.entry.index),!0)}get(t){const e=this._map.get(t);return void 0===e?void 0:e.value}*[Symbol.iterator](){for(const[t,{value:e}]of this._map)yield [t,e];}keys(){return this._map.keys()}*values(){for(const{value:t}of this._map.values())yield t;}clear(){this._map.clear(),this._map=new Map;}destroy(){this._map=null,this._array=null;}_gc(){this._delete(Math.floor(Math.random()*this._array.length));}_delete(t){if(t>=this._array.length)throw new Error("Cannot delete unused index (logic bug?)");const e=this._array.pop();let a=e;t<this._array.length&&(a=this._array[t],e.index=t,this._array[t]=e),a.map.delete(a.key);}};var r$4=a$2;

/**
 * Bundled by jsDelivr using Rollup v2.79.1 and Terser v5.19.2.
 * Original file: /npm/varint@5.0.0/index.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
var o$3=function o(a,r,d){r=r||[];var h=d=d||0;for(;a>=n$4;)r[d++]=255&a|e$1,a/=128;for(;a&t$3;)r[d++]=255&a|e$1,a>>>=7;return r[d]=0|a,o.bytes=d-h+1,r},e$1=128,t$3=-128,n$4=Math.pow(2,31);var a$1=function o(e,t){var n,a=0,h=0,w=t=t||0,c=e.length;do{if(w>=c)throw o.bytes=0,new RangeError("Could not decode varint");n=e[w++],a+=h<28?(n&d$3)<<h:(n&d$3)*Math.pow(2,h),h+=7;}while(n>=r$3);return o.bytes=w-t,a},r$3=128,d$3=127;var h$1=Math.pow(2,7),w$4=Math.pow(2,14),c$2=Math.pow(2,21),p$3=Math.pow(2,28),M$4=Math.pow(2,35),i$3=Math.pow(2,42),u$3=Math.pow(2,49),f$3=Math.pow(2,56),g$3=Math.pow(2,63),s$3={encode:o$3,decode:a$1,encodingLength:function(o){return o<h$1?1:o<w$4?2:o<c$2?3:o<p$3?4:o<M$4?5:o<i$3?6:o<u$3?7:o<f$3?8:o<g$3?9:10}};

/**
 * Bundled by jsDelivr using Rollup v2.79.1 and Terser v5.19.2.
 * Original file: /npm/varint@5.0.2/index.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
var o$2=function o(a,r,d){r=r||[];var h=d=d||0;for(;a>=n$3;)r[d++]=255&a|e,a/=128;for(;a&t$2;)r[d++]=255&a|e,a>>>=7;return r[d]=0|a,o.bytes=d-h+1,r},e=128,t$2=-128,n$3=Math.pow(2,31);var a=function o(e,t){var n,a=0,h=0,w=t=t||0,c=e.length;do{if(w>=c)throw o.bytes=0,new RangeError("Could not decode varint");n=e[w++],a+=h<28?(n&d$2)<<h:(n&d$2)*Math.pow(2,h),h+=7;}while(n>=r$2);return o.bytes=w-t,a},r$2=128,d$2=127;var h=Math.pow(2,7),w$3=Math.pow(2,14),c$1=Math.pow(2,21),p$2=Math.pow(2,28),M$3=Math.pow(2,35),i$2=Math.pow(2,42),u$2=Math.pow(2,49),f$2=Math.pow(2,56),g$2=Math.pow(2,63),s$2={encode:o$2,decode:a,encodingLength:function(o){return o<h?1:o<w$3?2:o<c$1?3:o<p$2?4:o<M$3?5:o<i$2?6:o<u$2?7:o<f$2?8:o<g$2?9:10}};

/**
 * Bundled by jsDelivr using Rollup v2.79.1 and Terser v5.19.2.
 * Original file: /npm/signed-varint@2.0.1/index.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
var n$2={},t$1=s$2;n$2.encode=function e(n,o,r){n=n>=0?2*n:-2*n-1;var d=t$1.encode(n,o,r);return e.bytes=t$1.encode.bytes,d};n$2.decode=function e(n,o){var r=t$1.decode(n,o);return e.bytes=t$1.decode.bytes,1&r?(r+1)/-2:r/2};n$2.encodingLength=function(e){return t$1.encodingLength(e>=0?2*e:-2*e-1)};

/**
 * Bundled by jsDelivr using Rollup v2.79.1 and Terser v5.19.2.
 * Original file: /npm/protocol-buffers-encodings@1.2.0/index.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
var r$1={};!function(r){var o=s$3,u=n$2,i=L$b;function c(e,n,t,r){return n.bytes=t.bytes=0,{type:e,encode:n,decode:t,encodingLength:r}}function s(e){return i.isBuffer(e)?e.length:i.byteLength(e)}r.make=c,r.name=function(e){for(var n=Object.keys(r),t=0;t<n.length;t++)if(r[n[t]]===e)return n[t];return null},r.skip=function(e,n,t){switch(e){case 0:return o.decode(n,t),t+o.decode.bytes;case 1:return t+8;case 2:var r=o.decode(n,t);return t+o.decode.bytes+r;case 3:case 4:throw new Error("Groups are not supported");case 5:return t+4}throw new Error("Unknown wire type: "+e)},r.bytes=c(2,(function e(n,t,r){var u=r,c=s(n);return o.encode(c,t,r),r+=o.encode.bytes,i.isBuffer(n)?i.copy(n,t,r):i.write(t,n,r,c),e.bytes=(r+=c)-u,t}),(function e(n,t){var r=t,u=o.decode(n,t);t+=o.decode.bytes;var i=n.subarray(t,t+u);return t+=i.length,e.bytes=t-r,i}),(function(e){var n=s(e);return o.encodingLength(n)+n})),r.string=c(2,(function e(n,t,r){var u=r,c=i.byteLength(n);return o.encode(c,t,r,"utf-8"),r+=o.encode.bytes,i.write(t,n,r,c),e.bytes=(r+=c)-u,t}),(function e(n,t){var r=t,u=o.decode(n,t);t+=o.decode.bytes;var c=i.toString(n,"utf-8",t,t+u);return e.bytes=(t+=u)-r,c}),(function(e){var n=i.byteLength(e);return o.encodingLength(n)+n})),r.bool=c(0,(function e(n,t,r){return t[r]=n?1:0,e.bytes=1,t}),(function e(n,t){var r=n[t]>0;return e.bytes=1,r}),(function(){return 1})),r.int32=c(0,(function e(n,t,r){return o.encode(n<0?n+4294967296:n,t,r),e.bytes=o.encode.bytes,t}),(function e(n,t){var r=o.decode(n,t);return e.bytes=o.decode.bytes,r>2147483647?r-4294967296:r}),(function(e){return o.encodingLength(e<0?e+4294967296:e)})),r.int64=c(0,(function e(n,t,r){if(n<0){var u=r+9;for(o.encode(-1*n,t,r),t[r+=o.encode.bytes-1]=128|t[r];r<u-1;)t[++r]=255;t[u]=1,e.bytes=10;}else o.encode(n,t,r),e.bytes=o.encode.bytes;return t}),(function e(n,t){var r=o.decode(n,t);if(r>=Math.pow(2,63)){for(var u=9;255===n[t+u-1];)u--;u=u||9;var c=i.allocUnsafe(u);i.copy(n,c,0,t,t+u),c[u-1]=127&c[u-1],r=-1*o.decode(c,0),e.bytes=10;}else e.bytes=o.decode.bytes;return r}),(function(e){return e<0?10:o.encodingLength(e)})),r.sint32=r.sint64=c(0,u.encode,u.decode,u.encodingLength),r.uint32=r.uint64=r.enum=r.varint=c(0,o.encode,o.decode,o.encodingLength),r.fixed64=r.sfixed64=c(1,(function e(n,t,r){return i.copy(n,t,r),e.bytes=8,t}),(function e(n,t){var r=n.subarray(t,t+8);return e.bytes=8,r}),(function(){return 8})),r.double=c(1,(function e(n,t,r){return i.writeDoubleLE(t,n,r),e.bytes=8,t}),(function e(n,t){var r=i.readDoubleLE(n,t);return e.bytes=8,r}),(function(){return 8})),r.fixed32=c(5,(function e(n,t,r){return i.writeUInt32LE(t,n,r),e.bytes=4,t}),(function e(n,t){var r=i.readUInt32LE(n,t);return e.bytes=4,r}),(function(){return 4})),r.sfixed32=c(5,(function e(n,t,r){return i.writeInt32LE(t,n,r),e.bytes=4,t}),(function e(n,t){var r=i.readInt32LE(n,t);return e.bytes=4,r}),(function(){return 4})),r.float=c(5,(function e(n,t,r){return i.writeFloatLE(t,n,r),e.bytes=4,t}),(function e(n,t){var r=i.readFloatLE(n,t);return e.bytes=4,r}),(function(){return 4}));}(r$1);r$1.bool;r$1.bytes;r$1.double;r$1.enum;r$1.fixed32;r$1.fixed64;r$1.float;r$1.int32;r$1.int64;r$1.make;r$1.name;r$1.sfixed32;r$1.sfixed64;r$1.sint32;r$1.sint64;r$1.skip;r$1.string;r$1.uint32;r$1.uint64;r$1.varint;

/**
 * Bundled by jsDelivr using Rollup v2.79.1 and Terser v5.19.2.
 * Original file: /npm/hyperbee@2.20.2/index.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
const d$1=L$c;function u$1(e,t){return {type:e.isDeletion()?"del":"put",...e.final(t)}}const g$1=L$c;let y$1 = class y{constructor(e,t){this.node=e,this.parent=t,this.isKey=0===e.children.length,this.i=this.isKey?1:0,this.n=0;const n=this.isKey?null:this.node.children[0];this.seq=null!==n?n.seq:this.node.keys[0].seq,this.offset=null!==n?n.offset:0;}next(){return this.i++,this.isKey=1==(1&this.i),this.isKey||this.node.children.length||this.i++,this.update()}async bisect(e,t){let n,s=0,i=this.node.keys.length;for(;s<i;){const o=s+i>>1;if(n=p$1(e,await this.node.getKey(o)),0===n)return this.i=t?2*o+1:2*o+(this.node.children.length?2:3),!0;n<0?i=o:s=o+1;}const o=n<0?i:s;return this.i=2*o+(this.node.children.length?0:1),0===this.node.children.length}update(){if(this.isKey=1==(1&this.i),this.n=this.i>>1,this.n>=(this.isKey?this.node.keys.length:this.node.children.length))return !1;const e=this.isKey?null:this.node.children[this.n];return this.seq=null!==e?e.seq:this.node.keys[this.n].seq,this.offset=null!==e?e.offset:0,!0}async key(){return this.n<this.node.keys.length?this.node.getKey(this.n):this.parent&&this.parent.key()}async compare(e){const[t,n]=await Promise.all([this.key(),e.key()]);return p$1(t,n)}};let f$1 = class f{constructor(e,t){this.batch=e,this.stack=[],this.lt=t.lt||t.lte||null,this.lte=!!t.lte,this.gt=t.gt||t.gte||null,this.gte=!!t.gte,this.seeking=!!this.gt,this.encoding=t.encoding||e.encoding;}async open(){const e=await this.batch.getRoot(!1);if(!e||!e.keys.length)return;const t=new y$1(e,null);this.seeking&&!await this._seek(t)||this.stack.push(t);}async _seek(e){const t=await e.bisect(this.gt,this.gte),n=!e.update();return !t&&!n||(this.seeking=!1,!n)}peek(){return this.stack.length?this.stack[this.stack.length-1]:null}skip(){this.stack.length&&(this.stack[this.stack.length-1].next()||this.stack.pop());}async nextKey(){let e=null;for(;this.stack.length&&null===e;)e=await this.next();if(null===e)return null;if(!this.lt)return e.final(this.encoding);const t=p$1(e.key,this.lt);return (this.lte?t<=0:t<0)?e.final(this.encoding):(this.stack=[],null)}async next(){if(!this.stack.length)return null;const e=this.stack[this.stack.length-1],{isKey:t,n:n,seq:s}=e;if(e.next()||this.stack.pop(),t)return this.seeking=!1,this.batch.getBlock(s);const i=await e.node.getChildNode(n);e.node.children[n]=null;const o=new y$1(i,e);return this.seeking&&!await this._seek(o)||this.stack.push(o),null}close(){return this.batch._closeSnapshot()}};function p$1(e,t){return e?t?g$1.compare(e,t):e?-1:0:t?1:0}var k$2={},b$2=r$1,v$2=L$c,w$2=b$2.varint,_$2=b$2.skip,m$2=k$2.YoloIndex={buffer:!0,encodingLength:null,encode:null,decode:null},x$2=k$2.Header={buffer:!0,encodingLength:null,encode:null,decode:null},E$2=k$2.Node={buffer:!0,encodingLength:null,encode:null,decode:null},L$2=k$2.Extension={buffer:!0,encodingLength:null,encode:null,decode:null};function q$2(e){return null!=e&&("number"!=typeof e||!isNaN(e))}!function(){var e=m$2.Level={buffer:!0,encodingLength:null,encode:null,decode:null};function t(t){var n=0;if(q$2(t.levels))for(var s=0;s<t.levels.length;s++)if(q$2(t.levels[s])){var i=e.encodingLength(t.levels[s]);n+=w$2.encodingLength(i),n+=1+i;}return n}((function(){function t(e){var t=0;if(q$2(e.keys)){for(var n=0,s=0;s<e.keys.length;s++)q$2(e.keys[s])&&(n+=b$2.varint.encodingLength(e.keys[s]));n&&(t+=1+n+w$2.encodingLength(n));}if(q$2(e.children)){for(n=0,s=0;s<e.children.length;s++)q$2(e.children[s])&&(n+=b$2.varint.encodingLength(e.children[s]));n&&(t+=1+n+w$2.encodingLength(n));}return t}e.encodingLength=t,e.encode=function e(n,s,i){i||(i=0),s||(s=v$2.allocUnsafe(t(n)));var o=i;if(q$2(n.keys)){for(var r=0,h=0;h<n.keys.length;h++)q$2(n.keys[h])&&(r+=b$2.varint.encodingLength(n.keys[h]));for(r&&(s[i++]=10,w$2.encode(r,s,i),i+=w$2.encode.bytes),h=0;h<n.keys.length;h++)q$2(n.keys[h])&&(b$2.varint.encode(n.keys[h],s,i),i+=b$2.varint.encode.bytes);}if(q$2(n.children)){for(r=0,h=0;h<n.children.length;h++)q$2(n.children[h])&&(r+=b$2.varint.encodingLength(n.children[h]));for(r&&(s[i++]=18,w$2.encode(r,s,i),i+=w$2.encode.bytes),h=0;h<n.children.length;h++)q$2(n.children[h])&&(b$2.varint.encode(n.children[h],s,i),i+=b$2.varint.encode.bytes);}return e.bytes=i-o,s},e.decode=function e(t,n,s){if(n||(n=0),s||(s=t.length),!(s<=t.length&&n<=t.length))throw new Error("Decoded message is not valid");for(var i=n,o={keys:[],children:[]};;){if(s<=n)return e.bytes=n-i,o;var r=w$2.decode(t,n);switch(n+=w$2.decode.bytes,r>>3){case 1:var h=w$2.decode(t,n);for(h+=n+=w$2.decode.bytes;n<h;)o.keys.push(b$2.varint.decode(t,n)),n+=b$2.varint.decode.bytes;break;case 2:for(h=w$2.decode(t,n),h+=n+=w$2.decode.bytes;n<h;)o.children.push(b$2.varint.decode(t,n)),n+=b$2.varint.decode.bytes;break;default:n=_$2(7&r,t,n);}}};}))(),m$2.encodingLength=t,m$2.encode=function n(s,i,o){o||(o=0),i||(i=v$2.allocUnsafe(t(s)));var r=o;if(q$2(s.levels))for(var h=0;h<s.levels.length;h++)q$2(s.levels[h])&&(i[o++]=10,w$2.encode(e.encodingLength(s.levels[h]),i,o),o+=w$2.encode.bytes,e.encode(s.levels[h],i,o),o+=e.encode.bytes);return n.bytes=o-r,i},m$2.decode=function t(n,s,i){if(s||(s=0),i||(i=n.length),!(i<=n.length&&s<=n.length))throw new Error("Decoded message is not valid");for(var o=s,r={levels:[]};;){if(i<=s)return t.bytes=s-o,r;var h=w$2.decode(n,s);if(s+=w$2.decode.bytes,1==h>>3){var c=w$2.decode(n,s);s+=w$2.decode.bytes,r.levels.push(e.decode(n,s,s+c)),s+=e.decode.bytes;}else s=_$2(7&h,n,s);}};}(),function(){var e=x$2.Metadata={buffer:!0,encodingLength:null,encode:null,decode:null};function t(t){var n=0;if(!q$2(t.protocol))throw new Error("protocol is required");if(n+=1+(s=b$2.string.encodingLength(t.protocol)),q$2(t.metadata)){var s=e.encodingLength(t.metadata);n+=w$2.encodingLength(s),n+=1+s;}return n}((function(){function t(e){var t=0;return q$2(e.contentFeed)&&(t+=1+b$2.bytes.encodingLength(e.contentFeed)),q$2(e.userData)&&(t+=1+b$2.bytes.encodingLength(e.userData)),t}e.encodingLength=t,e.encode=function e(n,s,i){i||(i=0),s||(s=v$2.allocUnsafe(t(n)));var o=i;return q$2(n.contentFeed)&&(s[i++]=10,b$2.bytes.encode(n.contentFeed,s,i),i+=b$2.bytes.encode.bytes),q$2(n.userData)&&(s[i++]=18,b$2.bytes.encode(n.userData,s,i),i+=b$2.bytes.encode.bytes),e.bytes=i-o,s},e.decode=function e(t,n,s){if(n||(n=0),s||(s=t.length),!(s<=t.length&&n<=t.length))throw new Error("Decoded message is not valid");for(var i=n,o={contentFeed:null,userData:null};;){if(s<=n)return e.bytes=n-i,o;var r=w$2.decode(t,n);switch(n+=w$2.decode.bytes,r>>3){case 1:o.contentFeed=b$2.bytes.decode(t,n),n+=b$2.bytes.decode.bytes;break;case 2:o.userData=b$2.bytes.decode(t,n),n+=b$2.bytes.decode.bytes;break;default:n=_$2(7&r,t,n);}}};}))(),x$2.encodingLength=t,x$2.encode=function n(s,i,o){o||(o=0),i||(i=v$2.allocUnsafe(t(s)));var r=o;if(!q$2(s.protocol))throw new Error("protocol is required");return i[o++]=10,b$2.string.encode(s.protocol,i,o),o+=b$2.string.encode.bytes,q$2(s.metadata)&&(i[o++]=18,w$2.encode(e.encodingLength(s.metadata),i,o),o+=w$2.encode.bytes,e.encode(s.metadata,i,o),o+=e.encode.bytes),n.bytes=o-r,i},x$2.decode=function t(n,s,i){if(s||(s=0),i||(i=n.length),!(i<=n.length&&s<=n.length))throw new Error("Decoded message is not valid");for(var o=s,r={protocol:"",metadata:null},h=!1;;){if(i<=s){if(!h)throw new Error("Decoded message is not valid");return t.bytes=s-o,r}var c=w$2.decode(n,s);switch(s+=w$2.decode.bytes,c>>3){case 1:r.protocol=b$2.string.decode(n,s),s+=b$2.string.decode.bytes,h=!0;break;case 2:var l=w$2.decode(n,s);s+=w$2.decode.bytes,r.metadata=e.decode(n,s,s+l),s+=e.decode.bytes;break;default:s=_$2(7&c,n,s);}}};}(),function(){function e(e){var t=0;if(!q$2(e.index))throw new Error("index is required");if(t+=1+b$2.bytes.encodingLength(e.index),!q$2(e.key))throw new Error("key is required");(t+=1+b$2.bytes.encodingLength(e.key),q$2(e.value))&&(t+=1+b$2.bytes.encodingLength(e.value));return t}E$2.encodingLength=e,E$2.encode=function t(n,s,i){i||(i=0),s||(s=v$2.allocUnsafe(e(n)));var o=i;if(!q$2(n.index))throw new Error("index is required");if(s[i++]=10,b$2.bytes.encode(n.index,s,i),i+=b$2.bytes.encode.bytes,!q$2(n.key))throw new Error("key is required");return s[i++]=18,b$2.bytes.encode(n.key,s,i),i+=b$2.bytes.encode.bytes,q$2(n.value)&&(s[i++]=26,b$2.bytes.encode(n.value,s,i),i+=b$2.bytes.encode.bytes),t.bytes=i-o,s},E$2.decode=function e(t,n,s){if(n||(n=0),s||(s=t.length),!(s<=t.length&&n<=t.length))throw new Error("Decoded message is not valid");for(var i=n,o={index:null,key:null,value:null},r=!1,h=!1;;){if(s<=n){if(!r||!h)throw new Error("Decoded message is not valid");return e.bytes=n-i,o}var c=w$2.decode(t,n);switch(n+=w$2.decode.bytes,c>>3){case 1:o.index=b$2.bytes.decode(t,n),n+=b$2.bytes.decode.bytes,r=!0;break;case 2:o.key=b$2.bytes.decode(t,n),n+=b$2.bytes.decode.bytes,h=!0;break;case 3:o.value=b$2.bytes.decode(t,n),n+=b$2.bytes.decode.bytes;break;default:n=_$2(7&c,t,n);}}};}(),function(){var e=L$2.Get={buffer:!0,encodingLength:null,encode:null,decode:null},t=L$2.Iterator={buffer:!0,encodingLength:null,encode:null,decode:null},n=L$2.Cache={buffer:!0,encodingLength:null,encode:null,decode:null};function s(s){var i=0;if(q$2(s.cache)){var o=n.encodingLength(s.cache);i+=w$2.encodingLength(o),i+=1+o;}if(q$2(s.get)){o=e.encodingLength(s.get);i+=w$2.encodingLength(o),i+=1+o;}if(q$2(s.iterator)){o=t.encodingLength(s.iterator);i+=w$2.encodingLength(o),i+=1+o;}return i}((function(){function t(e){var t=0;return q$2(e.version)&&(t+=1+b$2.varint.encodingLength(e.version)),q$2(e.key)&&(t+=1+b$2.bytes.encodingLength(e.key)),t}e.encodingLength=t,e.encode=function e(n,s,i){i||(i=0),s||(s=v$2.allocUnsafe(t(n)));var o=i;return q$2(n.version)&&(s[i++]=8,b$2.varint.encode(n.version,s,i),i+=b$2.varint.encode.bytes),q$2(n.key)&&(s[i++]=18,b$2.bytes.encode(n.key,s,i),i+=b$2.bytes.encode.bytes),e.bytes=i-o,s},e.decode=function e(t,n,s){if(n||(n=0),s||(s=t.length),!(s<=t.length&&n<=t.length))throw new Error("Decoded message is not valid");for(var i=n,o={version:0,key:null};;){if(s<=n)return e.bytes=n-i,o;var r=w$2.decode(t,n);switch(n+=w$2.decode.bytes,r>>3){case 1:o.version=b$2.varint.decode(t,n),n+=b$2.varint.decode.bytes;break;case 2:o.key=b$2.bytes.decode(t,n),n+=b$2.bytes.decode.bytes;break;default:n=_$2(7&r,t,n);}}};}))(),function(){function e(e){var t=0;if(q$2(e.version)&&(t+=1+b$2.varint.encodingLength(e.version)),q$2(e.gte)&&(t+=1+b$2.bytes.encodingLength(e.gte)),q$2(e.gt)&&(t+=1+b$2.bytes.encodingLength(e.gt)),q$2(e.lte)&&(t+=1+b$2.bytes.encodingLength(e.lte)),q$2(e.lt)&&(t+=1+b$2.bytes.encodingLength(e.lt)),q$2(e.limit)&&(t+=1+b$2.varint.encodingLength(e.limit)),q$2(e.reverse)&&(t+=1+b$2.bool.encodingLength(e.reverse)),q$2(e.checkpoint)){for(var n=0,s=0;s<e.checkpoint.length;s++)q$2(e.checkpoint[s])&&(n+=b$2.varint.encodingLength(e.checkpoint[s]));n&&(t+=1+n+w$2.encodingLength(n));}return t}t.encodingLength=e,t.encode=function t(n,s,i){i||(i=0),s||(s=v$2.allocUnsafe(e(n)));var o=i;if(q$2(n.version)&&(s[i++]=8,b$2.varint.encode(n.version,s,i),i+=b$2.varint.encode.bytes),q$2(n.gte)&&(s[i++]=18,b$2.bytes.encode(n.gte,s,i),i+=b$2.bytes.encode.bytes),q$2(n.gt)&&(s[i++]=26,b$2.bytes.encode(n.gt,s,i),i+=b$2.bytes.encode.bytes),q$2(n.lte)&&(s[i++]=34,b$2.bytes.encode(n.lte,s,i),i+=b$2.bytes.encode.bytes),q$2(n.lt)&&(s[i++]=42,b$2.bytes.encode(n.lt,s,i),i+=b$2.bytes.encode.bytes),q$2(n.limit)&&(s[i++]=48,b$2.varint.encode(n.limit,s,i),i+=b$2.varint.encode.bytes),q$2(n.reverse)&&(s[i++]=56,b$2.bool.encode(n.reverse,s,i),i+=b$2.bool.encode.bytes),q$2(n.checkpoint)){for(var r=0,h=0;h<n.checkpoint.length;h++)q$2(n.checkpoint[h])&&(r+=b$2.varint.encodingLength(n.checkpoint[h]));for(r&&(s[i++]=66,w$2.encode(r,s,i),i+=w$2.encode.bytes),h=0;h<n.checkpoint.length;h++)q$2(n.checkpoint[h])&&(b$2.varint.encode(n.checkpoint[h],s,i),i+=b$2.varint.encode.bytes);}return t.bytes=i-o,s},t.decode=function e(t,n,s){if(n||(n=0),s||(s=t.length),!(s<=t.length&&n<=t.length))throw new Error("Decoded message is not valid");for(var i=n,o={version:0,gte:null,gt:null,lte:null,lt:null,limit:0,reverse:!1,checkpoint:[]};;){if(s<=n)return e.bytes=n-i,o;var r=w$2.decode(t,n);switch(n+=w$2.decode.bytes,r>>3){case 1:o.version=b$2.varint.decode(t,n),n+=b$2.varint.decode.bytes;break;case 2:o.gte=b$2.bytes.decode(t,n),n+=b$2.bytes.decode.bytes;break;case 3:o.gt=b$2.bytes.decode(t,n),n+=b$2.bytes.decode.bytes;break;case 4:o.lte=b$2.bytes.decode(t,n),n+=b$2.bytes.decode.bytes;break;case 5:o.lt=b$2.bytes.decode(t,n),n+=b$2.bytes.decode.bytes;break;case 6:o.limit=b$2.varint.decode(t,n),n+=b$2.varint.decode.bytes;break;case 7:o.reverse=b$2.bool.decode(t,n),n+=b$2.bool.decode.bytes;break;case 8:var h=w$2.decode(t,n);for(h+=n+=w$2.decode.bytes;n<h;)o.checkpoint.push(b$2.varint.decode(t,n)),n+=b$2.varint.decode.bytes;break;default:n=_$2(7&r,t,n);}}};}(),function(){function e(e){var t=0;if(!q$2(e.start))throw new Error("start is required");if(t+=1+b$2.varint.encodingLength(e.start),!q$2(e.end))throw new Error("end is required");if(t+=1+b$2.varint.encodingLength(e.end),q$2(e.blocks)){for(var n=0,s=0;s<e.blocks.length;s++)q$2(e.blocks[s])&&(n+=b$2.varint.encodingLength(e.blocks[s]));n&&(t+=1+n+w$2.encodingLength(n));}return t}n.encodingLength=e,n.encode=function t(n,s,i){i||(i=0),s||(s=v$2.allocUnsafe(e(n)));var o=i;if(!q$2(n.start))throw new Error("start is required");if(s[i++]=8,b$2.varint.encode(n.start,s,i),i+=b$2.varint.encode.bytes,!q$2(n.end))throw new Error("end is required");if(s[i++]=16,b$2.varint.encode(n.end,s,i),i+=b$2.varint.encode.bytes,q$2(n.blocks)){for(var r=0,h=0;h<n.blocks.length;h++)q$2(n.blocks[h])&&(r+=b$2.varint.encodingLength(n.blocks[h]));for(r&&(s[i++]=26,w$2.encode(r,s,i),i+=w$2.encode.bytes),h=0;h<n.blocks.length;h++)q$2(n.blocks[h])&&(b$2.varint.encode(n.blocks[h],s,i),i+=b$2.varint.encode.bytes);}return t.bytes=i-o,s},n.decode=function e(t,n,s){if(n||(n=0),s||(s=t.length),!(s<=t.length&&n<=t.length))throw new Error("Decoded message is not valid");for(var i=n,o={start:0,end:0,blocks:[]},r=!1,h=!1;;){if(s<=n){if(!r||!h)throw new Error("Decoded message is not valid");return e.bytes=n-i,o}var c=w$2.decode(t,n);switch(n+=w$2.decode.bytes,c>>3){case 1:o.start=b$2.varint.decode(t,n),n+=b$2.varint.decode.bytes,r=!0;break;case 2:o.end=b$2.varint.decode(t,n),n+=b$2.varint.decode.bytes,h=!0;break;case 3:var l=w$2.decode(t,n);for(l+=n+=w$2.decode.bytes;n<l;)o.blocks.push(b$2.varint.decode(t,n)),n+=b$2.varint.decode.bytes;break;default:n=_$2(7&c,t,n);}}};}(),L$2.encodingLength=s,L$2.encode=function i(o,r,h){h||(h=0),r||(r=v$2.allocUnsafe(s(o)));var c=h;return q$2(o.cache)&&(r[h++]=10,w$2.encode(n.encodingLength(o.cache),r,h),h+=w$2.encode.bytes,n.encode(o.cache,r,h),h+=n.encode.bytes),q$2(o.get)&&(r[h++]=18,w$2.encode(e.encodingLength(o.get),r,h),h+=w$2.encode.bytes,e.encode(o.get,r,h),h+=e.encode.bytes),q$2(o.iterator)&&(r[h++]=26,w$2.encode(t.encodingLength(o.iterator),r,h),h+=w$2.encode.bytes,t.encode(o.iterator,r,h),h+=t.encode.bytes),i.bytes=h-c,r},L$2.decode=function s(i,o,r){if(o||(o=0),r||(r=i.length),!(r<=i.length&&o<=i.length))throw new Error("Decoded message is not valid");for(var h=o,c={cache:null,get:null,iterator:null};;){if(r<=o)return s.bytes=o-h,c;var l=w$2.decode(i,o);switch(o+=w$2.decode.bytes,l>>3){case 1:var a=w$2.decode(i,o);o+=w$2.decode.bytes,c.cache=n.decode(i,o,o+a),o+=n.decode.bytes;break;case 2:a=w$2.decode(i,o),o+=w$2.decode.bytes,c.get=e.decode(i,o,o+a),o+=e.decode.bytes;break;case 3:a=w$2.decode(i,o),o+=w$2.decode.bytes,c.iterator=t.decode(i,o,o+a),o+=t.decode.bytes;break;default:o=_$2(7&l,i,o);}}};}();const{Extension:K$2}=k$2;let C$2 = class C{constructor(e,t){this.blocks=[],this.start=0,this.end=0,this.outgoing=e,this.from=t;}push(e){const t=this.blocks.push(e);(1===t||e<this.start)&&(this.start=e),(1===t||e>=this.end)&&(this.end=e+1),t>=128&&(this.send(),this.clear());}send(){this.blocks.length&&this.outgoing.send(K$2.encode({cache:{blocks:this.blocks,start:this.start,end:this.end}}),this.from);}clear(){this.start=this.end=0,this.blocks=[];}};let B$2 = class B{constructor(e){this.encoding=null,this.outgoing=null,this.db=e,this.active=0;}get(e,t){this.outgoing.broadcast(K$2.encode({get:{version:e,key:t}}));}iterator(e){e.ended||0!==e.limit&&(-1===e.limit&&(e.limit=0),this.outgoing.broadcast(K$2.encode({iterator:e})));}onmessage(e,t){const n=function(e){try{return K$2.decode(e)}catch(e){return null}}(e);n&&(n.cache&&this.oncache(n.cache,t),n.get&&this.onget(n.get,t),n.iterator&&this.oniterator(n.iterator,t));}oncache(e,t){e.blocks.length&&this.db.core.download(e);}onget(e,t){if(!e.version||e.version>this.db.version)return;const n=new C$2(this.outgoing,t),s=this.db.checkout(e.version);function i(){s.close().catch(N$2),n.send();}s.get(e.key,{extension:!1,wait:!1,update:!1,onseq:function(e){n.push(e);}}).then(i,i);}async oniterator(e,t){if(!e.version||e.version>this.db.version)return;const n=new C$2(this.outgoing,t);let s=e.checkpoint.length,i=0;const o=this.db.checkout(e.version),r=o.createRangeIterator({...e,wait:!1,extension:!1,update:!1,limit:0===e.limit?-1:e.limit,onseq(e){s&&s--||(i++,n.push(e));}});try{for(await r.open();i<2176&&await r.next(););}catch(e){}finally{o.close().catch(N$2),n.send();}}static register(e){const t=new this(e);return t.outgoing=e.core.registerExtension("hyperbee",t),t}};B$2.BATCH_SIZE=2048;var S$2=B$2;function N$2(){}const D$2=t$5,{Readable:I$2}=qt$2,M$2=t$n,R$2=L$c,U$2=r$u,O$2=f$l,A$2=n$w,T$2=r$4,{all:P$2}=n$a,F$2=class F{constructor(e,t,n={}){this.batch=e,this.stack=[],this.opened=!1,this.encoding=t||e.encoding,this._limit="number"==typeof n.limit?n.limit:-1,this._gIncl=!n.gt,this._gKey=n.gt||n.gte||null,this._lIncl=!n.lt,this._lKey=n.lt||n.lte||null,this._reverse=!!n.reverse,this._version=0,this._checkpoint=n.checkpoint&&n.checkpoint.length?n.checkpoint:null,this._nexting=!1;}snapshot(e=this.batch.version){const t=[];for(const e of this.stack){let{node:n,i:s}=e;this._nexting&&e===this.stack[this.stack.length-1]&&(s=this._reverse?s+1:s-1),n.block&&(s<0||t.push(n.block.seq,n.offset,s));}return {version:e,gte:this._gIncl?this._gKey:null,gt:this._gIncl?null:this._gKey,lte:this._lIncl?this._lKey:null,lt:this._lIncl?null:this._lKey,limit:this._limit,reverse:this._reverse,ended:this.opened&&!t.length,checkpoint:this.opened?t:[]}}async open(){await this._open(),this.opened=!0;}async _open(){if(this._checkpoint){for(let e=0;e<this._checkpoint.length;e+=3){const t=this._checkpoint[e],n=this._checkpoint[e+1],s=this._checkpoint[e+2];this.stack.push({node:(await this.batch.getBlock(t)).getTreeNode(n),i:s});}return}this._nexting=!0;let e=await this.batch.getRoot(!1);if(!e)return void(this._nexting=!1);const t=this._reverse?this._lIncl:this._gIncl,n=this._reverse?this._lKey:this._gKey;if(!n)return this.stack.push({node:e,i:this._reverse?e.keys.length<<1:0}),void(this._nexting=!1);for(;;){const s={node:e,i:this._reverse?e.keys.length<<1:0};let i,o=0,r=e.keys.length;for(;o<r;){const h=o+r>>1;if(i=d$1.compare(n,await e.getKey(h)),0===i)return s.i=t?2*h+1:2*h+(this._reverse?0:2),this.stack.push(s),void(this._nexting=!1);i<0?r=h:o=h+1;}const h=i<0?r:o;if(s.i=2*h+(this._reverse?-1:1),s.i>=0&&s.i<=e.keys.length<<1&&this.stack.push(s),!e.children.length)return void(this._nexting=!1);e=await e.getChildNode(h);}}async next(){this._nexting=!0;const e=this._reverse?this._gKey:this._lKey,t=this._reverse?this._gIncl:this._lIncl;for(;this.stack.length&&(-1===this._limit||this._limit>0);){const n=this.stack[this.stack.length-1],s=1==(1&n.i),i=this._reverse?n.i<0?n.node.keys.length:n.i-- >>1:n.i++>>1;if(!s){if(!n.node.children.length)continue;const e=await n.node.getChildNode(i);n.node.block.seq<this.batch.core.length&&(n.node.children[i].value=null),this.stack.push({i:this._reverse?e.keys.length<<1:0,node:e});continue}if(i>=n.node.keys.length){this.stack.pop();continue}const o=n.node.keys[i],r=await this.batch.getBlock(o.seq);if(e){const n=d$1.compare(r.key,e);if(0===n?!t:this._reverse?n<0:n>0){this._limit=0;break}}return this._limit>0&&this._limit--,this._nexting=!1,r.final(this.encoding)}return this._nexting=!1,null}close(){return this.batch._closeSnapshot()}},W$2=class W{constructor(e,t={}){if(this.batch=e,this.options=t,this.live=!!t.live,this.gte=0,this.lt=0,this.reverse=!!t.reverse,this.limit="number"==typeof t.limit?t.limit:-1,this.encoding=t.encoding||e.encoding,this.live&&this.reverse)throw new Error("Cannot have both live and reverse enabled")}async open(){await this.batch.getRoot(!1),this.gte=function(e,t){if(e.gt)return (e.gt<0?e.gt+t:e.gt)+1;const n=e.gte||e.since||1;return n<0?n+t:n}(this.options,this.batch.version),this.lt=this.live?1/0:function(e,t){if(0===e.lte||0===e.lt||0===e.end)return 0;if(e.lte)return (e.lte<0?e.lte+t:e.lte)+1;const n=e.lt||e.end||t;return n<0?n+t:n}(this.options,this.batch.version);}async next(){return 0===this.limit?null:(this.limit>0&&this.limit--,this.gte>=this.lt?null:this.reverse?this.lt<=1?null:u$1(await this.batch.getBlock(--this.lt),this.encoding):u$1(await this.batch.getBlock(this.gte++),this.encoding))}close(){return this.batch._closeSnapshot()}},H$2=class H{constructor(e,t,n={}){this.left=new f$1(e,n),this.right=new f$1(t,n),this.limit="number"==typeof n.limit?n.limit:-1;}async open(){await Promise.all([this.left.open(),this.right.open()]);}async next(){if(0===this.limit)return null;const e=await this._next();return !e||null===e.left&&null===e.right?null:(this.limit--,e)}async _next(){const e=this.left,t=this.right;for(;;){const[n,s]=await Promise.all([e.peek(),t.peek()]);if(!n&&!s)return null;if(!n)return {left:null,right:await t.nextKey()};if(!s)return {left:await e.nextKey(),right:null};if(n.seq===s.seq&&n.isKey===s.isKey&&n.offset===s.offset){e.skip(),t.skip();continue}const i=await n.compare(s);if(!n.isKey||s.isKey)if(n.isKey||!s.isKey){if(n.isKey&&s.isKey)return 0===i?{left:await e.nextKey(),right:await t.nextKey()}:i<0?{left:await e.nextKey(),right:null}:{left:null,right:await t.nextKey()};0===i?await Promise.all([e.next(),t.next()]):i<0?await t.next():await e.next();}else await e.next();else await t.next();}}async close(){await Promise.all([this.left.close(),this.right.close()]);}},z$2=S$2,{YoloIndex:G$2,Node:V$2,Header:Y$2}=k$2,{BLOCK_NOT_AVAILABLE:Z$2,DECODING_ERROR:j$2}=E$6,J$2=R$2.alloc(1),Q$2=R$2.alloc(0);let X$2 = class X{constructor(e,t){this.seq=e,this.value=t;}};let $$2 = class ${constructor(e,t,n){this.seq=e,this.offset=t,this.value=n;}};let ee$2 = class ee{constructor(e){this.keys=e,this.length=0;}get(e){return this.keys.get(e)||null}set(e,t){this.keys.set(e,t),e>=this.length&&(this.length=e+1);}gc(e){if(this.length-e>128)this.keys.clear();else for(let t=e;t<this.length;t++)this.keys.delete(t);this.length=e;}};let te$2 = class te{constructor(e){this.levels=e.levels.map((e=>{const t=[],n=[];for(let t=0;t<e.keys.length;t++)n.push(new X$2(e.keys[t],null));for(let n=0;n<e.children.length;n+=2)t.push(new $$2(e.children[n],e.children[n+1],null));return {keys:n,children:t}}));}get(e){return this.levels[e]}hasKey(e){for(const t of this.levels)for(const n of t.keys)if(n.seq===e)return !0;return !1}};function ne$2(e){return null===e.inflated&&(e.inflated=G$2.decode(e.index),e.index=null),new te$2(e.inflated)}function se$2(e){const t=e.map((e=>{const t=[],n=[];for(let n=0;n<e.value.keys.length;n++)t.push(e.value.keys[n].seq);for(let t=0;t<e.value.children.length;t++)n.push(e.value.children[t].seq,e.value.children[t].offset);return {keys:t,children:n}}));return G$2.encode({levels:t})}function ie$2(e,t){e.replicator._blocks.get(t)||e.get(t).catch(U$2);}let oe$2 = class oe{constructor(e,t,n,s){this.block=e,this.offset=s,this.keys=t,this.children=n,this.changed=!1,this.preload();}preload(){if(null===this.block)return;const e=function(e){return e._source?e._source.originalCore:e.flush?e.session:e}(this.block.tree.core),t=function(e){return e._source?e._source.core.indexedLength:e.flush?e.indexedLength:e.length}(this.block.tree.core),n=e.core.bitfield;for(let s=0;s<this.keys.length;s++){const i=this.keys[s];i.value||(i.seq>=t||n.get(i.seq)||ie$2(e,i.seq));}for(let s=0;s<this.children.length;s++){const i=this.children[s];i.value||(i.seq>=t||n.get(i.seq)||ie$2(e,i.seq));}}async insertKey(e,t,n,s,i,o){let r,h=0,c=this.keys.length;for(;h<c;){const n=h+c>>1;if(r=R$2.compare(e.value,await this.getKey(n)),0===r){if(o){const e=await this.getKeyNode(n);if(!await o(e.final(i),s))return !0}if(!this.block.tree.tree.alwaysDuplicate){if(me$2((await this.getKeyNode(n)).value,t))return !0}return this.changed=!0,this.keys[n]=e,!0}r<0?c=n:h=n+1;}const l=r<0?c:h;return this.keys.splice(l,0,e),n&&this.children.splice(l+1,0,new $$2(0,0,n)),this.changed=!0,this.keys.length<9}removeKey(e){this.keys.splice(e,1),this.children.length&&(this.children[e+1].seq=0,this.children.splice(e+1,1)),this.changed=!0;}async siblings(e){for(let t=0;t<e.children.length;t++)if(e.children[t].value===this){const n=t?e.getChildNode(t-1):null,s=t<e.children.length-1?e.getChildNode(t+1):null;return {left:await n,index:t,right:await s}}throw new Error("Bad parent")}merge(e,t){this.changed=!0,this.keys.push(t);for(let t=0;t<e.keys.length;t++)this.keys.push(e.keys[t]);for(let t=0;t<e.children.length;t++)this.children.push(e.children[t]);}async split(){const e=this.keys.length>>1,t=oe.create(this.block);for(;t.keys.length<e;)t.keys.push(this.keys.pop());t.keys.reverse(),await this.getKey(this.keys.length-1);const n=this.keys.pop();if(this.children.length){for(;t.children.length<e+1;)t.children.push(this.children.pop());t.children.reverse();}return this.changed=!0,{left:this,median:n,right:t}}getKeyNode(e){return this.block.tree.getBlock(this.keys[e].seq)}async getChildNode(e){const t=this.children[e];if(t.value)return t.value;const n=t.seq===this.block.seq?this.block:await this.block.tree.getBlock(t.seq);return t.value=n.getTreeNode(t.offset)}setKey(e,t){this.keys[e]=t,this.changed=!0;}async getKey(e){const t=this.keys[e];if(t.value)return t.value;const n=t.seq===this.block.seq?this.block.key:await this.block.tree.getKey(t.seq);return t.value=n}indexChanges(e,t){const n=e.push(null)-1;this.changed=!1;for(const n of this.children)n.value&&n.value.changed&&(n.seq=t,n.offset=n.value.indexChanges(e,t),e[n.offset]=n);return n}updateChildren(e,t){for(const n of this.children)n.value&&n.seq===e&&(n.value.block=t,n.value.updateChildren(e,t));}static create(e){const t=new oe(e,[],[],0);return t.changed=!0,t}};let re$2 = class re{constructor(e,t,n){this.seq=e,this.tree=t,this.index=null,this.entry=n,this.key=n.key,this.value=n.value;}isTarget(e){return R$2.equals(this.key,e)}isDeletion(){return null===this.value&&(null===this.index&&(this.index=ne$2(this.entry)),!this.index.hasKey(this.seq))}final(e){return {seq:this.seq,key:e.key?e.key.decode(this.key):this.key,value:this.value&&(e.value?e.value.decode(this.value):this.value)}}getTreeNode(e){null===this.index&&(this.index=ne$2(this.entry));const t=this.index.get(e);return new oe$2(this,t.keys,t.children,e)}};let he$2 = class he extends re$2{constructor(e,t,n,s,i){super(e,t,{key:n,value:s,index:null,inflated:null}),this.pendingIndex=i;}isTarget(e){return !1}getTreeNode(e){return this.pendingIndex[e].value}};let ce$2 = class ce extends O$2{constructor(e,t={}){var n,s;super(),this.feed=e,this.core=e,this.keyEncoding=t.keyEncoding?D$2(t.keyEncoding):null,this.valueEncoding=t.valueEncoding?D$2(t.valueEncoding):null,this.extension=!1!==t.extension?t.extension||z$2.register(this):null,this.metadata=t.metadata||null,this.lock=t.lock||M$2(),this.sep=t.sep||J$2,this.readonly=!!t.readonly,this.prefix=t.prefix||null,this.alwaysDuplicate=!1!==t.alwaysDuplicate,this._unprefixedKeyEncoding=this.keyEncoding,this._sub=!!this.prefix,this._checkout=t.checkout||0,this._view=!!t._view,this._onappendBound=this._view?null:this._onappend.bind(this),this._ontruncateBound=this._view?null:this._ontruncate.bind(this),this._watchers=this._onappendBound?[]:null,this._entryWatchers=this._onappendBound?[]:null,this._sessions=!1!==t.sessions,this._keyCache=null,this._nodeCache=null,this._batches=[],this._watchers&&(this.core.on("append",this._onappendBound),this.core.on("truncate",this._ontruncateBound)),this.prefix&&t._sub&&(this.keyEncoding=(n=this.prefix,s=this.keyEncoding,{encode:e=>R$2.concat([n,R$2.isBuffer(e)?e:we$2(s,e)]),decode(e){const t=e.slice(n.length,e.length);return s?s.decode(t):t}}));}async _open(){await this.core.ready();const e=T$2.from(this.core.globalCache);this._keyCache=new ee$2(e),this._nodeCache=new ee$2(T$2.from(e));}get version(){return Math.max(1,this._checkout||this.core.length)}get id(){return this.core.id}get key(){return this.core.key}get discoveryKey(){return this.core.discoveryKey}get writable(){return this.core.writable}get readable(){return this.core.readable}replicate(e,t){return this.core.replicate(e,t)}update(e){return this.core.update(e)}peek(e,t){return be$2(this.createRangeIterator(e,{...t,limit:1}))}createRangeIterator(e,t={}){const n=!1===(t=t?{...t,...e}:e).extension&&0!==t.limit?null:this.extension,s=t.keyEncoding?D$2(t.keyEncoding):this.keyEncoding;if(n){const{onseq:e,onwait:o}=t;let r=0,h=0;t=ve$2(s,{...t,sub:this._sub,onseq(t){r||(r=t+1),h&&h--,e&&e(t);},onwait(e){h||(h=z$2.BATCH_SIZE,n.iterator(i.snapshot(r))),o&&o(e);}});}else t=ve$2(s,{...t,sub:this._sub});const i=new F$2(new le$2(this,this._makeSnapshot(),null,!1,t),null,t);return i}createReadStream(e,t){const n=t&&t.signal||null;return ke$2(this.createRangeIterator(e,t),n)}createHistoryStream(e){const t=e&&e.live?this.core.session():this._makeSnapshot(),n=e&&e.signal||null;return ke$2(new W$2(new le$2(this,t,null,!1,e),e),n)}createDiffStream(e,t,n){"number"==typeof e&&(e=this.checkout(Math.max(1,e),{reuseSession:!0})),n=n?{...n,...t}:t;const s=e.version>this.version?e._makeSnapshot():this._makeSnapshot(),i=n&&n.signal||null,o=n&&n.keyEncoding?D$2(n.keyEncoding):this.keyEncoding;return o&&(n=ve$2(o,{...n,sub:this._sub})),ke$2(new H$2(new le$2(this,s,null,!1,n),new le$2(e,s,null,!1,n),n),i)}get(e,t){return new le$2(this,this._makeSnapshot(),null,!0,t).get(e)}getBySeq(e,t){return new le$2(this,this._makeSnapshot(),null,!0,t).getBySeq(e)}put(e,t,n){return new le$2(this,this.core,null,!0,n).put(e,t,n)}batch(e){return new le$2(this,this.core,M$2(),!0,e)}del(e,t){return new le$2(this,this.core,null,!0,t).del(e,t)}watch(e,t){if(!this._watchers)throw new Error("Can only watch the main bee instance");return new de$2(this,e,t)}async getAndWatch(e,t){if(!this._watchers)throw new Error("Can only watch the main bee instance");const n=new ae$2(this,e,t);if(await n._debouncedUpdate(),this.closing)throw await n.close(),new Error("Bee closed");return n}_onappend(){for(const e of this._watchers)e._onappend();for(const e of this._entryWatchers)e._onappend();}_ontruncate(){for(const e of this._watchers)e._ontruncate();for(const e of this._entryWatchers)e._ontruncate();this._nodeCache.gc(this.core.length),this._keyCache.gc(this.core.length);}_makeSnapshot(){return !1===this._sessions?this.core:this._checkout<=this.core.length||this._checkout<=1?this.core.snapshot():this.core.session({snapshot:!1})}checkout(e,t={}){e<1&&(e=1);const n=t.reuseSession||!1===this._sessions?this.core:e<=this.core.length||e<=1?this.core.snapshot():this.core.session({snapshot:!1});return new ce(n,{_view:!0,_sub:!1,prefix:this.prefix,sep:this.sep,lock:this.lock,checkout:e,keyEncoding:t.keyEncoding||this.keyEncoding,valueEncoding:t.valueEncoding||this.valueEncoding,extension:null!==this.extension&&this.extension})}snapshot(e){return this.checkout(Math.max(1,this.version),e)}sub(e,t={}){let n=t.sep||this.sep;R$2.isBuffer(n)||(n=R$2.from(n)),e=R$2.concat([this.prefix||Q$2,R$2.from(e),n]);const s=D$2(t.valueEncoding||this.valueEncoding),i=D$2(t.keyEncoding||this._unprefixedKeyEncoding);return new ce(this.core,{_view:!0,_sub:!0,prefix:e,sep:this.sep,lock:this.lock,checkout:this._checkout,valueEncoding:s,keyEncoding:i,extension:null!==this.extension&&this.extension,metadata:this.metadata})}async getHeader(e){const t=await this.core.get(0,e);try{return t&&Y$2.decode(t)}catch{throw j$2()}}async _close(){if(this._watchers)for(this.core.off("append",this._onappendBound),this.core.off("truncate",this._ontruncateBound);this._watchers.length;)await this._watchers[this._watchers.length-1].close();if(this._entryWatchers)for(;this._entryWatchers.length;)await this._entryWatchers[this._entryWatchers.length-1].close();for(;this._batches.length;)await this._batches[this._batches.length-1].close();return this.core.close()}static async isHyperbee(e,t){await e.ready();const n=await e.get(0,t);if(null===n)throw Z$2();try{return "hyperbee"===Y$2.decode(n).protocol}catch(e){return !1}}};let le$2 = class le{constructor(e,t,n,s,i={}){this.tree=e,this.feed=t,this.core=t,this.index=e._batches.push(this)-1,this.blocks=s?new Map:null,this.autoFlush=!n,this.rootSeq=0,this.root=null,this.length=0,this.options=i,this.locked=null,this.batchLock=n,this.onseq=this.options.onseq||xe$2,this.appending=null,this.isSnapshot=this.core!==this.tree.core,this.shouldUpdate=!1!==this.options.update,this.updating=null,this.encoding={key:i.keyEncoding?D$2(i.keyEncoding):e.keyEncoding,value:i.valueEncoding?D$2(i.valueEncoding):e.valueEncoding};}ready(){return this.tree.ready()}async lock(){if(this.tree.readonly)throw new Error("Hyperbee is marked as read-only");null===this.locked&&(this.locked=await this.tree.lock());}get version(){return Math.max(1,this.tree._checkout?this.tree._checkout:this.core.length+this.length)}async getRoot(e){return await this.ready(),e&&0===this.core.length&&this.core.writable&&!this.tree.readonly&&await this.core.append(Y$2.encode({protocol:"hyperbee",metadata:this.tree.metadata})),0===this.tree._checkout&&this.shouldUpdate&&(null===this.updating&&(this.updating=this.core.update()),await this.updating),this.version<2?null:(await this.getBlock(this.version-1)).getTreeNode(0)}async getKey(e){const t=this.core.fork===this.tree.core.fork?this.tree._keyCache.get(e):null;if(null!==t)return t;const n=(await this.getBlock(e)).key;return this.core.fork===this.tree.core.fork&&this.tree._keyCache.set(e,n),n}async _getNode(e){const t=this.core.fork===this.tree.core.fork?this.tree._nodeCache.get(e):null;if(null!==t)return t;const n=await this.core.get(e,{...this.options,valueEncoding:V$2});if(null===n)throw Z$2();const s=function(e){let t=e.key,n=e.value,s=e.index;if(2*(t.byteLength+(null===n?0:n.byteLength)+(null===s?0:s.byteLength))<t.buffer.byteLength){const[i,o,r]=P$2([e.key,e.value,e.index]);t=i,n=o,s=r;}return {key:t,value:n,index:s,inflated:null}}(n);return this.core.fork===this.tree.core.fork&&this.tree._nodeCache.set(e,s),s}async getBlock(e){0===this.rootSeq&&(this.rootSeq=e);let t=this.blocks&&this.blocks.get(e);if(t)return t;this.onseq(e);const n=await this._getNode(e);return t=new re$2(e,this,n),this.blocks&&this.blocks.size-this.length<128&&this.blocks.set(e,t),t}_onwait(e){this.options.onwait=null,this.tree.extension.get(this.rootSeq+1,e);}_getEncoding(e){return e?{key:e.keyEncoding?D$2(e.keyEncoding):this.encoding.key,value:e.valueEncoding?D$2(e.valueEncoding):this.encoding.value}:this.encoding}peek(e,t){return be$2(this.createRangeIterator(e,{...t,limit:1}))}createRangeIterator(e,t={}){t=t?{...t,...e}:e;const n=this._getEncoding(t);return new F$2(this,n,ve$2(n.key,{...t,sub:this.tree._sub}))}createReadStream(e,t){const n=t&&t.signal||null;return ke$2(this.createRangeIterator(e,t),n)}async getBySeq(e,t){const n=this._getEncoding(t);try{const t=(await this.getBlock(e)).final(n);return {key:t.key,value:t.value}}finally{await this._closeSnapshot();}}async get(e,t){const n=this._getEncoding(t);try{return await this._get(e,n)}finally{await this._closeSnapshot();}}async _get(e,t){e=we$2(t.key,e),null!==this.tree.extension&&!1!==this.options.extension&&(this.options.onwait=this._onwait.bind(this,e));let n=await this.getRoot(!1);if(!n)return null;for(;;){if(n.block.isTarget(e))return n.block.isDeletion()?null:n.block.final(t);let s,i=0,o=n.keys.length;for(;i<o;){const r=i+o>>1;if(s=R$2.compare(e,await n.getKey(r)),0===s)return (await this.getBlock(n.keys[r].seq)).final(t);s<0?o=r:i=r+1;}if(!n.children.length)return null;const r=s<0?o:i;n=await n.getChildNode(r);}}async put(e,t,n){const s=this.batchLock?await this.batchLock():null,i=n&&n.cas||null,o=this._getEncoding(n);if(this.locked||await this.lock(),!s)return this._put(e,t,o,i);try{return await this._put(e,t,o,i)}finally{s();}}async _put(e,t,n,s){const i={seq:0,key:e,value:t};e=we$2(n.key,e),t=we$2(n.value,t);const o=[];let r,h=r=await this.getRoot(!0);h||(h=r=oe$2.create(null));const c=i.seq=this.core.length+this.length,l=new X$2(c,e);for(;h.children.length;){o.push(h),h.changed=!0;let a,d=0,u=h.keys.length;for(;d<u;){const o=d+u>>1;if(a=R$2.compare(l.value,await h.getKey(o)),0===a){if(s){const e=await h.getKeyNode(o);if(!await s(e.final(n),i))return this._unlockMaybe()}if(!this.tree.alwaysDuplicate){if(me$2((await h.getKeyNode(o)).value,t))return this._unlockMaybe()}return h.setKey(o,l),this._append(r,c,e,t)}a<0?u=o:d=o+1;}const g=a<0?u:d;h=await h.getChildNode(g);}let a=!await h.insertKey(l,t,null,i,n,s);if(!h.changed)return this._unlockMaybe();for(;a;){const e=o.pop(),{median:s,right:i}=await h.split();e?(a=!await e.insertKey(s,t,i,null,n,null),h=e):(r=oe$2.create(h.block),r.changed=!0,r.keys.push(s),r.children.push(new $$2(0,0,h),new $$2(0,0,i)),a=!1);}return this._append(r,c,e,t)}async del(e,t){const n=this.batchLock?await this.batchLock():null,s=t&&t.cas||null,i=this._getEncoding(t);if(this.locked||await this.lock(),!n)return this._del(e,i,s);try{return await this._del(e,i,s)}finally{n();}}async _del(e,t,n){const s={seq:0,key:e,value:null};e=we$2(t.key,e);const i=[];let o=await this.getRoot(!0);if(!o)return this._unlockMaybe();const r=s.seq=this.core.length+this.length;for(;;){i.push(o);let h,c=0,l=o.keys.length;for(;c<l;){const a=c+l>>1;if(h=R$2.compare(e,await o.getKey(a)),0===h){if(n){const e=await o.getKeyNode(a);if(!await n(e.final(t),s))return this._unlockMaybe()}o.children.length?await fe$2(o,a,i):o.removeKey(a);for(const e of i)e.changed=!0;return this._append(await pe$2(i),r,e,null)}h<0?l=a:c=a+1;}if(!o.children.length)return this._unlockMaybe();const a=h<0?l:c;o=await o.getChildNode(a);}}async _closeSnapshot(){this.isSnapshot&&(await this.core.close(),this._finalize());}async close(){if(this.isSnapshot)return this._closeSnapshot();this.root=null,this.blocks&&this.blocks.clear(),this.length=0,this._unlock();}destroy(){this.close().catch(xe$2);}toBlocks(){if(this.appending)return this.appending;const e=new Array(this.length);for(let t=0;t<this.length;t++){const n=this.core.length+t,{pendingIndex:s,key:i,value:o}=this.blocks.get(n);if(t<this.length-1){s[0]=null;let e=0;for(;e<s.length;){const t=s[e];null===t||t.seq!==n?e===s.length-1?s.pop():s[e]=s.pop():t.offset=e++;}}e[t]=V$2.encode({key:i,value:o,index:se$2(s)});}return this.appending=e,e}flush(){if(!this.length)return this.close();const e=this.toBlocks();return this.root=null,this.blocks.clear(),this.length=0,this._appendBatch(e)}_unlockMaybe(){this.autoFlush&&this._unlock();}_unlock(){const e=this.locked;this.locked=null,null!==e&&e(),this._finalize();}_finalize(){if(this.index>=this.tree._batches.length||this.tree._batches[this.index]!==this)return;const e=this.tree._batches.pop();e!==this&&(e.index=this.index,this.tree._batches[e.index]=e);}_append(e,t,n,s){const i=[];if(e.indexChanges(i,t),i[0]=new $$2(t,0,e),!this.autoFlush){const o=new he$2(t,this,n,s,i);return e.block=o,this.root=e,this.length++,this.blocks.set(t,o),void e.updateChildren(t,o)}return this._appendBatch(V$2.encode({key:n,value:s,index:se$2(i)}))}async _appendBatch(e){try{await this.core.append(e);}finally{this._unlock();}}};let ae$2 = class ae extends O$2{constructor(e,t,n={}){super(),this.keyEncoding=n.keyEncoding||e.keyEncoding,this.valueEncoding=n.valueEncoding||e.valueEncoding,this.index=e._entryWatchers.push(this)-1,this.bee=e,this.key=t,this.node=null,this._forceUpdate=!1,this._debouncedUpdate=A$2(this._processUpdate.bind(this)),this._updateOnce=!!n.updateOnce;}_close(){const e=this.bee._entryWatchers.pop();e!==this&&(e.index=this.index,this.bee._entryWatchers[e.index]=e);}_onappend(){this._debouncedUpdate();}_ontruncate(){this._forceUpdate=!0,this._debouncedUpdate();}async _processUpdate(){const e=this._forceUpdate;let t;this._forceUpdate=!1,this._updateOnce&&(this._updateOnce=!1,await this.bee.update({wait:!0}));try{t=await this.bee.get(this.key,{keyEncoding:this.keyEncoding,valueEncoding:this.valueEncoding});}catch(e){if("SNAPSHOT_NOT_AVAILABLE"===e.code)return;return this.bee.closing?void this.close().catch(U$2):void this.emit("error",e)}(e||t?.seq!==this.node?.seq)&&(this.node=t,this.emit("update"));}};let de$2 = class de extends O$2{constructor(e,t,n={}){super(),this.keyEncoding=n.keyEncoding||e.keyEncoding,this.valueEncoding=n.valueEncoding||e.valueEncoding,this.index=e._watchers.push(this)-1,this.bee=e,this.core=e.core,this.latestDiff=0,this.range=t,this.map=n.map||ge$2,this.current=null,this.previous=null,this.currentMapped=null,this.previousMapped=null,this.stream=null,this._lock=M$2(),this._flowing=!1,this._resolveOnChange=null,this._differ=n.differ||_e$2,this._eager=!!n.eager,this._updateOnce=!!n.updateOnce,this._onchange=n.onchange||null,this._flush=!1!==n.flush&&this.core.isAutobase,this.on("newListener",ue$2),this.ready().catch(U$2);}async _consume(){if(!this._flowing)try{for await(const e of this);}catch{}}async _open(){await this.bee.ready();const e={keyEncoding:this.keyEncoding,valueEncoding:this.valueEncoding};this.current=this._eager?this.bee.checkout(1,e):this.bee.snapshot(e),this._onchange&&(this._eager&&await this._onchange(),this._consume());}[Symbol.asyncIterator](){return this._flowing=!0,this}_ontruncate(){this.core.isAutobase&&this._onappend();}_onappend(){if(!(this.closing||this.core.isAutobase||this.core.core&&this.core.core.tree.length===this.core.length))return;const e=this._resolveOnChange;this._resolveOnChange=null,e&&e();}async _waitForChanges(){this.current.version<this.bee.version||this.closing||await new Promise((e=>{this._resolveOnChange=e;}));}async next(){try{return await this._next()}catch(e){if(this.closing)return {value:void 0,done:!0};throw await this.close(),e}}async _next(){const e=await this._lock();try{if(this.closing)return {value:void 0,done:!0};for(this.opened||await this.ready();;){if(await this._waitForChanges(),this.closing)return {value:void 0,done:!0};if(this._updateOnce&&(this._updateOnce=!1,await this.bee.update({wait:!0})),this._flush&&await this.core.base.flush(),this.closing)return {value:void 0,done:!0};if(await this._closePrevious(),this.previous=this.current.snapshot(),await this._closeCurrent(),this.current=this.bee.snapshot({keyEncoding:this.keyEncoding,valueEncoding:this.valueEncoding}),this.current.core.fork!==this.previous.core.fork)return await this._yield();this.stream=this._differ(this.current,this.previous,this.range);try{for await(const e of this.stream)return await this._yield()}finally{this.stream=null;}}}finally{e();}}async _yield(){if(this.currentMapped=this.map(this.current),this.previousMapped=this.map(this.previous),this._onchange)try{await this._onchange();}catch(e){U$2(e);}return this.emit("update"),{done:!1,value:[this.currentMapped,this.previousMapped]}}async return(){return await this.close(),{done:!0}}async _close(){const e=this.bee._watchers.pop();e!==this&&(e.index=this.index,this.bee._watchers[e.index]=e),this.stream&&!this.stream.destroying&&this.stream.destroy(),this._onappend(),await this._closeCurrent().catch(U$2),await this._closePrevious().catch(U$2);(await this._lock())();}destroy(){return this.close()}async _closeCurrent(){this.currentMapped&&await this.currentMapped.close(),this.current&&await this.current.close(),this.current=this.currentMapped=null;}async _closePrevious(){this.previousMapped&&await this.previousMapped.close(),this.previous&&await this.previous.close(),this.previous=this.previousMapped=null;}};function ue$2(e){"update"===e&&this._consume();}function ge$2(e){return e}async function ye$2(e,t){for(;e.children.length;)e=await e.getChildNode(t?0:e.children.length-1);return e.keys.length}async function fe$2(e,t,n){let[s,i]=await Promise.all([e.getChildNode(t),e.getChildNode(t+1)]);const[o,r]=await Promise.all([ye$2(s,!1),ye$2(i,!0)]);if(o<r){for(n.push(i);i.children.length;)n.push(i=i.children[0].value);e.keys[t]=i.keys.shift();}else {for(n.push(s);s.children.length;)n.push(s=s.children[s.children.length-1].value);e.keys[t]=s.keys.pop();}}async function pe$2(e){const t=e[0];for(;e.length>1;){const n=e.pop(),s=e[e.length-1];if(n.keys.length>=4)return t;let{left:i,index:o,right:r}=await n.siblings(s);if(i&&i.keys.length>4)return i.changed=!0,n.keys.unshift(s.keys[o-1]),i.children.length&&n.children.unshift(i.children.pop()),s.keys[o-1]=i.keys.pop(),t;if(r&&r.keys.length>4)return r.changed=!0,n.keys.push(s.keys[o]),r.children.length&&n.children.push(r.children.shift()),s.keys[o]=r.keys.shift(),t;i?(o--,r=n):i=n,i.merge(r,s.keys[o]),s.removeKey(o);}return !t.keys.length&&t.children.length?t.getChildNode(0):t}function ke$2(e,t){let n,s;const i=new I$2({signal:t,open(t){n=t,e.open().then(o,o);},read(t){n=t,e.next().then(r,o);},predestroy(){s=e.close(),s.catch(xe$2);},destroy(t){n=t,s||(s=e.close()),s.then(o,o);}});return i;function o(e){n(e);}function r(e){i.push(e),n(null);}}async function be$2(e){try{return await e.open(),await e.next()}finally{await e.close();}}function ve$2(e,t){if(!e)return t;if(e.encodeRange){const n=e.encodeRange({gt:t.gt,gte:t.gte,lt:t.lt,lte:t.lte});return t.gt=n.gt,t.gte=n.gte,t.lt=n.lt,t.lte=n.lte,t}var n;return void 0!==t.gt&&(t.gt=we$2(e,t.gt)),void 0!==t.gte&&(t.gte=we$2(e,t.gte)),void 0!==t.lt&&(t.lt=we$2(e,t.lt)),void 0!==t.lte&&(t.lte=we$2(e,t.lte)),!t.sub||t.gt||t.gte||(t.gt=we$2(e,J$2)),!t.sub||t.lt||t.lte||(t.lt=((n=we$2(e,Q$2))[n.length-1]++,n)),t}function we$2(e,t){return null==t?null:null!==e?e.encode(t):"string"==typeof t?R$2.from(t):t}function _e$2(e,t,n){return e.createDiffStream(t,n)}function me$2(e,t){return e===t||null!==e&&null!==t&&R$2.equals(e,t)}function xe$2(){}var Ee$2=ce$2;

/**
 * Bundled by jsDelivr using Rollup v2.79.1 and Terser v5.19.2.
 * Original file: /npm/sub-encoder@2.1.3/index.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
const n$1=t$5,i$1=L$a,r=i$1.alloc(1),s$1=i$1.from([1]),o$1=i$1.alloc(0);var c=class e{constructor(e,t,o=null){this.userEncoding=n$1(t),this.prefix=null!=e?function(e,t){return e="string"==typeof e?i$1.from(e):e,e&&t?i$1.concat([t,e,r]):e?i$1.concat([e,r]):t?i$1.concat([t,r]):r}(e,o):null,this.lt=this.prefix&&i$1.concat([this.prefix.subarray(0,this.prefix.byteLength-1),s$1]);}_encodeRangeUser(e){if(this.userEncoding.encodeRange)return this.userEncoding.encodeRange(e);const t={};return null!=e.gt&&(t.gt=this.userEncoding.encode(e.gt)),null!=e.gte&&(t.gte=this.userEncoding.encode(e.gte)),null!=e.lte&&(t.lte=this.userEncoding.encode(e.lte)),null!=e.lt&&(t.lt=this.userEncoding.encode(e.lt)),t}_addPrefix(e){return this.prefix?i$1.concat([this.prefix,e]):e}encode(e){return this._addPrefix(this.userEncoding.encode(e))}encodeRange(e){const t=this._encodeRangeUser(e);return t.gt?t.gt=this._addPrefix(t.gt):t.gte?t.gte=this._addPrefix(t.gte):this.prefix&&(t.gte=this.prefix),t.lt?t.lt=this._addPrefix(t.lt):t.lte?t.lte=this._addPrefix(t.lte):this.prefix&&(t.lt=this.lt),t}decode(e){return this.userEncoding.decode(this.prefix?e.subarray(this.prefix.byteLength):e)}sub(t,n){return new e(t||o$1,(i=n)&&i.keyEncoding?i.keyEncoding:i,this.prefix);var i;}};

/**
 * Bundled by jsDelivr using Rollup v2.79.1 and Terser v5.19.2.
 * Original file: /npm/autobase@6.5.8/index.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
function _$1(e){return e&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}const w$1=s$o;var m$1=class m{constructor(){this.seen=new w$1;}get size(){return this.seen.size}has(e){return this.seen.has(e)}includes(e,t){return this.seen.has(e)&&this.seen.get(e)>=t}get(e){return this.seen.get(e)||0}set(e,t){return this.seen.set(e,t),t}add(e){for(const[t,s]of e)this.get(t)<s&&this.set(t,s);}[Symbol.iterator](){return this.seen[Symbol.iterator]()}};const k$1=s$o,v$1=m$1;const x$1=L$c,b$1=r$s;function S$1(e,t,s=0){t.push(e);let i=t.length-1;for(;i>=s+1;){const s=t[i-1];if(L$1(e,s))break;t[i]=s,t[--i]=e;}for(;i<t.length-1;){const s=t[i+1];if(C$1(e,s)<=0)break;t[i]=s,t[++i]=e;}return i}function L$1(e,t){return !!t.dependents.has(e)||e.length>0&&t.length===e.length-1&&e.writer===t.writer}function C$1(e,t){const s=x$1.compare(e.writer.core.key,t.writer.core.key);return 0!==s&&e.version!==t.version?t.version-e.version:0===s?e.length<t.length?-1:1:s}const W$1=L$c,I$1=r$s,B$1=m$1,F$1=class F{constructor(e){this.merges=new Set,this.majority=1+(e.length>>>1),this.indexers=e,this.removed=new v$1,this.updated=!1,this.writers=new k$1;for(const e of this.indexers)this.writers.set(e.core.key,e);}addHead(e){if(e.writer.isActiveIndexer)return this._isMerge(e)&&this.merges.add(e),this.updated=!0,e}_tails(e,t){const s=new Set;for(const i of t)e.clock.includes(i.writer.core.key,i.length)&&s.add(i);return s}_tailsAndMerges(e,t){const s=this._tails(e,t);for(const t of this.merges)t!==e&&e.clock.includes(t.writer.core.key,t.length)&&s.add(t);return s}_isMerge(e){if(!e.writer.isActiveIndexer)return !1;const t=[];for(const s of this.indexers){let i=e.clock.get(s.core.key)-1;s===e.writer&&i--;const n=s.get(i);if(!n||this.removed.includes(n.writer.core.key,n.length))continue;let r=!0;for(let e=0;e<t.length;e++){const s=t[e];if(s!==n){if(s.clock.includes(n.writer.core.key,n.length)){r=!1;break}if(n.clock.includes(s.writer.core.key,s.length)){const i=t.pop();if(s===i)continue;t[e--]=i;}}}r&&t.push(n);}return t.length>1}_indexerTails(){const e=new Set;for(const t of this.indexers){const s=this.removed.has(t.core.key)?this.removed.get(t.core.key):t.indexed,i=t.get(s);if(!i||this.removed.includes(i.writer.core.key,i.length))continue;let n=!0;for(const t of e){if(i.clock.includes(t.writer.core.key,t.length)){n=!1;break}t.clock.includes(i.writer.core.key,i.length)&&e.delete(t);}n&&e.add(i);}return e}_strictlyNewer(e,t){for(const[s,i]of t.clock){const n=this.removed.get(s);if(i<=n)continue;let r=e.clock.get(s);if(r<=n&&(r=n),i<r)return !1;if(i===r)continue;const o=this.writers.get(s),h=o&&o.get(r>=o.indexed?r:o.indexed);if(h&&(!h.clock.includes(e.writer.core.key,e.length)&&t.clock.includes(h.writer.core.key,h.length)))return !1}return t.clock.get(e.writer.core.key)>=e.length}_acks(e){const t=e.writer.isActiveIndexer?[e]:[];for(const s of this.indexers){if(s===e.writer)continue;let i=e.clock.get(s.core.key);i<s.nodes.offset&&(i=s.nodes.offset);const n=s.get(i>=s.indexed?i:s.indexed);n&&(n.clock.includes(e.writer.core.key,e.length)&&this._strictlyNewer(e,n)&&t.push(n));}return t}acksFromNode(e,t){const s=new Set;if(!t||!t.clock.includes(e.writer.core.key,e.length))return s;s.add(t.writer);for(const i of this.indexers){if(i===t.writer)continue;const n=t.clock.get(i.core.key);if(e.clock.includes(i.core.key,n))continue;const r=i.get(n);r&&(r.clock.includes(e.writer.core.key,e.length)&&s.add(i));}return s}_ackedAt(e,t){let s=0,i=e.length;for(const n of e)if(i--,t.clock.includes(n.writer.core.key,n.length)){if(++s>=this.majority)return !0}else if(s+i<this.majority)return !1;return !1}confirms(e,t,s,i){if(!i||this.removed.get(e.core.key)>=i)return 0;let n=!0,r=!0;for(let o=i-1;o>=0;o--){const h=e.get(o);if(null===h)return 0;let a=0;for(const e of s)if(h.clock.includes(e.writer.core.key,e.length)&&++a>=this.majority)break;if(!r&&a<this.majority)break;if(this._strictlyNewer(t,h))return a<this.majority?1:2;if(n){n=!1;let s=i-1,r=0;for(;s>r;){const i=s+r>>>1,n=e.get(i);null===n||!n.clock.includes(t.writer.core.key,t.length)||this._strictlyNewer(t,n)?r=i+1:s=i-1;}r+1<o&&(o=r+2);}r=!1;}return 0}_isConfirmed(e,t=null){const s=this._acks(e),i=new Set;if(s.length<this.majority)return !1;let n=!0;for(const r of this.indexers){const o=t?t.writer===r?t.length-1:t.clock.get(r.core.key):r.length,h=this.confirms(r,e,s,o);if(2===h&&(i.add(r),i.size>=this.majority))return !0;0===h&&(n=!1);}return t?this._isConfirmableAt(e,t,s,i):n}_isConfirmableAt(e,t,s,i){if(!this._ackedAt(s,t))return !1;let n=i.size;for(const s of this.indexers){if(i.has(s))continue;const r=t.clock.get(s.core.key);if(!e.clock.includes(s.core.key,r)){const t=s.get(r-1);if(t&&!this.removed.includes(t.writer.core.key,t.length)&&!this._strictlyNewer(e,t))continue}if(++n>=this.majority)return !0}return !1}remove(e){return this.merges.delete(e),this.removed.set(e.writer.core.key,e.length),e}shift(){if(!this.updated)return [];const e=this._indexerTails();for(const t of e)if(this._isConfirmed(t))return [this.remove(t)];for(const t of this.merges)if(this._isConfirmed(t))return this._yieldNext(t,e);return this.updated=!1,[]}_yieldNext(e,t){for(;!t.has(e);){let s=null;for(const i of this._tailsAndMerges(e,t))if(this._isConfirmed(i,e)){s=i;break}if(s){e=s;continue}const i=[];for(const s of this._tails(e,t))i.push(this.remove(s));return i}return [this.remove(e)]}shouldAck(e){for(const t of this._indexerTails())if(t.writer!==e&&this._shouldAckNode(t,e))return !0;return !1}_shouldAckNode(e,t){const s=t.head(),i=e.clock.get(t.core.key),n=t.get(i>=t.indexed?i:t.indexed);if(!n&&t!==e.writer)return !0;if(n){if(!n.clock.includes(e.writer.core.key,e.length))return !s.clock.includes(e.writer.core.key,e.length);if(!this._strictlyNewer(e,n))return !1}const r=this._acks(e);return r.length>=this.majority&&0===this.confirms(t,e,r,t.length)}},E$1=class E{constructor(){this.tip=[],this.undo=0,this.shared=0;}static compare(e,t){return C$1(e,t)}static add(e,t,s){S$1(e,t,s);}mark(){this.shared=this.tip.length,this.undo=0;}flush(e=[]){e.length&&this._applyIndexed(e);const t={shared:this.shared,undo:this.undo,length:e.length+this.tip.length,indexed:e,tip:this.tip};return this.mark(),t}print(){return this.tip.map((e=>e.writer.core.key.toString()+e.length))}_applyIndexed(e){b$1(e.length<=this.tip.length,"Indexed batch cannot exceed tip");let t=0;for(;t<e.length&&this.tip[t]===e[t];t++);t<e.length&&this._track(t);let s=0;for(let e=t;e<this.tip.length;e++){const t=this.tip[e];t.yielded||(this.tip[s++]=t);}this.tip.splice(s,this.tip.length-s);}add(e){const t=S$1(e,this.tip,0);this._track(t);}_track(e){e<this.shared&&(this.undo+=this.shared-e,this.shared=e);}};let A$1 = class A{constructor(e,t,s,i,n,r,o){this.writer=e,this.length=t,this.value=s,this.heads=i,this.actualHeads=i.slice(0),this.dependents=new Set,this.dependencies=r,this.version=o,this.batch=n,this.clock=new B$1,this.yielded=!1,this.yielding=!1;}clear(){return this.clock=null,this.dependencies=null,this.dependents=null,this}reset(){this.yielded=!1,this.yielding=!1;for(const e of this.dependents)e.dependencies.add(this);this.dependents.clear();}active(){for(const e of this.dependencies)e.yielded?this.dependencies.delete(e):(e.dependents.add(this),this.clock.add(e.clock));this.writer.isActiveIndexer&&this.clock.set(this.writer.core.key,this.length);}tieBreak(e){return t=this,s=e,E$1.compare(t,s)<0;var t,s;}hasDependency(e){for(const i of this.actualHeads)if(t=i,s=e,W$1.equals(t.key,s.writer.core.key)&&t.length===s.length)return !0;var t,s;return !1}get ref(){return this.writer.core.key.toString("hex").slice(0,2)+":"+this.length}};var K$1=class K{constructor(e,{heads:t=[],writers:s=new Map}={}){this.heads=new Set,this.tails=new Set,this.tip=new E$1,this.size=0,this.updated=!1,this.indexersUpdated=!1,this.writers=s,this.consensus=new F$1(e),this._initialHeads=t.slice(0),this._strictlyAdded=null;for(const{key:e,length:s}of t)this.consensus.removed.set(e,s);}get indexers(){return this.consensus.indexers}static createNode(e,t,s,i,n,r,o){return new A$1(e,t,s,i,n,r,o)}getHeads(){const e=this._initialHeads.slice(0);for(const t of this.heads)e.push({key:t.writer.core.key,length:t.length});return e}getBootstrapWriters(){const e=[];for(const t of this.heads)e.push(t.writer);for(let t=0;t<this.consensus.indexers.length;t++)e.push(this.consensus.indexers[t]);return e}addHead(e){e.active(),this._initialHeads.length>0&&this._updateInitialHeads(e),e.dependencies.size||this.tails.add(e);for(const t of this.heads)e.hasDependency(t)&&this.heads.delete(t);return this.tip.add(e),e.writer.isActiveIndexer&&this.consensus.addHead(e),this.size++,this.heads.add(e),this.updated=!0,e}update(){if(!this.updated)return null;this.updated=!1;const e=[];for(;;){const t=this.consensus.shift();if(!t.length)break;this._yield(t,e);}return this.tip.flush(e)}_updateInitialHeads(e){for(const t of e.actualHeads)for(let e=0;e<this._initialHeads.length;e++){const{key:s,length:i}=this._initialHeads[e];i===t.length&&W$1.equals(s,t.key)&&this._initialHeads.splice(e--,1);}}shouldAck(e,t=!1){if(!e||!e.isActiveIndexer)return !1;for(const e of this.indexers)if(e.length!==e.available)return !1;let s=!1;for(const t of this.heads){if(!t.writer.isActiveIndexer)return !0;t.writer===e&&(s=!0);}if(1===this.heads.size&&s)return !1;const i=new Set;let n=!1;for(const e of this.tails)if(t||this._nonNull(e,i)){n=!0;break}return !!n&&(!!this.consensus.shouldAck(e)||this._shouldAckHeads(e,t))}_nonNull(e,t){const s=[e];for(;s.length;){const e=s.pop();if(!t.has(e)){if(null!==e.value)return !0;t.add(e);for(const t of e.dependents)s.push(t);}}return !1}_shouldAckHeads(e){const t=e.head();for(const s of this.heads){if(s.writer===e)continue;const i=[s],n=new Set;for(;i.length;){const e=i.pop();if(!n.has(e)){if(n.add(e),null!==e.value){const i=this.consensus.acksFromNode(e,s),n=this.consensus.acksFromNode(e,t);if(i.size>n.size)return !0;for(const e of i)if(!n.has(e))return !0;if(n.size&&i.size)continue}i.push(...e.dependencies);}}}return !1}_yield(e,t=[]){const s=t.length,i=[];for(;e.length;){const t=e.pop();t.yielding||(t.yielding=!0,t.dependencies.size||i.push(t),e.push(...t.dependencies));}for(;i.length;){let e=i.pop();for(e of this._removeBatch(e))E$1.add(e,t,s);for(const t of e.dependents)!t.dependencies.size&&t.yielding&&i.push(t);}return t}_isTail(e){for(const t of e.dependencies)if(!t.yielded)return !1;return !0}_removeNode(e){this.tails.delete(e),this.heads.delete(e),this.consensus.remove(e);for(const t of e.dependents)t.dependencies.delete(e),this._isTail(t)&&this.tails.add(t);return e.yielded=!0,this.size--,0===this.heads.size&&this._initialHeads.push({key:e.writer.core.key,length:e.length}),e}_removeBatch(e){const t=[this._removeNode(e)];for(;1!==e.batch;){if(0===e.dependents.size){const t=e.writer.get(e.length);t&&t.batch===e.batch-1&&e.dependents.add(t);}I$1(1===e.dependents.size,"Batch is linked partially, which is not allowed"),e=e.dependents[Symbol.iterator]().next().value,t.push(this._removeNode(e));}return t}};function T$1(){}function q$1(){q$1.init.call(this);}function D$1(e){return void 0===e._maxListeners?q$1.defaultMaxListeners:e._maxListeners}function z$1(e,t,s,i){var n,r,o,h;if("function"!=typeof s)throw new TypeError('"listener" argument must be a function');if((r=e._events)?(r.newListener&&(e.emit("newListener",t,s.listener?s.listener:s),r=e._events),o=r[t]):(r=e._events=new T$1,e._eventsCount=0),o){if("function"==typeof o?o=r[t]=i?[s,o]:[o,s]:i?o.unshift(s):o.push(s),!o.warned&&(n=D$1(e))&&n>0&&o.length>n){o.warned=!0;var a=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+t+" listeners added. Use emitter.setMaxListeners() to increase limit");a.name="MaxListenersExceededWarning",a.emitter=e,a.type=t,a.count=o.length,h=a,"function"==typeof console.warn?console.warn(h):console.log(h);}}else o=r[t]=s,++e._eventsCount;return e}function U$1(e,t,s){var i=!1;function n(){e.removeListener(t,n),i||(i=!0,s.apply(e,arguments));}return n.listener=s,n}function P$1(e){var t=this._events;if(t){var s=t[e];if("function"==typeof s)return 1;if(s)return s.length}return 0}function R$1(e,t){for(var s=new Array(t);t--;)s[t]=e[t];return s}T$1.prototype=Object.create(null),q$1.EventEmitter=q$1,q$1.usingDomains=!1,q$1.prototype.domain=void 0,q$1.prototype._events=void 0,q$1.prototype._maxListeners=void 0,q$1.defaultMaxListeners=10,q$1.init=function(){this.domain=null,q$1.usingDomains&&undefined.active,this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=new T$1,this._eventsCount=0),this._maxListeners=this._maxListeners||void 0;},q$1.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=e,this},q$1.prototype.getMaxListeners=function(){return D$1(this)},q$1.prototype.emit=function(e){var t,s,i,n,r,o,h,a="error"===e;if(o=this._events)a=a&&null==o.error;else if(!a)return !1;if(h=this.domain,a){if(t=arguments[1],!h){if(t instanceof Error)throw t;var c=new Error('Uncaught, unspecified "error" event. ('+t+")");throw c.context=t,c}return t||(t=new Error('Uncaught, unspecified "error" event')),t.domainEmitter=this,t.domain=h,t.domainThrown=!1,h.emit("error",t),!1}if(!(s=o[e]))return !1;var d="function"==typeof s;switch(i=arguments.length){case 1:!function(e,t,s){if(t)e.call(s);else for(var i=e.length,n=R$1(e,i),r=0;r<i;++r)n[r].call(s);}(s,d,this);break;case 2:!function(e,t,s,i){if(t)e.call(s,i);else for(var n=e.length,r=R$1(e,n),o=0;o<n;++o)r[o].call(s,i);}(s,d,this,arguments[1]);break;case 3:!function(e,t,s,i,n){if(t)e.call(s,i,n);else for(var r=e.length,o=R$1(e,r),h=0;h<r;++h)o[h].call(s,i,n);}(s,d,this,arguments[1],arguments[2]);break;case 4:!function(e,t,s,i,n,r){if(t)e.call(s,i,n,r);else for(var o=e.length,h=R$1(e,o),a=0;a<o;++a)h[a].call(s,i,n,r);}(s,d,this,arguments[1],arguments[2],arguments[3]);break;default:for(n=new Array(i-1),r=1;r<i;r++)n[r-1]=arguments[r];!function(e,t,s,i){if(t)e.apply(s,i);else for(var n=e.length,r=R$1(e,n),o=0;o<n;++o)r[o].apply(s,i);}(s,d,this,n);}return !0},q$1.prototype.addListener=function(e,t){return z$1(this,e,t,!1)},q$1.prototype.on=q$1.prototype.addListener,q$1.prototype.prependListener=function(e,t){return z$1(this,e,t,!0)},q$1.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.on(e,U$1(this,e,t)),this},q$1.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.prependListener(e,U$1(this,e,t)),this},q$1.prototype.removeListener=function(e,t){var s,i,n,r,o;if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');if(!(i=this._events))return this;if(!(s=i[e]))return this;if(s===t||s.listener&&s.listener===t)0==--this._eventsCount?this._events=new T$1:(delete i[e],i.removeListener&&this.emit("removeListener",e,s.listener||t));else if("function"!=typeof s){for(n=-1,r=s.length;r-- >0;)if(s[r]===t||s[r].listener&&s[r].listener===t){o=s[r].listener,n=r;break}if(n<0)return this;if(1===s.length){if(s[0]=void 0,0==--this._eventsCount)return this._events=new T$1,this;delete i[e];}else !function(e,t){for(var s=t,i=s+1,n=e.length;i<n;s+=1,i+=1)e[s]=e[i];e.pop();}(s,n);i.removeListener&&this.emit("removeListener",e,o||t);}return this},q$1.prototype.off=function(e,t){return this.removeListener(e,t)},q$1.prototype.removeAllListeners=function(e){var t,s;if(!(s=this._events))return this;if(!s.removeListener)return 0===arguments.length?(this._events=new T$1,this._eventsCount=0):s[e]&&(0==--this._eventsCount?this._events=new T$1:delete s[e]),this;if(0===arguments.length){for(var i,n=Object.keys(s),r=0;r<n.length;++r)"removeListener"!==(i=n[r])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=new T$1,this._eventsCount=0,this}if("function"==typeof(t=s[e]))this.removeListener(e,t);else if(t)do{this.removeListener(e,t[t.length-1]);}while(t[0]);return this},q$1.prototype.listeners=function(e){var t,s=this._events;return s&&(t=s[e])?"function"==typeof t?[t.listener||t]:function(e){for(var t=new Array(e.length),s=0;s<t.length;++s)t[s]=e[s].listener||e[s];return t}(t):[]},q$1.listenerCount=function(e,t){return "function"==typeof e.listenerCount?e.listenerCount(t):P$1.call(e,t)},q$1.prototype.listenerCount=P$1,q$1.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};var M$1=_$1(Object.freeze({__proto__:null,default:q$1,EventEmitter:q$1}));const H$1=t$r,N$1=r$s,V$1={preencode(e,t){H$1.fixed32.preencode(e,t.key),H$1.uint.preencode(e,t.length);},encode(e,t){H$1.fixed32.encode(e,t.key),H$1.uint.encode(e,t.length);},decode:e=>({key:H$1.fixed32.decode(e),length:H$1.uint.decode(e)})},O$1=H$1.array(V$1),j$1={preencode(e,t){H$1.fixed64.preencode(e,t.signature),H$1.uint.preencode(e,t.length);},encode(e,t){H$1.fixed64.encode(e,t.signature),H$1.uint.encode(e,t.length);},decode:e=>({signature:H$1.fixed64.decode(e),length:H$1.uint.decode(e)})},Q$1={preencode(e,t){H$1.fixed32.preencode(e,t.key);},encode(e,t){H$1.fixed32.encode(e,t.key);},decode:e=>({key:H$1.fixed32.decode(e),length:-1})},G$1=H$1.array(Q$1),J$1={preencode(e,t){H$1.uint.preencode(e,0),H$1.uint.preencode(e,t.type),1===t.type&&G$1.preencode(e,t.writers);},encode(e,t){H$1.uint.encode(e,0),H$1.uint.encode(e,t.type),1===t.type&&G$1.encode(e,t.writers);},decode(e){const t=H$1.uint.decode(e);if(0!==t)throw new Error("Unsupported version: "+t);const s={version:0,type:H$1.uint.decode(e),writers:null};return 1===s.type&&(s.writers=G$1.decode(e)),s}},X$1={preencode(e,t){if(0===t.version)return J$1.preencode(e,t);H$1.uint.preencode(e,1),H$1.uint.preencode(e,t.type),1===t.type&&O$1.preencode(e,t.writers);},encode(e,t){if(0===t.version)return J$1.encode(e,t);H$1.uint.encode(e,1),H$1.uint.encode(e,t.type),1===t.type&&O$1.encode(e,t.writers);},decode(e){const t=e.start,s=H$1.uint.decode(e);if(s>1)throw new Error("Unsupported version: "+s);if(0===s)return e.start=t,J$1.decode(e);const i={version:1,type:H$1.uint.decode(e),writers:null};return 1===i.type&&(i.writers=O$1.decode(e)),i}},Y$1=H$1.array(H$1.string),Z$1={preencode(e,t){H$1.uint.preencode(e,0),V$1.preencode(e,t.indexed),O$1.preencode(e,t.heads),Y$1.preencode(e,t.views);},encode(e,t){H$1.uint.encode(e,0),V$1.encode(e,t.indexed),O$1.encode(e,t.heads),Y$1.encode(e,t.views);},decode(e){const t=H$1.uint.decode(e);return N$1(0===t,"Unsupported version: "+t),{indexed:V$1.decode(e),heads:O$1.decode(e),views:Y$1.decode(e)}}},$$1={preencode(e,t){H$1.uint.preencode(e,0),H$1.string.preencode(e,t.name),H$1.uint.preencode(e,(t.migrated?1:0)|(t.audits?2:0)),t.migrated&&H$1.fixed32.preencode(e,t.migrated),t.audits&&H$1.uint.preencode(e,t.audits);},encode(e,t){H$1.uint.encode(e,0),H$1.string.encode(e,t.name),H$1.uint.encode(e,(t.migrated?1:0)|(t.audits?2:0)),t.migrated&&H$1.fixed32.encode(e,t.migrated),t.audits&&H$1.uint.encode(e,t.audits);},decode(e){const t=H$1.uint.decode(e);N$1(0===t,"Unsupported version: "+t);const s=H$1.string.decode(e),i=H$1.uint.decode(e);return {name:s,migrated:1&i?H$1.fixed32.decode(e):null,audits:2&i?H$1.uint.decode(e):0}}},ee$1=H$1.array({preencode(e,t){H$1.uint.preencode(e,t.checkpointer),null!==t.checkpoint&&j$1.preencode(e,t.checkpoint);},encode(e,t){H$1.uint.encode(e,t.checkpointer),null!==t.checkpoint&&j$1.encode(e,t.checkpoint);},decode(e){const t=H$1.uint.decode(e);return {checkpointer:t,checkpoint:t?null:j$1.decode(e)}}}),te$1={preencode(e,t){H$1.uint.preencode(e,t.signature),H$1.fixed32.preencode(e,t.namespace),H$1.fixed32.preencode(e,t.publicKey);},encode(e,t){H$1.uint.encode(e,t.signature),H$1.fixed32.encode(e,t.namespace),H$1.fixed32.encode(e,t.publicKey);},decode:e=>({signature:H$1.uint.decode(e),namespace:H$1.fixed32.decode(e),publicKey:H$1.fixed32.decode(e)})},se$1=H$1.array(te$1),ie$1={preencode(e,t){H$1.uint.preencode(e,t.pointer),0===t.pointer&&se$1.preencode(e,t.indexers);},encode(e,t){H$1.uint.encode(e,t.pointer),0===t.pointer&&se$1.encode(e,t.indexers);},decode(e){const t=H$1.uint.decode(e);return {pointer:t,indexers:0===t?se$1.decode(e):null}}},ne$1={preencode(e,t){H$1.uint.preencode(e,t.pointer),0===t.pointer&&H$1.fixed32.preencode(e,t.key);},encode(e,t){H$1.uint.encode(e,t.pointer),0===t.pointer&&H$1.fixed32.encode(e,t.key);},decode(e){const t=H$1.uint.decode(e);return {pointer:t,key:0===t?H$1.fixed32.decode(e):null}}},re$1={preencode(e,t){O$1.preencode(e,t.heads),H$1.uint.preencode(e,t.batch),H$1.buffer.preencode(e,t.value);},encode(e,t){O$1.encode(e,t.heads),H$1.uint.encode(e,t.batch),H$1.buffer.encode(e,t.value);},decode:(e,t)=>({heads:O$1.decode(e),batch:H$1.uint.decode(e),value:H$1.buffer.decode(e)})},oe$1={preencode(e,t){H$1.uint.preencode(e,t.pointer),0===t.pointer&&he$1.preencode(e,t.data);},encode(e,t){H$1.uint.encode(e,t.pointer),0===t.pointer&&he$1.encode(e,t.data);},decode(e){const t=H$1.uint.decode(e);return {pointer:t,data:0===t?he$1.decode(e):null}}},he$1={preencode(e,t){H$1.uint.preencode(e,0);},encode(e,t){H$1.uint.encode(e,0);},decode(e){const t=H$1.uint.decode(e);return {encryptionId:1&t?H$1.fixed32.decode(e):null,abi:2&t?H$1.uint.decode(e):0}}},ae$1={preencode(e,t){H$1.uint.preencode(e,t.version),H$1.uint.preencode(e,t.maxSupportedVersion);const s=null!==t.digest&&null!==t.checkpoint;let i=0;s&&(i|=1),H$1.uint.preencode(e,i),s&&(ee$1.preencode(e,t.checkpoint),ne$1.preencode(e,t.digest)),re$1.preencode(e,t.node);},encode(e,t){H$1.uint.encode(e,t.version),H$1.uint.encode(e,t.maxSupportedVersion);const s=null!==t.digest&&null!==t.checkpoint;let i=0;s&&(i|=1),H$1.uint.encode(e,i),s&&(ee$1.encode(e,t.checkpoint),ne$1.encode(e,t.digest)),re$1.encode(e,t.node);},decode(e){const t=H$1.uint.decode(e);if(0===t){const s=ce$1.decode(e);return {version:t,maxSupportedVersion:s.maxSupportedVersion,digest:null,checkpoint:s.checkpoint,node:s.node}}const s=H$1.uint.decode(e),i=0!=(1&H$1.uint.decode(e)),n=i?ee$1.decode(e):null;return {version:t,maxSupportedVersion:s,digest:i?ne$1.decode(e):null,checkpoint:n,node:re$1.decode(e)}}},ce$1={preencode(e,t){const s=null!==t.digest&&null!==t.checkpoint;H$1.uint.preencode(e,s?1:0),s&&(ie$1.preencode(e,t.digest),ee$1.preencode(e,t.checkpoint)),re$1.preencode(e,t.node),oe$1.preencode(e,t.additional),H$1.uint.preencode(e,t.maxSupportedVersion);},encode(e,t){H$1.uint.encode(e,t.version);const s=null!==t.digest&&null!==t.checkpoint;H$1.uint.encode(e,s?1:0),s&&(ie$1.encode(e,t.digest),ee$1.encode(e,t.checkpoint)),re$1.encode(e,t.node),oe$1.encode(e,t.additional),H$1.uint.encode(e,t.maxSupportedVersion);},decode(e){const t=0!=(1&H$1.uint.decode(e));return {version:0,digest:t?ie$1.decode(e):null,checkpoint:t?ee$1.decode(e):null,node:re$1.decode(e),additional:oe$1.decode(e),maxSupportedVersion:e.start<e.end?H$1.uint.decode(e):0}}},de$1=H$1.array(H$1.fixed32),le$1={preencode(e,t){H$1.uint.preencode(e,t.version),H$1.uint.preencode(e,t.members),de$1.preencode(e,t.pendingIndexers),O$1.preencode(e,t.indexers),O$1.preencode(e,t.heads),O$1.preencode(e,t.views);},encode(e,t){H$1.uint.encode(e,t.version),H$1.uint.encode(e,t.members),de$1.encode(e,t.pendingIndexers),O$1.encode(e,t.indexers),O$1.encode(e,t.heads),O$1.encode(e,t.views);},decode:e=>({version:H$1.uint.decode(e),members:H$1.uint.decode(e),pendingIndexers:de$1.decode(e),indexers:O$1.decode(e),heads:O$1.decode(e),views:O$1.decode(e)})};var ue$1={Wakeup:X$1,Clock:O$1,Checkout:V$1,BootRecord:Z$1,ViewRecord:$$1,OplogMessage:ae$1,Checkpoint:ee$1,Info:le$1,Member:{preencode(e,t){e.end++,H$1.uint.preencode(e,t.length);},encode(e,t){H$1.uint.encode(e,(t.isIndexer?1:0)|(t.isRemoved?2:0)),H$1.uint.encode(e,t.length);},decode(e){const t=H$1.uint.decode(e);return {isIndexer:0!=(1&t),isRemoved:0!=(2&t),length:H$1.uint.decode(e)}}}};const pe$1=t$r,ge$1=L$c,{Wakeup:fe$1}=ue$1;const ye$1=L$c,{partialSignature:_e$1}=fe$3;function we$1(e,t){return e>t?-1:e<t?1:0}const{EventEmitter:me$1}=M$1,ke$1=f$l,ve$1=r$u,xe$1=t$r,be$1=r$s,Se=L$c,Le=class{constructor(e,t){this.base=e,this.core=t,this.extension=this.core.registerExtension("autobase",{onmessage:this._onmessage.bind(this)});const s=pe$1.encode(fe$1,{type:0});this.core.on("peer-add",(e=>{this.extension.send(s,e);}));for(const e of this.core.peers)this.extension.send(s,e);}sendWakeup(e,t){const s=this._encodeWakeup(1);if(s)for(const t of this.core.peers)if(ge$1.equals(t.remotePublicKey,e)){this.extension.send(s,t);break}}requestWakeup(){this.extension.broadcast(pe$1.encode(fe$1,{type:0}));}broadcastWakeup(){const e=this._encodeWakeup(1);e&&this.extension.broadcast(e);}_encodeWakeup(e){const t=[];for(const e of this.base.activeWriters)e.isActiveIndexer||e.flushed()||t.push({key:e.core.key,length:e.length});return t.length?pe$1.encode(fe$1,{version:e,type:1,writers:t}):null}_onmessage(e,t){if(!e)return;let s=null;try{s=pe$1.decode(fe$1,e);}catch{return}if(0!==s.type)this.base.hintWakeup(s.writers);else {const e=this._encodeWakeup(s.version);e&&this.extension.send(e,t);}}},Ce=class{constructor(e,t){this.base=e,this.core=t,this.opened=!1,this.checkpoints=new Map,this.open();}async sign(e,t){const s=await this.getSignatures(e,t),i=this.core.core.createTreeBatch(),n=await Promise.all(s.map((e=>_e$1(i,e.signer,t,e.length,e.signature))));return this.core.core.session.core.verifier.assemble(n)}async _verify(e,t,s){if(!this.core.core||e>this.core.core.length)return !1;if(e<this.core.core.indexedLength)return !0;const i=await this.core.core.restoreBatch(e),{publicKey:n}=this.base.getNamespace(s,this.core);return i.tree.crypto.verify(i.signable(this.core.key),t,n)}open(){if(this.opened)return !0;if(!this.core.pendingIndexedLength)return !1;for(const e of this.base.linearizer.indexers)for(const t of e.flushCheckpoints(this.core.systemIndex))this.addCheckpoint(e.core.key,t);return this.opened=!0,!0}addCheckpoint(e,t){const s=ye$1.toString(e,"hex");let i=this.checkpoints.get(s);i||(i=[],this.checkpoints.set(s,i)),i.length>0&&t.length<=i[i.length-1].length||i.push(t);}bestCheckpoint(e,t=!1){const s=ye$1.toString(e.core.key,"hex"),i=this.checkpoints.get(s);if(!i)return null;const n=function(e,t){if(!e.length||e[0].length>t)return -1;let s=0,i=e.length;for(;;){const n=s+i>>1,r=e[n];if(r.length===t)return n;if(r.length>t?i=n:s=n+1,s===i)return r.length<t?n:n-1}}(i,this.core.pendingIndexedLength);if(-1===n)return null;const r=i[n];return t&&this.checkpoints.set(s,i.slice(n)),r}async getSignableLength(e){if(!this.open())return 0;const t=[],s=1+(e.length>>1);for(const s of e){const e=this.bestCheckpoint(s);e&&(await this._verify(e.length,e.signature,s.core.key)&&t.push(e.length));}return t.length<s?0:t.sort(we$1)[s-1]}async getSignatures(e,t){const s=[],i=1+(e.length>>1);for(let n=0;n<e.length;n++){const r=e[n],o=this.bestCheckpoint(r,!0);if(!o)continue;if(!await this._verify(o.length,o.signature,r.core.key))continue;const h={signature:o.signature,length:o.length,signer:n};if(o.length===t?(s.length>=i&&s.pop(),s.push(h)):o.length>t&&o.length<=this.core.core.length&&s.push(h),s.length>=i)return s}return null}},{ViewRecord:We}=ue$1,{SESSION_CLOSED:Ie,REQUEST_CANCELLED:Be,BLOCK_NOT_AVAILABLE:Fe}=e$3;let Ee$1 = class Ee{constructor(e,t){this.index=e._pendingSnapshots.push(this)-1,this.fork=0,this.length=0,this.byteLength=0,this.tipLength=0,this.tip=null,this.source=e,t&&this.update();}clone(){const e=new Ee(this.source,!1);return e.fork=this.fork,e.length=this.length,e.byteLength=this.byteLength,-1===this.index&&e.detach(this.tip,this.tipLength),e}getIndexedLength(){const e=this.length-this.tipLength;return Math.min(this.source.indexedLength,e)}getSignedLength(){const e=this.length-this.tipLength;return Math.min(this.source.core.indexedLength,e)}getIndexedByteLength(){const e=0===this.tipLength?this.byteLength:this.tip[0].byteOffset;return Math.min(this.source.indexedByteLength,e)}update(){-1===this.index&&(this.index=this.source._pendingSnapshots.push(this)-1,this.tip=null,this.tipLength=0),this.fork=this.source.fork,this.length=this.source.length,this.byteLength=this.source.byteLength;}clear(){-1!==this.index&&this.detach(null,0),this.source=null;}detach(e,t){if(this.tip=e,this.tipLength=t,-1===this.index)return;const s=this.source._pendingSnapshots.pop();s!==this&&(this.source._pendingSnapshots[s.index=this.index]=s),this.index=-1;}};class Ae extends me$1{constructor(e,t,s,i){super(),this.isAutobase=!0,this.closing=!1,this.closed=e.closed,this.opened=!1,this.indexed=!t&&!0===s,this.writable=!0,this.activeRequests=[],this.valueEncoding=i||null,this.globalCache=e.base.globalCache,this._source=e,this._index=e.sessions.push(this)-1,this._snapshot=t,this.ready().catch(ve$1);}get base(){return this._source.base}get id(){return this._source.id}get key(){return this._source.key}get snapshotted(){return null!==this._snapshot}get discoveryKey(){return this._source.discoveryKey}get fork(){return null===this._snapshot?this._source.fork:this._snapshot.fork}get byteLength(){return null===this._snapshot?this.indexed?this.indexedByteLength:this._source.byteLength:this._snapshot.byteLength}get length(){return null===this._snapshot?this.indexed?this.indexedLength:this._source.length:this._snapshot.length}get indexedByteLength(){return null===this._snapshot?this._source.indexedByteLength:this._snapshot.getIndexedByteLength()}get indexedLength(){return null===this._snapshot?this._source.indexedLength:this._snapshot.getIndexedLength()}get signedLength(){return null===this._snapshot?this._source.core.indexedLength:this._snapshot.getSignedLength()}get manifest(){return this._source.core?this._source.core.manifest:null}getBackingCore(){return this._source.core?this._source.core:null}async ready(){this.opened||(await this._source.ready(),this.opened||(this.opened=!0,this.emit("ready")));}async getUserData(e){if(!1===this.opened&&await this.ready(),!0===this.closing)throw Ie();return await this._source.getUserData(e)}async setUserData(e,t,s){if(!1===this.opened&&await this.ready(),!0===this.closing)throw Ie();return await this._source.setUserData(e,t,s)}snapshot({valueEncoding:e=this.valueEncoding}={}){if(!0===this.closing)throw Ie();return null===this._snapshot?this._source.createSnapshot(e):this._source._createSession(this._snapshot.clone(),e)}session({valueEncoding:e=this.valueEncoding,snapshot:t=!1!==this._snapshot,indexed:s=this.indexed}={}){if(!0===this.closing)throw Ie();return t?this.snapshot({valueEncoding:e}):this._source.createSession(e,s)}async update(e){if(!1===this.opened&&await this.ready(),!0===this.closing)throw Ie();if(e&&e.wait&&(await this._source.update(e),!0===this.closing))throw Ie();return null!==this._snapshot&&this._snapshot.update(),!0}async seek(e,t){if(!1===this.opened&&await this.ready(),!0===this.closing)throw Ie();if(e<this.indexedByteLength)return this._source.seek(e,{activeRequests:this.activeRequests,...t});const s=this._getNodes(),i=s===this._source.nodes?this._source._shifted:0;let n=i,r=s===this._source.nodes?s.length:this._snapshot.tipLength;for(;r-n>1;){const t=n+r>>>1;s[t].byteOffset<=e?n=t:r=t;}if(n>=r)return null;const o=s[n];return o.byteOffset+o.block.byteLength<=e?null:[n-i+this.indexedLength,e-o.byteOffset]}async get(e,t){if(!1===this.opened&&await this.ready(),!0===this.closing)throw Ie();const s=Ke.bind(this,t&&t.onwait);if(t={activeRequests:this.activeRequests,valueEncoding:this.valueEncoding,...t,onwait:s},e<this.indexedLength)return this._source.get(e,t);if(e>=this.length)throw Fe();const i=this._getNodes();i===this._source.nodes?(e-=this.indexedLength,e+=this._source._shifted):(e-=this._snapshot.length,e+=this._snapshot.tipLength);const n=e>=0&&e<i.length?i[e].block:null,r=t.valueEncoding&&xe$1.from(t.valueEncoding)||this.valueEncoding;return r?xe$1.decode(r,n):n}async truncate(e){throw !1===this.opened&&await this.ready(),new Error("Truncating an Autobased index explicitly is not currently supported")}async append(e){if(!1===this.opened&&await this.ready(),!0===this.closing)throw Ie();const t=Array.isArray(e)?e:[e],s=new Array(t.length);for(let e=0;e<t.length;e++){const i=t[e];Se.isBuffer(i)?s[e]=i:this.valueEncoding?s[e]=xe$1.encode(this.valueEncoding,i):s[e]=Se.from(i);}return this._source._append(s)}async close(){if(this.closing=!0,!1===this.opened&&await this.ready(),this.closed)return;this.closed=!0,null!==this._snapshot&&this._snapshot.clear();const e=this._source.sessions.pop();e!==this&&(this._source.sessions[e._index=this._index]=e);const t=this.getBackingCore().session;t.replicator&&t.replicator.clearRequests(this.activeRequests),this.emit("close",!1);}_getNodes(){return null===this._snapshot||null===this._snapshot.tip?this._source.nodes:this._snapshot.tip}}function Ke(e,t,s){if(this.closing)throw Be();if(e)return e(t,this)}const Te=L$c,qe=t$r,De=Xn,ze=o$e,Ue=class extends ke$1{constructor(e,t,s,i={}){super(),this.indexedLength=0,this.indexedByteLength=0,this.length=0,this.byteLength=0,this.fork=0,this.base=e,this.name=s,this.originalCore=t,this.core=null,this.wakeupExtension=null,this.migrated=null,this.opts=i,this.appending=0,this.truncating=0,this.indexing=0,this.systemIndex=-1,this.checkpointer=0,this.sessions=[],this.nodes=[],this.signer=new Ce(e,this),this._shifted=0,this._pendingSnapshots=[],this._lastCheckpoint=null,this._queueFastForward=this.base.queueFastForward.bind(this.base),this.ready().catch(ve$1);}_isSystem(){return this.base.system.core._source===this}get id(){return this.originalCore.id}get key(){return this.originalCore.key}get discoveryKey(){return this.originalCore.discoveryKey}get latestKey(){return this.base._viewStore.deriveKey(this.name)||this.key}get pendingIndexedLength(){return this.indexedLength+this.indexing}_registerSystemCore(){this._registerWakeupExtension(),this._registerFastForwardListener();}_registerWakeupExtension(){this.wakeupExtension&&this.wakeupExtension.core===this.originalCore||(this.wakeupExtension=new Le(this.base,this.originalCore));}_registerFastForwardListener(){this.originalCore.removeListener("append",this._queueFastForward),this.originalCore.on("append",this._queueFastForward);}async _ensureCore(e,t){let s=null;if(!Se.equals(this.originalCore.key,e)){const t=this.base._viewStore.getBlockKey(this.name);s=this.base.store.get({key:e,encryptionKey:t,isBlockKey:!0,cache:!!this.originalCore.cache}),await s.ready();}const i=this.originalCore;this.originalCore=s||this.originalCore,this._isSystem()&&this._registerSystemCore();const n=this.originalCore.batch({autoClose:!1,session:!0,checkout:t});await n.ready(),this.core?await this._updateBatch(n):this.core=n,s&&await i.close(),await this._ensureUserData(this.core,!1);}async reset(e){let t=this.originalCore.batch({clear:!0,autoClose:!1,session:!0});await t.ready(),t.length>e&&(await t.close(),t=this.originalCore.batch({checkout:e,autoClose:!1,session:!0}),await t.ready()),await this._updateBatch(t);}async _updateBatch(e){const t=this.core,s=this.length;for(let e=this._pendingSnapshots.length-1;e>=0;e--){const t=this._pendingSnapshots[e],s=t.length-this.indexedLength-this._shifted;t.detach(this.nodes,s);}this.core=e,this.nodes=[],this._shifted=0,this.indexing=0,this.appending=0,this.truncating=0,this._updateCoreState(),this.length>s&&this._emitAppend(),await t.close();}_updateCoreState(){this.length=this.core.length,this.byteLength=this.core.byteLength,this.indexedLength=this.core.length,this.indexedByteLength=this.core.byteLength;}async _open(){await Promise.resolve(),await this.base._presystem,await this.originalCore.ready(),this.base.encryptionKey&&!this.originalCore.encryption&&await this.originalCore.setEncryptionKey(this.base._viewStore.getBlockKey(this.name),{isBlockKey:!0});const e=this.base.system.opened?this.base.system:this.base._initialSystem;if(e){await e.ready();for(let e=0;e<this.base._initialViews.length;e++){const{name:t,key:s,length:i}=this.base._initialViews[e];if(t===this.name){this.systemIndex=e-1,await this._ensureCore(s,i);break}}}this._isSystem()&&this._registerSystemCore(),this.core||(this.core=this.originalCore.batch({autoClose:!1,session:!0,checkout:0}),await this.core.ready()),await this._ensureUserData(this.originalCore,!1),this._updateCoreState();for(const e of this._pendingSnapshots)e.update();null!==this.signer&&this.signer.open();}_close(){return this.core.close()}async _ensureUserData(e,t){await e.setUserData("referrer",this.base.key);const s=await e.getUserData("autobase/view"),i=null!==s&&0===s[0]?xe$1.decode(We,s):{name:null,migrated:null,audits:0};if(0===i.audits){const t=await e.core.audit();(t.blocks||t.tree)&&function(...e){console.log("[autobase]",...e);}("view",e.id,"auto corrected itself",t);}const n=!t&&i.name?i:null;n&&!this.migrated&&(this.migrated=n.migrated),await e.setUserData("autobase/view",xe$1.encode(We,{name:this.name,migrated:n?n.migrated:this.migrated,audits:1}));}createSession(e,t){return this._createSession(null,e,t)}createSnapshot(e){return this._createSession(new Ee$1(this,this.opened),e)}_createSession(e,t,s){return new Ae(this,e,s,t?xe$1.from(t):null)}async seek(e,t){const s=this.core;for(;;)try{return await s.seek(e,t)}catch(e){if("REQUEST_CANCELLED"===e.code||this.base.closing||s===this.core)throw e}}async get(e,t){const s=this.core;for(;;)try{return await s.get(e,t)}catch(e){if("REQUEST_CANCELLED"===e.code||this.base.closing||s===this.core)throw e}}async setUserData(e,t,s){const i=this.core;for(;;)try{return await i.setUserData(e,t,s)}catch(e){if(this.base.closing||i===this.core)throw e}}async getUserData(e){const t=this.core;for(;;)try{return await t.getUserData(e)}catch(e){if(this.base.closing||t===this.core)throw e}}truncate(e){this._truncateAndDetach(e),this.fork++;for(const t of this.sessions)!1===t.snapshotted&&t.emit("truncate",e,this.fork);}async checkpoint(){return {checkpointer:0===this.indexing?this.checkpointer:0,checkpoint:this.checkpointer&&0===this.indexing?null:await this._checkpoint()}}async _checkpoint(){return (!this._lastCheckpoint||this._lastCheckpoint.length<this.pendingIndexedLength)&&await this._updateCheckpoint(),this._lastCheckpoint}async _updateCheckpoint(e){const t=this.indexBatch(0,this.indexing),s=await this.core.restoreBatch(this.pendingIndexedLength,{blocks:t,clone:!1}),i=s.signable(this.core.key),n=this.base.local.core.crypto.sign(i,this.base.local.keyPair.secretKey);this._lastCheckpoint={signature:n,length:s.length};}update(e){if(!this._isSystem())return this.base.update(e)}indexBatch(e,t){if(e>=t)return [];const s=new Array(t-e);for(let t=0;t<s.length;t++)s[t]=this.nodes[this._shifted+e+t].block;return s}_onindex(e){const t=this.nodes[this._shifted+e-1];this.indexedLength+=e,this.indexedByteLength=t.byteOffset+t.block.byteLength,this._shifted+=e,(this._shifted>=32||this._shifted===this.nodes.length)&&this._gc(),this.checkpointer=0,this._emitIndexedAppend();}_onundo(e){if(!e)return;const t=this.length-e;this.truncate(t);}_append(e){for(let t=0;t<e.length;t++){const s=e[t];this.nodes.push({byteOffset:this.byteLength,block:s}),this.byteLength+=s.byteLength;}this.length+=e.length,this.base._onviewappend(this,e.length),this._emitAppend();}_emitAppend(){for(const e of this.sessions)!1===e.snapshotted&&!1===e.indexed&&e.emit("append");}_emitIndexedAppend(){for(const e of this.sessions)e.indexed&&e.emit("append");}isBootstrapped(){return !!(this.core&&this.core.manifest&&this.core.manifest.signers.length>0)}async bootstrap(){if(this.isBootstrapped())return !0;if(0===this.base.linearizer.indexers.length)return !1;const[e]=this.base.linearizer.indexers;return !!e.core.manifest&&(await this.migrateTo([e],0),this.base.queueFastForward(),!0)}_shouldFlush(){return this.indexing>0||(!this.core.session.opened||this.core.indexedLength!==this.core.length)}async flush(){if(this.core.opened||await this.core.ready(),!this.isBootstrapped()&&!await this.bootstrap())return !1;if(!this._shouldFlush())return !0;if(this.indexing){const e=this.indexBatch(0,this.indexing);await this.core.append(e);}return this._flush()}async _flush(){let e=this.core.flushedLength===this.core.length;const t=this.core.length;if(0===t)return e;Math.min(t,this.core.length)>this.core.indexedLength&&this.core.flushedLength<this.core.length&&(e=!1);const s=this.base._viewStore._indexers,i=await this.signer.getSignableLength(s),n=Math.min(t,i);if(n>this.core.indexedLength){const t=await this.signer.sign(s,n);if(!await this.core.flush({length:n,signature:t}))return !1;e=!0;}return e}async getPrologue(e){if(!e)return null;const t=this.indexBatch(0,e-this.indexedLength);return {hash:(await this.core.restoreBatch(e,{blocks:t,clone:!1})).hash(),length:e}}async deriveKey(e,t){const s=await this.getPrologue(t);return this.base.deriveKey(this.name,e,s)}async migrateTo(e,t){this.opened||await this.ready();const s=await this.base._viewStore.getCore(this,e,t,this.opts);await s.ready();const i=await this._migrateCurrentCore(s,t,e),n=this.core,r=this.originalCore;this.originalCore=s,this.core=i,await n.close(),await r.close(),this._isSystem()&&this._registerSystemCore();for(const e of this.sessions)e.snapshotted||e.emit("migrate");}async _migrateCurrentCore(e,t,s){if(t>0){const s=[];for(let e=this.core.indexedLength;e<t;e++)s.push(await this.core.get(e,{raw:!0}));this.core.session.core!==e.core&&await e.core.copyPrologue(this.core.session.core,{additional:s});}this.migrated=this.core.key,await this._ensureUserData(e,!0);const i=e.batch({autoClose:!1,session:!0,checkout:t});if(await i.ready(),i.length<this.core.length){const e=[];for(;i.length+e.length<this.core.length;)e.push(await this.core.get(i.length+e.length));await i.append(e);}return i}async catchup({key:e,length:t,systemIndex:s}){this.opened||await this.ready(),await this._ensureCore(e,t),-1!==s&&(this.systemIndex=s);}_gc(){0!==this._shifted&&(this.nodes=this.nodes.slice(this._shifted),this._shifted=0);}_truncateAndDetach(e){if(be$1(this.indexedLength<=e&&e<=this.length,"Invalid truncation"),e===this.length)return;0===e&&this.base._viewStore._unindex(this);let t=0;for(const s of this._pendingSnapshots)s.length>e&&t<s.length&&(t=s.length);if(t<=e){for(;this.length>e;){const{block:e}=this.nodes.pop();this.length--,this.byteLength-=e.byteLength;}return}this._gc();for(let t=this._pendingSnapshots.length-1;t>=0;t--){const s=this._pendingSnapshots[t],i=s.length-this.indexedLength-this._shifted;s.length>e&&s.detach(this.nodes,i);}const s=e-this.indexedLength,i=this.nodes[s];this.nodes=this.nodes.slice(0,s),this.length=e,this.byteLength=i.byteOffset;}},Pe=Te.alloc(0),[Re,Me]=ze.namespace("autobase",2);function He(e,t,s){return t&&ze.hash([Me,e,t,Te.from(s)])}const Ne=Ee$2,Ve=c,Oe=f$l,je=L$c,Qe=t$r,{Info:Ge,Member:Je}=ue$1,Xe=new Ve,Ye=Xe.sub(je.from([0])),Ze=Xe.sub(je.from([1]));function $e(e,t){for(const n of e.actualHeads)if(s=n,i=t,je.equals(s.key,i.key)&&s.length===i.length)return !0;var s,i;return !1}const et=r$u;function tt(e,t){t.delete(e),e.resolve();}function st(e){return Math.floor(e+Math.random()*e)}function it(){}const nt=K$1,rt=class{constructor(e,t){this.hwm=t||32,this.defaultHwm=this.hwm,this.mask=this.hwm-1,this.top=0,this.btm=0,this.buffer=new Array(this.hwm),this.offset=e||0,this.length=this.offset;}get size(){return this.length-this.offset}isEmpty(){return this.length===this.offset}isFull(){return this.size===this.buffer.length}grow(){this.hwm<<=1;const e=this.size,t=new Array(this.hwm),s=this.hwm-1;for(let s=0;s<e;s++)t[s]=this.buffer[this.btm+s&this.mask];this.mask=s,this.top=e,this.btm=0,this.buffer=t;}push(e){return this.isFull()&&this.grow(),this.buffer[this.top]=e,this.top=this.top+1&this.mask,this.length++}shift(){if(this.isEmpty())return null;const e=this.buffer[this.btm];return this.buffer[this.btm]=void 0,this.btm=this.btm+1&this.mask,this.offset++,this.isEmpty()&&this.hwm!==this.defaultHwm&&(this.buffer=new Array(this.defaultHwm),this.hwm=this.buffer.length,this.mask=this.hwm-1,this.top=this.btm=0),e}get(e){return e<this.offset||e>=this.length?null:this.buffer[this.btm+(e-this.offset)&this.mask]}},ot=t$r,ht=L$c,at=f$l,ct=r$u,dt=r$s,lt=s$q;function ut(e,t){const s=e.pop();return !(t>=e.length)&&(e[t]=s,!0)}function pt(e,t){return e.length===t.length&&ht.equals(e.writer.core.key,t.key)}const gt=L$c;var ft=class{constructor(){this.map=new Map;}get size(){return this.map.size}[Symbol.iterator](){return this.map.values()}get(e){return this.map.get(gt.toString(e,"hex"))||null}has(e){return null!==this.get(e)}add(e){this.map.set(gt.toString(e.core.key,"hex"),e);}delete(e){this.map.delete(gt.toString(e.core.key,"hex"));}clear(){const e=[];for(const t of this.map.values())e.push(t.close());return this.map.clear(),Promise.all(e)}};const yt=L$c,_t=r$u;function wt(e,t){const s=yt.toString(t.key,"hex");t.close().catch(_t),e.pool.delete(s);}const mt=L$c,kt=t$r,vt=f$l,xt={preencode(e,t){kt.fixed32.preencode(e,t.key),kt.uint.preencode(e,t.length);},encode(e,t){kt.fixed32.encode(e,t.key),kt.uint.encode(e,t.length);},decode:e=>({key:kt.fixed32.decode(e),length:kt.uint.decode(e)})};var bt=class extends vt{constructor(e){super(),this.base=e,this.flushing=null,this._rootStore=function(e){return e._root}(this.base.store),this._addBound=this.add.bind(this),this._preupdateBound=this._preupdate.bind(this),this._needsFlush=!1,this._map=new Map;}[Symbol.iterator](){return this._map.values()}async _preupdate(e,t){this.queue(t,e.length),await this.flush(),this.base._onwakeup();}async _save(){const e=mt.allocUnsafe(8+40*this._map.size),t={start:0,end:0,buffer:e};kt.uint.encode(t,this._map.size);for(const e of this._map.values())xt.encode(t,e);await this.base.local.setUserData("autobase/wakeup",e.subarray(0,t.start));}async _load(){const e=await this.base.local.getUserData("autobase/wakeup");if(!e)return;const t={start:0,end:e.byteLength,buffer:e};let s=kt.uint.decode(t);for(;s-- >0;){const e=xt.decode(t);this._map.set(mt.toString(e.key,"hex"),e);}}async _open(){await this._load(),this._rootStore.setMaxListeners(0),this._rootStore.on("core-open",this._addBound);for(const e of this._rootStore.cores.values())!1===e.opened&&await e.ready().catch(St),e.closing||this.add(e);}async _close(){this._rootStore.removeListener("core-open",this._addBound);for(const e of this._rootStore.cores.values())e.opened&&!e.closing&&this.remove(e);for(this._map.clear();this.flushing;)try{await this.flushing;}catch{}}queue(e,t){const s=mt.toString(e,"hex"),i=this._map.get(s);return !(i&&i.length>t)&&(this._needsFlush=!0,this._map.set(s,{key:e,length:t}),!0)}unqueue(e,t){const s=mt.toString(e,"hex"),i=this._map.get(s);return !i||!(i.length>t)&&(this._needsFlush=!0,this._map.delete(s),!0)}async flush(){if(this.closing)throw new Error("Closing");if(this.flushing&&await this.flushing,this.flushing)return this.flushing;if(!1!==this._needsFlush){this._needsFlush=!1;try{return this.flushing=this._save(),await this.flushing}finally{this.flushing=null;}}}add(e){if(!e.writable&&e.opened)return this._add(e.core)}remove(e){return this._remove(e.core)}_add(e){const t=e.header.userData;let s=null;for(const{key:e,value:i}of t)if("referrer"===e)s=i;else if("autobase/view"===e)return !1;return !(null===s||!mt.equals(s,this.base.key))&&(e.preupdate=this._preupdateBound,!0)}_remove(e){return e.preupdate===this._preupdateBound&&(e.preupdate=null,!0)}};function St(){}const Lt=L$c,Ct=f$l,Wt=n$w,It=t$r,Bt=r$u,Ft=o$q,Et=r$s,At=s$q,Kt=s$p,Tt=t$n,qt=K$1,Dt=class{constructor(e){this.base=e,this.opened=new Map,this.coresByKey=new Map,this.coresByIndex=new Map,this.waiting=[];}async ready(){await this.base._presystem;}get _indexers(){return this.base.linearizer&&(1!==(e=this.base.linearizer.indexers.slice(0)).length||e[0].core.manifest?e:[]);var e;}async migrate(){const e=this.getSystemCore(),{indexers:t,views:s}=await this.base.system.getIndexedInfo(),i=await this.getWriters(t);for(const t of this.opened.values()){const n=s[t.systemIndex],r=n?n.length:t._isSystem()?e.indexedLength:0;await t.migrateTo(i,r);}this.base.recouple();}get(e,t){"string"==typeof e&&(e={name:e}),t&&(e={...e,...t,compat:!1});const s=e.name,i=e.valueEncoding||null,n=this._indexers?this.base.store.get(this._corePreload(this._indexers,s,null,e.cache)):this.base.store.get({preload:async()=>{if(await Promise.resolve(),!this.base.opening)throw new Error("Autobase failed to open");return await this.ready(),this._corePreload(this._indexers,s,null,e.cache)}}),r=new Ue(this.base,n,s,e);return this.opened.set(s,r),this.waiting.push(r),r.createSession(i)}_corePreload(e,t,s,i){return {manifest:this._createManifest(e,t,s),cache:i,exclusive:!0,compat:!1,encryptionKey:this.getBlockKey(t),isBlockKey:!0}}close(){const e=[];for(const t of this.opened.values())e.push(t.close());return Promise.all(e)}static getBlockKey(e,t,s){return He(e,t,s)}getBlockKey(e){return He(this.base.bootstrap,this.base.encryptionKey,e)}getSystemCore(){return this.base.system.core._source}async getWriters(e){return e.length?Promise.all(e.map((({key:e})=>this.base._getWriterByKey(e,-1,0,!1,!1,null)))):this.base.linearizer.indexers.slice(0)}async getCore(e,t,s,i={}){const n=await e.getPrologue(s);return this.base.store.get(this._corePreload(t,e.name,n,i.cache))}getIndexedCores(){const e=[this.getSystemCore()];for(let t=0;t<this.base.system.views.length;t++){const s=this.getByIndex(t);if(!s||!s.pendingIndexedLength)break;e.push(s);}return e}indexedViewsByName(){const e=[];for(let t=0;t<this.base.system.views.length;t++){const s=this.getByIndex(t);if(!s||!s.pendingIndexedLength)break;e.push(s.name);}return e}async flush(){for(;this.waiting.length;){const e=this.waiting.pop();await e.ready();}for(const e of this.opened.values())if(!e.isBootstrapped()&&!await e.bootstrap())return !1;return !0}_unindex(e){this.coresByIndex.delete(e.systemIndex),e.systemIndex=-1;}deriveNamespace(e,t){const s=ze.hash(this.base.encryptionKey||Pe),i=qe.encode(qe.uint,1),n=this.base.bootstrap;return ze.hash([Re,i,n,s,t,Te.from(e)])}getByKey(e,t=this.base.linearizer.indexers){const s=Te.toString(e,"hex");if(this.coresByKey.has(s))return this.coresByKey.get(s);for(const t of this.opened.values())if(Te.equals(e,t.key))return this.coresByKey.set(s,t),t;return null}getByIndex(e){if(this.coresByIndex.has(e))return this.coresByIndex.get(e);for(const t of this.opened.values())if(t.systemIndex===e)return this.coresByIndex.set(e,t),t;return null}deriveKey(e,t=this.base.linearizer.indexers,s=null){const i=s&&s.length?s:null,n=this._createManifest(t,e,i);return n&&De.key(n)}_deriveStaticHash(e){return ze.hash([this.base.bootstrap,Te.from(e)])}_createManifest(e,t,s){e.length||s&&s.length>0||(s={hash:this._deriveStaticHash(t),length:0});for(const t of e)if(!t.core.manifest)return null;const i=e.map((e=>({namespace:this.deriveNamespace(t,e.core.manifest.signers[0].namespace),signature:"ed25519",publicKey:e.core.manifest.signers[0].publicKey})));return {version:1,hash:"blake2b",prologue:s,allowPatch:!0,quorum:Math.min(i.length,1+(i.length>>1)),signers:i}}},zt=class e extends Oe{constructor(e,{checkout:t=0}={}){super(),this.core=e,this.db=new Ne(e,{keyEncoding:"binary",extension:!1,checkout:t,sessions:"function"==typeof e.session}),this.version=-1,this.members=0,this.pendingIndexers=[],this.indexers=[],this.heads=[],this.views=[],this.indexerUpdate=!1,this._fork=0,this._length=0,this._indexerMap=new Map,this._clockUpdates=new Map,this._batch=null;}static async getIndexedInfo(e,t){const s=new this(e.session());try{return await s.getIndexedInfo(t)}finally{await s.close();}}get bootstrapping(){return 0===this.members}sendWakeup(e){this.core._source.wakeupExtension&&this.core._source.wakeupExtension.sendWakeup(e);}requestWakeup(){this.core._source.wakeupExtension&&this.core._source.wakeupExtension.requestWakeup();}broadcastWakeup(){this.core._source.wakeupExtension&&this.core._source.wakeupExtension.broadcastWakeup();}async checkout(t){const s=new e(this.core.session(),{checkout:t});return await s.ready(),s}async _open(){const e=await this.db.get("info",{valueEncoding:Ge,keyEncoding:Ye,update:!1,wait:!1});await this._reset(e);}async _close(){await this.db.close();}async getIndexedInfo(e=this.core.indexedLength){if(!1===this.opened&&await this.ready(),e===this.core.length)return {version:this.version,members:this.members,pendingIndexers:this.pendingIndexers,indexers:this.indexers,heads:this.heads,views:this.views};const t=0===e?null:await this.db.getBySeq(e-1);return null===t?{version:0,members:0,pendingIndexers:[],indexers:[],heads:[],views:[]}:Qe.decode(Ge,t.value)}sameIndexers(e){if(this.indexers.length!==e.length)return !1;for(let t=0;t<this.indexers.length;t++)if(!je.equals(this.indexers[t].key,e[t].core.key))return !1;return !0}async update(){return !1===this.opened&&await this.ready(),(this._fork!==this.core.fork||this._length!==this.core.length)&&(await this._reset(await this.db.get("info",{valueEncoding:Ge,keyEncoding:Ye})),!0)}async _reset(e){this.version=null===e?-1:e.value.version,this.members=null===e?0:e.value.members,this.pendingIndexers=null===e?[]:e.value.pendingIndexers,this.indexers=null===e?[]:e.value.indexers,this.heads=null===e?[]:e.value.heads,this.views=null===e?[]:e.value.views,this.indexerUpdate=!1,this._indexerMap.clear(),this._clockUpdates.clear(),this._length=this.core.length,this._fork=this.core.fork;for(const e of this.indexers)this._indexerMap.set(je.toString(e.key,"hex"),e);this._batch&&await this._batch.close(),this._batch=this.db.batch({update:!1});}_updateView(e,t,s,i){if(s>-1&&s<this.views.length){const t=this.views[s];if(t)return t.length=e,i&&(t.key=i),s}return this.views.push({length:e,key:i}),this.views.length-1}async flush(e){for(const[e,t]of this._clockUpdates){const s=void 0!==this._indexerMap.get(e),i=je.from(e,"hex"),n={isIndexer:s,isRemoved:(await this._batch.get(i,{valueEncoding:Je,keyEncoding:Ze})).value.isRemoved,length:t};await this._batch.put(i,n,{valueEncoding:Je,keyEncoding:Ze});}this._clockUpdates.clear();for(const{view:t,key:s}of e)t.systemIndex=this._updateView(t.length,t,t.systemIndex,s);const t={version:this.version,members:this.members,pendingIndexers:this.pendingIndexers,indexers:this.indexers,heads:this.heads,views:this.views};await this._batch.put("info",t,{valueEncoding:Ge,keyEncoding:Ye}),await this._batch.flush(),this._length=this.core.length,this._batch=this.db.batch({update:!1}),this.indexerUpdate&&(this.indexerUpdate=!1);}addHead(e){const t={key:e.writer.core.key,length:e.length};for(let s=0;s<this.heads.length;s++){const i=this.heads[s];if(!$e(e,i)){if(!je.equals(e.writer.core.key,i.key))continue;if(i.length>t.length)return !1}const n=this.heads.pop();n!==i&&(this.heads[s--]=n);}this.heads.push(t);const s=je.toString(t.key,"hex");if(this._clockUpdates.set(s,t.length),this.pendingIndexers.length>0)for(let e=0;e<this.pendingIndexers.length;e++)if(je.equals(this.pendingIndexers[e],t.key))return this._updateIndexer(t.key,t.length,!0,e),!0;const i=this._indexerMap.get(s);return void 0!==i&&(i.length=t.length),!1}_updateIndexer(e,t,s,i){const n=je.toString(e,"hex");if(!s){const e=this._indexerMap.get(n);return void(e&&(this.indexerUpdate=!0,this.indexers.splice(this.indexers.indexOf(e),1),this._indexerMap.delete(n)))}for(;i<this.pendingIndexers.length&&!je.equals(this.pendingIndexers[i],e);i++);if(0===t)return void(i>=this.pendingIndexers.length&&this.pendingIndexers.push(e));if(i<this.pendingIndexers.length){const e=this.pendingIndexers.pop();i<this.pendingIndexers.length&&(this.pendingIndexers[i]=e);}const r=this._indexerMap.get(n);if(void 0===r){const s={key:e,length:t};this._indexerMap.set(n,s),this.indexers.push(s),this.bootstrapping||(this.indexerUpdate=!0);}else r.length=t;}_seenLength(e){return this._clockUpdates.get(je.toString(e,"hex"))||0}async add(e,{isIndexer:t=!1,length:s=this._seenLength(e)}={}){let i=!1,n=!1;if(0===s){const t=await this._batch.get(e,{valueEncoding:Je,keyEncoding:Ze});t&&(s=t.value.length);}await this._batch.put(e,{isIndexer:t,isRemoved:!1,length:s},{valueEncoding:Je,keyEncoding:Ze,cas(e,t){if(null===e)return !0;const r=e.value,o=t.value;return r.isRemoved||(i=!0),r.isIndexer&&(n=!0),0===s&&r.length&&(s=r.length),r.isRemoved!==o.isRemoved||r.isIndexer!==o.isIndexer||r.length!==o.length}}),i||this.members++,(n||t)&&this._updateIndexer(e,s,t,0);}async remove(e){let t=!1;for(const s of this.indexers)if(t=je.equals(s.key,e),t)break;t&&this._updateIndexer(e,null,!1,0);let s=!1;const i=await this._batch.get(e,{valueEncoding:Je,keyEncoding:Ze}),n=i?i.value.length:0;return await this._batch.put(e,{isIndexer:!1,isRemoved:!0,length:n},{valueEncoding:Je,keyEncoding:Ze,cas:(e,t)=>null===e||(s=!!e.value.isRemoved,!s)}),s||this.members--,t}async has(e,t){return null!==await this.get(e,t)}async get(e,t={}){const s=await this._batch.get(e,{valueEncoding:Je,keyEncoding:Ze});return null===s||!1===t.onlyActive&&s.value.isRemoved?null:s.value}async hasLocal(e){try{return null!==await this.db.get(e,{valueEncoding:Je,keyEncoding:Ze,update:!1,wait:!1})}catch{return !1}}async getLocalLength(e){try{const t=await this.db.get(e,{valueEncoding:Je,keyEncoding:Ze,update:!1,wait:!1});return null===t?0:t.value.length}catch{return 0}}list(){return this._batch.createReadStream({valueEncoding:Je,keyEncoding:Ze})}async isIndexed(e,t){const s=this.db.checkout(this.core.indexedLength);try{const i=await s.get(e,{valueEncoding:Je,keyEncoding:Ze});return null!==i&&i.value.length>=t}finally{await s.close();}}},Ut=ue$1,Pt=class{constructor(e,t,s={}){this.handler=e||it,this.interval=t||1e4,this.limit=s.limit||12e4,this._executing=null,this._limit=st(this.limit),this._timer=null,this._resolve=null,this._start=0,this._stopped=!1,this._asap=!1,this._standalone=new Set,this._unref=!1!==s.unref,this._timerCallback=this._executeBackground.bind(this);}_executeBackground(){this._executing=this._execute(),this._executing.catch(et);}async _execute(){this._asap=!1,await this.handler(),this._start=0,this._executing=null,this.bump();}bump(){if(this._stopped||this._executing||this._asap)return;if(this._start){if(Date.now()-this._start>this._limit)return}else this._start=Date.now();const e=st(this.interval);clearTimeout(this._timer),this._timer=setTimeout(this._timerCallback,e),this._unref&&this._timer.unref&&this._timer.unref();}async trigger(){this._stopped||(this._executing&&await this._executing,this._stopped||(clearTimeout(this._timer),this._timer=null,this._executeBackground(),await this._executing));}async flush(){this._executing&&await this._executing;}bau(){this._asap&&(this._asap=!1,this.bump());}asap(){if(this._asap)return;this._asap=!0;const e=Math.floor(Math.random()*this.interval/3);clearTimeout(this._timer),this._timer=setTimeout(this._timerCallback,e),this._unref&&this._timer.unref&&this._timer.unref();}stop(){this._timer&&clearTimeout(this._timer),this._timer=null,this._start=0,this._asap=!1,this._stopped=!0;for(const{timer:e,resolve:t}of this._standalone)clearTimeout(e),t();this._standalone.clear();}asapStandalone(){const e=Math.floor(Math.random()*this.interval/3);return new Promise((t=>{const s={timer:null,resolve:t};s.timer=setTimeout(tt,e,s,this._standalone),s.timer.unref&&s.timer.unref(),this._standalone.add(s);}))}unref(){this._timer&&this._timer.unref&&this._timer.unref();}},Rt=class extends at{constructor(e,t,s,i){super(),this.base=e,this.core=t,this.isRemoved=i,this.updated=!1,this.range=null,this.nodes=new rt(s),this.node=null,this.isBootstrap=!1,this.isActiveIndexer=!1,this.available=s,this.length=s,this.seenLength=0,this.recover=!1,this.system=null,this.digestIndex=0,this.digestLength=0,this.pendingCheckpoints=[],this.syncSignal=null;}pause(){this.range&&this.range.destroy(),this.range=null;}setBootstrap(e){this.isBootstrap=e,this.core.setActive(e);}async isInSystem(){if(!(0===this.base.system.core.length&&ht.equals(this.core.key,this.base.key))){if(null===await this.base.system.get(this.core.key,{onlyActive:!0}))return !1}return !0}resume(){this.range||(this.range=this.core.download({start:this.nodes.length,end:-1,linear:!0}));}seen(e){e>this.seenLength&&(this.seenLength=e);}waitForSynced(){return this.core.length===this.length?Promise.resolve():(null===this.syncSignal&&(this.syncSignal=new lt),this.syncSignal.wait())}async _open(){await this.core.ready(),await this.core.setUserData("referrer",this.base.key),this.recover=function(e){switch(dt(e.opened),e.id){case"ghrpexaboutdm46ombqho7mroxknassnntrxx3cubfux4qi6w6hy":case"qoaanao71s4he1rcd197d336qepykk4467geo1uq8cwnzmpb786o":case"fomhdxgn4j4tzjqy6y7iskhffimzokt7kraddyd8orcht3r8q61o":case"d8f5taxxrit51apftoi38e5b86hb98cgfd7dfp3uo1uoh95qt49o":case"objyf75uggsqpjcut69xdgj46ks8r71jjrq7oxdfsz95sstchkno":return !0}return !1}(this.core),this.base._wakeup.add(this.core);}inflateBackground(){this.inflateExistingCheckpoints().catch(ct);}async inflateExistingCheckpoints(){if(await this.ready(),0===this.core.length||!this.isActiveIndexer||0===this.nodes.length)return;const e=this.nodes.length-1,{checkpoint:t}=await this.core.get(e);if(t)for(let s=0;s<t.length;s++){const i=t[s];if(0===i.checkpointer){this._addCheckpoint(s,i.checkpoint);continue}const n=await this.core.get(e-i.checkpointer);this._addCheckpoint(s,n.checkpoint[s].checkpoint);}}_close(){return null!==this.syncSignal&&this.syncSignal.notify(),this.core.close()}reset(e){dt(e<=this.core.length||e<=this.length),this.pause(),this.updated=!1,this.node=null,this.nodes=new rt(e),this.length=e,this.available=e,this.seenLength=e;}get indexed(){return this.nodes.offset}idle(){return this.length===this.available&&this.length===this.core.length&&this.core.opened}flushed(){return this.seenLength<=this.length&&this.length===this.available&&this.length===this.core.length&&!1===this.shiftable()&&!this.core.core.upgrading&&this.core.opened}compare(e){return ht.compare(this.core.key,e.core.key)}head(){return this.nodes.get(this.length-1)}advance(){return null!==this.syncSignal&&this.length+1===this.core.length&&this.syncSignal.notify(),this.length<this.available?this.nodes.get(this.length++):null}shiftable(){return this.length>this.nodes.offset}shift(){if(!1===this.shiftable())return !1;let e=this._shiftAndClear();for(;e.batch>1;)e=this._shiftAndClear();return !0}deriveNamespace(e){const{namespace:t}=this.core.manifest.signers[0];return this.base._viewStore.deriveNamespace(e,t)}get(e){return e<this.length?this.nodes.get(e):null}append(e,t,s,i,n){const r=nt.createNode(this,this.nodes.length+1,e,t,s,i,n);return r.actualHeads=r.heads.slice(0),this.nodes.push(r),this.available++,this.length++,r}async update(e){for(!1===this.opened&&await this.ready();this.available-this.length<4&&this.nodes.length!==this.core.length&&0!==this.core.length&&(null!==this.node||await this._loadNextNode())&&await this._ensureNodeDependencies()&&(e||0!==this.length||await this.isInSystem()||this.recover);)this.recover&&(this.node.value=null),this.nodes.push(this.node),1===this.node.batch&&(this.available=this.nodes.length),this.node=null;return this.digestLength<this.core.length&&this.isActiveIndexer&&await this._checkDigest(),this.length<this.available}async _checkDigest(){const e=this.core.length-1,t=await this.core.get(e,{wait:!1});if(!t)return void this.core.get(e).catch(ct);if(!t.digest)return void(this.digestLength=e+1);const s=e-t.digest.pointer;if(s<0||s===this.digestIndex)return void(this.digestLength=e+1);const i=s===e?t:await this.core.get(s,{wait:!1});i?(this.digestLength=e+1,this.digestIndex=s,this.system=i.digest.key,this.base._maybeStaticFastForward=!0):this.core.get(s).catch(ct);}async getVersion(e=this.core.length){if(!1===this.opened&&await this.ready(),0===e)return -1;return (await this.core.get(e-1)).maxSupportedVersion}async getDigest(e=this.core.length){if(!1===this.opened&&await this.ready(),0===e)return null;let t=await this.core.get(e-1);return null===t.digest?null:(t.digest.pointer&&(e-=t.digest.pointer,t=await this.core.get(e-1)),t.digest.pointer=this.core.length-(e-1),t.digest)}async getCheckpoint(e,t=this.core.length){if(!1===this.opened&&await this.ready(),0===t)return null;let s=await this.core.get(t-1),i=s.checkpoint[e];return i?(i.checkpoint||(t-=i.checkpointer,s=await this.core.get(t-1),i=s.checkpoint[e]),i.checkpoint):null}_shiftAndClear(){const e=this.nodes.shift();return e.clear(),e}flushCheckpoints(e){const t=e+1;if(t>=this.pendingCheckpoints.length)return [];const s=this.pendingCheckpoints[t];for(this.pendingCheckpoints[t]=null;this.pendingCheckpoints.length>0&&null===this.pendingCheckpoints[this.pendingCheckpoints.length-1];)this.pendingCheckpoints.pop();return null!==s?s:[]}_addCheckpoints(e){for(let t=0;t<e.length;t++){const{checkpoint:s,checkpointer:i}=e[t];0===i&&this._addCheckpoint(t,s);}}_upsertPendingCheckpoints(e){for(;e>=this.pendingCheckpoints.length;)this.pendingCheckpoints.push(null);if(this.pendingCheckpoints[e])return this.pendingCheckpoints[e];return this.pendingCheckpoints[e]=[]}_addCheckpoint(e,t){const s=this.base._viewStore.getByIndex(e-1);if(s)return void s.signer.addCheckpoint(this.core.key,t);const i=this._upsertPendingCheckpoints(e);i.length>0&&i[i.length-1].length>=t.length||i.push(t);}async _loadNextNode(){const e=this.nodes.length;if(!await this.core.has(e))return !1;const{node:t,checkpoint:s,maxSupportedVersion:i}=await this.core.get(e,{wait:!1});this.isActiveIndexer&&s&&this._addCheckpoints(s);const n=null==t.value?null:ot.decode(this.base.valueEncoding,t.value);return this.node=nt.createNode(this,e+1,n,t.heads,t.batch,new Set,i),!0}async _ensureNodeDependencies(){for(;this.node.dependencies.size<this.node.heads.length;){const e=this.node.heads[this.node.dependencies.size],t=await this.base._getWriterByKey(e.key,-1,e.length,!0,!1,null);if(t!==this&&(null===t||t.length<e.length))return this.base._ensureWakeup(t),!1;let s=t.nodes.get(e.length-1);if(!s)for(const t of this.base.linearizer.heads)if(pt(t,e)){s=t;break}dt(!this.node.dependencies.has(s),"Corrupted DAG"),null!==s?this.node.dependencies.add(s):ut(this.node.heads,this.node.dependencies.size);}const e=this.node.length-1;return e>this.indexed&&this.node.dependencies.add(this.nodes.get(e-1)),!0}},Mt=ft,Ht=class{constructor(){this.pool=new Map;}linger(e){const t=yt.toString(e.key,"hex");if(this.pool.has(t))return;const s=e.session(),i={session:s,timeout:setTimeout(wt,3e4,this,s)};this.pool.set(t,i);}get(e){const t=yt.toString(e,"hex"),s=this.pool.get(t);return s?(this.pool.delete(t),clearTimeout(s.timeout),s.session):null}clear(){const e=[];for(const{session:t,timeout:s}of this.pool.values())clearTimeout(s),e.push(t.close());return this.pool.clear(),Promise.all(e)}},Nt=bt,Vt=Symbol.for("nodejs.util.inspect.custom"),Ot=new Error("Apply interrupted"),jt=1e4,Qt=4,Gt=1e4;var Jt=class e extends Ct{constructor(e,t,s={}){var i,n;Array.isArray(t)&&(t=t[0]),t&&"string"!=typeof t&&!Lt.isBuffer(t)&&(s=t,t=null),super(),this.bootstrap=t?(i=t,Lt.isBuffer(i)?i:Ft.decode(i)):null,this.keyPair=s.keyPair||null,this.valueEncoding=It.from(s.valueEncoding||"binary"),this.store=e,this.globalCache=e.globalCache||null,this.encrypted=s.encrypted||!!s.encryptionKey,this.encryptionKey=s.encryptionKey||null,this._tryLoadingLocal=!0,this._primaryBootstrap=null,this.bootstrap&&(this._primaryBootstrap=this.store.get({key:this.bootstrap,compat:!1,active:!1,encryptionKey:this.encryptionKey}),this.store=this.store.namespace(this._primaryBootstrap,{detach:!1})),this.local=null,this.localWriter=null,this.isIndexer=!1,this.activeWriters=new Mt,this.corePool=new Ht,this.linearizer=null,this.updating=!1,this.fastForwardEnabled=!1!==s.fastForward,this.fastForwarding=0,this.fastForwardTo=null,this.fastForwardEnabled&&("object"==typeof(n=s.fastForward)&&null!==n)&&(this.fastForwardTo=s.fastForward),this._bootstrapWriters=[],this._bootstrapWritersChanged=!1,this._checkWriters=[],this._appending=null,this._wakeup=new Nt(this),this._wakeupHints=new Map,this._wakeupPeerBound=this._wakeupPeer.bind(this),this._coupler=null,this._queueViewReset=!1,this._lock=Tt(),this._applying=null,this._updatingCores=!1,this._localDigest=null,this._needsWakeup=!0,this._needsWakeupHeads=!0,this._addCheckpoints=!1,this._firstCheckpoint=!0,this._hasPendingCheckpoint=!1,this._completeRemovalAt=null,this._systemPointer=0,this._maybeStaticFastForward=!1,this._updates=[],this._handlers=s||{},this._warn=ts.bind(this),this._draining=!1,this._advancing=null,this._advanced=null,this._interrupting=!1,this.reindexing=!1,this.paused=!1,this._bump=Wt((()=>(this._advancing=this._advance(),this._advancing))),this._onremotewriterchangeBound=this._onremotewriterchange.bind(this),this.maxSupportedVersion=1,this._presystem=null,this._prebump=null,this._hasApply=!!this._handlers.apply,this._hasOpen=!!this._handlers.open,this._hasClose=!!this._handlers.close,this.onindex=s.onindex||es,this._viewStore=new Dt(this),this.view=null,this.system=null,this.version=-1,this.interrupted=null;const{ackInterval:r=jt,ackThreshold:o=Qt}=s;this._ackInterval=r,this._ackThreshold=o,this._ackTickThreshold=o,this._ackTick=0,this._ackTimer=null,this._acking=!1,this._initialHeads=[],this._initialSystem=null,this._initialViews=null,this._waiting=new At;const h=this._viewStore.get({name:"_system",exclusive:!0});this.system=new zt(h,{checkout:0}),this.view=this._hasOpen?this._handlers.open(this._viewStore,this):null,this.ready().catch(Bt);}[Vt](e,t){let s="";if("number"==typeof t.indentationLvl)for(;s.length<t.indentationLvl;)s+=" ";return s+"Autobase { ... }"}get bootstraps(){return [this.bootstrap]}get writable(){return null!==this.localWriter&&!this.localWriter.isRemoved}get ackable(){return null!==this.localWriter}get key(){return null===this._primaryBootstrap?this.local.key:this._primaryBootstrap.key}get discoveryKey(){return null===this._primaryBootstrap?this.local.discoveryKey:this._primaryBootstrap.discoveryKey}_isActiveIndexer(){return !!this.localWriter&&this.localWriter.isActiveIndexer}replicate(e,t){return this.store.replicate(e,t)}heads(){const e=new Array(this.system.heads.length);for(let t=0;t<this.system.heads.length;t++)e[t]=this.system.heads[t];return e.sort(Zt)}hasPendingIndexers(){return this.system.pendingIndexers.length>0||this.hasUnflushedIndexers()}hasUnflushedIndexers(){if(this.linearizer.indexers.length!==this.system.indexers.length)return !0;for(let e=0;e<this.system.indexers.length;e++){const t=this.linearizer.indexers[e];if(!Lt.equals(t.core.key,this.system.indexers[e].key))return !0}return !1}hintWakeup(e){Array.isArray(e)||(e=[e]);for(const{key:t,length:s}of e){const e=Lt.toString(t,"hex"),i=this._wakeupHints.get(e);(!i||-1===s||i<s)&&this._wakeupHints.set(e,s);}this._queueBump();}_queueBump(){this._bump().catch(Bt);}async _openPreSystem(){this._handlers.wait&&await this._handlers.wait(),await this.store.ready();const t={valueEncoding:this.valueEncoding,keyPair:this.keyPair,key:this._primaryBootstrap?await this._primaryBootstrap.getUserData("autobase/local"):null};this.local=e.getLocalCore(this.store,t,this.encryptionKey),await this.local.ready(),this.encryptionKey?await this.local.setUserData("autobase/encryption",this.encryptionKey):(this.encryptionKey=await this.local.getUserData("autobase/encryption"),this.encryptionKey&&(await this.local.setEncryptionKey(this.encryptionKey),this._primaryBootstrap&&this._primaryBootstrap.setEncryptionKey(this.encryptionKey))),this.encrypted&&Et(null!==this.encryptionKey,"Encryption key is expected");const s=await this.local.getUserData("referrer");!s||Lt.equals(s,this.local.key)||this._primaryBootstrap||(this._primaryBootstrap=this.store.get({key:s,compat:!1,active:!1,encryptionKey:this.encryptionKey}),this.store=this.store.namespace(this._primaryBootstrap,{detach:!1})),await this.local.setUserData("referrer",this.key),this._primaryBootstrap?(await this._primaryBootstrap.ready(),this._primaryBootstrap.setUserData("autobase/local",this.local.key),this.encryptionKey&&await this._primaryBootstrap.setUserData("autobase/encryption",this.encryptionKey)):this.local.setUserData("autobase/local",this.local.key);const{bootstrap:i,system:n,heads:r}=await this._loadSystemInfo();this.version=n?n.version:this.bootstrap&&!Lt.equals(this.bootstrap,this.local.key)?-1:this.maxSupportedVersion,this.bootstrap=i,this._initialSystem=n,this._initialHeads=r,await this._makeLinearizer(n);}async _loadSystemInfo(){const e=await this.local.getUserData("autobase/boot"),t=this.bootstrap||await this.local.getUserData("referrer")||this.local.key;if(!e)return {bootstrap:t,system:null,heads:[]};const{indexed:s,views:i,heads:n}=It.decode(Ut.BootRecord,e),{key:r,length:o}=s;if(this._systemPointer=o,!o)return {bootstrap:t,system:null,heads:[]};const h=Dt.getBlockKey(t,this.encryptionKey,"_system"),a=this.store.get({key:r,exclusive:!1,compat:!1,encryptionKey:h,isBlockKey:!0});await a.ready();const c=a.batch({checkout:o,session:!1});if(0===o||!await c.has(o-1))return await this.local.setUserData("autobase/boot",null),this._systemPointer=0,{bootstrap:t,system:null,heads:[]};const d=new zt(c,{checkout:o});if(await d.ready(),d.version>this.maxSupportedVersion)throw new Error("Autobase upgrade required");this._initialViews=[{name:"_system",key:r,length:o}];for(let e=0;e<d.views.length;e++)this._initialViews.push({name:i[e],...d.views[e]});return {bootstrap:t,system:d,heads:n}}interrupt(e){throw Et(null!==this._applying,"Interrupt is only allowed in apply"),this._interrupting=!0,e&&(this.interrupted=e),Ot}async flush(){!1===this.opened&&await this.ready(),await this._advancing;}getSystemKey(){const e=this.system.core.getBackingCore();return e?e.key:null}recouple(){this._coupler&&this._coupler.destroy();const e=this.system.core.getBackingCore();this._coupler=new Kt(e.session,this._wakeupPeerBound);}_updateBootstrapWriters(){const e=this.linearizer.getBootstrapWriters();for(const e of this._bootstrapWriters)e.isBootstrap=!1;for(const t of e)t.setBootstrap(!0);for(const e of this._bootstrapWriters)!1===e.isBootstrap&&e.setBootstrap(!1);this._bootstrapWriters=e,this._bootstrapWritersChanged=!1;}async _openPreBump(){this._presystem=this._openPreSystem();try{await this._presystem,await this._viewStore.flush();}catch(e){if(Bt(e),"ELOCKED"===e.code)throw e;throw await this.local.setUserData("autobase/last-error",Lt.from(e.stack+"")),await this.local.setUserData("autobase/boot",null),this.store.close().catch(Bt),e}await this.system.ready(),this._initialSystem&&(await this._initialSystem.close(),this._initialSystem=null,this._initialViews=null);const e=await this.local.getUserData("autobase/system");if(null!==e&&null===await this.local.getUserData("autobase/reindexed")&&(this.reindexing=!0,this.emit("reindexing"),this._onreindexing(e).catch(Bt)),this.localWriter&&!this.system.bootstrapping&&await this._restoreLocalState(),this.recouple(),null!==this.fastForwardTo){const{key:e,timeout:t}=this.fastForwardTo;this.fastForwardTo=null,this.initialFastForward(e,t||2e4);}this.localWriter&&this._ackInterval&&this._startAckTimer();}async _onreindexing(e){const{key:t,length:s}=Ut.Checkout.decode({buffer:e,start:0,end:e.byteLength}),i=this._viewStore.getBlockKey(this._viewStore.getSystemCore().name),n=this.store.get({key:t,encryptionKey:i,isBlockKey:!0}).batch({checkout:s,session:!1}),r=this,o=new zt(n,{checkout:s});await o.ready();const h=[];for(const{key:e}of o.indexers){const t=this.store.get({key:e,compat:!1,valueEncoding:Ut.OplogMessage,encryptionKey:this.encryptionKey});h.push(t);}await o.close();for(const e of h)c(e).catch(Bt);async function a(e){for(const e of h)await e.close();null!==e&&r.reindexing&&!r._isFastForwarding()&&r.initialFastForward(e,2e4);}async function c(e){for(await e.ready();r.reindexing&&!r._isFastForwarding();){const t=e.length-1,s=t>=0?await e.get(t):null;if(s&&s.version>=1){const i=await d(e,t,s);if(i)return a(i)}await e.get(e.length);}return a(null)}async function d(e,t,s){if(!s.digest)return null;if(s.digest.key)return s.digest.key;const i=await e.get(t-s.digest.pointer);return i.digest&&i.digest.key}}async _restoreLocalState(){if(await this.localWriter.getVersion()>this.maxSupportedVersion)throw this.store.close().catch(Bt),new Error("Autobase version cannot be downgraded");await this._updateDigest();}async _open(){this._prebump=this._openPreBump(),await this._prebump,await this._catchup(this._initialHeads),await this._wakeup.ready(),this.system.requestWakeup(),this._queueBump(),this._advanced=this._advancing,this.reindexing&&this._setReindexed(),this.queueFastForward(),this._updateBootstrapWriters();}async _catchup(e){if(!e.length)return;const t=new Set,s=new Map;for(;e.length;){const{key:i,length:n}=e.pop(),r=Lt.toString(i,"hex"),o=r+":"+n;if(t.has(o))continue;t.add(o);let h=s.get(r);if(!h){const e=await this._getWriterByKey(i,-1,0,!0,!1,null);h={writer:e,end:e.length},s.set(r,h);}if(h.writer.length>=n)continue;n>h.end&&(h.end=n);const a=await h.writer.core.get(n-1,{wait:!1});Et(null!==a,"Catchup failed: local block not available");for(const t of a.node.heads)e.push(t);}for(;s.size;)for(const[e,t]of s){const{writer:i,end:n}=t;if(null===i||i.length===n){s.delete(e);continue}i.available<=i.length&&await i.update(!0);const r=i.advance();r&&this.linearizer.addHead(r);}await this._drain();}_reindexersIdle(){for(const e of this.linearizer.indexers)if(e.core.length!==e.length)return !1;return !this.localWriter||this.localWriter.core.length===this.localWriter.length}async _setReindexed(){try{for(;;){await this._bump();let e=this.progress();if(e.processed===e.total&&(1!==this.linearizer.indexers.length||0!==this.linearizer.indexers[0].core.length))break;if(await this._waiting.wait(2e3),await this._advancing,e=this.progress(),e.processed===e.total)break;if(this._reindexersIdle())break}if(this._interrupting)return;await this.local.setUserData("autobase/reindexed",Lt.from([0])),this.reindexing=!1,this.emit("reindexed");}catch(e){Bt(e);}}async _close(){this._interrupting=!0,await Promise.resolve(),this._coupler&&this._coupler.destroy(),this._coupler=null,this._waiting.notify(null);const e=this._advancing.catch(Bt);this._ackTimer&&(this._ackTimer.stop(),await this._ackTimer.flush()),await this._wakeup.close(),this._hasClose&&await this._handlers.close(this.view),this._primaryBootstrap&&await this._primaryBootstrap.close(),await this.activeWriters.clear(),await this.corePool.clear(),await this.store.close(),await e;}_onError(e){this.closing||(e!==Ot?(this.close().catch(Bt),0!==Ct.listenerCount(this,"error")?this.emit("error",e):function(e){throw queueMicrotask((()=>{throw e})),e}(e)):this.emit("interrupt",this.interrupted));}async _closeWriter(e,t){this.activeWriters.delete(e),t||this.corePool.linger(e.core),await e.close();}async _gcWriters(){if(0!==this._checkWriters.length){for(;this._checkWriters.length>0;){const e=this._checkWriters.pop();if(!e.flushed())continue;const t=this._wakeup.unqueue(e.core.key,e.core.length);this._coupler.remove(e.core),t&&!e.isActiveIndexer&&(this.localWriter!==e&&await this._closeWriter(e,!1));}await this._wakeup.flush();}}_startAckTimer(){this._ackTimer||(this._ackTimer=new Pt(this._backgroundAck.bind(this),this._ackInterval),this._bumpAckTimer());}_bumpAckTimer(){this._ackTimer&&this._ackTimer.bump();}async _waitForIdle(){let e=this.progress();for(;!this.closing&&this.reindexing&&(e.processed!==e.total||1===this.linearizer.indexers.length&&0===this.linearizer.indexers[0].core.length);){await this._waiting.wait(2e3),await this._advancing;const t=this.progress();if(t.processed===e.processed&&t.total===e.total)break;e=t;}if(this.localWriter)for(await this.localWriter.ready();!this.closing&&this.localWriter.core.length>this.localWriter.length;)await this.localWriter.waitForSynced(),await this._bump();}async update(){!1===this.opened&&await this.ready();try{await this._bump(),this._acking&&await this._bump(),await this._waitForIdle();}catch(e){if(this._interrupting)return;throw e}}async _onremotewriterchange(){this._bumpAckTimer();try{await this._bump();}catch(e){if(!this._interrupting)throw e}}_onwakeup(){this._needsWakeup=!0,this._queueBump();}_isPending(){for(const e of this.system.pendingIndexers)if(Lt.equals(e,this.local.key))return !0;return !1}_isFastForwarding(){return null!==this.fastForwardTo||this.fastForwardEnabled&&this.fastForwarding>0}_backgroundAck(){return this.ack(!0)}async ack(e=!1){if(null===this.localWriter)return;const t=this._isPending();if(!t&&this._isFastForwarding())return;if(!(this.localWriter.isActiveIndexer||t)||this._acking||this._interrupting)return;this._acking=!0;try{await this._bump();}catch(e){if(!this._interrupting)throw e}if(this._ackTimer&&e&&await this._ackTimer.asapStandalone(),this._interrupting)return;const s=this._hasPendingCheckpoint||this.hasUnflushedIndexers();if(!this._interrupting&&(t||this.linearizer.shouldAck(this.localWriter,s))){try{this.localWriter&&await this.append(null);}catch(e){if(!this._interrupting)throw e}this._interrupting||(this._updateAckThreshold(),this._bumpAckTimer());}this._acking=!1;}async append(e){if(this.opened||await this.ready(),this._interrupting)throw new Error("Autobase is closing");for(;this._queueViewReset&&!this._interrupting;)await this._bump();if(null===this.localWriter||this.localWriter.isRemoved&&null!==e)throw new Error("Not writable");if(null===this._appending&&(this._appending=[]),Array.isArray(e))for(const t of e)this._append(t);else this._append(e);if(this._advancing&&await this._advancing,null!==this._appending)return this._bump()}_append(e){if(this._appending.length>0){if(null===e)return;null===this._appending[this._appending.length-1]&&this._appending.pop();}this._appending.push(e);}async checkpoint(){await this.ready();const e=[];for(const t of this.activeWriters)e.push(t.getCheckpoint());const t=await Promise.all(e);let s=null;for(const e of t)e&&(null===s||e.length>s.length)&&(s=e);return s}static getLocalCore(e,t,s){const i={...t,compat:!1,active:!1,exclusive:!0,valueEncoding:Ut.OplogMessage,encryptionKey:s};return i.keyPair?e.get(i):e.get({...i,name:"local"})}static async getUserData(e){const t=await e.getUserData("autobase/view");return {referrer:await e.getUserData("referrer"),view:t&&0===t[0]?It.decode(Ut.ViewRecord,t):null}}static async isAutobase(e,t={}){const s=await e.get(0,t);if(!s)throw new Error("Core is empty.");if(!Lt.isBuffer(s))return Yt(s);try{return Yt(It.decode(Ut.OplogMessage,s))}catch{return !1}}async setUserData(e,t){await this._presystem;const s=null===this._primaryBootstrap?this.local:this._primaryBootstrap;await s.setUserData(e,t);}async getUserData(e){await this._presystem;const t=null===this._primaryBootstrap?this.local:this._primaryBootstrap;return await t.getUserData(e)}getNamespace(e,t){const s=this.activeWriters.get(e);if(!s)return null;return {namespace:s.deriveNamespace(t.name),publicKey:s.core.manifest.signers[0].publicKey}}async _getWriterByKey(e,t,s,i,n,r){Et(!0===this._draining||this.opening&&!this.opened);const o=await this._lock();if(this._interrupting)throw o(),new Error("Autobase is closing");try{let o=this.activeWriters.get(e);if(null!==o)return n&&o.core.writable&&null===this.localWriter&&this._setLocalWriter(o),o.isRemoved&&n&&(o.isRemoved=!1),o.seen(s),o;const h=r||this.system,a=await h.get(e);if(-1===t){if(!i&&null===a)return null;t=null===a?0:a.length;}const c=null!==a&&(n||!a.isRemoved),d=0===s?null!==a&&!n&&a.isRemoved:!c;return o=this._makeWriter(e,t,c,d),o?(o.seen(s),await o.ready(),i&&o.flushed()&&(this._wakeup.unqueue(e,t),o!==this.localWriter)?(this.corePool.linger(o.core),await o.close(),o):(this.activeWriters.add(o),this._checkWriters.push(o),this._coupler&&this._coupler.add(o.core),Et(o.opened),Et(!o.closed),this._resumeWriter(o),o)):null}finally{o();}}_updateAll(){const e=[];for(const t of this.activeWriters)e.push(t.update(!1).catch(this._warn));return Promise.all(e)}_makeWriterCore(e){const t=this.corePool.get(e);if(t)return t.valueEncoding=Ut.OplogMessage,t;return Lt.equals(e,this.local.key)?this.local.session({valueEncoding:Ut.OplogMessage,encryptionKey:this.encryptionKey,active:!1}):this.store.get({key:e,compat:!1,writable:!1,valueEncoding:Ut.OplogMessage,encryptionKey:this.encryptionKey,active:!1})}_makeWriter(e,t,s,i){const n=this._makeWriterCore(e),r=new Rt(this,n,t,i);return n.writable?(s&&this._setLocalWriter(r),r):(n.on("append",this._onremotewriterchangeBound),n.on("download",this._onremotewriterchangeBound),n.on("manifest",this._onremotewriterchangeBound),r)}_updateLinearizer(e,t){const s=this._isActiveIndexer();for(const e of this.activeWriters)e.isActiveIndexer=!1;for(const t of e)t.isActiveIndexer=!0;this._isActiveIndexer()&&!s?this._setLocalIndexer():!this._isActiveIndexer()&&s&&(this._unsetLocalIndexer(),this._clearLocalIndexer()),this.linearizer=new qt(e,{heads:t,writers:this.activeWriters}),this._addCheckpoints=!(!this.localWriter||!this.localWriter.isActiveIndexer&&!this._isPending()),this._updateAckThreshold();}_resumeWriter(e){this._isFastForwarding()||e.resume();}async _loadLocalWriter(e){null===this.localWriter&&(await this._getWriterByKey(this.local.key,-1,0,!1,!1,e),this._tryLoadingLocal=!1);}async _bootstrapLinearizer(){const e=this._makeWriter(this.bootstrap,0,!0,!1);this.activeWriters.add(e),this._checkWriters.push(e),e.inflateBackground(),await e.ready(),this._resumeWriter(e),this._updateLinearizer([e],[]);}async _makeLinearizer(e){if(this._tryLoadingLocal=!0,null===e)return this._bootstrapLinearizer();(this.opened||await e.hasLocal(this.local.key))&&await this._loadLocalWriter(e);const t=[];for(const s of e.indexers){const i=await this._getWriterByKey(s.key,s.length,0,!1,!1,e);i.inflateBackground(),t.push(i);}if(!this._isActiveIndexer())for(const t of e.pendingIndexers)if(Lt.equals(t,this.local.key)){this._setLocalIndexer();break}this._updateLinearizer(t,e.heads);for(const{key:t,length:s}of e.heads)await this._getWriterByKey(t,s,0,!1,!1,e);}async _refreshSystemState(){if(await this.system.update())for(const e of this.activeWriters){const t=await this.system.get(e.core.key);e.isRemoved=!!t&&t.isRemoved;}}async _reindex(){this._updates.length&&(this._undoAll(),await this._refreshSystemState());const e=this.system.sameIndexers(this.linearizer.indexers);await this._makeLinearizer(this.system),e||await this._viewStore.migrate(),this.version=this.system.version,this.queueFastForward();for(const e of this.activeWriters){const t=await this.system.get(e.core.key),s=t?t.length:0;e.reset(s),this._resumeWriter(e);}}_onUpgrade(e){if(e>this.maxSupportedVersion)throw new Error("Autobase upgrade required")}_setLocalWriter(e){this.localWriter=e,this._ackInterval&&this._startAckTimer();}_unsetLocalWriter(){this.localWriter&&(this._closeWriter(this.localWriter,!0),this.localWriter.isActiveIndexer&&this._clearLocalIndexer(),this.localWriter=null);}_setLocalIndexer(){Et(null!==this.localWriter),this.isIndexer||(this.isIndexer=!0,this._addCheckpoints=!0,this.emit("is-indexer"));}_unsetLocalIndexer(){Et(null!==this.localWriter),this.isIndexer&&(this.isIndexer=!1,this.emit("is-non-indexer"));}_clearLocalIndexer(){Et(null!==this.localWriter),this.localWriter.isActiveIndexer=!1,this._ackTimer&&this._ackTimer.stop(),this._ackTimer=null,this._addCheckpoints=!1;}_addLocalHeads(){if(!this.localWriter.idle())return null;const e=new Array(this._appending.length);for(let t=0;t<this._appending.length;t++){const s=this.linearizer.getHeads(),i=new Set(this.linearizer.heads),n=this._appending.length-t,r=this._appending[t],o=this.localWriter.append(r,s,n,i,this.maxSupportedVersion);this.linearizer.addHead(o),e[t]=o;}return this._appending=null,e}async _addRemoteHeads(){let e=0;for(;e<64;){await this._updateAll();let t=0;for(const e of this.activeWriters){let s=e.advance();if(null!==s)for(t+=s.batch;this.linearizer.addHead(s),1!==s.batch;)s=e.advance();}if(0===t)break;e+=t;}return e}async _advanceBootRecord(e){if(e){const{views:t}=await this.system.getIndexedInfo(e);for(const{key:e,length:s}of t){const t=this._viewStore.getByKey(e);if(!t||t.core.flushedLength<s)return}}this._systemPointer=e;const t=this._viewStore.indexedViewsByName();await this._setBootRecord(this.system.core.key,e,this.system.heads,t);}async _updateBootRecordHeads(e){if(0===this._systemPointer)return;const t=this._viewStore.indexedViewsByName();await this._setBootRecord(this.system.core.key,this._systemPointer,e,t);}async _setBootRecord(e,t,s,i){const n=It.encode(Ut.BootRecord,{indexed:{key:e,length:t},heads:s,views:i});await this.local.setUserData("autobase/boot",n);}async _drain(){const e=this.writable;for(;!this._interrupting&&!this.paused;){this.opened&&null!==this.fastForwardTo&&(await this._applyFastForward(),this.system.requestWakeup()),null===this.localWriter&&!0===this._tryLoadingLocal&&await this._loadLocalWriter(this.system);const e=this.opened?await this._addRemoteHeads():null,t=this.opened&&null!==this._appending?this._addLocalHeads():null;if(!0===this._maybeStaticFastForward&&!0===this.fastForwardEnabled&&await this._checkStaticFastForward(),this._interrupting)return;(e>0||null!==t)&&(this.updating=!0);const s=this.linearizer.update(),i=s?await this._applyUpdate(s):null,n=!!this._updatingCores;if(this._interrupting)return;if(null!==this.localWriter&&null!==t&&await this._flushLocal(t),this.opened&&await this._updateBootRecordHeads(this.system.heads),this._interrupting)return;const r=await this._flushIndexes()?this.system.core.getBackingCore().flushedLength:this._systemPointer;if((this.updating||r>this._systemPointer)&&await this._advanceBootRecord(r),n&&await this.onindex(this),this._interrupting)return;if(this._queueViewReset&&null===this._appending){this._queueViewReset=!1;const e=this.system.core.getBackingCore();await this._forceResetViews(e.indexedLength);}else {if(!i){if(this._checkWriters.length>0){if(await this._gcWriters(),!this.opened)break;continue}if(e>=64)continue;break}await this._gcWriters(),await this._reindex();}}e!==this.writable&&this.emit(e?"unwritable":"writable");}progress(){let e=0,t=0;for(const s of this.activeWriters)e+=s.length,t+=s.core.length;return {processed:e,total:t}}async _getLocallyStoredHeads(){const e=await this.local.getUserData("autobase/boot");return e?It.decode(Ut.BootRecord,e).heads:[]}_wakeupPeer(e){this.system.sendWakeup(e.remotePublicKey);}async _wakeupWriter(e){this._ensureWakeup(await this._getWriterByKey(e,-1,0,!0,!1,null));}_ensureWakeup(e){null!==e&&!0!==e.isBootstrap&&(e.setBootstrap(!0),this._bootstrapWriters.push(e),this._bootstrapWritersChanged=!0);}async _drainWakeup(){if(!0===this._needsWakeup){this._needsWakeup=!1;for(const{key:e}of this._wakeup)await this._wakeupWriter(e);if(!0===this._needsWakeupHeads){this._needsWakeupHeads=!1;for(const{key:e}of await this._getLocallyStoredHeads())await this._wakeupWriter(e);}}for(const[e,t]of this._wakeupHints){const s=Lt.from(e,"hex");if(-1!==t){const e=await this.system.get(s);if(e&&t<e.length)continue}await this._wakeupWriter(s);}this._wakeupHints.clear();}pause(){this.paused=!0;}resume(){this.paused=!1,this._queueBump();}async _advance(){if(!1===this.opened&&await this.ready(),!this.paused){try{this._draining=!0,(!0===this._needsWakeup||this._wakeupHints.size>0)&&await this._drainWakeup(),await this._drain(),this._draining=!1;}catch(e){return void this._onError(e)}!this._interrupting&&this.localWriter&&this._ackIsNeeded()&&(this._ackTimer?this._ackTimer.asap():this.ack()),!0!==this.updating&&!0!==this._bootstrapWritersChanged||this._updateBootstrapWriters(),!0===this.updating&&(this.updating=!1,this.emit("update"),this._waiting.notify(null)),this.closing||await this._gcWriters();}}_ackIsNeeded(){if(!this._addCheckpoints)return !1;if(this.system.pendingIndexers.length>0)for(const e of this.system.pendingIndexers)if(Lt.equals(e,this.local.key)&&!Lt.equals(e,this.bootstrap))return !0;for(const e of this._viewStore.opened.values()){if(-1===e.queued)continue;const t=e.signer.bestCheckpoint(this.localWriter),s=t?t.length:0;if(s<e.queued&&s<e.indexedLength)return this._hasPendingCheckpoint=!0,!0}if(this._ackTickThreshold&&!this._acking&&this._ackTick>=this._ackTickThreshold){if(this._ackTimer){for(const e of this.linearizer.indexers)if(e.core.length>e.length)return !1;return this.linearizer.shouldAck(this.localWriter,this.hasUnflushedIndexers())}return !0}return !1}async forceResetViews(){this.opened||await this.ready(),this._queueViewReset=!0,this._queueBump(),this._advanced=this._advancing,await this._advanced;}async _forceResetViews(e){const t=await this.system.getIndexedInfo(e);this._undoAll(),this._systemPointer=e;const s=await this.local.getUserData("autobase/boot"),{views:i}=It.decode(Ut.BootRecord,s);await this._setBootRecord(this.system.core.key,e,t.heads,i);for(const{key:e,length:s}of t.views){const t=this._viewStore.getByKey(e);await t.reset(s);}await this._closeAllActiveWriters(!1),await this._refreshSystemState(),await this._makeLinearizer(this.system);}doneFastForwarding(){if(0==--this.fastForwarding&&!this._isFastForwarding())for(const e of this.activeWriters)e.resume();}async _checkStaticFastForward(){let e=null;for(let t=0;t<this.linearizer.indexers.length;t++){const s=this.linearizer.indexers[t];if(null!==s.system&&!Lt.equals(s.system,this.system.core.key)){null===e&&(e=new Map);const t=Lt.toString(s.system,"hex");e.set(t,(e.get(t)||0)+1);}}if(null===e)return void(this._maybeStaticFastForward=!1);const t=1+(this.linearizer.indexers.length>>1);let s=null;for(const[i,n]of e)if(!(n<t)){s=Lt.from(i,"hex");break}s&&!this._isFastForwarding()&&await this.initialFastForward(s,2e4);}async initialFastForward(e,t){this.fastForwarding++;const s=this._viewStore.getBlockKey(this._viewStore.getSystemCore().name),i=this.store.get({key:e,encryptionKey:s,isBlockKey:!0});await i.ready();const n=await new Promise(((e,s)=>{if(i.length)return e(i.length);const n=setTimeout((()=>{i.off("append",r),e(0);}),t);function r(){clearTimeout(n),e(i.length);}i.once("append",r);}));if(!n||n<this.system.core.indexedLength)return await i.close(),this.doneFastForwarding(),void this.queueFastForward();const r=await this._preFastForward(i,n,t);await i.close(),null!==r?(this.fastForwardTo=r,this.doneFastForwarding(),this._bumpAckTimer(),this._queueBump()):this.doneFastForwarding();}async queueFastForward(){if(!this.fastForwardEnabled||this.fastForwarding>0)return;const e=this.system.core.getBackingCore();if(e.session.length<=e.length+16)return;if(null!==this.fastForwardTo&&e.session.length<=this.fastForwardTo.length+16)return;if(!e.session.length)return;this.fastForwarding++;const t=await this._preFastForward(e.session,e.session.length,Gt);null!==t&&e===this.system.core.getBackingCore()?(this.fastForwardTo=t,this.doneFastForwarding(),this._bumpAckTimer(),this._queueBump()):this.doneFastForwarding();}async _preFastForward(e,t,s){if(0===t)return null;const i={key:e.key,length:t,localLength:0};for(const e of this.activeWriters)e.pause();try{await e.has(t-1)||await e.get(t-1,{timeout:s});const n=new zt(e.session(),{checkout:t,maxCacheSize:this.maxCacheSize});if(await n.ready(),n.version>this.maxSupportedVersion){const e={version:n.version,length:t};return this.emit("upgrade-available",e),null}const r=Lt.equals(e.key,this.system.core.key)&&!n.sameIndexers(this.linearizer.indexers),o=this.localWriter?n.get(this.local.key,{timeout:s}):null;o&&o.catch(es);const h=[],a=[];for(const{key:e,length:t}of n.indexers){if(0===t)continue;const s=this.store.get(e);await s.ready(),h.push({key:e,core:s,length:t});}for(const e of n.views){const t=this.store.get(e.key);0===e.length||await t.has(e.length-1)?await t.close():a.push({core:t,length:e.length});}const c=[];for(const{key:e,core:t,length:i}of h)0===t.length&&i>0&&c.push(t.get(i-1,{timeout:s})),c.push(n.get(e));for(const{core:e,length:t}of a)c.push(e.get(t-1,{timeout:s}));if(await Promise.all(c),o){const e=await o;e&&(i.localLength=e.isRemoved?-1:e.length);}const d=[];if(r){const e=n.core.core.tree.hash(),r=this.system.core._source.name,o={hash:e,length:t};i.key=this.deriveKey(r,h,o);const a=this.store.get(i.key);await a.get(t-1,{timeout:s}),d.push(a.close());}for(const{core:e}of a)d.push(e.close());d.push(n.close()),await Promise.allSettled(d);}catch(e){return Bt(e),null}return i}_clearFastForward(e){if(0===this.fastForwarding)for(const e of this.activeWriters)e.resume();this.fastForwardTo=null,e&&this.queueFastForward();}async _applyFastForward(){const{key:e,length:t,localLength:s}=this.fastForwardTo,i=!Lt.equals(e,this.system.core.key),n=this._viewStore.getSystemCore().name,r=this._viewStore.getBlockKey(n),o=this.store.get({key:e,encryptionKey:r,isBlockKey:!0});await o.ready();const h=this.system.core.getBackingCore().length;if(h>=t||o.length<t)return void this._clearFastForward(!0);const a=new zt(o,{checkout:t,maxCacheSize:this.maxCacheSize});await a.ready();const c=[],d=[],l=[];if(i){for(const{key:e}of a.indexers){const t=this.store.get(e);await t.ready(),d.push({core:t}),await t.close();}for(const{key:e}of a.views){const t=this.store.get(e);await t.ready(),l.push(t.manifest.prologue),await t.close();}}const u=new Map,p=this.system.core._source,g={key:e,length:t,systemIndex:-1};u.set(p,g);for(let e=0;e<a.views.length;e++){const t=a.views[e];let s=this._viewStore.getByKey(t.key);if(!s)for(s of this._viewStore.opened.values()){const i=this.deriveKey(s.name,d,l[e]);if(Lt.equals(i,t.key))break;s=null;}if(!s)return await ss(c),void this._clearFastForward(!1);const i=this.store.get(t.key);if(await i.ready(),c.push(i),i.length<t.length)return await ss(c),void this._clearFastForward(!0);u.set(s,{key:t.key,length:t.length,systemIndex:e});}await a.close(),await this._closeAllActiveWriters(!1),this._undoAll();for(const e of this._viewStore.opened.values()){const t=u.get(e);t?await e.catchup(t):i&&await e.migrateTo(d,0);}await this._refreshSystemState(),this.localWriter&&(s<0?this._unsetLocalWriter():this.localWriter.reset(s)),await this._makeLinearizer(this.system),await this._advanceBootRecord(t),i&&(this._setDigest(e),this.recouple()),Lt.equals(this.fastForwardTo.key,e)&&this.fastForwardTo.length===t&&this._clearFastForward(!1),this.updating=!0,this.emit("fast-forward",t,h),this.queueFastForward(),await ss(c);}async _closeAllActiveWriters(e){for(const e of this.activeWriters)this.localWriter!==e&&await this._closeWriter(e,!0);e&&await this.corePool.clear();}async _flushIndexes(){let e=!0;this._updatingCores=!1;for(const t of this._viewStore.opened.values())await t.flush()||(e=!1);for(const e of this._viewStore.opened.values()){if(0===e.indexing)continue;const t=e.indexing;e.indexing=0,e._onindex(t);}return e}_onviewappend(e,t){Et(null!==this._applying,"Append is only allowed in apply"),0===e.appending&&this._applying.views.push({core:e,appending:0}),e.appending+=t;}async addWriter(e,{indexer:t=!0,isIndexer:s=t}={}){Et(null!==this._applying,"System changes are only allowed in apply"),await this.system.add(e,{isIndexer:s});const i=await this._getWriterByKey(e,-1,0,!1,!0,null)||this._makeWriter(e,0,!0,!1);await i.ready(),this.activeWriters.has(e)||(this.activeWriters.add(i),this._checkWriters.push(i),this._resumeWriter(i)),i===this.localWriter&&(s?this._setLocalIndexer():this._unsetLocalIndexer()),this._queueBump();}removeable(e){return 1!==this.system.indexers.length||!Lt.equals(this.system.indexers[0].key,e)}async removeWriter(e){if(Et(null!==this._applying,"System changes are only allowed in apply"),!this.removeable(e))throw new Error("Not allowed to remove the last indexer");await this.system.remove(e),Lt.equals(e,this.local.key)&&this.isIndexer&&this._unsetLocalIndexer();const t=this.activeWriters.get(e);t&&(t.isRemoved=!0),this._queueBump();}_undoAll(){let e=0;for(const t of this._updates)e+=t.batch;return this._undo(e)}_undo(e){const t=[];for(;e>0;){const s=this._updates.pop();e-=s.batch;for(const{core:e,appending:i}of s.views)0===e.truncating&&t.push(e),e.truncating+=i;}for(const e of t){const t=e.truncating;e.truncating=0,e._onundo(t);}}async _getManifest(e,t){for(const s of this.linearizer.indexers){const i=await s.getDigest(t);if(i&&i.indexers.length>e)return i.indexers[e]}return null}_bootstrap(){return this.system.add(this.bootstrap,{isIndexer:!0,isPending:!1})}_updateAckThreshold(){var e;0!==this._ackThreshold&&(this._ackTimer&&this._ackTimer.bau(),this._ackTickThreshold=(e=this.linearizer.indexers.length*this._ackThreshold,Math.floor(e+Math.random()*e)));}_resetAckTick(){this._ackTick=0,this._ackTimer&&this._ackTimer.bau();}async _applyUpdate(e){Et(await this._viewStore.flush(),"Views failed to open"),e.undo&&this._undo(e.undo),e.indexed.length&&this._resetAckTick(),await this._refreshSystemState();let t=0,s=[],i=!1,n=0,r=0;for(;r<Math.min(e.indexed.length,e.shared);){const t=e.indexed[r++];if(t.batch>1)continue;this._shiftWriter(t.writer);const s=this._updates[n++];let i=!1;if(s.version>this.version&&(this._onUpgrade(s.version),i=!0),s.indexers||i)return this._queueIndexFlush(r),await this._updateDigest(),!0}for(r=e.shared;r<e.length;r++){if(null!==this.fastForwardTo&&this.fastForwardTo.length>this.system.core.length&&Lt.equals(this.fastForwardTo.key,this.system.core.key))return !1;const n=r<e.indexed.length,o=n?e.indexed[r]:e.tip[r-e.indexed.length];if(o.version>this.system.version&&(i=!0),o.writer===this.localWriter?this._resetAckTick():n||this._ackTick++,t++,this.system.addHead(o),null===o.value||o.writer.isRemoved||s.push({indexed:n,from:o.writer.core,length:o.length,value:o.value,heads:o.actualHeads}),o.batch>1)continue;if(i){const e=await this._checkVersion();this.system.version=-1===e?o.version:e;}const h={batch:t,indexers:!1,views:[],version:this.system.version};this._updates.push(h),this._applying=h,this.system.bootstrapping&&await this._bootstrap(),s.length&&!0===this._hasApply&&await this._handlers.apply(s,this.view,this),h.indexers=!!this.system.indexerUpdate,await this.system.flush(await this._getViewInfo(h.indexers)),this._applying=null,t=0,s=[];for(let e=0;e<h.views.length;e++){const t=h.views[e];t.appending=t.core.appending,t.core.appending=0;}if(!n)continue;this._shiftWriter(o.writer);let a=!1;if(h.version>this.version&&(this._onUpgrade(h.version),a=!0),h.indexers||a)return this._queueIndexFlush(r+1),await this._updateDigest(),!0}return e.indexed.length&&(this._queueIndexFlush(e.indexed.length),await this._updateDigest()),!1}async _getViewInfo(e){const t=[];for(const{key:e,length:s}of this.system.indexers){const i=await this._getWriterByKey(e,s,0,!1,!1,null);t.push(i);}const s=[];for(const i of this._viewStore.opened.values()){if(!i.length||i._isSystem())continue;const n=-1!==i.systemIndex?this.system.views[i.systemIndex].length:0,r=(t.length>1||this.linearizer.indexers.length>t.length)&&e?await i.deriveKey(t,n+i.appending):-1===i.systemIndex?i.key:null;s.push({view:i,key:r});}return s}async _checkVersion(){if(!this.system.indexers.length)return -1;const e=1+(this.system.indexers.length>>1),t=[];let s=!1;for(const{key:e,length:i}of this.system.indexers){const n=await this._getWriterByKey(e,i,0,!1,!1,null);i>n.core.length?s=!0:t.push(n.core.get(i-1));}const i=await Promise.all(t),n=new Map,r=[];if(s){const e={version:this.maxSupportedVersion,n:1};r.push(e),n.set(this.maxSupportedVersion,e);}for(const{maxSupportedVersion:t}of i){let s=n.get(t);if(s||(s={version:t,n:0},n.set(t,s),r.push(s)),++s.n>=e)return t}let o=0;for(const{version:t,n:s}of r.sort($t))if((o+=s)>=e)return t;Et(!1,"Failed to determine version");}_shiftWriter(e){e.shift(),e.flushed()&&this._checkWriters.push(e);}_queueIndexFlush(e){for(Et(!1===this._updatingCores,"Updated cores not flushed"),this._updatingCores=!0;e>0;){const t=this._updates.shift();e-=t.batch;for(const{core:e,appending:s}of t.views)e.indexing+=s;}}deriveKey(e,t,s){return this._viewStore.deriveKey(e,t,s)}async _updateDigest(){if(!this._addCheckpoints)return;if(null===this._localDigest)return this._localDigest=await this.localWriter.getDigest(),void(null===this._localDigest&&this._setDigest(this.system.core.key));const e=this.system.core._source.pendingIndexedLength,t=await this.system.getIndexedInfo(e);let s=t.indexers.length===this.linearizer.indexers.length;if(s)for(let e=0;e<t.indexers.length;e++)if(!Lt.equals(t.indexers[e].key,this.linearizer.indexers[e].core.key)){s=!1;break}let i=this.system.core.key;if(!s){const s=[];for(const{key:e}of t.indexers)s.push(await this._getWriterByKey(e,-1,0,!1,!1,null));const n=await s,r=this._viewStore.getSystemCore();i=await r.deriveKey(n,e);}this._localDigest.key&&Lt.equals(i,this._localDigest.key)||this._setDigest(i);}_setDigest(e){null===this._localDigest&&(this._localDigest={}),this._localDigest.key=e,this._localDigest.pointer=0;}_generateDigest(){return {pointer:this._localDigest.pointer,key:this._localDigest.key}}async _generateCheckpoint(e){return this._addCheckpoints?this._firstCheckpoint?(this._firstCheckpoint=!1,Xt(this._viewStore.opened.values())):Xt(e):null}async _flushLocal(e){this._localDigest||await this._updateDigest();const t=this._addCheckpoints?this._viewStore.getIndexedCores():[],s=new Array(e.length);for(let i=0;i<s.length;i++){const{value:n,heads:r,batch:o}=e[i];s[i]={version:1,maxSupportedVersion:this.maxSupportedVersion,checkpoint:this._addCheckpoints?await Xt(t):null,digest:this._addCheckpoints?this._generateDigest():null,node:{heads:r,batch:o,value:null===n?null:It.encode(this.valueEncoding,n)},trace:[]},this._addCheckpoints&&this._localDigest.pointer++;}if(await this.local.append(s),this._addCheckpoints){const{checkpoint:e}=s[s.length-1];this.localWriter._addCheckpoints(e),this._hasPendingCheckpoint=!1;}}};function Xt(e){const t=[];for(const s of e)t.push(s.checkpoint()),s.checkpointer++;return Promise.all(t)}function Yt(e){return e.checkpoint?e.checkpoint.length>0:null===e.checkpoint}function Zt(e,t){return Lt.compare(e.key,t.key)}function $t(e,t){return t.version-e.version}function es(){}function ts(e){Bt(e),this.emit("warning",e);}async function ss(e){for(const t of e)await t.close();}Jt.getLocalCore;Jt.getUserData;Jt.isAutobase;

/**
 * Bundled by jsDelivr using Rollup v2.79.1 and Terser v5.19.2.
 * Original file: /npm/hyperbee@2.20.2/index.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
const d=L$c;function u(e,t){return {type:e.isDeletion()?"del":"put",...e.final(t)}}const g=L$c;class y{constructor(e,t){this.node=e,this.parent=t,this.isKey=0===e.children.length,this.i=this.isKey?1:0,this.n=0;const n=this.isKey?null:this.node.children[0];this.seq=null!==n?n.seq:this.node.keys[0].seq,this.offset=null!==n?n.offset:0;}next(){return this.i++,this.isKey=1==(1&this.i),this.isKey||this.node.children.length||this.i++,this.update()}async bisect(e,t){let n,s=0,i=this.node.keys.length;for(;s<i;){const o=s+i>>1;if(n=p(e,await this.node.getKey(o)),0===n)return this.i=t?2*o+1:2*o+(this.node.children.length?2:3),!0;n<0?i=o:s=o+1;}const o=n<0?i:s;return this.i=2*o+(this.node.children.length?0:1),0===this.node.children.length}update(){if(this.isKey=1==(1&this.i),this.n=this.i>>1,this.n>=(this.isKey?this.node.keys.length:this.node.children.length))return !1;const e=this.isKey?null:this.node.children[this.n];return this.seq=null!==e?e.seq:this.node.keys[this.n].seq,this.offset=null!==e?e.offset:0,!0}async key(){return this.n<this.node.keys.length?this.node.getKey(this.n):this.parent&&this.parent.key()}async compare(e){const[t,n]=await Promise.all([this.key(),e.key()]);return p(t,n)}}class f{constructor(e,t){this.batch=e,this.stack=[],this.lt=t.lt||t.lte||null,this.lte=!!t.lte,this.gt=t.gt||t.gte||null,this.gte=!!t.gte,this.seeking=!!this.gt,this.encoding=t.encoding||e.encoding;}async open(){const e=await this.batch.getRoot(!1);if(!e||!e.keys.length)return;const t=new y(e,null);this.seeking&&!await this._seek(t)||this.stack.push(t);}async _seek(e){const t=await e.bisect(this.gt,this.gte),n=!e.update();return !t&&!n||(this.seeking=!1,!n)}peek(){return this.stack.length?this.stack[this.stack.length-1]:null}skip(){this.stack.length&&(this.stack[this.stack.length-1].next()||this.stack.pop());}async nextKey(){let e=null;for(;this.stack.length&&null===e;)e=await this.next();if(null===e)return null;if(!this.lt)return e.final(this.encoding);const t=p(e.key,this.lt);return (this.lte?t<=0:t<0)?e.final(this.encoding):(this.stack=[],null)}async next(){if(!this.stack.length)return null;const e=this.stack[this.stack.length-1],{isKey:t,n:n,seq:s}=e;if(e.next()||this.stack.pop(),t)return this.seeking=!1,this.batch.getBlock(s);const i=await e.node.getChildNode(n);e.node.children[n]=null;const o=new y(i,e);return this.seeking&&!await this._seek(o)||this.stack.push(o),null}close(){return this.batch._closeSnapshot()}}function p(e,t){return e?t?g.compare(e,t):e?-1:0:t?1:0}var k={},b=r$1,v=L$c,w=b.varint,_=b.skip,m=k.YoloIndex={buffer:!0,encodingLength:null,encode:null,decode:null},x=k.Header={buffer:!0,encodingLength:null,encode:null,decode:null},E=k.Node={buffer:!0,encodingLength:null,encode:null,decode:null},L=k.Extension={buffer:!0,encodingLength:null,encode:null,decode:null};function q(e){return null!=e&&("number"!=typeof e||!isNaN(e))}!function(){var e=m.Level={buffer:!0,encodingLength:null,encode:null,decode:null};function t(t){var n=0;if(q(t.levels))for(var s=0;s<t.levels.length;s++)if(q(t.levels[s])){var i=e.encodingLength(t.levels[s]);n+=w.encodingLength(i),n+=1+i;}return n}((function(){function t(e){var t=0;if(q(e.keys)){for(var n=0,s=0;s<e.keys.length;s++)q(e.keys[s])&&(n+=b.varint.encodingLength(e.keys[s]));n&&(t+=1+n+w.encodingLength(n));}if(q(e.children)){for(n=0,s=0;s<e.children.length;s++)q(e.children[s])&&(n+=b.varint.encodingLength(e.children[s]));n&&(t+=1+n+w.encodingLength(n));}return t}e.encodingLength=t,e.encode=function e(n,s,i){i||(i=0),s||(s=v.allocUnsafe(t(n)));var o=i;if(q(n.keys)){for(var r=0,h=0;h<n.keys.length;h++)q(n.keys[h])&&(r+=b.varint.encodingLength(n.keys[h]));for(r&&(s[i++]=10,w.encode(r,s,i),i+=w.encode.bytes),h=0;h<n.keys.length;h++)q(n.keys[h])&&(b.varint.encode(n.keys[h],s,i),i+=b.varint.encode.bytes);}if(q(n.children)){for(r=0,h=0;h<n.children.length;h++)q(n.children[h])&&(r+=b.varint.encodingLength(n.children[h]));for(r&&(s[i++]=18,w.encode(r,s,i),i+=w.encode.bytes),h=0;h<n.children.length;h++)q(n.children[h])&&(b.varint.encode(n.children[h],s,i),i+=b.varint.encode.bytes);}return e.bytes=i-o,s},e.decode=function e(t,n,s){if(n||(n=0),s||(s=t.length),!(s<=t.length&&n<=t.length))throw new Error("Decoded message is not valid");for(var i=n,o={keys:[],children:[]};;){if(s<=n)return e.bytes=n-i,o;var r=w.decode(t,n);switch(n+=w.decode.bytes,r>>3){case 1:var h=w.decode(t,n);for(h+=n+=w.decode.bytes;n<h;)o.keys.push(b.varint.decode(t,n)),n+=b.varint.decode.bytes;break;case 2:for(h=w.decode(t,n),h+=n+=w.decode.bytes;n<h;)o.children.push(b.varint.decode(t,n)),n+=b.varint.decode.bytes;break;default:n=_(7&r,t,n);}}};}))(),m.encodingLength=t,m.encode=function n(s,i,o){o||(o=0),i||(i=v.allocUnsafe(t(s)));var r=o;if(q(s.levels))for(var h=0;h<s.levels.length;h++)q(s.levels[h])&&(i[o++]=10,w.encode(e.encodingLength(s.levels[h]),i,o),o+=w.encode.bytes,e.encode(s.levels[h],i,o),o+=e.encode.bytes);return n.bytes=o-r,i},m.decode=function t(n,s,i){if(s||(s=0),i||(i=n.length),!(i<=n.length&&s<=n.length))throw new Error("Decoded message is not valid");for(var o=s,r={levels:[]};;){if(i<=s)return t.bytes=s-o,r;var h=w.decode(n,s);if(s+=w.decode.bytes,1==h>>3){var c=w.decode(n,s);s+=w.decode.bytes,r.levels.push(e.decode(n,s,s+c)),s+=e.decode.bytes;}else s=_(7&h,n,s);}};}(),function(){var e=x.Metadata={buffer:!0,encodingLength:null,encode:null,decode:null};function t(t){var n=0;if(!q(t.protocol))throw new Error("protocol is required");if(n+=1+(s=b.string.encodingLength(t.protocol)),q(t.metadata)){var s=e.encodingLength(t.metadata);n+=w.encodingLength(s),n+=1+s;}return n}((function(){function t(e){var t=0;return q(e.contentFeed)&&(t+=1+b.bytes.encodingLength(e.contentFeed)),q(e.userData)&&(t+=1+b.bytes.encodingLength(e.userData)),t}e.encodingLength=t,e.encode=function e(n,s,i){i||(i=0),s||(s=v.allocUnsafe(t(n)));var o=i;return q(n.contentFeed)&&(s[i++]=10,b.bytes.encode(n.contentFeed,s,i),i+=b.bytes.encode.bytes),q(n.userData)&&(s[i++]=18,b.bytes.encode(n.userData,s,i),i+=b.bytes.encode.bytes),e.bytes=i-o,s},e.decode=function e(t,n,s){if(n||(n=0),s||(s=t.length),!(s<=t.length&&n<=t.length))throw new Error("Decoded message is not valid");for(var i=n,o={contentFeed:null,userData:null};;){if(s<=n)return e.bytes=n-i,o;var r=w.decode(t,n);switch(n+=w.decode.bytes,r>>3){case 1:o.contentFeed=b.bytes.decode(t,n),n+=b.bytes.decode.bytes;break;case 2:o.userData=b.bytes.decode(t,n),n+=b.bytes.decode.bytes;break;default:n=_(7&r,t,n);}}};}))(),x.encodingLength=t,x.encode=function n(s,i,o){o||(o=0),i||(i=v.allocUnsafe(t(s)));var r=o;if(!q(s.protocol))throw new Error("protocol is required");return i[o++]=10,b.string.encode(s.protocol,i,o),o+=b.string.encode.bytes,q(s.metadata)&&(i[o++]=18,w.encode(e.encodingLength(s.metadata),i,o),o+=w.encode.bytes,e.encode(s.metadata,i,o),o+=e.encode.bytes),n.bytes=o-r,i},x.decode=function t(n,s,i){if(s||(s=0),i||(i=n.length),!(i<=n.length&&s<=n.length))throw new Error("Decoded message is not valid");for(var o=s,r={protocol:"",metadata:null},h=!1;;){if(i<=s){if(!h)throw new Error("Decoded message is not valid");return t.bytes=s-o,r}var c=w.decode(n,s);switch(s+=w.decode.bytes,c>>3){case 1:r.protocol=b.string.decode(n,s),s+=b.string.decode.bytes,h=!0;break;case 2:var l=w.decode(n,s);s+=w.decode.bytes,r.metadata=e.decode(n,s,s+l),s+=e.decode.bytes;break;default:s=_(7&c,n,s);}}};}(),function(){function e(e){var t=0;if(!q(e.index))throw new Error("index is required");if(t+=1+b.bytes.encodingLength(e.index),!q(e.key))throw new Error("key is required");(t+=1+b.bytes.encodingLength(e.key),q(e.value))&&(t+=1+b.bytes.encodingLength(e.value));return t}E.encodingLength=e,E.encode=function t(n,s,i){i||(i=0),s||(s=v.allocUnsafe(e(n)));var o=i;if(!q(n.index))throw new Error("index is required");if(s[i++]=10,b.bytes.encode(n.index,s,i),i+=b.bytes.encode.bytes,!q(n.key))throw new Error("key is required");return s[i++]=18,b.bytes.encode(n.key,s,i),i+=b.bytes.encode.bytes,q(n.value)&&(s[i++]=26,b.bytes.encode(n.value,s,i),i+=b.bytes.encode.bytes),t.bytes=i-o,s},E.decode=function e(t,n,s){if(n||(n=0),s||(s=t.length),!(s<=t.length&&n<=t.length))throw new Error("Decoded message is not valid");for(var i=n,o={index:null,key:null,value:null},r=!1,h=!1;;){if(s<=n){if(!r||!h)throw new Error("Decoded message is not valid");return e.bytes=n-i,o}var c=w.decode(t,n);switch(n+=w.decode.bytes,c>>3){case 1:o.index=b.bytes.decode(t,n),n+=b.bytes.decode.bytes,r=!0;break;case 2:o.key=b.bytes.decode(t,n),n+=b.bytes.decode.bytes,h=!0;break;case 3:o.value=b.bytes.decode(t,n),n+=b.bytes.decode.bytes;break;default:n=_(7&c,t,n);}}};}(),function(){var e=L.Get={buffer:!0,encodingLength:null,encode:null,decode:null},t=L.Iterator={buffer:!0,encodingLength:null,encode:null,decode:null},n=L.Cache={buffer:!0,encodingLength:null,encode:null,decode:null};function s(s){var i=0;if(q(s.cache)){var o=n.encodingLength(s.cache);i+=w.encodingLength(o),i+=1+o;}if(q(s.get)){o=e.encodingLength(s.get);i+=w.encodingLength(o),i+=1+o;}if(q(s.iterator)){o=t.encodingLength(s.iterator);i+=w.encodingLength(o),i+=1+o;}return i}((function(){function t(e){var t=0;return q(e.version)&&(t+=1+b.varint.encodingLength(e.version)),q(e.key)&&(t+=1+b.bytes.encodingLength(e.key)),t}e.encodingLength=t,e.encode=function e(n,s,i){i||(i=0),s||(s=v.allocUnsafe(t(n)));var o=i;return q(n.version)&&(s[i++]=8,b.varint.encode(n.version,s,i),i+=b.varint.encode.bytes),q(n.key)&&(s[i++]=18,b.bytes.encode(n.key,s,i),i+=b.bytes.encode.bytes),e.bytes=i-o,s},e.decode=function e(t,n,s){if(n||(n=0),s||(s=t.length),!(s<=t.length&&n<=t.length))throw new Error("Decoded message is not valid");for(var i=n,o={version:0,key:null};;){if(s<=n)return e.bytes=n-i,o;var r=w.decode(t,n);switch(n+=w.decode.bytes,r>>3){case 1:o.version=b.varint.decode(t,n),n+=b.varint.decode.bytes;break;case 2:o.key=b.bytes.decode(t,n),n+=b.bytes.decode.bytes;break;default:n=_(7&r,t,n);}}};}))(),function(){function e(e){var t=0;if(q(e.version)&&(t+=1+b.varint.encodingLength(e.version)),q(e.gte)&&(t+=1+b.bytes.encodingLength(e.gte)),q(e.gt)&&(t+=1+b.bytes.encodingLength(e.gt)),q(e.lte)&&(t+=1+b.bytes.encodingLength(e.lte)),q(e.lt)&&(t+=1+b.bytes.encodingLength(e.lt)),q(e.limit)&&(t+=1+b.varint.encodingLength(e.limit)),q(e.reverse)&&(t+=1+b.bool.encodingLength(e.reverse)),q(e.checkpoint)){for(var n=0,s=0;s<e.checkpoint.length;s++)q(e.checkpoint[s])&&(n+=b.varint.encodingLength(e.checkpoint[s]));n&&(t+=1+n+w.encodingLength(n));}return t}t.encodingLength=e,t.encode=function t(n,s,i){i||(i=0),s||(s=v.allocUnsafe(e(n)));var o=i;if(q(n.version)&&(s[i++]=8,b.varint.encode(n.version,s,i),i+=b.varint.encode.bytes),q(n.gte)&&(s[i++]=18,b.bytes.encode(n.gte,s,i),i+=b.bytes.encode.bytes),q(n.gt)&&(s[i++]=26,b.bytes.encode(n.gt,s,i),i+=b.bytes.encode.bytes),q(n.lte)&&(s[i++]=34,b.bytes.encode(n.lte,s,i),i+=b.bytes.encode.bytes),q(n.lt)&&(s[i++]=42,b.bytes.encode(n.lt,s,i),i+=b.bytes.encode.bytes),q(n.limit)&&(s[i++]=48,b.varint.encode(n.limit,s,i),i+=b.varint.encode.bytes),q(n.reverse)&&(s[i++]=56,b.bool.encode(n.reverse,s,i),i+=b.bool.encode.bytes),q(n.checkpoint)){for(var r=0,h=0;h<n.checkpoint.length;h++)q(n.checkpoint[h])&&(r+=b.varint.encodingLength(n.checkpoint[h]));for(r&&(s[i++]=66,w.encode(r,s,i),i+=w.encode.bytes),h=0;h<n.checkpoint.length;h++)q(n.checkpoint[h])&&(b.varint.encode(n.checkpoint[h],s,i),i+=b.varint.encode.bytes);}return t.bytes=i-o,s},t.decode=function e(t,n,s){if(n||(n=0),s||(s=t.length),!(s<=t.length&&n<=t.length))throw new Error("Decoded message is not valid");for(var i=n,o={version:0,gte:null,gt:null,lte:null,lt:null,limit:0,reverse:!1,checkpoint:[]};;){if(s<=n)return e.bytes=n-i,o;var r=w.decode(t,n);switch(n+=w.decode.bytes,r>>3){case 1:o.version=b.varint.decode(t,n),n+=b.varint.decode.bytes;break;case 2:o.gte=b.bytes.decode(t,n),n+=b.bytes.decode.bytes;break;case 3:o.gt=b.bytes.decode(t,n),n+=b.bytes.decode.bytes;break;case 4:o.lte=b.bytes.decode(t,n),n+=b.bytes.decode.bytes;break;case 5:o.lt=b.bytes.decode(t,n),n+=b.bytes.decode.bytes;break;case 6:o.limit=b.varint.decode(t,n),n+=b.varint.decode.bytes;break;case 7:o.reverse=b.bool.decode(t,n),n+=b.bool.decode.bytes;break;case 8:var h=w.decode(t,n);for(h+=n+=w.decode.bytes;n<h;)o.checkpoint.push(b.varint.decode(t,n)),n+=b.varint.decode.bytes;break;default:n=_(7&r,t,n);}}};}(),function(){function e(e){var t=0;if(!q(e.start))throw new Error("start is required");if(t+=1+b.varint.encodingLength(e.start),!q(e.end))throw new Error("end is required");if(t+=1+b.varint.encodingLength(e.end),q(e.blocks)){for(var n=0,s=0;s<e.blocks.length;s++)q(e.blocks[s])&&(n+=b.varint.encodingLength(e.blocks[s]));n&&(t+=1+n+w.encodingLength(n));}return t}n.encodingLength=e,n.encode=function t(n,s,i){i||(i=0),s||(s=v.allocUnsafe(e(n)));var o=i;if(!q(n.start))throw new Error("start is required");if(s[i++]=8,b.varint.encode(n.start,s,i),i+=b.varint.encode.bytes,!q(n.end))throw new Error("end is required");if(s[i++]=16,b.varint.encode(n.end,s,i),i+=b.varint.encode.bytes,q(n.blocks)){for(var r=0,h=0;h<n.blocks.length;h++)q(n.blocks[h])&&(r+=b.varint.encodingLength(n.blocks[h]));for(r&&(s[i++]=26,w.encode(r,s,i),i+=w.encode.bytes),h=0;h<n.blocks.length;h++)q(n.blocks[h])&&(b.varint.encode(n.blocks[h],s,i),i+=b.varint.encode.bytes);}return t.bytes=i-o,s},n.decode=function e(t,n,s){if(n||(n=0),s||(s=t.length),!(s<=t.length&&n<=t.length))throw new Error("Decoded message is not valid");for(var i=n,o={start:0,end:0,blocks:[]},r=!1,h=!1;;){if(s<=n){if(!r||!h)throw new Error("Decoded message is not valid");return e.bytes=n-i,o}var c=w.decode(t,n);switch(n+=w.decode.bytes,c>>3){case 1:o.start=b.varint.decode(t,n),n+=b.varint.decode.bytes,r=!0;break;case 2:o.end=b.varint.decode(t,n),n+=b.varint.decode.bytes,h=!0;break;case 3:var l=w.decode(t,n);for(l+=n+=w.decode.bytes;n<l;)o.blocks.push(b.varint.decode(t,n)),n+=b.varint.decode.bytes;break;default:n=_(7&c,t,n);}}};}(),L.encodingLength=s,L.encode=function i(o,r,h){h||(h=0),r||(r=v.allocUnsafe(s(o)));var c=h;return q(o.cache)&&(r[h++]=10,w.encode(n.encodingLength(o.cache),r,h),h+=w.encode.bytes,n.encode(o.cache,r,h),h+=n.encode.bytes),q(o.get)&&(r[h++]=18,w.encode(e.encodingLength(o.get),r,h),h+=w.encode.bytes,e.encode(o.get,r,h),h+=e.encode.bytes),q(o.iterator)&&(r[h++]=26,w.encode(t.encodingLength(o.iterator),r,h),h+=w.encode.bytes,t.encode(o.iterator,r,h),h+=t.encode.bytes),i.bytes=h-c,r},L.decode=function s(i,o,r){if(o||(o=0),r||(r=i.length),!(r<=i.length&&o<=i.length))throw new Error("Decoded message is not valid");for(var h=o,c={cache:null,get:null,iterator:null};;){if(r<=o)return s.bytes=o-h,c;var l=w.decode(i,o);switch(o+=w.decode.bytes,l>>3){case 1:var a=w.decode(i,o);o+=w.decode.bytes,c.cache=n.decode(i,o,o+a),o+=n.decode.bytes;break;case 2:a=w.decode(i,o),o+=w.decode.bytes,c.get=e.decode(i,o,o+a),o+=e.decode.bytes;break;case 3:a=w.decode(i,o),o+=w.decode.bytes,c.iterator=t.decode(i,o,o+a),o+=t.decode.bytes;break;default:o=_(7&l,i,o);}}};}();const{Extension:K}=k;class C{constructor(e,t){this.blocks=[],this.start=0,this.end=0,this.outgoing=e,this.from=t;}push(e){const t=this.blocks.push(e);(1===t||e<this.start)&&(this.start=e),(1===t||e>=this.end)&&(this.end=e+1),t>=128&&(this.send(),this.clear());}send(){this.blocks.length&&this.outgoing.send(K.encode({cache:{blocks:this.blocks,start:this.start,end:this.end}}),this.from);}clear(){this.start=this.end=0,this.blocks=[];}}class B{constructor(e){this.encoding=null,this.outgoing=null,this.db=e,this.active=0;}get(e,t){this.outgoing.broadcast(K.encode({get:{version:e,key:t}}));}iterator(e){e.ended||0!==e.limit&&(-1===e.limit&&(e.limit=0),this.outgoing.broadcast(K.encode({iterator:e})));}onmessage(e,t){const n=function(e){try{return K.decode(e)}catch(e){return null}}(e);n&&(n.cache&&this.oncache(n.cache,t),n.get&&this.onget(n.get,t),n.iterator&&this.oniterator(n.iterator,t));}oncache(e,t){e.blocks.length&&this.db.core.download(e);}onget(e,t){if(!e.version||e.version>this.db.version)return;const n=new C(this.outgoing,t),s=this.db.checkout(e.version);function i(){s.close().catch(N),n.send();}s.get(e.key,{extension:!1,wait:!1,update:!1,onseq:function(e){n.push(e);}}).then(i,i);}async oniterator(e,t){if(!e.version||e.version>this.db.version)return;const n=new C(this.outgoing,t);let s=e.checkpoint.length,i=0;const o=this.db.checkout(e.version),r=o.createRangeIterator({...e,wait:!1,extension:!1,update:!1,limit:0===e.limit?-1:e.limit,onseq(e){s&&s--||(i++,n.push(e));}});try{for(await r.open();i<2176&&await r.next(););}catch(e){}finally{o.close().catch(N),n.send();}}static register(e){const t=new this(e);return t.outgoing=e.core.registerExtension("hyperbee",t),t}}B.BATCH_SIZE=2048;var S=B;function N(){}const D=t$5,{Readable:I}=qt$2,M=t$n,R=L$c,U=r$u,O=f$l,A=n$w,T=r$4,{all:P}=n$a,F=class{constructor(e,t,n={}){this.batch=e,this.stack=[],this.opened=!1,this.encoding=t||e.encoding,this._limit="number"==typeof n.limit?n.limit:-1,this._gIncl=!n.gt,this._gKey=n.gt||n.gte||null,this._lIncl=!n.lt,this._lKey=n.lt||n.lte||null,this._reverse=!!n.reverse,this._version=0,this._checkpoint=n.checkpoint&&n.checkpoint.length?n.checkpoint:null,this._nexting=!1;}snapshot(e=this.batch.version){const t=[];for(const e of this.stack){let{node:n,i:s}=e;this._nexting&&e===this.stack[this.stack.length-1]&&(s=this._reverse?s+1:s-1),n.block&&(s<0||t.push(n.block.seq,n.offset,s));}return {version:e,gte:this._gIncl?this._gKey:null,gt:this._gIncl?null:this._gKey,lte:this._lIncl?this._lKey:null,lt:this._lIncl?null:this._lKey,limit:this._limit,reverse:this._reverse,ended:this.opened&&!t.length,checkpoint:this.opened?t:[]}}async open(){await this._open(),this.opened=!0;}async _open(){if(this._checkpoint){for(let e=0;e<this._checkpoint.length;e+=3){const t=this._checkpoint[e],n=this._checkpoint[e+1],s=this._checkpoint[e+2];this.stack.push({node:(await this.batch.getBlock(t)).getTreeNode(n),i:s});}return}this._nexting=!0;let e=await this.batch.getRoot(!1);if(!e)return void(this._nexting=!1);const t=this._reverse?this._lIncl:this._gIncl,n=this._reverse?this._lKey:this._gKey;if(!n)return this.stack.push({node:e,i:this._reverse?e.keys.length<<1:0}),void(this._nexting=!1);for(;;){const s={node:e,i:this._reverse?e.keys.length<<1:0};let i,o=0,r=e.keys.length;for(;o<r;){const h=o+r>>1;if(i=d.compare(n,await e.getKey(h)),0===i)return s.i=t?2*h+1:2*h+(this._reverse?0:2),this.stack.push(s),void(this._nexting=!1);i<0?r=h:o=h+1;}const h=i<0?r:o;if(s.i=2*h+(this._reverse?-1:1),s.i>=0&&s.i<=e.keys.length<<1&&this.stack.push(s),!e.children.length)return void(this._nexting=!1);e=await e.getChildNode(h);}}async next(){this._nexting=!0;const e=this._reverse?this._gKey:this._lKey,t=this._reverse?this._gIncl:this._lIncl;for(;this.stack.length&&(-1===this._limit||this._limit>0);){const n=this.stack[this.stack.length-1],s=1==(1&n.i),i=this._reverse?n.i<0?n.node.keys.length:n.i-- >>1:n.i++>>1;if(!s){if(!n.node.children.length)continue;const e=await n.node.getChildNode(i);n.node.block.seq<this.batch.core.length&&(n.node.children[i].value=null),this.stack.push({i:this._reverse?e.keys.length<<1:0,node:e});continue}if(i>=n.node.keys.length){this.stack.pop();continue}const o=n.node.keys[i],r=await this.batch.getBlock(o.seq);if(e){const n=d.compare(r.key,e);if(0===n?!t:this._reverse?n<0:n>0){this._limit=0;break}}return this._limit>0&&this._limit--,this._nexting=!1,r.final(this.encoding)}return this._nexting=!1,null}close(){return this.batch._closeSnapshot()}},W=class{constructor(e,t={}){if(this.batch=e,this.options=t,this.live=!!t.live,this.gte=0,this.lt=0,this.reverse=!!t.reverse,this.limit="number"==typeof t.limit?t.limit:-1,this.encoding=t.encoding||e.encoding,this.live&&this.reverse)throw new Error("Cannot have both live and reverse enabled")}async open(){await this.batch.getRoot(!1),this.gte=function(e,t){if(e.gt)return (e.gt<0?e.gt+t:e.gt)+1;const n=e.gte||e.since||1;return n<0?n+t:n}(this.options,this.batch.version),this.lt=this.live?1/0:function(e,t){if(0===e.lte||0===e.lt||0===e.end)return 0;if(e.lte)return (e.lte<0?e.lte+t:e.lte)+1;const n=e.lt||e.end||t;return n<0?n+t:n}(this.options,this.batch.version);}async next(){return 0===this.limit?null:(this.limit>0&&this.limit--,this.gte>=this.lt?null:this.reverse?this.lt<=1?null:u(await this.batch.getBlock(--this.lt),this.encoding):u(await this.batch.getBlock(this.gte++),this.encoding))}close(){return this.batch._closeSnapshot()}},H=class{constructor(e,t,n={}){this.left=new f(e,n),this.right=new f(t,n),this.limit="number"==typeof n.limit?n.limit:-1;}async open(){await Promise.all([this.left.open(),this.right.open()]);}async next(){if(0===this.limit)return null;const e=await this._next();return !e||null===e.left&&null===e.right?null:(this.limit--,e)}async _next(){const e=this.left,t=this.right;for(;;){const[n,s]=await Promise.all([e.peek(),t.peek()]);if(!n&&!s)return null;if(!n)return {left:null,right:await t.nextKey()};if(!s)return {left:await e.nextKey(),right:null};if(n.seq===s.seq&&n.isKey===s.isKey&&n.offset===s.offset){e.skip(),t.skip();continue}const i=await n.compare(s);if(!n.isKey||s.isKey)if(n.isKey||!s.isKey){if(n.isKey&&s.isKey)return 0===i?{left:await e.nextKey(),right:await t.nextKey()}:i<0?{left:await e.nextKey(),right:null}:{left:null,right:await t.nextKey()};0===i?await Promise.all([e.next(),t.next()]):i<0?await t.next():await e.next();}else await e.next();else await t.next();}}async close(){await Promise.all([this.left.close(),this.right.close()]);}},z=S,{YoloIndex:G,Node:V,Header:Y}=k,{BLOCK_NOT_AVAILABLE:Z,DECODING_ERROR:j}=E$6,J=R.alloc(1),Q=R.alloc(0);class X{constructor(e,t){this.seq=e,this.value=t;}}class ${constructor(e,t,n){this.seq=e,this.offset=t,this.value=n;}}class ee{constructor(e){this.keys=e,this.length=0;}get(e){return this.keys.get(e)||null}set(e,t){this.keys.set(e,t),e>=this.length&&(this.length=e+1);}gc(e){if(this.length-e>128)this.keys.clear();else for(let t=e;t<this.length;t++)this.keys.delete(t);this.length=e;}}class te{constructor(e){this.levels=e.levels.map((e=>{const t=[],n=[];for(let t=0;t<e.keys.length;t++)n.push(new X(e.keys[t],null));for(let n=0;n<e.children.length;n+=2)t.push(new $(e.children[n],e.children[n+1],null));return {keys:n,children:t}}));}get(e){return this.levels[e]}hasKey(e){for(const t of this.levels)for(const n of t.keys)if(n.seq===e)return !0;return !1}}function ne(e){return null===e.inflated&&(e.inflated=G.decode(e.index),e.index=null),new te(e.inflated)}function se(e){const t=e.map((e=>{const t=[],n=[];for(let n=0;n<e.value.keys.length;n++)t.push(e.value.keys[n].seq);for(let t=0;t<e.value.children.length;t++)n.push(e.value.children[t].seq,e.value.children[t].offset);return {keys:t,children:n}}));return G.encode({levels:t})}function ie(e,t){e.replicator._blocks.get(t)||e.get(t).catch(U);}class oe{constructor(e,t,n,s){this.block=e,this.offset=s,this.keys=t,this.children=n,this.changed=!1,this.preload();}preload(){if(null===this.block)return;const e=function(e){return e._source?e._source.originalCore:e.flush?e.session:e}(this.block.tree.core),t=function(e){return e._source?e._source.core.indexedLength:e.flush?e.indexedLength:e.length}(this.block.tree.core),n=e.core.bitfield;for(let s=0;s<this.keys.length;s++){const i=this.keys[s];i.value||(i.seq>=t||n.get(i.seq)||ie(e,i.seq));}for(let s=0;s<this.children.length;s++){const i=this.children[s];i.value||(i.seq>=t||n.get(i.seq)||ie(e,i.seq));}}async insertKey(e,t,n,s,i,o){let r,h=0,c=this.keys.length;for(;h<c;){const n=h+c>>1;if(r=R.compare(e.value,await this.getKey(n)),0===r){if(o){const e=await this.getKeyNode(n);if(!await o(e.final(i),s))return !0}if(!this.block.tree.tree.alwaysDuplicate){if(me((await this.getKeyNode(n)).value,t))return !0}return this.changed=!0,this.keys[n]=e,!0}r<0?c=n:h=n+1;}const l=r<0?c:h;return this.keys.splice(l,0,e),n&&this.children.splice(l+1,0,new $(0,0,n)),this.changed=!0,this.keys.length<9}removeKey(e){this.keys.splice(e,1),this.children.length&&(this.children[e+1].seq=0,this.children.splice(e+1,1)),this.changed=!0;}async siblings(e){for(let t=0;t<e.children.length;t++)if(e.children[t].value===this){const n=t?e.getChildNode(t-1):null,s=t<e.children.length-1?e.getChildNode(t+1):null;return {left:await n,index:t,right:await s}}throw new Error("Bad parent")}merge(e,t){this.changed=!0,this.keys.push(t);for(let t=0;t<e.keys.length;t++)this.keys.push(e.keys[t]);for(let t=0;t<e.children.length;t++)this.children.push(e.children[t]);}async split(){const e=this.keys.length>>1,t=oe.create(this.block);for(;t.keys.length<e;)t.keys.push(this.keys.pop());t.keys.reverse(),await this.getKey(this.keys.length-1);const n=this.keys.pop();if(this.children.length){for(;t.children.length<e+1;)t.children.push(this.children.pop());t.children.reverse();}return this.changed=!0,{left:this,median:n,right:t}}getKeyNode(e){return this.block.tree.getBlock(this.keys[e].seq)}async getChildNode(e){const t=this.children[e];if(t.value)return t.value;const n=t.seq===this.block.seq?this.block:await this.block.tree.getBlock(t.seq);return t.value=n.getTreeNode(t.offset)}setKey(e,t){this.keys[e]=t,this.changed=!0;}async getKey(e){const t=this.keys[e];if(t.value)return t.value;const n=t.seq===this.block.seq?this.block.key:await this.block.tree.getKey(t.seq);return t.value=n}indexChanges(e,t){const n=e.push(null)-1;this.changed=!1;for(const n of this.children)n.value&&n.value.changed&&(n.seq=t,n.offset=n.value.indexChanges(e,t),e[n.offset]=n);return n}updateChildren(e,t){for(const n of this.children)n.value&&n.seq===e&&(n.value.block=t,n.value.updateChildren(e,t));}static create(e){const t=new oe(e,[],[],0);return t.changed=!0,t}}class re{constructor(e,t,n){this.seq=e,this.tree=t,this.index=null,this.entry=n,this.key=n.key,this.value=n.value;}isTarget(e){return R.equals(this.key,e)}isDeletion(){return null===this.value&&(null===this.index&&(this.index=ne(this.entry)),!this.index.hasKey(this.seq))}final(e){return {seq:this.seq,key:e.key?e.key.decode(this.key):this.key,value:this.value&&(e.value?e.value.decode(this.value):this.value)}}getTreeNode(e){null===this.index&&(this.index=ne(this.entry));const t=this.index.get(e);return new oe(this,t.keys,t.children,e)}}class he extends re{constructor(e,t,n,s,i){super(e,t,{key:n,value:s,index:null,inflated:null}),this.pendingIndex=i;}isTarget(e){return !1}getTreeNode(e){return this.pendingIndex[e].value}}class ce extends O{constructor(e,t={}){var n,s;super(),this.feed=e,this.core=e,this.keyEncoding=t.keyEncoding?D(t.keyEncoding):null,this.valueEncoding=t.valueEncoding?D(t.valueEncoding):null,this.extension=!1!==t.extension?t.extension||z.register(this):null,this.metadata=t.metadata||null,this.lock=t.lock||M(),this.sep=t.sep||J,this.readonly=!!t.readonly,this.prefix=t.prefix||null,this.alwaysDuplicate=!1!==t.alwaysDuplicate,this._unprefixedKeyEncoding=this.keyEncoding,this._sub=!!this.prefix,this._checkout=t.checkout||0,this._view=!!t._view,this._onappendBound=this._view?null:this._onappend.bind(this),this._ontruncateBound=this._view?null:this._ontruncate.bind(this),this._watchers=this._onappendBound?[]:null,this._entryWatchers=this._onappendBound?[]:null,this._sessions=!1!==t.sessions,this._keyCache=null,this._nodeCache=null,this._batches=[],this._watchers&&(this.core.on("append",this._onappendBound),this.core.on("truncate",this._ontruncateBound)),this.prefix&&t._sub&&(this.keyEncoding=(n=this.prefix,s=this.keyEncoding,{encode:e=>R.concat([n,R.isBuffer(e)?e:we(s,e)]),decode(e){const t=e.slice(n.length,e.length);return s?s.decode(t):t}}));}async _open(){await this.core.ready();const e=T.from(this.core.globalCache);this._keyCache=new ee(e),this._nodeCache=new ee(T.from(e));}get version(){return Math.max(1,this._checkout||this.core.length)}get id(){return this.core.id}get key(){return this.core.key}get discoveryKey(){return this.core.discoveryKey}get writable(){return this.core.writable}get readable(){return this.core.readable}replicate(e,t){return this.core.replicate(e,t)}update(e){return this.core.update(e)}peek(e,t){return be(this.createRangeIterator(e,{...t,limit:1}))}createRangeIterator(e,t={}){const n=!1===(t=t?{...t,...e}:e).extension&&0!==t.limit?null:this.extension,s=t.keyEncoding?D(t.keyEncoding):this.keyEncoding;if(n){const{onseq:e,onwait:o}=t;let r=0,h=0;t=ve(s,{...t,sub:this._sub,onseq(t){r||(r=t+1),h&&h--,e&&e(t);},onwait(e){h||(h=z.BATCH_SIZE,n.iterator(i.snapshot(r))),o&&o(e);}});}else t=ve(s,{...t,sub:this._sub});const i=new F(new le(this,this._makeSnapshot(),null,!1,t),null,t);return i}createReadStream(e,t){const n=t&&t.signal||null;return ke(this.createRangeIterator(e,t),n)}createHistoryStream(e){const t=e&&e.live?this.core.session():this._makeSnapshot(),n=e&&e.signal||null;return ke(new W(new le(this,t,null,!1,e),e),n)}createDiffStream(e,t,n){"number"==typeof e&&(e=this.checkout(Math.max(1,e),{reuseSession:!0})),n=n?{...n,...t}:t;const s=e.version>this.version?e._makeSnapshot():this._makeSnapshot(),i=n&&n.signal||null,o=n&&n.keyEncoding?D(n.keyEncoding):this.keyEncoding;return o&&(n=ve(o,{...n,sub:this._sub})),ke(new H(new le(this,s,null,!1,n),new le(e,s,null,!1,n),n),i)}get(e,t){return new le(this,this._makeSnapshot(),null,!0,t).get(e)}getBySeq(e,t){return new le(this,this._makeSnapshot(),null,!0,t).getBySeq(e)}put(e,t,n){return new le(this,this.core,null,!0,n).put(e,t,n)}batch(e){return new le(this,this.core,M(),!0,e)}del(e,t){return new le(this,this.core,null,!0,t).del(e,t)}watch(e,t){if(!this._watchers)throw new Error("Can only watch the main bee instance");return new de(this,e,t)}async getAndWatch(e,t){if(!this._watchers)throw new Error("Can only watch the main bee instance");const n=new ae(this,e,t);if(await n._debouncedUpdate(),this.closing)throw await n.close(),new Error("Bee closed");return n}_onappend(){for(const e of this._watchers)e._onappend();for(const e of this._entryWatchers)e._onappend();}_ontruncate(){for(const e of this._watchers)e._ontruncate();for(const e of this._entryWatchers)e._ontruncate();this._nodeCache.gc(this.core.length),this._keyCache.gc(this.core.length);}_makeSnapshot(){return !1===this._sessions?this.core:this._checkout<=this.core.length||this._checkout<=1?this.core.snapshot():this.core.session({snapshot:!1})}checkout(e,t={}){e<1&&(e=1);const n=t.reuseSession||!1===this._sessions?this.core:e<=this.core.length||e<=1?this.core.snapshot():this.core.session({snapshot:!1});return new ce(n,{_view:!0,_sub:!1,prefix:this.prefix,sep:this.sep,lock:this.lock,checkout:e,keyEncoding:t.keyEncoding||this.keyEncoding,valueEncoding:t.valueEncoding||this.valueEncoding,extension:null!==this.extension&&this.extension})}snapshot(e){return this.checkout(Math.max(1,this.version),e)}sub(e,t={}){let n=t.sep||this.sep;R.isBuffer(n)||(n=R.from(n)),e=R.concat([this.prefix||Q,R.from(e),n]);const s=D(t.valueEncoding||this.valueEncoding),i=D(t.keyEncoding||this._unprefixedKeyEncoding);return new ce(this.core,{_view:!0,_sub:!0,prefix:e,sep:this.sep,lock:this.lock,checkout:this._checkout,valueEncoding:s,keyEncoding:i,extension:null!==this.extension&&this.extension,metadata:this.metadata})}async getHeader(e){const t=await this.core.get(0,e);try{return t&&Y.decode(t)}catch{throw j()}}async _close(){if(this._watchers)for(this.core.off("append",this._onappendBound),this.core.off("truncate",this._ontruncateBound);this._watchers.length;)await this._watchers[this._watchers.length-1].close();if(this._entryWatchers)for(;this._entryWatchers.length;)await this._entryWatchers[this._entryWatchers.length-1].close();for(;this._batches.length;)await this._batches[this._batches.length-1].close();return this.core.close()}static async isHyperbee(e,t){await e.ready();const n=await e.get(0,t);if(null===n)throw Z();try{return "hyperbee"===Y.decode(n).protocol}catch(e){return !1}}}class le{constructor(e,t,n,s,i={}){this.tree=e,this.feed=t,this.core=t,this.index=e._batches.push(this)-1,this.blocks=s?new Map:null,this.autoFlush=!n,this.rootSeq=0,this.root=null,this.length=0,this.options=i,this.locked=null,this.batchLock=n,this.onseq=this.options.onseq||xe,this.appending=null,this.isSnapshot=this.core!==this.tree.core,this.shouldUpdate=!1!==this.options.update,this.updating=null,this.encoding={key:i.keyEncoding?D(i.keyEncoding):e.keyEncoding,value:i.valueEncoding?D(i.valueEncoding):e.valueEncoding};}ready(){return this.tree.ready()}async lock(){if(this.tree.readonly)throw new Error("Hyperbee is marked as read-only");null===this.locked&&(this.locked=await this.tree.lock());}get version(){return Math.max(1,this.tree._checkout?this.tree._checkout:this.core.length+this.length)}async getRoot(e){return await this.ready(),e&&0===this.core.length&&this.core.writable&&!this.tree.readonly&&await this.core.append(Y.encode({protocol:"hyperbee",metadata:this.tree.metadata})),0===this.tree._checkout&&this.shouldUpdate&&(null===this.updating&&(this.updating=this.core.update()),await this.updating),this.version<2?null:(await this.getBlock(this.version-1)).getTreeNode(0)}async getKey(e){const t=this.core.fork===this.tree.core.fork?this.tree._keyCache.get(e):null;if(null!==t)return t;const n=(await this.getBlock(e)).key;return this.core.fork===this.tree.core.fork&&this.tree._keyCache.set(e,n),n}async _getNode(e){const t=this.core.fork===this.tree.core.fork?this.tree._nodeCache.get(e):null;if(null!==t)return t;const n=await this.core.get(e,{...this.options,valueEncoding:V});if(null===n)throw Z();const s=function(e){let t=e.key,n=e.value,s=e.index;if(2*(t.byteLength+(null===n?0:n.byteLength)+(null===s?0:s.byteLength))<t.buffer.byteLength){const[i,o,r]=P([e.key,e.value,e.index]);t=i,n=o,s=r;}return {key:t,value:n,index:s,inflated:null}}(n);return this.core.fork===this.tree.core.fork&&this.tree._nodeCache.set(e,s),s}async getBlock(e){0===this.rootSeq&&(this.rootSeq=e);let t=this.blocks&&this.blocks.get(e);if(t)return t;this.onseq(e);const n=await this._getNode(e);return t=new re(e,this,n),this.blocks&&this.blocks.size-this.length<128&&this.blocks.set(e,t),t}_onwait(e){this.options.onwait=null,this.tree.extension.get(this.rootSeq+1,e);}_getEncoding(e){return e?{key:e.keyEncoding?D(e.keyEncoding):this.encoding.key,value:e.valueEncoding?D(e.valueEncoding):this.encoding.value}:this.encoding}peek(e,t){return be(this.createRangeIterator(e,{...t,limit:1}))}createRangeIterator(e,t={}){t=t?{...t,...e}:e;const n=this._getEncoding(t);return new F(this,n,ve(n.key,{...t,sub:this.tree._sub}))}createReadStream(e,t){const n=t&&t.signal||null;return ke(this.createRangeIterator(e,t),n)}async getBySeq(e,t){const n=this._getEncoding(t);try{const t=(await this.getBlock(e)).final(n);return {key:t.key,value:t.value}}finally{await this._closeSnapshot();}}async get(e,t){const n=this._getEncoding(t);try{return await this._get(e,n)}finally{await this._closeSnapshot();}}async _get(e,t){e=we(t.key,e),null!==this.tree.extension&&!1!==this.options.extension&&(this.options.onwait=this._onwait.bind(this,e));let n=await this.getRoot(!1);if(!n)return null;for(;;){if(n.block.isTarget(e))return n.block.isDeletion()?null:n.block.final(t);let s,i=0,o=n.keys.length;for(;i<o;){const r=i+o>>1;if(s=R.compare(e,await n.getKey(r)),0===s)return (await this.getBlock(n.keys[r].seq)).final(t);s<0?o=r:i=r+1;}if(!n.children.length)return null;const r=s<0?o:i;n=await n.getChildNode(r);}}async put(e,t,n){const s=this.batchLock?await this.batchLock():null,i=n&&n.cas||null,o=this._getEncoding(n);if(this.locked||await this.lock(),!s)return this._put(e,t,o,i);try{return await this._put(e,t,o,i)}finally{s();}}async _put(e,t,n,s){const i={seq:0,key:e,value:t};e=we(n.key,e),t=we(n.value,t);const o=[];let r,h=r=await this.getRoot(!0);h||(h=r=oe.create(null));const c=i.seq=this.core.length+this.length,l=new X(c,e);for(;h.children.length;){o.push(h),h.changed=!0;let a,d=0,u=h.keys.length;for(;d<u;){const o=d+u>>1;if(a=R.compare(l.value,await h.getKey(o)),0===a){if(s){const e=await h.getKeyNode(o);if(!await s(e.final(n),i))return this._unlockMaybe()}if(!this.tree.alwaysDuplicate){if(me((await h.getKeyNode(o)).value,t))return this._unlockMaybe()}return h.setKey(o,l),this._append(r,c,e,t)}a<0?u=o:d=o+1;}const g=a<0?u:d;h=await h.getChildNode(g);}let a=!await h.insertKey(l,t,null,i,n,s);if(!h.changed)return this._unlockMaybe();for(;a;){const e=o.pop(),{median:s,right:i}=await h.split();e?(a=!await e.insertKey(s,t,i,null,n,null),h=e):(r=oe.create(h.block),r.changed=!0,r.keys.push(s),r.children.push(new $(0,0,h),new $(0,0,i)),a=!1);}return this._append(r,c,e,t)}async del(e,t){const n=this.batchLock?await this.batchLock():null,s=t&&t.cas||null,i=this._getEncoding(t);if(this.locked||await this.lock(),!n)return this._del(e,i,s);try{return await this._del(e,i,s)}finally{n();}}async _del(e,t,n){const s={seq:0,key:e,value:null};e=we(t.key,e);const i=[];let o=await this.getRoot(!0);if(!o)return this._unlockMaybe();const r=s.seq=this.core.length+this.length;for(;;){i.push(o);let h,c=0,l=o.keys.length;for(;c<l;){const a=c+l>>1;if(h=R.compare(e,await o.getKey(a)),0===h){if(n){const e=await o.getKeyNode(a);if(!await n(e.final(t),s))return this._unlockMaybe()}o.children.length?await fe(o,a,i):o.removeKey(a);for(const e of i)e.changed=!0;return this._append(await pe(i),r,e,null)}h<0?l=a:c=a+1;}if(!o.children.length)return this._unlockMaybe();const a=h<0?l:c;o=await o.getChildNode(a);}}async _closeSnapshot(){this.isSnapshot&&(await this.core.close(),this._finalize());}async close(){if(this.isSnapshot)return this._closeSnapshot();this.root=null,this.blocks&&this.blocks.clear(),this.length=0,this._unlock();}destroy(){this.close().catch(xe);}toBlocks(){if(this.appending)return this.appending;const e=new Array(this.length);for(let t=0;t<this.length;t++){const n=this.core.length+t,{pendingIndex:s,key:i,value:o}=this.blocks.get(n);if(t<this.length-1){s[0]=null;let e=0;for(;e<s.length;){const t=s[e];null===t||t.seq!==n?e===s.length-1?s.pop():s[e]=s.pop():t.offset=e++;}}e[t]=V.encode({key:i,value:o,index:se(s)});}return this.appending=e,e}flush(){if(!this.length)return this.close();const e=this.toBlocks();return this.root=null,this.blocks.clear(),this.length=0,this._appendBatch(e)}_unlockMaybe(){this.autoFlush&&this._unlock();}_unlock(){const e=this.locked;this.locked=null,null!==e&&e(),this._finalize();}_finalize(){if(this.index>=this.tree._batches.length||this.tree._batches[this.index]!==this)return;const e=this.tree._batches.pop();e!==this&&(e.index=this.index,this.tree._batches[e.index]=e);}_append(e,t,n,s){const i=[];if(e.indexChanges(i,t),i[0]=new $(t,0,e),!this.autoFlush){const o=new he(t,this,n,s,i);return e.block=o,this.root=e,this.length++,this.blocks.set(t,o),void e.updateChildren(t,o)}return this._appendBatch(V.encode({key:n,value:s,index:se(i)}))}async _appendBatch(e){try{await this.core.append(e);}finally{this._unlock();}}}class ae extends O{constructor(e,t,n={}){super(),this.keyEncoding=n.keyEncoding||e.keyEncoding,this.valueEncoding=n.valueEncoding||e.valueEncoding,this.index=e._entryWatchers.push(this)-1,this.bee=e,this.key=t,this.node=null,this._forceUpdate=!1,this._debouncedUpdate=A(this._processUpdate.bind(this)),this._updateOnce=!!n.updateOnce;}_close(){const e=this.bee._entryWatchers.pop();e!==this&&(e.index=this.index,this.bee._entryWatchers[e.index]=e);}_onappend(){this._debouncedUpdate();}_ontruncate(){this._forceUpdate=!0,this._debouncedUpdate();}async _processUpdate(){const e=this._forceUpdate;let t;this._forceUpdate=!1,this._updateOnce&&(this._updateOnce=!1,await this.bee.update({wait:!0}));try{t=await this.bee.get(this.key,{keyEncoding:this.keyEncoding,valueEncoding:this.valueEncoding});}catch(e){if("SNAPSHOT_NOT_AVAILABLE"===e.code)return;return this.bee.closing?void this.close().catch(U):void this.emit("error",e)}(e||t?.seq!==this.node?.seq)&&(this.node=t,this.emit("update"));}}class de extends O{constructor(e,t,n={}){super(),this.keyEncoding=n.keyEncoding||e.keyEncoding,this.valueEncoding=n.valueEncoding||e.valueEncoding,this.index=e._watchers.push(this)-1,this.bee=e,this.core=e.core,this.latestDiff=0,this.range=t,this.map=n.map||ge,this.current=null,this.previous=null,this.currentMapped=null,this.previousMapped=null,this.stream=null,this._lock=M(),this._flowing=!1,this._resolveOnChange=null,this._differ=n.differ||_e,this._eager=!!n.eager,this._updateOnce=!!n.updateOnce,this._onchange=n.onchange||null,this._flush=!1!==n.flush&&this.core.isAutobase,this.on("newListener",ue),this.ready().catch(U);}async _consume(){if(!this._flowing)try{for await(const e of this);}catch{}}async _open(){await this.bee.ready();const e={keyEncoding:this.keyEncoding,valueEncoding:this.valueEncoding};this.current=this._eager?this.bee.checkout(1,e):this.bee.snapshot(e),this._onchange&&(this._eager&&await this._onchange(),this._consume());}[Symbol.asyncIterator](){return this._flowing=!0,this}_ontruncate(){this.core.isAutobase&&this._onappend();}_onappend(){if(!(this.closing||this.core.isAutobase||this.core.core&&this.core.core.tree.length===this.core.length))return;const e=this._resolveOnChange;this._resolveOnChange=null,e&&e();}async _waitForChanges(){this.current.version<this.bee.version||this.closing||await new Promise((e=>{this._resolveOnChange=e;}));}async next(){try{return await this._next()}catch(e){if(this.closing)return {value:void 0,done:!0};throw await this.close(),e}}async _next(){const e=await this._lock();try{if(this.closing)return {value:void 0,done:!0};for(this.opened||await this.ready();;){if(await this._waitForChanges(),this.closing)return {value:void 0,done:!0};if(this._updateOnce&&(this._updateOnce=!1,await this.bee.update({wait:!0})),this._flush&&await this.core.base.flush(),this.closing)return {value:void 0,done:!0};if(await this._closePrevious(),this.previous=this.current.snapshot(),await this._closeCurrent(),this.current=this.bee.snapshot({keyEncoding:this.keyEncoding,valueEncoding:this.valueEncoding}),this.current.core.fork!==this.previous.core.fork)return await this._yield();this.stream=this._differ(this.current,this.previous,this.range);try{for await(const e of this.stream)return await this._yield()}finally{this.stream=null;}}}finally{e();}}async _yield(){if(this.currentMapped=this.map(this.current),this.previousMapped=this.map(this.previous),this._onchange)try{await this._onchange();}catch(e){U(e);}return this.emit("update"),{done:!1,value:[this.currentMapped,this.previousMapped]}}async return(){return await this.close(),{done:!0}}async _close(){const e=this.bee._watchers.pop();e!==this&&(e.index=this.index,this.bee._watchers[e.index]=e),this.stream&&!this.stream.destroying&&this.stream.destroy(),this._onappend(),await this._closeCurrent().catch(U),await this._closePrevious().catch(U);(await this._lock())();}destroy(){return this.close()}async _closeCurrent(){this.currentMapped&&await this.currentMapped.close(),this.current&&await this.current.close(),this.current=this.currentMapped=null;}async _closePrevious(){this.previousMapped&&await this.previousMapped.close(),this.previous&&await this.previous.close(),this.previous=this.previousMapped=null;}}function ue(e){"update"===e&&this._consume();}function ge(e){return e}async function ye(e,t){for(;e.children.length;)e=await e.getChildNode(t?0:e.children.length-1);return e.keys.length}async function fe(e,t,n){let[s,i]=await Promise.all([e.getChildNode(t),e.getChildNode(t+1)]);const[o,r]=await Promise.all([ye(s,!1),ye(i,!0)]);if(o<r){for(n.push(i);i.children.length;)n.push(i=i.children[0].value);e.keys[t]=i.keys.shift();}else {for(n.push(s);s.children.length;)n.push(s=s.children[s.children.length-1].value);e.keys[t]=s.keys.pop();}}async function pe(e){const t=e[0];for(;e.length>1;){const n=e.pop(),s=e[e.length-1];if(n.keys.length>=4)return t;let{left:i,index:o,right:r}=await n.siblings(s);if(i&&i.keys.length>4)return i.changed=!0,n.keys.unshift(s.keys[o-1]),i.children.length&&n.children.unshift(i.children.pop()),s.keys[o-1]=i.keys.pop(),t;if(r&&r.keys.length>4)return r.changed=!0,n.keys.push(s.keys[o]),r.children.length&&n.children.push(r.children.shift()),s.keys[o]=r.keys.shift(),t;i?(o--,r=n):i=n,i.merge(r,s.keys[o]),s.removeKey(o);}return !t.keys.length&&t.children.length?t.getChildNode(0):t}function ke(e,t){let n,s;const i=new I({signal:t,open(t){n=t,e.open().then(o,o);},read(t){n=t,e.next().then(r,o);},predestroy(){s=e.close(),s.catch(xe);},destroy(t){n=t,s||(s=e.close()),s.then(o,o);}});return i;function o(e){n(e);}function r(e){i.push(e),n(null);}}async function be(e){try{return await e.open(),await e.next()}finally{await e.close();}}function ve(e,t){if(!e)return t;if(e.encodeRange){const n=e.encodeRange({gt:t.gt,gte:t.gte,lt:t.lt,lte:t.lte});return t.gt=n.gt,t.gte=n.gte,t.lt=n.lt,t.lte=n.lte,t}var n;return void 0!==t.gt&&(t.gt=we(e,t.gt)),void 0!==t.gte&&(t.gte=we(e,t.gte)),void 0!==t.lt&&(t.lt=we(e,t.lt)),void 0!==t.lte&&(t.lte=we(e,t.lte)),!t.sub||t.gt||t.gte||(t.gt=we(e,J)),!t.sub||t.lt||t.lte||(t.lt=((n=we(e,Q))[n.length-1]++,n)),t}function we(e,t){return null==t?null:null!==e?e.encode(t):"string"==typeof t?R.from(t):t}function _e(e,t,n){return e.createDiffStream(t,n)}function me(e,t){return e===t||null!==e&&null!==t&&R.equals(e,t)}function xe(){}var Ee=ce;Ee.isHyperbee;

/**
 * Bundled by jsDelivr using Rollup v2.79.1 and Terser v5.19.2.
 * Original file: /npm/hypercore-id-encoding@1.3.0/index.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
const t=r$t,n=L$b;var o={encode:i,decode:s,normalize:function(e){return i(s(e))},isValid:function(e){try{return s(e),!0}catch{return !1}}};function i(e){if(!n.isBuffer(e))throw new Error("Key must be a Buffer");if(32!==e.byteLength)throw new Error("Key must be 32-bytes long");return t.encode(e)}function s(e){if(n.isBuffer(e)){if(32!==e.byteLength)throw new Error("ID must be 32-bytes long");return e}if("string"==typeof e){if(e.startsWith("pear://")&&(e=e.slice(7).split("/")[0]),52===e.length)return t.decode(e);if(64===e.length){const r=n.from(e,"hex");if(32===r.byteLength)return r}}throw new Error("Invalid Hypercore key")}o.decode;o.encode;o.isValid;o.normalize;

export { Jt as Autobase, Ee as Hyperbee, streamx as Streamx, o as hypercoreId };
