/**
 * Bundled by jsDelivr using Rollup v2.79.1 and Terser v5.19.2.
 * Original file: /npm/b4a@1.6.4/browser.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
var t$c={exports:{}};function e$8(t){return t.length}var n$b={byteLength:e$8,toString:function(t){const e=t.byteLength;let n="";for(let r=0;r<e;r++)n+=String.fromCharCode(t[r]);return n},write:function(t,n,r=0,o=e$8(n)){const f=Math.min(o,t.byteLength-r);for(let e=0;e<f;e++)t[r+e]=n.charCodeAt(e);return f}};const r$c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o$6=new Uint8Array(256);for(let t=0;t<64;t++)o$6[r$c.charCodeAt(t)]=t;function f$7(t){let e=t.length;return 61===t.charCodeAt(e-1)&&e--,e>1&&61===t.charCodeAt(e-1)&&e--,3*e>>>2}o$6[45]=62,o$6[95]=63;var i$6={byteLength:f$7,toString:function(t){const e=t.byteLength;let n="";for(let o=0;o<e;o+=3)n+=r$c[t[o]>>2]+r$c[(3&t[o])<<4|t[o+1]>>4]+r$c[(15&t[o+1])<<2|t[o+2]>>6]+r$c[63&t[o+2]];return e%3==2?n=n.substring(0,n.length-1)+"=":e%3==1&&(n=n.substring(0,n.length-2)+"=="),n},write:function(t,e,n=0,r=f$7(e)){const i=Math.min(r,t.byteLength-n);for(let n=0,r=0;r<i;n+=4){const f=o$6[e.charCodeAt(n)],i=o$6[e.charCodeAt(n+1)],u=o$6[e.charCodeAt(n+2)],a=o$6[e.charCodeAt(n+3)];t[r++]=f<<2|i>>4,t[r++]=(15&i)<<4|u>>2,t[r++]=(3&u)<<6|63&a;}return i}};function u$8(t){return t.length>>>1}var a$6={byteLength:u$8,toString:function(t){const e=t.byteLength;t=new DataView(t.buffer,t.byteOffset,e);let n="",r=0;for(let o=e-e%4;r<o;r+=4)n+=t.getUint32(r).toString(16).padStart(8,"0");for(;r<e;r++)n+=t.getUint8(r).toString(16).padStart(2,"0");return n},write:function(t,e,n=0,r=u$8(e)){const o=Math.min(r,t.byteLength-n);for(let r=0;r<o;r++){const o=c$6(e.charCodeAt(2*r)),f=c$6(e.charCodeAt(2*r+1));if(void 0===o||void 0===f)return t.subarray(0,r);t[n+r]=o<<4|f;}return o}};function c$6(t){return t>=48&&t<=57?t-48:t>=65&&t<=70?t-65+10:t>=97&&t<=102?t-97+10:void 0}function g$6(t){let e=0;for(let n=0,r=t.length;n<r;n++){const o=t.charCodeAt(n);if(o>=55296&&o<=56319&&n+1<r){const r=t.charCodeAt(n+1);if(r>=56320&&r<=57343){e+=4,n++;continue}}e+=o<=127?1:o<=2047?2:3;}return e}let s$7,y$4;if("undefined"!=typeof TextDecoder){const t=new TextDecoder;s$7=function(e){return t.decode(e)};}else s$7=function(t){const e=t.byteLength;let n="",r=0;for(;r<e;){let o=t[r];if(o<=127){n+=String.fromCharCode(o),r++;continue}let f=0,i=0;if(o<=223?(f=1,i=31&o):o<=239?(f=2,i=15&o):o<=244&&(f=3,i=7&o),e-r-f>0){let e=0;for(;e<f;)o=t[r+e+1],i=i<<6|63&o,e+=1;}else i=65533,f=e-r;n+=String.fromCodePoint(i),r+=f+1;}return n};if("undefined"!=typeof TextEncoder){const t=new TextEncoder;y$4=function(e,n,r=0,o=g$6(n)){const f=Math.min(o,e.byteLength-r);return t.encodeInto(n,e.subarray(r,r+f)),f};}else y$4=function(t,e,n=0,r=g$6(e)){const o=Math.min(r,t.byteLength-n);t=t.subarray(n,n+o);let f=0,i=0;for(;f<e.length;){const n=e.codePointAt(f);if(n<=127){t[i++]=n,f++;continue}let r=0,o=0;for(n<=2047?(r=6,o=192):n<=65535?(r=12,o=224):n<=2097151&&(r=18,o=240),t[i++]=o|n>>r,r-=6;r>=0;)t[i++]=128|n>>r&63,r-=6;f+=n>=65536?2:1;}return o};var b$4={byteLength:g$6,toString:s$7,write:y$4};function h$5(t){return 2*t.length}var l$5={byteLength:h$5,toString:function(t){const e=t.byteLength;let n="";for(let r=0;r<e-1;r+=2)n+=String.fromCharCode(t[r]+256*t[r+1]);return n},write:function(t,e,n=0,r=h$5(e)){const o=Math.min(r,t.byteLength-n);let f=o;for(let r=0;r<e.length&&!((f-=2)<0);++r){const o=e.charCodeAt(r),f=o>>8,i=o%256;t[n+2*r]=i,t[n+2*r+1]=f;}return o}};!function(t,e){const r=n$b,o=i$6,f=a$6,u=b$4,c=l$5,g=255===new Uint8Array(Uint16Array.of(255).buffer)[0];function s(t){switch(t){case"ascii":return r;case"base64":return o;case"hex":return f;case"utf8":case"utf-8":case void 0:return u;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return c;default:throw new Error(`Unknown encoding: ${t}`)}}function y(t){return t instanceof Uint8Array}function h(t,e,n){return "string"==typeof t?function(t,e){const n=s(e),r=new Uint8Array(n.byteLength(t));return n.write(r,t,0,r.byteLength),r}(t,e):Array.isArray(t)?function(t){const e=new Uint8Array(t.length);return e.set(t),e}(t):ArrayBuffer.isView(t)?function(t){const e=new Uint8Array(t.byteLength);return e.set(t),e}(t):function(t,e,n){return new Uint8Array(t,e,n)}(t,e,n)}function L(t,e,n,r,o){if(0===t.byteLength)return -1;if("string"==typeof n?(r=n,n=0):void 0===n?n=o?0:t.length-1:n<0&&(n+=t.byteLength),n>=t.byteLength){if(o)return -1;n=t.byteLength-1;}else if(n<0){if(!o)return -1;n=0;}if("string"==typeof e)e=h(e,r);else if("number"==typeof e)return e&=255,o?t.indexOf(e,n):t.lastIndexOf(e,n);if(0===e.byteLength)return -1;if(o){let r=-1;for(let o=n;o<t.byteLength;o++)if(t[o]===e[-1===r?0:o-r]){if(-1===r&&(r=o),o-r+1===e.byteLength)return r}else -1!==r&&(o-=o-r),r=-1;}else {n+e.byteLength>t.byteLength&&(n=t.byteLength-e.byteLength);for(let r=n;r>=0;r--){let n=!0;for(let o=0;o<e.byteLength;o++)if(t[r+o]!==e[o]){n=!1;break}if(n)return r}}return -1}function w(t,e,n,r){return L(t,e,n,r,!0)}function d(t,e,n){const r=t[e];t[e]=t[n],t[n]=r;}t.exports=e={isBuffer:y,isEncoding:function(t){try{return s(t),!0}catch{return !1}},alloc:function(t,n,r){const o=new Uint8Array(t);return void 0!==n&&e.fill(o,n,0,o.byteLength,r),o},allocUnsafe:function(t){return new Uint8Array(t)},allocUnsafeSlow:function(t){return new Uint8Array(t)},byteLength:function(t,e){return s(e).byteLength(t)},compare:function(t,e){if(t===e)return 0;const n=Math.min(t.byteLength,e.byteLength);t=new DataView(t.buffer,t.byteOffset,t.byteLength),e=new DataView(e.buffer,e.byteOffset,e.byteLength);let r=0;for(let o=n-n%4;r<o;r+=4){if(t.getUint32(r,g)!==e.getUint32(r,g))break}for(;r<n;r++){const n=t.getUint8(r),o=e.getUint8(r);if(n<o)return -1;if(n>o)return 1}return t.byteLength>e.byteLength?1:t.byteLength<e.byteLength?-1:0},concat:function(t,e){void 0===e&&(e=t.reduce(((t,e)=>t+e.byteLength),0));const n=new Uint8Array(e);let r=0;for(const e of t){if(r+e.byteLength>n.byteLength){const t=e.subarray(0,n.byteLength-r);return n.set(t,r),n}n.set(e,r),r+=e.byteLength;}return n},copy:function(t,e,n=0,r=0,o=t.byteLength){if(o>0&&o<r)return 0;if(o===r)return 0;if(0===t.byteLength||0===e.byteLength)return 0;if(n<0)throw new RangeError("targetStart is out of range");if(r<0||r>=t.byteLength)throw new RangeError("sourceStart is out of range");if(o<0)throw new RangeError("sourceEnd is out of range");n>=e.byteLength&&(n=e.byteLength),o>t.byteLength&&(o=t.byteLength),e.byteLength-n<o-r&&(o=e.length-n+r);const f=o-r;return t===e?e.copyWithin(n,r,o):e.set(t.subarray(r,o),n),f},equals:function(t,e){if(t===e)return !0;if(t.byteLength!==e.byteLength)return !1;const n=t.byteLength;t=new DataView(t.buffer,t.byteOffset,t.byteLength),e=new DataView(e.buffer,e.byteOffset,e.byteLength);let r=0;for(let o=n-n%4;r<o;r+=4)if(t.getUint32(r,g)!==e.getUint32(r,g))return !1;for(;r<n;r++)if(t.getUint8(r)!==e.getUint8(r))return !1;return !0},fill:function(t,e,n,r,o){if("string"==typeof e?"string"==typeof n?(o=n,n=0,r=t.byteLength):"string"==typeof r&&(o=r,r=t.byteLength):"number"==typeof e?e&=255:"boolean"==typeof e&&(e=+e),n<0||t.byteLength<n||t.byteLength<r)throw new RangeError("Out of range index");if(void 0===n&&(n=0),void 0===r&&(r=t.byteLength),r<=n)return t;if(e||(e=0),"number"==typeof e)for(let o=n;o<r;++o)t[o]=e;else {const f=(e=y(e)?e:h(e,o)).byteLength;for(let o=0;o<r-n;++o)t[o+n]=e[o%f];}return t},from:h,includes:function(t,e,n,r){return -1!==w(t,e,n,r)},indexOf:w,lastIndexOf:function(t,e,n,r){return L(t,e,n,r,!1)},swap16:function(t){const e=t.byteLength;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let n=0;n<e;n+=2)d(t,n,n+1);return t},swap32:function(t){const e=t.byteLength;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let n=0;n<e;n+=4)d(t,n,n+3),d(t,n+1,n+2);return t},swap64:function(t){const e=t.byteLength;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let n=0;n<e;n+=8)d(t,n,n+7),d(t,n+1,n+6),d(t,n+2,n+5),d(t,n+3,n+4);return t},toBuffer:function(t){return t},toString:function(t,e,n=0,r=t.byteLength){const o=t.byteLength;return n>=o||r<=n?"":(n<0&&(n=0),r>o&&(r=o),(0!==n||r<o)&&(t=t.subarray(n,r)),s(e).toString(t))},write:function(t,e,n,r,o){return void 0===n?o="utf8":void 0===r&&"string"==typeof n?(o=n,n=void 0):void 0===o&&"string"==typeof r&&(o=r,r=void 0),s(o).write(t,e,n,r)},writeDoubleLE:function(t,e,n){return void 0===n&&(n=0),new DataView(t.buffer,t.byteOffset,t.byteLength).setFloat64(n,e,!0),n+8},writeFloatLE:function(t,e,n){return void 0===n&&(n=0),new DataView(t.buffer,t.byteOffset,t.byteLength).setFloat32(n,e,!0),n+4},writeUInt32LE:function(t,e,n){return void 0===n&&(n=0),new DataView(t.buffer,t.byteOffset,t.byteLength).setUint32(n,e,!0),n+4},writeInt32LE:function(t,e,n){return void 0===n&&(n=0),new DataView(t.buffer,t.byteOffset,t.byteLength).setInt32(n,e,!0),n+4},readDoubleLE:function(t,e){return void 0===e&&(e=0),new DataView(t.buffer,t.byteOffset,t.byteLength).getFloat64(e,!0)},readFloatLE:function(t,e){return void 0===e&&(e=0),new DataView(t.buffer,t.byteOffset,t.byteLength).getFloat32(e,!0)},readUInt32LE:function(t,e){return void 0===e&&(e=0),new DataView(t.buffer,t.byteOffset,t.byteLength).getUint32(e,!0)},readInt32LE:function(t,e){return void 0===e&&(e=0),new DataView(t.buffer,t.byteOffset,t.byteLength).getInt32(e,!0)}};}(t$c,t$c.exports);var L$4=t$c.exports;

/**
 * Bundled by jsDelivr using Rollup v2.79.1 and Terser v5.19.2.
 * Original file: /npm/codecs@3.1.0/index.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
const n$a=L$4;var t$b=r$b;function r$b(e,t){if("object"==typeof e&&e)return (u=e).encode&&u.decode&&u.preencode?function(e){return {name:"compact-encoding",encode:function(t){const r={start:0,end:0,buffer:null,cache:null};return e.preencode(r,t),r.buffer=n$a.allocUnsafe(r.end),e.encode(r,t),r.buffer},decode:function(n){return e.decode({start:0,end:n.byteLength,buffer:n,cache:null})}}}(e):e;var u;switch(e){case"ndjson":return r$b.ndjson;case"json":return r$b.json;case"ascii":return r$b.ascii;case"utf-8":case"utf8":return r$b.utf8;case"hex":return r$b.hex;case"base64":return r$b.base64;case"ucs-2":case"ucs2":return r$b.ucs2;case"utf16-le":case"utf16le":return r$b.utf16le}return void 0!==t?t:r$b.binary}function u$7(e){return {name:e?"ndjson":"json",encode:e?function(e){return n$a.from(JSON.stringify(e)+"\n")}:function(e){return n$a.from(JSON.stringify(e))},decode:function(e){return JSON.parse(n$a.toString(e))}}}function c$5(e){return {name:e,encode:function(t){return "string"!=typeof t&&(t=t.toString()),n$a.from(t,e)},decode:function(t){return n$a.toString(t,e)}}}r$b.ascii=c$5("ascii"),r$b.utf8=c$5("utf-8"),r$b.hex=c$5("hex"),r$b.base64=c$5("base64"),r$b.ucs2=c$5("ucs2"),r$b.utf16le=c$5("utf16le"),r$b.ndjson=u$7(!0),r$b.json=u$7(!1),r$b.binary={name:"binary",encode:function(e){return "string"==typeof e?n$a.from(e,"utf-8"):n$a.toBuffer(e)},decode:function(e){return n$a.toBuffer(e)}};

/**
 * Bundled by jsDelivr using Rollup v2.79.1 and Terser v5.19.2.
 * Original file: /npm/queue-tick@1.0.1/queue-microtask.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
var e$7="function"==typeof queueMicrotask?queueMicrotask:e=>Promise.resolve().then(e);

/**
 * Bundled by jsDelivr using Rollup v2.79.1 and Terser v5.19.2.
 * Original file: /npm/fast-fifo@1.3.2/index.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
const t$a=class t{constructor(t){if(!(t>0)||0!=(t-1&t))throw new Error("Max size for a FixedFIFO should be a power of two");this.buffer=new Array(t),this.mask=t-1,this.top=0,this.btm=0,this.next=null;}clear(){this.top=this.btm=0,this.next=null,this.buffer.fill(void 0);}push(t){return void 0===this.buffer[this.top]&&(this.buffer[this.top]=t,this.top=this.top+1&this.mask,!0)}shift(){const t=this.buffer[this.btm];if(void 0!==t)return this.buffer[this.btm]=void 0,this.btm=this.btm+1&this.mask,t}peek(){return this.buffer[this.btm]}isEmpty(){return void 0===this.buffer[this.btm]}};var i$5=class i{constructor(i){this.hwm=i||16,this.head=new t$a(this.hwm),this.tail=this.head,this.length=0;}clear(){this.head=this.tail,this.head.clear(),this.length=0;}push(i){if(this.length++,!this.head.push(i)){const h=this.head;this.head=h.next=new t$a(2*this.head.buffer.length),this.head.push(i);}}shift(){0!==this.length&&this.length--;const t=this.tail.shift();if(void 0===t&&this.tail.next){const t=this.tail.next;return this.tail.next=null,this.tail=t,this.tail.shift()}return t}peek(){const t=this.tail.peek();return void 0===t&&this.tail.next?this.tail.next.peek():t}isEmpty(){return 0===this.length}};

/**
 * Bundled by jsDelivr using Rollup v2.79.1 and Terser v5.19.2.
 * Original file: /npm/text-decoder@1.2.0/index.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
var e$6=class e{constructor(e){this.decoder=new TextDecoder("utf16le"===e?"utf16-le":e);}get remaining(){return -1}decode(e){return this.decoder.decode(e,{stream:!0})}flush(){return this.decoder.decode(new Uint8Array(0))}};const t$9=e$6,r$a=e$6;var s$6=class s{constructor(e="utf8"){switch(this.encoding=function(e){switch(e=e.toLowerCase()){case"utf8":case"utf-8":return "utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return "utf16le";case"latin1":case"binary":return "latin1";case"base64":case"ascii":case"hex":return e;default:throw new Error("Unknown encoding: "+e)}}(e),this.encoding){case"utf8":this.decoder=new r$a;break;case"utf16le":case"base64":throw new Error("Unsupported encoding: "+this.encoding);default:this.decoder=new t$9(this.encoding);}}get remaining(){return this.decoder.remaining}push(e){return "string"==typeof e?e:this.decoder.decode(e)}write(e){return this.push(e)}end(e){let t="";return e&&(t=this.push(e)),t+=this.decoder.flush(),t}};

/**
 * Bundled by jsDelivr using Rollup v2.79.1 and Terser v5.19.2.
 * Original file: /npm/streamx@2.20.1/index.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
function r$9(t){return t&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function n$9(){}function s$5(){s$5.init.call(this);}function a$5(t){return void 0===t._maxListeners?s$5.defaultMaxListeners:t._maxListeners}function l$4(t,e,i,r){var s,l,u,h;if("function"!=typeof i)throw new TypeError('"listener" argument must be a function');if((l=t._events)?(l.newListener&&(t.emit("newListener",e,i.listener?i.listener:i),l=t._events),u=l[e]):(l=t._events=new n$9,t._eventsCount=0),u){if("function"==typeof u?u=l[e]=r?[i,u]:[u,i]:r?u.unshift(i):u.push(i),!u.warned&&(s=a$5(t))&&s>0&&u.length>s){u.warned=!0;var o=new Error("Possible EventEmitter memory leak detected. "+u.length+" "+e+" listeners added. Use emitter.setMaxListeners() to increase limit");o.name="MaxListenersExceededWarning",o.emitter=t,o.type=e,o.count=u.length,h=o,"function"==typeof console.warn?console.warn(h):console.log(h);}}else u=l[e]=i,++t._eventsCount;return t}function u$6(t,e,i){var r=!1;function n(){t.removeListener(e,n),r||(r=!0,i.apply(t,arguments));}return n.listener=i,n}function h$4(t){var e=this._events;if(e){var i=e[t];if("function"==typeof i)return 1;if(i)return i.length}return 0}function o$5(t,e){for(var i=new Array(e);e--;)i[e]=t[e];return i}n$9.prototype=Object.create(null),s$5.EventEmitter=s$5,s$5.usingDomains=!1,s$5.prototype.domain=void 0,s$5.prototype._events=void 0,s$5.prototype._maxListeners=void 0,s$5.defaultMaxListeners=10,s$5.init=function(){this.domain=null,s$5.usingDomains&&undefined.active,this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=new n$9,this._eventsCount=0),this._maxListeners=this._maxListeners||void 0;},s$5.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||isNaN(t))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=t,this},s$5.prototype.getMaxListeners=function(){return a$5(this)},s$5.prototype.emit=function(t){var e,i,r,n,s,a,l,u="error"===t;if(a=this._events)u=u&&null==a.error;else if(!u)return !1;if(l=this.domain,u){if(e=arguments[1],!l){if(e instanceof Error)throw e;var h=new Error('Uncaught, unspecified "error" event. ('+e+")");throw h.context=e,h}return e||(e=new Error('Uncaught, unspecified "error" event')),e.domainEmitter=this,e.domain=l,e.domainThrown=!1,l.emit("error",e),!1}if(!(i=a[t]))return !1;var d="function"==typeof i;switch(r=arguments.length){case 1:!function(t,e,i){if(e)t.call(i);else for(var r=t.length,n=o$5(t,r),s=0;s<r;++s)n[s].call(i);}(i,d,this);break;case 2:!function(t,e,i,r){if(e)t.call(i,r);else for(var n=t.length,s=o$5(t,n),a=0;a<n;++a)s[a].call(i,r);}(i,d,this,arguments[1]);break;case 3:!function(t,e,i,r,n){if(e)t.call(i,r,n);else for(var s=t.length,a=o$5(t,s),l=0;l<s;++l)a[l].call(i,r,n);}(i,d,this,arguments[1],arguments[2]);break;case 4:!function(t,e,i,r,n,s){if(e)t.call(i,r,n,s);else for(var a=t.length,l=o$5(t,a),u=0;u<a;++u)l[u].call(i,r,n,s);}(i,d,this,arguments[1],arguments[2],arguments[3]);break;default:for(n=new Array(r-1),s=1;s<r;s++)n[s-1]=arguments[s];!function(t,e,i,r){if(e)t.apply(i,r);else for(var n=t.length,s=o$5(t,n),a=0;a<n;++a)s[a].apply(i,r);}(i,d,this,n);}return !0},s$5.prototype.addListener=function(t,e){return l$4(this,t,e,!1)},s$5.prototype.on=s$5.prototype.addListener,s$5.prototype.prependListener=function(t,e){return l$4(this,t,e,!0)},s$5.prototype.once=function(t,e){if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');return this.on(t,u$6(this,t,e)),this},s$5.prototype.prependOnceListener=function(t,e){if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');return this.prependListener(t,u$6(this,t,e)),this},s$5.prototype.removeListener=function(t,e){var i,r,s,a,l;if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');if(!(r=this._events))return this;if(!(i=r[t]))return this;if(i===e||i.listener&&i.listener===e)0==--this._eventsCount?this._events=new n$9:(delete r[t],r.removeListener&&this.emit("removeListener",t,i.listener||e));else if("function"!=typeof i){for(s=-1,a=i.length;a-- >0;)if(i[a]===e||i[a].listener&&i[a].listener===e){l=i[a].listener,s=a;break}if(s<0)return this;if(1===i.length){if(i[0]=void 0,0==--this._eventsCount)return this._events=new n$9,this;delete r[t];}else !function(t,e){for(var i=e,r=i+1,n=t.length;r<n;i+=1,r+=1)t[i]=t[r];t.pop();}(i,s);r.removeListener&&this.emit("removeListener",t,l||e);}return this},s$5.prototype.off=function(t,e){return this.removeListener(t,e)},s$5.prototype.removeAllListeners=function(t){var e,i;if(!(i=this._events))return this;if(!i.removeListener)return 0===arguments.length?(this._events=new n$9,this._eventsCount=0):i[t]&&(0==--this._eventsCount?this._events=new n$9:delete i[t]),this;if(0===arguments.length){for(var r,s=Object.keys(i),a=0;a<s.length;++a)"removeListener"!==(r=s[a])&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=new n$9,this._eventsCount=0,this}if("function"==typeof(e=i[t]))this.removeListener(t,e);else if(e)do{this.removeListener(t,e[e.length-1]);}while(e[0]);return this},s$5.prototype.listeners=function(t){var e,i=this._events;return i&&(e=i[t])?"function"==typeof e?[e.listener||e]:function(t){for(var e=new Array(t.length),i=0;i<e.length;++i)e[i]=t[i].listener||t[i];return e}(e):[]},s$5.listenerCount=function(t,e){return "function"==typeof t.listenerCount?t.listenerCount(e):h$4.call(t,e)},s$5.prototype.listenerCount=h$4,s$5.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};var d$3=r$9(Object.freeze({__proto__:null,default:s$5,EventEmitter:s$5}));const{EventEmitter:p$3}=d$3,f$6=new Error("Stream was destroyed"),_$1=new Error("Premature close"),c$4=e$7,S$1=i$5,m$1=s$6,x$1=536870911,b$3=1^x$1,w$3=64,y$3=128,v$1=256,g$5=1024,k$1=2048,T$1=4096,L$3=8192,E$2=16384,N$1=32768,P$1=131072,W$1=131328,C$1=536805375,M$3=768^x$1,A$1=536838143,q$1=536739839,U$1=1<<18,O$1=2<<18,F$1=4<<18,R$1=8<<18,j$1=16<<18,D$1=32<<18,B$1=64<<18,I$1=128<<18,z$1=256<<18,K$1=512<<18,G$1=1024<<18,H$1=469499903,J$1=535822335,Q$1=503316479,V$1=268435455,X$1=262160,Y$1=536608751,Z$1=8404992,$$1=14,tt=15,et=8405006,it=33587200,rt=33587215,nt=2359296,st=270794767,at=Symbol.asyncIterator||Symbol("asyncIterator");class lt{constructor(t,{highWaterMark:e=16384,map:i=null,mapWritable:r,byteLength:n,byteLengthWritable:s}={}){this.stream=t,this.queue=new S$1,this.highWaterMark=e,this.buffered=0,this.error=null,this.pipeline=null,this.drains=null,this.byteLength=s||n||Ct,this.map=r||i,this.afterWrite=_t.bind(this),this.afterUpdateNextTick=mt.bind(this);}get ended(){return 0!=(this.stream._duplexState&D$1)}push(t){return null!==this.map&&(t=this.map(t)),this.buffered+=this.byteLength(t),this.queue.push(t),this.buffered<this.highWaterMark?(this.stream._duplexState|=R$1,!0):(this.stream._duplexState|=6291456,!1)}shift(){const t=this.queue.shift();return this.buffered-=this.byteLength(t),0===this.buffered&&(this.stream._duplexState&=534773759),t}end(t){"function"==typeof t?this.stream.once("finish",t):null!=t&&this.push(t),this.stream._duplexState=(this.stream._duplexState|K$1)&J$1;}autoBatch(t,e){const i=[],r=this.stream;for(i.push(t);(r._duplexState&st)===nt;)i.push(r._writableState.shift());if(0!=(r._duplexState&tt))return e(null);r._writev(i,e);}update(){const t=this.stream;t._duplexState|=O$1;do{for(;(t._duplexState&st)===R$1;){const e=this.shift();t._duplexState|=67371008,t._write(e,this.afterWrite);}0==(1310720&t._duplexState)&&this.updateNonPrimary();}while(!0===this.continueUpdate());t._duplexState&=536346623;}updateNonPrimary(){const t=this.stream;if((144965647&t._duplexState)===K$1)return t._duplexState=402653183&(t._duplexState|U$1),void t._final(pt.bind(this));4!=(t._duplexState&$$1)?1==(t._duplexState&rt)&&(t._duplexState=(t._duplexState|X$1)&b$3,t._open(xt.bind(this))):0==(t._duplexState&it)&&(t._duplexState|=X$1,t._destroy(ft.bind(this)));}continueUpdate(){return 0!=(this.stream._duplexState&I$1)&&(this.stream._duplexState&=Q$1,!0)}updateCallback(){(35127311&this.stream._duplexState)===F$1?this.update():this.updateNextTick();}updateNextTick(){0==(this.stream._duplexState&I$1)&&(this.stream._duplexState|=I$1,0==(this.stream._duplexState&O$1)&&c$4(this.afterUpdateNextTick));}}class ut{constructor(t,{highWaterMark:e=16384,map:i=null,mapReadable:r,byteLength:n,byteLengthReadable:s}={}){this.stream=t,this.queue=new S$1,this.highWaterMark=0===e?1:e,this.buffered=0,this.readAhead=e>0,this.error=null,this.pipeline=null,this.byteLength=s||n||Ct,this.map=r||i,this.pipeTo=null,this.afterRead=ct.bind(this),this.afterUpdateNextTick=St.bind(this);}get ended(){return 0!=(this.stream._duplexState&E$2)}pipe(t,e){if(null!==this.pipeTo)throw new Error("Can only pipe to one destination");if("function"!=typeof e&&(e=null),this.stream._duplexState|=512,this.pipeTo=t,this.pipeline=new ot(this.stream,t,e),e&&this.stream.on("error",Mt),Wt(t))t._writableState.pipeline=this.pipeline,e&&t.on("error",Mt),t.on("finish",this.pipeline.finished.bind(this.pipeline));else {const e=this.pipeline.done.bind(this.pipeline,t),i=this.pipeline.done.bind(this.pipeline,t,null);t.on("error",e),t.on("close",i),t.on("finish",this.pipeline.finished.bind(this.pipeline));}t.on("drain",dt.bind(this)),this.stream.emit("piping",t),t.emit("pipe",this.stream);}push(t){const e=this.stream;return null===t?(this.highWaterMark=0,e._duplexState=536805311&(e._duplexState|g$5),!1):null!==this.map&&null===(t=this.map(t))?(e._duplexState&=C$1,this.buffered<this.highWaterMark):(this.buffered+=this.byteLength(t),this.queue.push(t),e._duplexState=(e._duplexState|y$3)&C$1,this.buffered<this.highWaterMark)}shift(){const t=this.queue.shift();return this.buffered-=this.byteLength(t),0===this.buffered&&(this.stream._duplexState&=536862591),t}unshift(t){const e=[null!==this.map?this.map(t):t];for(;this.buffered>0;)e.push(this.shift());for(let t=0;t<e.length-1;t++){const i=e[t];this.buffered+=this.byteLength(i),this.queue.push(i);}this.push(e[e.length-1]);}read(){const t=this.stream;if((16527&t._duplexState)===y$3){const e=this.shift();return null!==this.pipeTo&&!1===this.pipeTo.write(e)&&(t._duplexState&=M$3),0!=(t._duplexState&k$1)&&t.emit("data",e),e}return !1===this.readAhead&&(t._duplexState|=P$1,this.updateNextTick()),null}drain(){const t=this.stream;for(;(16527&t._duplexState)===y$3&&0!=(768&t._duplexState);){const e=this.shift();null!==this.pipeTo&&!1===this.pipeTo.write(e)&&(t._duplexState&=M$3),0!=(t._duplexState&k$1)&&t.emit("data",e);}}update(){const t=this.stream;t._duplexState|=32;do{for(this.drain();this.buffered<this.highWaterMark&&(214047&t._duplexState)===P$1;)t._duplexState|=65552,t._read(this.afterRead),this.drain();4224==(12431&t._duplexState)&&(t._duplexState|=L$3,t.emit("readable")),0==(80&t._duplexState)&&this.updateNonPrimary();}while(!0===this.continueUpdate());t._duplexState&=536870879;}updateNonPrimary(){const t=this.stream;(1167&t._duplexState)===g$5&&(t._duplexState=536869887&(t._duplexState|E$2),t.emit("end"),(t._duplexState&et)===Z$1&&(t._duplexState|=4),null!==this.pipeTo&&this.pipeTo.end()),4!=(t._duplexState&$$1)?1==(t._duplexState&rt)&&(t._duplexState=(t._duplexState|X$1)&b$3,t._open(xt.bind(this))):0==(t._duplexState&it)&&(t._duplexState|=X$1,t._destroy(ft.bind(this)));}continueUpdate(){return 0!=(this.stream._duplexState&N$1)&&(this.stream._duplexState&=A$1,!0)}updateCallback(){(32879&this.stream._duplexState)===w$3?this.update():this.updateNextTick();}updateNextTick(){0==(this.stream._duplexState&N$1)&&(this.stream._duplexState|=N$1,0==(32&this.stream._duplexState)&&c$4(this.afterUpdateNextTick));}}class ht{constructor(t){this.data=null,this.afterTransform=bt.bind(t),this.afterFinal=null;}}class ot{constructor(t,e,i){this.from=t,this.to=e,this.afterPipe=i,this.error=null,this.pipeToFinished=!1;}finished(){this.pipeToFinished=!0;}done(t,e){e&&(this.error=e),t!==this.to||(this.to=null,null===this.from)?t!==this.from||(this.from=null,null===this.to)?(null!==this.afterPipe&&this.afterPipe(this.error),this.to=this.from=this.afterPipe=null):0==(t._duplexState&E$2)&&this.to.destroy(this.error||new Error("Readable stream closed before ending")):0!=(this.from._duplexState&E$2)&&this.pipeToFinished||this.from.destroy(this.error||new Error("Writable stream closed prematurely"));}}function dt(){this.stream._duplexState|=512,this.updateCallback();}function pt(t){const e=this.stream;t&&e.destroy(t),0==(e._duplexState&$$1)&&(e._duplexState|=D$1,e.emit("finish")),(e._duplexState&et)===Z$1&&(e._duplexState|=4),e._duplexState&=H$1,0==(e._duplexState&O$1)?this.update():this.updateNextTick();}function ft(t){const e=this.stream;t||this.error===f$6||(t=this.error),t&&e.emit("error",t),e._duplexState|=8,e.emit("close");const i=e._readableState,r=e._writableState;if(null!==i&&null!==i.pipeline&&i.pipeline.done(e,t),null!==r){for(;null!==r.drains&&r.drains.length>0;)r.drains.shift().resolve(!1);null!==r.pipeline&&r.pipeline.done(e,t);}}function _t(t){const e=this.stream;t&&e.destroy(t),e._duplexState&=H$1,null!==this.drains&&function(t){for(let e=0;e<t.length;e++)0==--t[e].writes&&(t.shift().resolve(!0),e--);}(this.drains),(6553615&e._duplexState)===j$1&&(e._duplexState&=532676607,(e._duplexState&B$1)===B$1&&e.emit("drain")),this.updateCallback();}function ct(t){t&&this.stream.destroy(t),this.stream._duplexState&=536870895,!1===this.readAhead&&0==(this.stream._duplexState&v$1)&&(this.stream._duplexState&=q$1),this.updateCallback();}function St(){0==(32&this.stream._duplexState)&&(this.stream._duplexState&=A$1,this.update());}function mt(){0==(this.stream._duplexState&O$1)&&(this.stream._duplexState&=Q$1,this.update());}function xt(t){const e=this.stream;t&&e.destroy(t),0==(4&e._duplexState)&&(0==(17423&e._duplexState)&&(e._duplexState|=w$3),0==(142606351&e._duplexState)&&(e._duplexState|=F$1),e.emit("open")),e._duplexState&=Y$1,null!==e._writableState&&e._writableState.updateCallback(),null!==e._readableState&&e._readableState.updateCallback();}function bt(t,e){null!=e&&this.push(e),this._writableState.afterWrite(t);}function wt(t){null!==this._readableState&&("data"===t&&(this._duplexState|=133376,this._readableState.updateNextTick()),"readable"===t&&(this._duplexState|=T$1,this._readableState.updateNextTick())),null!==this._writableState&&"drain"===t&&(this._duplexState|=B$1,this._writableState.updateNextTick());}class yt extends p$3{constructor(t){super(),this._duplexState=0,this._readableState=null,this._writableState=null,t&&(t.open&&(this._open=t.open),t.destroy&&(this._destroy=t.destroy),t.predestroy&&(this._predestroy=t.predestroy),t.signal&&t.signal.addEventListener("abort",At.bind(this))),this.on("newListener",wt);}_open(t){t(null);}_destroy(t){t(null);}_predestroy(){}get readable(){return null!==this._readableState||void 0}get writable(){return null!==this._writableState||void 0}get destroyed(){return 0!=(8&this._duplexState)}get destroying(){return 0!=(this._duplexState&$$1)}destroy(t){0==(this._duplexState&$$1)&&(t||(t=f$6),this._duplexState=535822271&(4|this._duplexState),null!==this._readableState&&(this._readableState.highWaterMark=0,this._readableState.error=t),null!==this._writableState&&(this._writableState.highWaterMark=0,this._writableState.error=t),this._duplexState|=2,this._predestroy(),this._duplexState&=536870909,null!==this._readableState&&this._readableState.updateNextTick(),null!==this._writableState&&this._writableState.updateNextTick());}}class vt extends yt{constructor(t){super(t),this._duplexState|=8519681,this._readableState=new ut(this,t),t&&(!1===this._readableState.readAhead&&(this._duplexState&=q$1),t.read&&(this._read=t.read),t.eagerOpen&&this._readableState.updateNextTick(),t.encoding&&this.setEncoding(t.encoding));}setEncoding(t){const e=new m$1(t),i=this._readableState.map||Nt;return this._readableState.map=function(t){const r=e.push(t);return ""===r&&(0!==t.byteLength||e.remaining>0)?null:i(r)},this}_read(t){t(null);}pipe(t,e){return this._readableState.updateNextTick(),this._readableState.pipe(t,e),t}read(){return this._readableState.updateNextTick(),this._readableState.read()}push(t){return this._readableState.updateNextTick(),this._readableState.push(t)}unshift(t){return this._readableState.updateNextTick(),this._readableState.unshift(t)}resume(){return this._duplexState|=W$1,this._readableState.updateNextTick(),this}pause(){return this._duplexState&=!1===this._readableState.readAhead?536739583:536870655,this}static _fromAsyncIterator(t,e){let i;const r=new vt({...e,read(e){t.next().then(n).then(e.bind(null,null)).catch(e);},predestroy(){i=t.return();},destroy(t){if(!i)return t(null);i.then(t.bind(null,null)).catch(t);}});return r;function n(t){t.done?r.push(null):r.push(t.value);}}static from(t,e){if(Wt(i=t)&&i.readable)return t;var i;if(t[at])return this._fromAsyncIterator(t[at](),e);Array.isArray(t)||(t=void 0===t?[]:[t]);let r=0;return new vt({...e,read(e){this.push(r===t.length?null:t[r++]),e(null);}})}static isBackpressured(t){return 0!=(17422&t._duplexState)||t._readableState.buffered>=t._readableState.highWaterMark}static isPaused(t){return 0==(t._duplexState&v$1)}[at](){const t=this;let e=null,i=null,r=null;return this.on("error",(t=>{e=t;})),this.on("readable",(function(){null!==i&&n(t.read());})),this.on("close",(function(){null!==i&&n(null);})),{[at](){return this},next:()=>new Promise((function(e,s){i=e,r=s;const a=t.read();null!==a?n(a):0!=(8&t._duplexState)&&n(null);})),return:()=>s(null),throw:t=>s(t)};function n(n){null!==r&&(e?r(e):null===n&&0==(t._duplexState&E$2)?r(f$6):i({value:n,done:null===n}),r=i=null);}function s(e){return t.destroy(e),new Promise(((i,r)=>{if(8&t._duplexState)return i({value:void 0,done:!0});t.once("close",(function(){e?r(e):i({value:void 0,done:!0});}));}))}}}class gt extends yt{constructor(t){super(t),this._duplexState|=16385,this._writableState=new lt(this,t),t&&(t.writev&&(this._writev=t.writev),t.write&&(this._write=t.write),t.final&&(this._final=t.final),t.eagerOpen&&this._writableState.updateNextTick());}cork(){this._duplexState|=G$1;}uncork(){this._duplexState&=V$1,this._writableState.updateNextTick();}_writev(t,e){e(null);}_write(t,e){this._writableState.autoBatch(t,e);}_final(t){t(null);}static isBackpressured(t){return 0!=(146800654&t._duplexState)}static drained(t){if(t.destroyed)return Promise.resolve(!1);const e=t._writableState;var i;const r=((i=t)._writev!==gt.prototype._writev&&i._writev!==kt.prototype._writev?Math.min(1,e.queue.length):e.queue.length)+(t._duplexState&z$1?1:0);return 0===r?Promise.resolve(!0):(null===e.drains&&(e.drains=[]),new Promise((t=>{e.drains.push({writes:r,resolve:t});})))}write(t){return this._writableState.updateNextTick(),this._writableState.push(t)}end(t){return this._writableState.updateNextTick(),this._writableState.end(t),this}}class kt extends vt{constructor(t){super(t),this._duplexState=1|this._duplexState&P$1,this._writableState=new lt(this,t),t&&(t.writev&&(this._writev=t.writev),t.write&&(this._write=t.write),t.final&&(this._final=t.final));}cork(){this._duplexState|=G$1;}uncork(){this._duplexState&=V$1,this._writableState.updateNextTick();}_writev(t,e){e(null);}_write(t,e){this._writableState.autoBatch(t,e);}_final(t){t(null);}write(t){return this._writableState.updateNextTick(),this._writableState.push(t)}end(t){return this._writableState.updateNextTick(),this._writableState.end(t),this}}class Tt extends kt{constructor(t){super(t),this._transformState=new ht(this),t&&(t.transform&&(this._transform=t.transform),t.flush&&(this._flush=t.flush));}_write(t,e){this._readableState.buffered>=this._readableState.highWaterMark?this._transformState.data=t:this._transform(t,this._transformState.afterTransform);}_read(t){if(null!==this._transformState.data){const e=this._transformState.data;this._transformState.data=null,t(null),this._transform(e,this._transformState.afterTransform);}else t(null);}destroy(t){super.destroy(t),null!==this._transformState.data&&(this._transformState.data=null,this._transformState.afterTransform());}_transform(t,e){e(null,t);}_flush(t){t(null);}_final(t){this._transformState.afterFinal=t,this._flush(Lt.bind(this));}}function Lt(t,e){const i=this._transformState.afterFinal;if(t)return i(t);null!=e&&this.push(e),this.push(null),i(null);}function Et(t,...e){const i=Array.isArray(t)?[...t,...e]:[t,...e],r=i.length&&"function"==typeof i[i.length-1]?i.pop():null;if(i.length<2)throw new Error("Pipeline requires at least 2 streams");let n=i[0],s=null,a=null;for(let t=1;t<i.length;t++)s=i[t],Wt(n)?n.pipe(s,u):(l(n,!0,t>1,u),n.pipe(s)),n=s;if(r){let t=!1;const e=Wt(s)||!(!s._writableState||!s._writableState.autoDestroy);s.on("error",(t=>{null===a&&(a=t);})),s.on("finish",(()=>{t=!0,e||r(a);})),e&&s.on("close",(()=>r(a||(t?null:_$1))));}return s;function l(t,e,i,r){t.on("error",r),t.on("close",(function(){if(t._readableState&&!t._readableState.ended)return r(_$1);if(i&&t._writableState&&!t._writableState.ended)return r(_$1)}));}function u(t){if(t&&!a){a=t;for(const e of i)e.destroy(t);}}}function Nt(t){return t}function Pt(t){return !!t._readableState||!!t._writableState}function Wt(t){return "number"==typeof t._duplexState&&Pt(t)}function Ct(t){return function(t){return "object"==typeof t&&null!==t&&"number"==typeof t.byteLength}(t)?t.byteLength:1024}function Mt(){}function At(){this.destroy(new Error("Stream aborted."));}var qt={pipeline:Et,pipelinePromise:function(...t){return new Promise(((e,i)=>Et(...t,(t=>{if(t)return i(t);e();}))))},isStream:Pt,isStreamx:Wt,isEnded:function(t){return !!t._readableState&&t._readableState.ended},isFinished:function(t){return !!t._writableState&&t._writableState.ended},getStreamError:function(t,e={}){const i=t._readableState&&t._readableState.error||t._writableState&&t._writableState.error;return e.all||i!==f$6?i:null},Stream:yt,Writable:gt,Readable:vt,Duplex:kt,Transform:Tt,PassThrough:class extends Tt{}};

/**
 * Bundled by jsDelivr using Rollup v2.79.1 and Terser v5.19.2.
 * Original file: /npm/mutexify@1.4.0/promise.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
var n$8=e$7,r$8=function(){var e=[],r=null,t=function(){r(o);},u=function(o){return r?e.push(o):(r=o,u.locked=!0,n$8(t),0)};u.locked=!1;var o=function(n,t,o){r=null,u.locked=!1,e.length&&u(e.shift()),n&&n(t,o);};return u},t$8=function(){var e=r$8(),n=function(){return new Promise(e)};return Object.defineProperty(n,"locked",{get:function(){return e.locked},enumerable:!0}),n};

/**
 * Bundled by jsDelivr using Rollup v2.79.1 and Terser v5.19.2.
 * Original file: /npm/b4a@1.6.7/browser.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
var t$7={exports:{}};function e$5(t){return t.length}var n$7={byteLength:e$5,toString:function(t){const e=t.byteLength;let n="";for(let r=0;r<e;r++)n+=String.fromCharCode(t[r]);return n},write:function(t,n,r=0,o=e$5(n)){const f=Math.min(o,t.byteLength-r);for(let e=0;e<f;e++)t[r+e]=n.charCodeAt(e);return f}};const r$7="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o$4=new Uint8Array(256);for(let t=0;t<64;t++)o$4[r$7.charCodeAt(t)]=t;function f$5(t){let e=t.length;return 61===t.charCodeAt(e-1)&&e--,e>1&&61===t.charCodeAt(e-1)&&e--,3*e>>>2}o$4[45]=62,o$4[95]=63;var i$4={byteLength:f$5,toString:function(t){const e=t.byteLength;let n="";for(let o=0;o<e;o+=3)n+=r$7[t[o]>>2]+r$7[(3&t[o])<<4|t[o+1]>>4]+r$7[(15&t[o+1])<<2|t[o+2]>>6]+r$7[63&t[o+2]];return e%3==2?n=n.substring(0,n.length-1)+"=":e%3==1&&(n=n.substring(0,n.length-2)+"=="),n},write:function(t,e,n=0,r=f$5(e)){const i=Math.min(r,t.byteLength-n);for(let n=0,r=0;r<i;n+=4){const f=o$4[e.charCodeAt(n)],i=o$4[e.charCodeAt(n+1)],u=o$4[e.charCodeAt(n+2)],a=o$4[e.charCodeAt(n+3)];t[r++]=f<<2|i>>4,t[r++]=(15&i)<<4|u>>2,t[r++]=(3&u)<<6|63&a;}return i}};function u$5(t){return t.length>>>1}var a$4={byteLength:u$5,toString:function(t){const e=t.byteLength;t=new DataView(t.buffer,t.byteOffset,e);let n="",r=0;for(let o=e-e%4;r<o;r+=4)n+=t.getUint32(r).toString(16).padStart(8,"0");for(;r<e;r++)n+=t.getUint8(r).toString(16).padStart(2,"0");return n},write:function(t,e,n=0,r=u$5(e)){const o=Math.min(r,t.byteLength-n);for(let r=0;r<o;r++){const o=b$2(e.charCodeAt(2*r)),f=b$2(e.charCodeAt(2*r+1));if(void 0===o||void 0===f)return t.subarray(0,r);t[n+r]=o<<4|f;}return o}};function b$2(t){return t>=48&&t<=57?t-48:t>=65&&t<=70?t-65+10:t>=97&&t<=102?t-97+10:void 0}function c$3(t){let e=0;for(let n=0,r=t.length;n<r;n++){const o=t.charCodeAt(n);if(o>=55296&&o<=56319&&n+1<r){const r=t.charCodeAt(n+1);if(r>=56320&&r<=57343){e+=4,n++;continue}}e+=o<=127?1:o<=2047?2:3;}return e}let g$4,s$4;if("undefined"!=typeof TextDecoder){const t=new TextDecoder;g$4=function(e){return t.decode(e)};}else g$4=function(t){const e=t.byteLength;let n="",r=0;for(;r<e;){let o=t[r];if(o<=127){n+=String.fromCharCode(o),r++;continue}let f=0,i=0;if(o<=223?(f=1,i=31&o):o<=239?(f=2,i=15&o):o<=244&&(f=3,i=7&o),e-r-f>0){let e=0;for(;e<f;)o=t[r+e+1],i=i<<6|63&o,e+=1;}else i=65533,f=e-r;n+=String.fromCodePoint(i),r+=f+1;}return n};if("undefined"!=typeof TextEncoder){const t=new TextEncoder;s$4=function(e,n,r=0,o=c$3(n)){const f=Math.min(o,e.byteLength-r);return t.encodeInto(n,e.subarray(r,r+f)),f};}else s$4=function(t,e,n=0,r=c$3(e)){const o=Math.min(r,t.byteLength-n);t=t.subarray(n,n+o);let f=0,i=0;for(;f<e.length;){const n=e.codePointAt(f);if(n<=127){t[i++]=n,f++;continue}let r=0,o=0;for(n<=2047?(r=6,o=192):n<=65535?(r=12,o=224):n<=2097151&&(r=18,o=240),t[i++]=o|n>>r,r-=6;r>=0;)t[i++]=128|n>>r&63,r-=6;f+=n>=65536?2:1;}return o};var y$2={byteLength:c$3,toString:g$4,write:s$4};function h$3(t){return 2*t.length}var l$3={byteLength:h$3,toString:function(t){const e=t.byteLength;let n="";for(let r=0;r<e-1;r+=2)n+=String.fromCharCode(t[r]+256*t[r+1]);return n},write:function(t,e,n=0,r=h$3(e)){const o=Math.min(r,t.byteLength-n);let f=o;for(let r=0;r<e.length&&!((f-=2)<0);++r){const o=e.charCodeAt(r),f=o>>8,i=o%256;t[n+2*r]=i,t[n+2*r+1]=f;}return o}};!function(t,e){const r=n$7,o=i$4,f=a$4,u=y$2,b=l$3,c=255===new Uint8Array(Uint16Array.of(255).buffer)[0];function g(t){switch(t){case"ascii":return r;case"base64":return o;case"hex":return f;case"utf8":case"utf-8":case void 0:case null:return u;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return b;default:throw new Error(`Unknown encoding: ${t}`)}}function s(t){return t instanceof Uint8Array}function h(t,e,n){return "string"==typeof t?function(t,e){const n=g(e),r=new Uint8Array(n.byteLength(t));return n.write(r,t,0,r.byteLength),r}(t,e):Array.isArray(t)?function(t){const e=new Uint8Array(t.length);return e.set(t),e}(t):ArrayBuffer.isView(t)?function(t){const e=new Uint8Array(t.byteLength);return e.set(t),e}(t):function(t,e,n){return new Uint8Array(t,e,n)}(t,e,n)}function L(t,e,n,r,o){if(0===t.byteLength)return -1;if("string"==typeof n?(r=n,n=0):void 0===n?n=o?0:t.length-1:n<0&&(n+=t.byteLength),n>=t.byteLength){if(o)return -1;n=t.byteLength-1;}else if(n<0){if(!o)return -1;n=0;}if("string"==typeof e)e=h(e,r);else if("number"==typeof e)return e&=255,o?t.indexOf(e,n):t.lastIndexOf(e,n);if(0===e.byteLength)return -1;if(o){let r=-1;for(let o=n;o<t.byteLength;o++)if(t[o]===e[-1===r?0:o-r]){if(-1===r&&(r=o),o-r+1===e.byteLength)return r}else -1!==r&&(o-=o-r),r=-1;}else {n+e.byteLength>t.byteLength&&(n=t.byteLength-e.byteLength);for(let r=n;r>=0;r--){let n=!0;for(let o=0;o<e.byteLength;o++)if(t[r+o]!==e[o]){n=!1;break}if(n)return r}}return -1}function w(t,e,n,r){return L(t,e,n,r,!0)}function d(t,e,n){const r=t[e];t[e]=t[n],t[n]=r;}t.exports=e={isBuffer:s,isEncoding:function(t){try{return g(t),!0}catch{return !1}},alloc:function(t,n,r){const o=new Uint8Array(t);return void 0!==n&&e.fill(o,n,0,o.byteLength,r),o},allocUnsafe:function(t){return new Uint8Array(t)},allocUnsafeSlow:function(t){return new Uint8Array(t)},byteLength:function(t,e){return g(e).byteLength(t)},compare:function(t,e){if(t===e)return 0;const n=Math.min(t.byteLength,e.byteLength);t=new DataView(t.buffer,t.byteOffset,t.byteLength),e=new DataView(e.buffer,e.byteOffset,e.byteLength);let r=0;for(let o=n-n%4;r<o;r+=4){if(t.getUint32(r,c)!==e.getUint32(r,c))break}for(;r<n;r++){const n=t.getUint8(r),o=e.getUint8(r);if(n<o)return -1;if(n>o)return 1}return t.byteLength>e.byteLength?1:t.byteLength<e.byteLength?-1:0},concat:function(t,e){void 0===e&&(e=t.reduce(((t,e)=>t+e.byteLength),0));const n=new Uint8Array(e);let r=0;for(const e of t){if(r+e.byteLength>n.byteLength){const t=e.subarray(0,n.byteLength-r);return n.set(t,r),n}n.set(e,r),r+=e.byteLength;}return n},copy:function(t,e,n=0,r=0,o=t.byteLength){if(o>0&&o<r)return 0;if(o===r)return 0;if(0===t.byteLength||0===e.byteLength)return 0;if(n<0)throw new RangeError("targetStart is out of range");if(r<0||r>=t.byteLength)throw new RangeError("sourceStart is out of range");if(o<0)throw new RangeError("sourceEnd is out of range");n>=e.byteLength&&(n=e.byteLength),o>t.byteLength&&(o=t.byteLength),e.byteLength-n<o-r&&(o=e.length-n+r);const f=o-r;return t===e?e.copyWithin(n,r,o):e.set(t.subarray(r,o),n),f},equals:function(t,e){if(t===e)return !0;if(t.byteLength!==e.byteLength)return !1;const n=t.byteLength;t=new DataView(t.buffer,t.byteOffset,t.byteLength),e=new DataView(e.buffer,e.byteOffset,e.byteLength);let r=0;for(let o=n-n%4;r<o;r+=4)if(t.getUint32(r,c)!==e.getUint32(r,c))return !1;for(;r<n;r++)if(t.getUint8(r)!==e.getUint8(r))return !1;return !0},fill:function(t,e,n,r,o){if("string"==typeof e?"string"==typeof n?(o=n,n=0,r=t.byteLength):"string"==typeof r&&(o=r,r=t.byteLength):"number"==typeof e?e&=255:"boolean"==typeof e&&(e=+e),n<0||t.byteLength<n||t.byteLength<r)throw new RangeError("Out of range index");if(void 0===n&&(n=0),void 0===r&&(r=t.byteLength),r<=n)return t;if(e||(e=0),"number"==typeof e)for(let o=n;o<r;++o)t[o]=e;else {const f=(e=s(e)?e:h(e,o)).byteLength;for(let o=0;o<r-n;++o)t[o+n]=e[o%f];}return t},from:h,includes:function(t,e,n,r){return -1!==w(t,e,n,r)},indexOf:w,lastIndexOf:function(t,e,n,r){return L(t,e,n,r,!1)},swap16:function(t){const e=t.byteLength;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let n=0;n<e;n+=2)d(t,n,n+1);return t},swap32:function(t){const e=t.byteLength;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let n=0;n<e;n+=4)d(t,n,n+3),d(t,n+1,n+2);return t},swap64:function(t){const e=t.byteLength;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let n=0;n<e;n+=8)d(t,n,n+7),d(t,n+1,n+6),d(t,n+2,n+5),d(t,n+3,n+4);return t},toBuffer:function(t){return t},toString:function(t,e,n=0,r=t.byteLength){const o=t.byteLength;return n>=o||r<=n?"":(n<0&&(n=0),r>o&&(r=o),(0!==n||r<o)&&(t=t.subarray(n,r)),g(e).toString(t))},write:function(t,e,n,r,o){return void 0===n?o="utf8":void 0===r&&"string"==typeof n?(o=n,n=void 0):void 0===o&&"string"==typeof r&&(o=r,r=void 0),g(o).write(t,e,n,r)},writeDoubleLE:function(t,e,n){return void 0===n&&(n=0),new DataView(t.buffer,t.byteOffset,t.byteLength).setFloat64(n,e,!0),n+8},writeFloatLE:function(t,e,n){return void 0===n&&(n=0),new DataView(t.buffer,t.byteOffset,t.byteLength).setFloat32(n,e,!0),n+4},writeUInt32LE:function(t,e,n){return void 0===n&&(n=0),new DataView(t.buffer,t.byteOffset,t.byteLength).setUint32(n,e,!0),n+4},writeInt32LE:function(t,e,n){return void 0===n&&(n=0),new DataView(t.buffer,t.byteOffset,t.byteLength).setInt32(n,e,!0),n+4},readDoubleLE:function(t,e){return void 0===e&&(e=0),new DataView(t.buffer,t.byteOffset,t.byteLength).getFloat64(e,!0)},readFloatLE:function(t,e){return void 0===e&&(e=0),new DataView(t.buffer,t.byteOffset,t.byteLength).getFloat32(e,!0)},readUInt32LE:function(t,e){return void 0===e&&(e=0),new DataView(t.buffer,t.byteOffset,t.byteLength).getUint32(e,!0)},readInt32LE:function(t,e){return void 0===e&&(e=0),new DataView(t.buffer,t.byteOffset,t.byteLength).getInt32(e,!0)},writeDoubleBE:function(t,e,n){return void 0===n&&(n=0),new DataView(t.buffer,t.byteOffset,t.byteLength).setFloat64(n,e,!1),n+8},writeFloatBE:function(t,e,n){return void 0===n&&(n=0),new DataView(t.buffer,t.byteOffset,t.byteLength).setFloat32(n,e,!1),n+4},writeUInt32BE:function(t,e,n){return void 0===n&&(n=0),new DataView(t.buffer,t.byteOffset,t.byteLength).setUint32(n,e,!1),n+4},writeInt32BE:function(t,e,n){return void 0===n&&(n=0),new DataView(t.buffer,t.byteOffset,t.byteLength).setInt32(n,e,!1),n+4},readDoubleBE:function(t,e){return void 0===e&&(e=0),new DataView(t.buffer,t.byteOffset,t.byteLength).getFloat64(e,!1)},readFloatBE:function(t,e){return void 0===e&&(e=0),new DataView(t.buffer,t.byteOffset,t.byteLength).getFloat32(e,!1)},readUInt32BE:function(t,e){return void 0===e&&(e=0),new DataView(t.buffer,t.byteOffset,t.byteLength).getUint32(e,!1)},readInt32BE:function(t,e){return void 0===e&&(e=0),new DataView(t.buffer,t.byteOffset,t.byteLength).getInt32(e,!1)}};}(t$7,t$7.exports);var L$2=t$7.exports;

/**
 * Bundled by jsDelivr using Rollup v2.79.1 and Terser v5.19.2.
 * Original file: /npm/safety-catch@1.0.2/index.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
var r$6=function(r){if(function(r){return !!r&&(r instanceof TypeError||r instanceof SyntaxError||r instanceof ReferenceError||r instanceof EvalError||r instanceof RangeError||r instanceof URIError||"ERR_ASSERTION"===r.code)}(r))throw function(r){queueMicrotask((()=>{throw r}));}(r),r};

/**
 * Bundled by jsDelivr using Rollup v2.79.1 and Terser v5.19.2.
 * Original file: /npm/ready-resource@1.1.1/index.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
function e$4(e){return e&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function t$6(){}function n$6(){n$6.init.call(this);}function r$5(e){return void 0===e._maxListeners?n$6.defaultMaxListeners:e._maxListeners}function i$3(e,n,i,s){var o,u,l,f;if("function"!=typeof i)throw new TypeError('"listener" argument must be a function');if((u=e._events)?(u.newListener&&(e.emit("newListener",n,i.listener?i.listener:i),u=e._events),l=u[n]):(u=e._events=new t$6,e._eventsCount=0),l){if("function"==typeof l?l=u[n]=s?[i,l]:[l,i]:s?l.unshift(i):l.push(i),!l.warned&&(o=r$5(e))&&o>0&&l.length>o){l.warned=!0;var a=new Error("Possible EventEmitter memory leak detected. "+l.length+" "+n+" listeners added. Use emitter.setMaxListeners() to increase limit");a.name="MaxListenersExceededWarning",a.emitter=e,a.type=n,a.count=l.length,f=a,"function"==typeof console.warn?console.warn(f):console.log(f);}}else l=u[n]=i,++e._eventsCount;return e}function s$3(e,t,n){var r=!1;function i(){e.removeListener(t,i),r||(r=!0,n.apply(e,arguments));}return i.listener=n,i}function o$3(e){var t=this._events;if(t){var n=t[e];if("function"==typeof n)return 1;if(n)return n.length}return 0}function u$4(e,t){for(var n=new Array(t);t--;)n[t]=e[t];return n}t$6.prototype=Object.create(null),n$6.EventEmitter=n$6,n$6.usingDomains=!1,n$6.prototype.domain=void 0,n$6.prototype._events=void 0,n$6.prototype._maxListeners=void 0,n$6.defaultMaxListeners=10,n$6.init=function(){this.domain=null,n$6.usingDomains&&undefined.active,this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=new t$6,this._eventsCount=0),this._maxListeners=this._maxListeners||void 0;},n$6.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=e,this},n$6.prototype.getMaxListeners=function(){return r$5(this)},n$6.prototype.emit=function(e){var t,n,r,i,s,o,l,f="error"===e;if(o=this._events)f=f&&null==o.error;else if(!f)return !1;if(l=this.domain,f){if(t=arguments[1],!l){if(t instanceof Error)throw t;var a=new Error('Uncaught, unspecified "error" event. ('+t+")");throw a.context=t,a}return t||(t=new Error('Uncaught, unspecified "error" event')),t.domainEmitter=this,t.domain=l,t.domainThrown=!1,l.emit("error",t),!1}if(!(n=o[e]))return !1;var c="function"==typeof n;switch(r=arguments.length){case 1:!function(e,t,n){if(t)e.call(n);else for(var r=e.length,i=u$4(e,r),s=0;s<r;++s)i[s].call(n);}(n,c,this);break;case 2:!function(e,t,n,r){if(t)e.call(n,r);else for(var i=e.length,s=u$4(e,i),o=0;o<i;++o)s[o].call(n,r);}(n,c,this,arguments[1]);break;case 3:!function(e,t,n,r,i){if(t)e.call(n,r,i);else for(var s=e.length,o=u$4(e,s),l=0;l<s;++l)o[l].call(n,r,i);}(n,c,this,arguments[1],arguments[2]);break;case 4:!function(e,t,n,r,i,s){if(t)e.call(n,r,i,s);else for(var o=e.length,l=u$4(e,o),f=0;f<o;++f)l[f].call(n,r,i,s);}(n,c,this,arguments[1],arguments[2],arguments[3]);break;default:for(i=new Array(r-1),s=1;s<r;s++)i[s-1]=arguments[s];!function(e,t,n,r){if(t)e.apply(n,r);else for(var i=e.length,s=u$4(e,i),o=0;o<i;++o)s[o].apply(n,r);}(n,c,this,i);}return !0},n$6.prototype.addListener=function(e,t){return i$3(this,e,t,!1)},n$6.prototype.on=n$6.prototype.addListener,n$6.prototype.prependListener=function(e,t){return i$3(this,e,t,!0)},n$6.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.on(e,s$3(this,e,t)),this},n$6.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.prependListener(e,s$3(this,e,t)),this},n$6.prototype.removeListener=function(e,n){var r,i,s,o,u;if("function"!=typeof n)throw new TypeError('"listener" argument must be a function');if(!(i=this._events))return this;if(!(r=i[e]))return this;if(r===n||r.listener&&r.listener===n)0==--this._eventsCount?this._events=new t$6:(delete i[e],i.removeListener&&this.emit("removeListener",e,r.listener||n));else if("function"!=typeof r){for(s=-1,o=r.length;o-- >0;)if(r[o]===n||r[o].listener&&r[o].listener===n){u=r[o].listener,s=o;break}if(s<0)return this;if(1===r.length){if(r[0]=void 0,0==--this._eventsCount)return this._events=new t$6,this;delete i[e];}else !function(e,t){for(var n=t,r=n+1,i=e.length;r<i;n+=1,r+=1)e[n]=e[r];e.pop();}(r,s);i.removeListener&&this.emit("removeListener",e,u||n);}return this},n$6.prototype.off=function(e,t){return this.removeListener(e,t)},n$6.prototype.removeAllListeners=function(e){var n,r;if(!(r=this._events))return this;if(!r.removeListener)return 0===arguments.length?(this._events=new t$6,this._eventsCount=0):r[e]&&(0==--this._eventsCount?this._events=new t$6:delete r[e]),this;if(0===arguments.length){for(var i,s=Object.keys(r),o=0;o<s.length;++o)"removeListener"!==(i=s[o])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=new t$6,this._eventsCount=0,this}if("function"==typeof(n=r[e]))this.removeListener(e,n);else if(n)do{this.removeListener(e,n[n.length-1]);}while(n[0]);return this},n$6.prototype.listeners=function(e){var t,n=this._events;return n&&(t=n[e])?"function"==typeof t?[t.listener||t]:function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(t):[]},n$6.listenerCount=function(e,t){return "function"==typeof e.listenerCount?e.listenerCount(t):o$3.call(e,t)},n$6.prototype.listenerCount=o$3,n$6.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};const l$2=e$4(Object.freeze({__proto__:null,default:n$6,EventEmitter:n$6}));var f$4=class f extends l$2{constructor(){super(),this.opening=null,this.closing=null,this.opened=!1,this.closed=!1;}ready(){return null!==this.opening||(this.opening=async function(e){try{await e._open();}catch(t){throw e.close(),t}e.opened=!0,e.emit("ready");}(this)),this.opening}close(){return null!==this.closing||(this.closing=async function(e){try{!1===e.opened&&null!==e.opening&&await e.opening;}catch{}!0!==e.opened&&null!==e.opening||await e._close();e.closed=!0,e.emit("close");}(this)),this.closing}async _open(){}async _close(){}};

/**
 * Bundled by jsDelivr using Rollup v2.79.1 and Terser v5.19.2.
 * Original file: /npm/debounceify@1.1.0/index.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
var n$5=function(n,u=null){return r.running=null,r;async function r(){if(null!==r.running)try{await r.running;}catch(n){}if(null!==r.running)return r.running;r.running=n.call(u);try{return await r.running}finally{r.running=null;}}};

/**
 * Bundled by jsDelivr using Rollup v2.79.1 and Terser v5.19.2.
 * Original file: /npm/rache@1.0.0/index.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
let t$5 = class t{constructor(t,e,a){this.key=t,this.index=e,this.map=a;}};let e$3 = class e{constructor(t,e){this.entry=t,this.value=e;}};let a$3 = class a{constructor({maxSize:t=65536,parent:e=null}={}){this.maxSize=e?.maxSize||t,this._array=e?._array||[],this._map=new Map;}static from(t){return t?new this({parent:t}):new this}get globalSize(){return this._array.length}get size(){return this._map.size}sub(){return new a({parent:this})}set(a,r){const s=this._map.get(a);if(void 0!==s)return void(s.value=r);this._array.length>=this.maxSize&&this._gc();const i=new t$5(a,this._array.length,this._map);this._array.push(i);const n=new e$3(i,r);this._map.set(a,n);}delete(t){const e=this._map.get(t);return void 0!==e&&(this._delete(e.entry.index),!0)}get(t){const e=this._map.get(t);return void 0===e?void 0:e.value}*[Symbol.iterator](){for(const[t,{value:e}]of this._map)yield [t,e];}keys(){return this._map.keys()}*values(){for(const{value:t}of this._map.values())yield t;}clear(){this._map.clear(),this._map=new Map;}destroy(){this._map=null,this._array=null;}_gc(){this._delete(Math.floor(Math.random()*this._array.length));}_delete(t){if(t>=this._array.length)throw new Error("Cannot delete unused index (logic bug?)");const e=this._array.pop();let a=e;t<this._array.length&&(a=this._array[t],e.index=t,this._array[t]=e),a.map.delete(a.key);}};var r$4=a$3;

/**
 * Bundled by jsDelivr using Rollup v2.79.1 and Terser v5.19.2.
 * Original file: /npm/b4a@1.6.6/browser.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
var t$4={exports:{}};function e$2(t){return t.length}var n$4={byteLength:e$2,toString:function(t){const e=t.byteLength;let n="";for(let r=0;r<e;r++)n+=String.fromCharCode(t[r]);return n},write:function(t,n,r=0,o=e$2(n)){const f=Math.min(o,t.byteLength-r);for(let e=0;e<f;e++)t[r+e]=n.charCodeAt(e);return f}};const r$3="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o$2=new Uint8Array(256);for(let t=0;t<64;t++)o$2[r$3.charCodeAt(t)]=t;function f$3(t){let e=t.length;return 61===t.charCodeAt(e-1)&&e--,e>1&&61===t.charCodeAt(e-1)&&e--,3*e>>>2}o$2[45]=62,o$2[95]=63;var i$2={byteLength:f$3,toString:function(t){const e=t.byteLength;let n="";for(let o=0;o<e;o+=3)n+=r$3[t[o]>>2]+r$3[(3&t[o])<<4|t[o+1]>>4]+r$3[(15&t[o+1])<<2|t[o+2]>>6]+r$3[63&t[o+2]];return e%3==2?n=n.substring(0,n.length-1)+"=":e%3==1&&(n=n.substring(0,n.length-2)+"=="),n},write:function(t,e,n=0,r=f$3(e)){const i=Math.min(r,t.byteLength-n);for(let n=0,r=0;r<i;n+=4){const f=o$2[e.charCodeAt(n)],i=o$2[e.charCodeAt(n+1)],u=o$2[e.charCodeAt(n+2)],a=o$2[e.charCodeAt(n+3)];t[r++]=f<<2|i>>4,t[r++]=(15&i)<<4|u>>2,t[r++]=(3&u)<<6|63&a;}return i}};function u$3(t){return t.length>>>1}var a$2={byteLength:u$3,toString:function(t){const e=t.byteLength;t=new DataView(t.buffer,t.byteOffset,e);let n="",r=0;for(let o=e-e%4;r<o;r+=4)n+=t.getUint32(r).toString(16).padStart(8,"0");for(;r<e;r++)n+=t.getUint8(r).toString(16).padStart(2,"0");return n},write:function(t,e,n=0,r=u$3(e)){const o=Math.min(r,t.byteLength-n);for(let r=0;r<o;r++){const o=c$2(e.charCodeAt(2*r)),f=c$2(e.charCodeAt(2*r+1));if(void 0===o||void 0===f)return t.subarray(0,r);t[n+r]=o<<4|f;}return o}};function c$2(t){return t>=48&&t<=57?t-48:t>=65&&t<=70?t-65+10:t>=97&&t<=102?t-97+10:void 0}function g$3(t){let e=0;for(let n=0,r=t.length;n<r;n++){const o=t.charCodeAt(n);if(o>=55296&&o<=56319&&n+1<r){const r=t.charCodeAt(n+1);if(r>=56320&&r<=57343){e+=4,n++;continue}}e+=o<=127?1:o<=2047?2:3;}return e}let s$2,y$1;if("undefined"!=typeof TextDecoder){const t=new TextDecoder;s$2=function(e){return t.decode(e)};}else s$2=function(t){const e=t.byteLength;let n="",r=0;for(;r<e;){let o=t[r];if(o<=127){n+=String.fromCharCode(o),r++;continue}let f=0,i=0;if(o<=223?(f=1,i=31&o):o<=239?(f=2,i=15&o):o<=244&&(f=3,i=7&o),e-r-f>0){let e=0;for(;e<f;)o=t[r+e+1],i=i<<6|63&o,e+=1;}else i=65533,f=e-r;n+=String.fromCodePoint(i),r+=f+1;}return n};if("undefined"!=typeof TextEncoder){const t=new TextEncoder;y$1=function(e,n,r=0,o=g$3(n)){const f=Math.min(o,e.byteLength-r);return t.encodeInto(n,e.subarray(r,r+f)),f};}else y$1=function(t,e,n=0,r=g$3(e)){const o=Math.min(r,t.byteLength-n);t=t.subarray(n,n+o);let f=0,i=0;for(;f<e.length;){const n=e.codePointAt(f);if(n<=127){t[i++]=n,f++;continue}let r=0,o=0;for(n<=2047?(r=6,o=192):n<=65535?(r=12,o=224):n<=2097151&&(r=18,o=240),t[i++]=o|n>>r,r-=6;r>=0;)t[i++]=128|n>>r&63,r-=6;f+=n>=65536?2:1;}return o};var b$1={byteLength:g$3,toString:s$2,write:y$1};function h$2(t){return 2*t.length}var l$1={byteLength:h$2,toString:function(t){const e=t.byteLength;let n="";for(let r=0;r<e-1;r+=2)n+=String.fromCharCode(t[r]+256*t[r+1]);return n},write:function(t,e,n=0,r=h$2(e)){const o=Math.min(r,t.byteLength-n);let f=o;for(let r=0;r<e.length&&!((f-=2)<0);++r){const o=e.charCodeAt(r),f=o>>8,i=o%256;t[n+2*r]=i,t[n+2*r+1]=f;}return o}};!function(t,e){const r=n$4,o=i$2,f=a$2,u=b$1,c=l$1,g=255===new Uint8Array(Uint16Array.of(255).buffer)[0];function s(t){switch(t){case"ascii":return r;case"base64":return o;case"hex":return f;case"utf8":case"utf-8":case void 0:return u;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return c;default:throw new Error(`Unknown encoding: ${t}`)}}function y(t){return t instanceof Uint8Array}function h(t,e,n){return "string"==typeof t?function(t,e){const n=s(e),r=new Uint8Array(n.byteLength(t));return n.write(r,t,0,r.byteLength),r}(t,e):Array.isArray(t)?function(t){const e=new Uint8Array(t.length);return e.set(t),e}(t):ArrayBuffer.isView(t)?function(t){const e=new Uint8Array(t.byteLength);return e.set(t),e}(t):function(t,e,n){return new Uint8Array(t,e,n)}(t,e,n)}function L(t,e,n,r,o){if(0===t.byteLength)return -1;if("string"==typeof n?(r=n,n=0):void 0===n?n=o?0:t.length-1:n<0&&(n+=t.byteLength),n>=t.byteLength){if(o)return -1;n=t.byteLength-1;}else if(n<0){if(!o)return -1;n=0;}if("string"==typeof e)e=h(e,r);else if("number"==typeof e)return e&=255,o?t.indexOf(e,n):t.lastIndexOf(e,n);if(0===e.byteLength)return -1;if(o){let r=-1;for(let o=n;o<t.byteLength;o++)if(t[o]===e[-1===r?0:o-r]){if(-1===r&&(r=o),o-r+1===e.byteLength)return r}else -1!==r&&(o-=o-r),r=-1;}else {n+e.byteLength>t.byteLength&&(n=t.byteLength-e.byteLength);for(let r=n;r>=0;r--){let n=!0;for(let o=0;o<e.byteLength;o++)if(t[r+o]!==e[o]){n=!1;break}if(n)return r}}return -1}function w(t,e,n,r){return L(t,e,n,r,!0)}function d(t,e,n){const r=t[e];t[e]=t[n],t[n]=r;}t.exports=e={isBuffer:y,isEncoding:function(t){try{return s(t),!0}catch{return !1}},alloc:function(t,n,r){const o=new Uint8Array(t);return void 0!==n&&e.fill(o,n,0,o.byteLength,r),o},allocUnsafe:function(t){return new Uint8Array(t)},allocUnsafeSlow:function(t){return new Uint8Array(t)},byteLength:function(t,e){return s(e).byteLength(t)},compare:function(t,e){if(t===e)return 0;const n=Math.min(t.byteLength,e.byteLength);t=new DataView(t.buffer,t.byteOffset,t.byteLength),e=new DataView(e.buffer,e.byteOffset,e.byteLength);let r=0;for(let o=n-n%4;r<o;r+=4){if(t.getUint32(r,g)!==e.getUint32(r,g))break}for(;r<n;r++){const n=t.getUint8(r),o=e.getUint8(r);if(n<o)return -1;if(n>o)return 1}return t.byteLength>e.byteLength?1:t.byteLength<e.byteLength?-1:0},concat:function(t,e){void 0===e&&(e=t.reduce(((t,e)=>t+e.byteLength),0));const n=new Uint8Array(e);let r=0;for(const e of t){if(r+e.byteLength>n.byteLength){const t=e.subarray(0,n.byteLength-r);return n.set(t,r),n}n.set(e,r),r+=e.byteLength;}return n},copy:function(t,e,n=0,r=0,o=t.byteLength){if(o>0&&o<r)return 0;if(o===r)return 0;if(0===t.byteLength||0===e.byteLength)return 0;if(n<0)throw new RangeError("targetStart is out of range");if(r<0||r>=t.byteLength)throw new RangeError("sourceStart is out of range");if(o<0)throw new RangeError("sourceEnd is out of range");n>=e.byteLength&&(n=e.byteLength),o>t.byteLength&&(o=t.byteLength),e.byteLength-n<o-r&&(o=e.length-n+r);const f=o-r;return t===e?e.copyWithin(n,r,o):e.set(t.subarray(r,o),n),f},equals:function(t,e){if(t===e)return !0;if(t.byteLength!==e.byteLength)return !1;const n=t.byteLength;t=new DataView(t.buffer,t.byteOffset,t.byteLength),e=new DataView(e.buffer,e.byteOffset,e.byteLength);let r=0;for(let o=n-n%4;r<o;r+=4)if(t.getUint32(r,g)!==e.getUint32(r,g))return !1;for(;r<n;r++)if(t.getUint8(r)!==e.getUint8(r))return !1;return !0},fill:function(t,e,n,r,o){if("string"==typeof e?"string"==typeof n?(o=n,n=0,r=t.byteLength):"string"==typeof r&&(o=r,r=t.byteLength):"number"==typeof e?e&=255:"boolean"==typeof e&&(e=+e),n<0||t.byteLength<n||t.byteLength<r)throw new RangeError("Out of range index");if(void 0===n&&(n=0),void 0===r&&(r=t.byteLength),r<=n)return t;if(e||(e=0),"number"==typeof e)for(let o=n;o<r;++o)t[o]=e;else {const f=(e=y(e)?e:h(e,o)).byteLength;for(let o=0;o<r-n;++o)t[o+n]=e[o%f];}return t},from:h,includes:function(t,e,n,r){return -1!==w(t,e,n,r)},indexOf:w,lastIndexOf:function(t,e,n,r){return L(t,e,n,r,!1)},swap16:function(t){const e=t.byteLength;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let n=0;n<e;n+=2)d(t,n,n+1);return t},swap32:function(t){const e=t.byteLength;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let n=0;n<e;n+=4)d(t,n,n+3),d(t,n+1,n+2);return t},swap64:function(t){const e=t.byteLength;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let n=0;n<e;n+=8)d(t,n,n+7),d(t,n+1,n+6),d(t,n+2,n+5),d(t,n+3,n+4);return t},toBuffer:function(t){return t},toString:function(t,e,n=0,r=t.byteLength){const o=t.byteLength;return n>=o||r<=n?"":(n<0&&(n=0),r>o&&(r=o),(0!==n||r<o)&&(t=t.subarray(n,r)),s(e).toString(t))},write:function(t,e,n,r,o){return void 0===n?o="utf8":void 0===r&&"string"==typeof n?(o=n,n=void 0):void 0===o&&"string"==typeof r&&(o=r,r=void 0),s(o).write(t,e,n,r)},writeDoubleLE:function(t,e,n){return void 0===n&&(n=0),new DataView(t.buffer,t.byteOffset,t.byteLength).setFloat64(n,e,!0),n+8},writeFloatLE:function(t,e,n){return void 0===n&&(n=0),new DataView(t.buffer,t.byteOffset,t.byteLength).setFloat32(n,e,!0),n+4},writeUInt32LE:function(t,e,n){return void 0===n&&(n=0),new DataView(t.buffer,t.byteOffset,t.byteLength).setUint32(n,e,!0),n+4},writeInt32LE:function(t,e,n){return void 0===n&&(n=0),new DataView(t.buffer,t.byteOffset,t.byteLength).setInt32(n,e,!0),n+4},readDoubleLE:function(t,e){return void 0===e&&(e=0),new DataView(t.buffer,t.byteOffset,t.byteLength).getFloat64(e,!0)},readFloatLE:function(t,e){return void 0===e&&(e=0),new DataView(t.buffer,t.byteOffset,t.byteLength).getFloat32(e,!0)},readUInt32LE:function(t,e){return void 0===e&&(e=0),new DataView(t.buffer,t.byteOffset,t.byteLength).getUint32(e,!0)},readInt32LE:function(t,e){return void 0===e&&(e=0),new DataView(t.buffer,t.byteOffset,t.byteLength).getInt32(e,!0)}};}(t$4,t$4.exports);var L$1=t$4.exports;

/**
 * Bundled by jsDelivr using Rollup v2.79.1 and Terser v5.19.2.
 * Original file: /npm/unslab@1.3.0/index.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
const t$3=L$1;l.all=function(e){let n=0;for(let t=0;t<e.length;t++){const l=e[t];n+=null===l||l.buffer.byteLength===l.byteLength?0:l.byteLength;}const l=t$3.allocUnsafeSlow(n),r=new Array(e.length);let f=0;for(let t=0;t<e.length;t++){let n=e[t];null!==n&&n.buffer.byteLength!==n.byteLength&&(l.set(n,f),n=l.subarray(f,f+=n.byteLength)),r[t]=n;}return r},l.is=function(e){return e.buffer.byteLength!==e.byteLength};var n$3=l;function l(e){if(null===e||e.buffer.byteLength===e.byteLength)return e;const n=t$3.allocUnsafeSlow(e.byteLength);return n.set(e,0),n}

/**
 * Bundled by jsDelivr using Rollup v2.79.1 and Terser v5.19.2.
 * Original file: /npm/varint@5.0.0/index.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
var o$1=function o(a,r,d){r=r||[];var h=d=d||0;for(;a>=n$2;)r[d++]=255&a|e$1,a/=128;for(;a&t$2;)r[d++]=255&a|e$1,a>>>=7;return r[d]=0|a,o.bytes=d-h+1,r},e$1=128,t$2=-128,n$2=Math.pow(2,31);var a$1=function o(e,t){var n,a=0,h=0,w=t=t||0,c=e.length;do{if(w>=c)throw o.bytes=0,new RangeError("Could not decode varint");n=e[w++],a+=h<28?(n&d$2)<<h:(n&d$2)*Math.pow(2,h),h+=7;}while(n>=r$2);return o.bytes=w-t,a},r$2=128,d$2=127;var h$1=Math.pow(2,7),w$2=Math.pow(2,14),c$1=Math.pow(2,21),p$2=Math.pow(2,28),M$2=Math.pow(2,35),i$1=Math.pow(2,42),u$2=Math.pow(2,49),f$2=Math.pow(2,56),g$2=Math.pow(2,63),s$1={encode:o$1,decode:a$1,encodingLength:function(o){return o<h$1?1:o<w$2?2:o<c$1?3:o<p$2?4:o<M$2?5:o<i$1?6:o<u$2?7:o<f$2?8:o<g$2?9:10}};

/**
 * Bundled by jsDelivr using Rollup v2.79.1 and Terser v5.19.2.
 * Original file: /npm/varint@5.0.2/index.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
var o=function o(a,r,d){r=r||[];var h=d=d||0;for(;a>=n$1;)r[d++]=255&a|e,a/=128;for(;a&t$1;)r[d++]=255&a|e,a>>>=7;return r[d]=0|a,o.bytes=d-h+1,r},e=128,t$1=-128,n$1=Math.pow(2,31);var a=function o(e,t){var n,a=0,h=0,w=t=t||0,c=e.length;do{if(w>=c)throw o.bytes=0,new RangeError("Could not decode varint");n=e[w++],a+=h<28?(n&d$1)<<h:(n&d$1)*Math.pow(2,h),h+=7;}while(n>=r$1);return o.bytes=w-t,a},r$1=128,d$1=127;var h=Math.pow(2,7),w$1=Math.pow(2,14),c=Math.pow(2,21),p$1=Math.pow(2,28),M$1=Math.pow(2,35),i=Math.pow(2,42),u$1=Math.pow(2,49),f$1=Math.pow(2,56),g$1=Math.pow(2,63),s={encode:o,decode:a,encodingLength:function(o){return o<h?1:o<w$1?2:o<c?3:o<p$1?4:o<M$1?5:o<i?6:o<u$1?7:o<f$1?8:o<g$1?9:10}};

/**
 * Bundled by jsDelivr using Rollup v2.79.1 and Terser v5.19.2.
 * Original file: /npm/signed-varint@2.0.1/index.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
var n={},t=s;n.encode=function e(n,o,r){n=n>=0?2*n:-2*n-1;var d=t.encode(n,o,r);return e.bytes=t.encode.bytes,d};n.decode=function e(n,o){var r=t.decode(n,o);return e.bytes=t.decode.bytes,1&r?(r+1)/-2:r/2};n.encodingLength=function(e){return t.encodingLength(e>=0?2*e:-2*e-1)};

/**
 * Bundled by jsDelivr using Rollup v2.79.1 and Terser v5.19.2.
 * Original file: /npm/protocol-buffers-encodings@1.2.0/index.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
var r={};!function(r){var o=s$1,u=n,i=L$1;function c(e,n,t,r){return n.bytes=t.bytes=0,{type:e,encode:n,decode:t,encodingLength:r}}function s(e){return i.isBuffer(e)?e.length:i.byteLength(e)}r.make=c,r.name=function(e){for(var n=Object.keys(r),t=0;t<n.length;t++)if(r[n[t]]===e)return n[t];return null},r.skip=function(e,n,t){switch(e){case 0:return o.decode(n,t),t+o.decode.bytes;case 1:return t+8;case 2:var r=o.decode(n,t);return t+o.decode.bytes+r;case 3:case 4:throw new Error("Groups are not supported");case 5:return t+4}throw new Error("Unknown wire type: "+e)},r.bytes=c(2,(function e(n,t,r){var u=r,c=s(n);return o.encode(c,t,r),r+=o.encode.bytes,i.isBuffer(n)?i.copy(n,t,r):i.write(t,n,r,c),e.bytes=(r+=c)-u,t}),(function e(n,t){var r=t,u=o.decode(n,t);t+=o.decode.bytes;var i=n.subarray(t,t+u);return t+=i.length,e.bytes=t-r,i}),(function(e){var n=s(e);return o.encodingLength(n)+n})),r.string=c(2,(function e(n,t,r){var u=r,c=i.byteLength(n);return o.encode(c,t,r,"utf-8"),r+=o.encode.bytes,i.write(t,n,r,c),e.bytes=(r+=c)-u,t}),(function e(n,t){var r=t,u=o.decode(n,t);t+=o.decode.bytes;var c=i.toString(n,"utf-8",t,t+u);return e.bytes=(t+=u)-r,c}),(function(e){var n=i.byteLength(e);return o.encodingLength(n)+n})),r.bool=c(0,(function e(n,t,r){return t[r]=n?1:0,e.bytes=1,t}),(function e(n,t){var r=n[t]>0;return e.bytes=1,r}),(function(){return 1})),r.int32=c(0,(function e(n,t,r){return o.encode(n<0?n+4294967296:n,t,r),e.bytes=o.encode.bytes,t}),(function e(n,t){var r=o.decode(n,t);return e.bytes=o.decode.bytes,r>2147483647?r-4294967296:r}),(function(e){return o.encodingLength(e<0?e+4294967296:e)})),r.int64=c(0,(function e(n,t,r){if(n<0){var u=r+9;for(o.encode(-1*n,t,r),t[r+=o.encode.bytes-1]=128|t[r];r<u-1;)t[++r]=255;t[u]=1,e.bytes=10;}else o.encode(n,t,r),e.bytes=o.encode.bytes;return t}),(function e(n,t){var r=o.decode(n,t);if(r>=Math.pow(2,63)){for(var u=9;255===n[t+u-1];)u--;u=u||9;var c=i.allocUnsafe(u);i.copy(n,c,0,t,t+u),c[u-1]=127&c[u-1],r=-1*o.decode(c,0),e.bytes=10;}else e.bytes=o.decode.bytes;return r}),(function(e){return e<0?10:o.encodingLength(e)})),r.sint32=r.sint64=c(0,u.encode,u.decode,u.encodingLength),r.uint32=r.uint64=r.enum=r.varint=c(0,o.encode,o.decode,o.encodingLength),r.fixed64=r.sfixed64=c(1,(function e(n,t,r){return i.copy(n,t,r),e.bytes=8,t}),(function e(n,t){var r=n.subarray(t,t+8);return e.bytes=8,r}),(function(){return 8})),r.double=c(1,(function e(n,t,r){return i.writeDoubleLE(t,n,r),e.bytes=8,t}),(function e(n,t){var r=i.readDoubleLE(n,t);return e.bytes=8,r}),(function(){return 8})),r.fixed32=c(5,(function e(n,t,r){return i.writeUInt32LE(t,n,r),e.bytes=4,t}),(function e(n,t){var r=i.readUInt32LE(n,t);return e.bytes=4,r}),(function(){return 4})),r.sfixed32=c(5,(function e(n,t,r){return i.writeInt32LE(t,n,r),e.bytes=4,t}),(function e(n,t){var r=i.readInt32LE(n,t);return e.bytes=4,r}),(function(){return 4})),r.float=c(5,(function e(n,t,r){return i.writeFloatLE(t,n,r),e.bytes=4,t}),(function e(n,t){var r=i.readFloatLE(n,t);return e.bytes=4,r}),(function(){return 4}));}(r);r.bool;r.bytes;r.double;r.enum;r.fixed32;r.fixed64;r.float;r.int32;r.int64;r.make;r.name;r.sfixed32;r.sfixed64;r.sint32;r.sint64;r.skip;r.string;r.uint32;r.uint64;r.varint;

/**
 * Bundled by jsDelivr using Rollup v2.79.1 and Terser v5.19.2.
 * Original file: /npm/hypercore-errors@1.3.0/index.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
var E$1=class E extends Error{constructor(A,I,O=E){super(`${I}: ${A}`),this.code=I,Error.captureStackTrace&&Error.captureStackTrace(this,O);}get name(){return "HypercoreError"}static ASSERTION(A){return new E(A,"ERR_ASSERTION",E.ASSERT)}static BAD_ARGUMENT(A){return new E(A,"BAD_ARGUMENT",E.BAD_ARGUMENT)}static STORAGE_EMPTY(A){return new E(A,"STORAGE_EMPTY",E.STORAGE_EMPTY)}static STORAGE_CONFLICT(A){return new E(A,"STORAGE_CONFLICT",E.STORAGE_CONFLICT)}static INVALID_SIGNATURE(A){return new E(A,"INVALID_SIGNATURE",E.INVALID_SIGNATURE)}static INVALID_CAPABILITY(A){return new E(A,"INVALID_CAPABILITY",E.INVALID_CAPABILITY)}static INVALID_CHECKSUM(A="Invalid checksum"){return new E(A,"INVALID_CHECKSUM",E.INVALID_CHECKSUM)}static INVALID_OPERATION(A){return new E(A,"INVALID_OPERATION",E.INVALID_OPERATION)}static INVALID_PROOF(A="Proof not verifiable"){return new E(A,"INVALID_PROOF",E.INVALID_PROOF)}static BLOCK_NOT_AVAILABLE(A="Block is not available"){return new E(A,"BLOCK_NOT_AVAILABLE",E.BLOCK_NOT_AVAILABLE)}static SNAPSHOT_NOT_AVAILABLE(A="Snapshot is not available"){return new E(A,"SNAPSHOT_NOT_AVAILABLE",E.SNAPSHOT_NOT_AVAILABLE)}static REQUEST_CANCELLED(A="Request was cancelled"){return new E(A,"REQUEST_CANCELLED",E.REQUEST_CANCELLED)}static REQUEST_TIMEOUT(A="Request timed out"){return new E(A,"REQUEST_TIMEOUT",E.REQUEST_TIMEOUT)}static SESSION_NOT_WRITABLE(A="Session is not writable"){return new E(A,"SESSION_NOT_WRITABLE",E.SESSION_NOT_WRITABLE)}static SESSION_CLOSED(A="Session is closed"){return new E(A,"SESSION_CLOSED",E.SESSION_CLOSED)}static BATCH_UNFLUSHED(A="Batch not yet flushed"){return new E(A,"BATCH_UNFLUSHED",E.BATCH_UNFLUSHED)}static BATCH_ALREADY_EXISTS(A="Batch already exists"){return new E(A,"BATCH_ALREADY_EXISTS",E.BATCH_ALREADY_EXISTS)}static BATCH_ALREADY_FLUSHED(A="Batch has already been flushed"){return new E(A,"BATCH_ALREADY_FLUSHED",E.BATCH_ALREADY_FLUSHED)}static OPLOG_CORRUPT(A="Oplog file appears corrupt or out of date"){return new E(A,"OPLOG_CORRUPT",E.OPLOG_CORRUPT)}static OPLOG_HEADER_OVERFLOW(A="Oplog header exceeds page size"){return new E(A,"OPLOG_HEADER_OVERFLOW",E.OPLOG_HEADER_OVERFLOW)}static INVALID_OPLOG_VERSION(A="Invalid header version"){return new E(A,"INVALID_OPLOG_VERSION",E.INVALID_OPLOG_VERSION)}static WRITE_FAILED(A="Write to storage failed"){return new E(A,"WRITE_FAILED",E.WRITE_FAILED)}static DECODING_ERROR(A="Decoding error"){return new E(A,"DECODING_ERROR",E.DECODING_ERROR)}};E$1.ASSERTION;E$1.BAD_ARGUMENT;E$1.BATCH_ALREADY_EXISTS;E$1.BATCH_ALREADY_FLUSHED;E$1.BATCH_UNFLUSHED;E$1.BLOCK_NOT_AVAILABLE;E$1.DECODING_ERROR;E$1.INVALID_CAPABILITY;E$1.INVALID_CHECKSUM;E$1.INVALID_OPERATION;E$1.INVALID_OPLOG_VERSION;E$1.INVALID_PROOF;E$1.INVALID_SIGNATURE;E$1.OPLOG_CORRUPT;E$1.OPLOG_HEADER_OVERFLOW;E$1.REQUEST_CANCELLED;E$1.REQUEST_TIMEOUT;E$1.SESSION_CLOSED;E$1.SESSION_NOT_WRITABLE;E$1.SNAPSHOT_NOT_AVAILABLE;E$1.STORAGE_CONFLICT;E$1.STORAGE_EMPTY;E$1.WRITE_FAILED;

/**
 * Bundled by jsDelivr using Rollup v2.79.1 and Terser v5.19.2.
 * Original file: /npm/hyperbee@2.20.2/index.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
const d=L$2;function u(e,t){return {type:e.isDeletion()?"del":"put",...e.final(t)}}const g=L$2;class y{constructor(e,t){this.node=e,this.parent=t,this.isKey=0===e.children.length,this.i=this.isKey?1:0,this.n=0;const n=this.isKey?null:this.node.children[0];this.seq=null!==n?n.seq:this.node.keys[0].seq,this.offset=null!==n?n.offset:0;}next(){return this.i++,this.isKey=1==(1&this.i),this.isKey||this.node.children.length||this.i++,this.update()}async bisect(e,t){let n,s=0,i=this.node.keys.length;for(;s<i;){const o=s+i>>1;if(n=p(e,await this.node.getKey(o)),0===n)return this.i=t?2*o+1:2*o+(this.node.children.length?2:3),!0;n<0?i=o:s=o+1;}const o=n<0?i:s;return this.i=2*o+(this.node.children.length?0:1),0===this.node.children.length}update(){if(this.isKey=1==(1&this.i),this.n=this.i>>1,this.n>=(this.isKey?this.node.keys.length:this.node.children.length))return !1;const e=this.isKey?null:this.node.children[this.n];return this.seq=null!==e?e.seq:this.node.keys[this.n].seq,this.offset=null!==e?e.offset:0,!0}async key(){return this.n<this.node.keys.length?this.node.getKey(this.n):this.parent&&this.parent.key()}async compare(e){const[t,n]=await Promise.all([this.key(),e.key()]);return p(t,n)}}class f{constructor(e,t){this.batch=e,this.stack=[],this.lt=t.lt||t.lte||null,this.lte=!!t.lte,this.gt=t.gt||t.gte||null,this.gte=!!t.gte,this.seeking=!!this.gt,this.encoding=t.encoding||e.encoding;}async open(){const e=await this.batch.getRoot(!1);if(!e||!e.keys.length)return;const t=new y(e,null);this.seeking&&!await this._seek(t)||this.stack.push(t);}async _seek(e){const t=await e.bisect(this.gt,this.gte),n=!e.update();return !t&&!n||(this.seeking=!1,!n)}peek(){return this.stack.length?this.stack[this.stack.length-1]:null}skip(){this.stack.length&&(this.stack[this.stack.length-1].next()||this.stack.pop());}async nextKey(){let e=null;for(;this.stack.length&&null===e;)e=await this.next();if(null===e)return null;if(!this.lt)return e.final(this.encoding);const t=p(e.key,this.lt);return (this.lte?t<=0:t<0)?e.final(this.encoding):(this.stack=[],null)}async next(){if(!this.stack.length)return null;const e=this.stack[this.stack.length-1],{isKey:t,n:n,seq:s}=e;if(e.next()||this.stack.pop(),t)return this.seeking=!1,this.batch.getBlock(s);const i=await e.node.getChildNode(n);e.node.children[n]=null;const o=new y(i,e);return this.seeking&&!await this._seek(o)||this.stack.push(o),null}close(){return this.batch._closeSnapshot()}}function p(e,t){return e?t?g.compare(e,t):e?-1:0:t?1:0}var k={},b=r,v=L$2,w=b.varint,_=b.skip,m=k.YoloIndex={buffer:!0,encodingLength:null,encode:null,decode:null},x=k.Header={buffer:!0,encodingLength:null,encode:null,decode:null},E=k.Node={buffer:!0,encodingLength:null,encode:null,decode:null},L=k.Extension={buffer:!0,encodingLength:null,encode:null,decode:null};function q(e){return null!=e&&("number"!=typeof e||!isNaN(e))}!function(){var e=m.Level={buffer:!0,encodingLength:null,encode:null,decode:null};function t(t){var n=0;if(q(t.levels))for(var s=0;s<t.levels.length;s++)if(q(t.levels[s])){var i=e.encodingLength(t.levels[s]);n+=w.encodingLength(i),n+=1+i;}return n}((function(){function t(e){var t=0;if(q(e.keys)){for(var n=0,s=0;s<e.keys.length;s++)q(e.keys[s])&&(n+=b.varint.encodingLength(e.keys[s]));n&&(t+=1+n+w.encodingLength(n));}if(q(e.children)){for(n=0,s=0;s<e.children.length;s++)q(e.children[s])&&(n+=b.varint.encodingLength(e.children[s]));n&&(t+=1+n+w.encodingLength(n));}return t}e.encodingLength=t,e.encode=function e(n,s,i){i||(i=0),s||(s=v.allocUnsafe(t(n)));var o=i;if(q(n.keys)){for(var r=0,h=0;h<n.keys.length;h++)q(n.keys[h])&&(r+=b.varint.encodingLength(n.keys[h]));for(r&&(s[i++]=10,w.encode(r,s,i),i+=w.encode.bytes),h=0;h<n.keys.length;h++)q(n.keys[h])&&(b.varint.encode(n.keys[h],s,i),i+=b.varint.encode.bytes);}if(q(n.children)){for(r=0,h=0;h<n.children.length;h++)q(n.children[h])&&(r+=b.varint.encodingLength(n.children[h]));for(r&&(s[i++]=18,w.encode(r,s,i),i+=w.encode.bytes),h=0;h<n.children.length;h++)q(n.children[h])&&(b.varint.encode(n.children[h],s,i),i+=b.varint.encode.bytes);}return e.bytes=i-o,s},e.decode=function e(t,n,s){if(n||(n=0),s||(s=t.length),!(s<=t.length&&n<=t.length))throw new Error("Decoded message is not valid");for(var i=n,o={keys:[],children:[]};;){if(s<=n)return e.bytes=n-i,o;var r=w.decode(t,n);switch(n+=w.decode.bytes,r>>3){case 1:var h=w.decode(t,n);for(h+=n+=w.decode.bytes;n<h;)o.keys.push(b.varint.decode(t,n)),n+=b.varint.decode.bytes;break;case 2:for(h=w.decode(t,n),h+=n+=w.decode.bytes;n<h;)o.children.push(b.varint.decode(t,n)),n+=b.varint.decode.bytes;break;default:n=_(7&r,t,n);}}};}))(),m.encodingLength=t,m.encode=function n(s,i,o){o||(o=0),i||(i=v.allocUnsafe(t(s)));var r=o;if(q(s.levels))for(var h=0;h<s.levels.length;h++)q(s.levels[h])&&(i[o++]=10,w.encode(e.encodingLength(s.levels[h]),i,o),o+=w.encode.bytes,e.encode(s.levels[h],i,o),o+=e.encode.bytes);return n.bytes=o-r,i},m.decode=function t(n,s,i){if(s||(s=0),i||(i=n.length),!(i<=n.length&&s<=n.length))throw new Error("Decoded message is not valid");for(var o=s,r={levels:[]};;){if(i<=s)return t.bytes=s-o,r;var h=w.decode(n,s);if(s+=w.decode.bytes,1==h>>3){var c=w.decode(n,s);s+=w.decode.bytes,r.levels.push(e.decode(n,s,s+c)),s+=e.decode.bytes;}else s=_(7&h,n,s);}};}(),function(){var e=x.Metadata={buffer:!0,encodingLength:null,encode:null,decode:null};function t(t){var n=0;if(!q(t.protocol))throw new Error("protocol is required");if(n+=1+(s=b.string.encodingLength(t.protocol)),q(t.metadata)){var s=e.encodingLength(t.metadata);n+=w.encodingLength(s),n+=1+s;}return n}((function(){function t(e){var t=0;return q(e.contentFeed)&&(t+=1+b.bytes.encodingLength(e.contentFeed)),q(e.userData)&&(t+=1+b.bytes.encodingLength(e.userData)),t}e.encodingLength=t,e.encode=function e(n,s,i){i||(i=0),s||(s=v.allocUnsafe(t(n)));var o=i;return q(n.contentFeed)&&(s[i++]=10,b.bytes.encode(n.contentFeed,s,i),i+=b.bytes.encode.bytes),q(n.userData)&&(s[i++]=18,b.bytes.encode(n.userData,s,i),i+=b.bytes.encode.bytes),e.bytes=i-o,s},e.decode=function e(t,n,s){if(n||(n=0),s||(s=t.length),!(s<=t.length&&n<=t.length))throw new Error("Decoded message is not valid");for(var i=n,o={contentFeed:null,userData:null};;){if(s<=n)return e.bytes=n-i,o;var r=w.decode(t,n);switch(n+=w.decode.bytes,r>>3){case 1:o.contentFeed=b.bytes.decode(t,n),n+=b.bytes.decode.bytes;break;case 2:o.userData=b.bytes.decode(t,n),n+=b.bytes.decode.bytes;break;default:n=_(7&r,t,n);}}};}))(),x.encodingLength=t,x.encode=function n(s,i,o){o||(o=0),i||(i=v.allocUnsafe(t(s)));var r=o;if(!q(s.protocol))throw new Error("protocol is required");return i[o++]=10,b.string.encode(s.protocol,i,o),o+=b.string.encode.bytes,q(s.metadata)&&(i[o++]=18,w.encode(e.encodingLength(s.metadata),i,o),o+=w.encode.bytes,e.encode(s.metadata,i,o),o+=e.encode.bytes),n.bytes=o-r,i},x.decode=function t(n,s,i){if(s||(s=0),i||(i=n.length),!(i<=n.length&&s<=n.length))throw new Error("Decoded message is not valid");for(var o=s,r={protocol:"",metadata:null},h=!1;;){if(i<=s){if(!h)throw new Error("Decoded message is not valid");return t.bytes=s-o,r}var c=w.decode(n,s);switch(s+=w.decode.bytes,c>>3){case 1:r.protocol=b.string.decode(n,s),s+=b.string.decode.bytes,h=!0;break;case 2:var l=w.decode(n,s);s+=w.decode.bytes,r.metadata=e.decode(n,s,s+l),s+=e.decode.bytes;break;default:s=_(7&c,n,s);}}};}(),function(){function e(e){var t=0;if(!q(e.index))throw new Error("index is required");if(t+=1+b.bytes.encodingLength(e.index),!q(e.key))throw new Error("key is required");(t+=1+b.bytes.encodingLength(e.key),q(e.value))&&(t+=1+b.bytes.encodingLength(e.value));return t}E.encodingLength=e,E.encode=function t(n,s,i){i||(i=0),s||(s=v.allocUnsafe(e(n)));var o=i;if(!q(n.index))throw new Error("index is required");if(s[i++]=10,b.bytes.encode(n.index,s,i),i+=b.bytes.encode.bytes,!q(n.key))throw new Error("key is required");return s[i++]=18,b.bytes.encode(n.key,s,i),i+=b.bytes.encode.bytes,q(n.value)&&(s[i++]=26,b.bytes.encode(n.value,s,i),i+=b.bytes.encode.bytes),t.bytes=i-o,s},E.decode=function e(t,n,s){if(n||(n=0),s||(s=t.length),!(s<=t.length&&n<=t.length))throw new Error("Decoded message is not valid");for(var i=n,o={index:null,key:null,value:null},r=!1,h=!1;;){if(s<=n){if(!r||!h)throw new Error("Decoded message is not valid");return e.bytes=n-i,o}var c=w.decode(t,n);switch(n+=w.decode.bytes,c>>3){case 1:o.index=b.bytes.decode(t,n),n+=b.bytes.decode.bytes,r=!0;break;case 2:o.key=b.bytes.decode(t,n),n+=b.bytes.decode.bytes,h=!0;break;case 3:o.value=b.bytes.decode(t,n),n+=b.bytes.decode.bytes;break;default:n=_(7&c,t,n);}}};}(),function(){var e=L.Get={buffer:!0,encodingLength:null,encode:null,decode:null},t=L.Iterator={buffer:!0,encodingLength:null,encode:null,decode:null},n=L.Cache={buffer:!0,encodingLength:null,encode:null,decode:null};function s(s){var i=0;if(q(s.cache)){var o=n.encodingLength(s.cache);i+=w.encodingLength(o),i+=1+o;}if(q(s.get)){o=e.encodingLength(s.get);i+=w.encodingLength(o),i+=1+o;}if(q(s.iterator)){o=t.encodingLength(s.iterator);i+=w.encodingLength(o),i+=1+o;}return i}((function(){function t(e){var t=0;return q(e.version)&&(t+=1+b.varint.encodingLength(e.version)),q(e.key)&&(t+=1+b.bytes.encodingLength(e.key)),t}e.encodingLength=t,e.encode=function e(n,s,i){i||(i=0),s||(s=v.allocUnsafe(t(n)));var o=i;return q(n.version)&&(s[i++]=8,b.varint.encode(n.version,s,i),i+=b.varint.encode.bytes),q(n.key)&&(s[i++]=18,b.bytes.encode(n.key,s,i),i+=b.bytes.encode.bytes),e.bytes=i-o,s},e.decode=function e(t,n,s){if(n||(n=0),s||(s=t.length),!(s<=t.length&&n<=t.length))throw new Error("Decoded message is not valid");for(var i=n,o={version:0,key:null};;){if(s<=n)return e.bytes=n-i,o;var r=w.decode(t,n);switch(n+=w.decode.bytes,r>>3){case 1:o.version=b.varint.decode(t,n),n+=b.varint.decode.bytes;break;case 2:o.key=b.bytes.decode(t,n),n+=b.bytes.decode.bytes;break;default:n=_(7&r,t,n);}}};}))(),function(){function e(e){var t=0;if(q(e.version)&&(t+=1+b.varint.encodingLength(e.version)),q(e.gte)&&(t+=1+b.bytes.encodingLength(e.gte)),q(e.gt)&&(t+=1+b.bytes.encodingLength(e.gt)),q(e.lte)&&(t+=1+b.bytes.encodingLength(e.lte)),q(e.lt)&&(t+=1+b.bytes.encodingLength(e.lt)),q(e.limit)&&(t+=1+b.varint.encodingLength(e.limit)),q(e.reverse)&&(t+=1+b.bool.encodingLength(e.reverse)),q(e.checkpoint)){for(var n=0,s=0;s<e.checkpoint.length;s++)q(e.checkpoint[s])&&(n+=b.varint.encodingLength(e.checkpoint[s]));n&&(t+=1+n+w.encodingLength(n));}return t}t.encodingLength=e,t.encode=function t(n,s,i){i||(i=0),s||(s=v.allocUnsafe(e(n)));var o=i;if(q(n.version)&&(s[i++]=8,b.varint.encode(n.version,s,i),i+=b.varint.encode.bytes),q(n.gte)&&(s[i++]=18,b.bytes.encode(n.gte,s,i),i+=b.bytes.encode.bytes),q(n.gt)&&(s[i++]=26,b.bytes.encode(n.gt,s,i),i+=b.bytes.encode.bytes),q(n.lte)&&(s[i++]=34,b.bytes.encode(n.lte,s,i),i+=b.bytes.encode.bytes),q(n.lt)&&(s[i++]=42,b.bytes.encode(n.lt,s,i),i+=b.bytes.encode.bytes),q(n.limit)&&(s[i++]=48,b.varint.encode(n.limit,s,i),i+=b.varint.encode.bytes),q(n.reverse)&&(s[i++]=56,b.bool.encode(n.reverse,s,i),i+=b.bool.encode.bytes),q(n.checkpoint)){for(var r=0,h=0;h<n.checkpoint.length;h++)q(n.checkpoint[h])&&(r+=b.varint.encodingLength(n.checkpoint[h]));for(r&&(s[i++]=66,w.encode(r,s,i),i+=w.encode.bytes),h=0;h<n.checkpoint.length;h++)q(n.checkpoint[h])&&(b.varint.encode(n.checkpoint[h],s,i),i+=b.varint.encode.bytes);}return t.bytes=i-o,s},t.decode=function e(t,n,s){if(n||(n=0),s||(s=t.length),!(s<=t.length&&n<=t.length))throw new Error("Decoded message is not valid");for(var i=n,o={version:0,gte:null,gt:null,lte:null,lt:null,limit:0,reverse:!1,checkpoint:[]};;){if(s<=n)return e.bytes=n-i,o;var r=w.decode(t,n);switch(n+=w.decode.bytes,r>>3){case 1:o.version=b.varint.decode(t,n),n+=b.varint.decode.bytes;break;case 2:o.gte=b.bytes.decode(t,n),n+=b.bytes.decode.bytes;break;case 3:o.gt=b.bytes.decode(t,n),n+=b.bytes.decode.bytes;break;case 4:o.lte=b.bytes.decode(t,n),n+=b.bytes.decode.bytes;break;case 5:o.lt=b.bytes.decode(t,n),n+=b.bytes.decode.bytes;break;case 6:o.limit=b.varint.decode(t,n),n+=b.varint.decode.bytes;break;case 7:o.reverse=b.bool.decode(t,n),n+=b.bool.decode.bytes;break;case 8:var h=w.decode(t,n);for(h+=n+=w.decode.bytes;n<h;)o.checkpoint.push(b.varint.decode(t,n)),n+=b.varint.decode.bytes;break;default:n=_(7&r,t,n);}}};}(),function(){function e(e){var t=0;if(!q(e.start))throw new Error("start is required");if(t+=1+b.varint.encodingLength(e.start),!q(e.end))throw new Error("end is required");if(t+=1+b.varint.encodingLength(e.end),q(e.blocks)){for(var n=0,s=0;s<e.blocks.length;s++)q(e.blocks[s])&&(n+=b.varint.encodingLength(e.blocks[s]));n&&(t+=1+n+w.encodingLength(n));}return t}n.encodingLength=e,n.encode=function t(n,s,i){i||(i=0),s||(s=v.allocUnsafe(e(n)));var o=i;if(!q(n.start))throw new Error("start is required");if(s[i++]=8,b.varint.encode(n.start,s,i),i+=b.varint.encode.bytes,!q(n.end))throw new Error("end is required");if(s[i++]=16,b.varint.encode(n.end,s,i),i+=b.varint.encode.bytes,q(n.blocks)){for(var r=0,h=0;h<n.blocks.length;h++)q(n.blocks[h])&&(r+=b.varint.encodingLength(n.blocks[h]));for(r&&(s[i++]=26,w.encode(r,s,i),i+=w.encode.bytes),h=0;h<n.blocks.length;h++)q(n.blocks[h])&&(b.varint.encode(n.blocks[h],s,i),i+=b.varint.encode.bytes);}return t.bytes=i-o,s},n.decode=function e(t,n,s){if(n||(n=0),s||(s=t.length),!(s<=t.length&&n<=t.length))throw new Error("Decoded message is not valid");for(var i=n,o={start:0,end:0,blocks:[]},r=!1,h=!1;;){if(s<=n){if(!r||!h)throw new Error("Decoded message is not valid");return e.bytes=n-i,o}var c=w.decode(t,n);switch(n+=w.decode.bytes,c>>3){case 1:o.start=b.varint.decode(t,n),n+=b.varint.decode.bytes,r=!0;break;case 2:o.end=b.varint.decode(t,n),n+=b.varint.decode.bytes,h=!0;break;case 3:var l=w.decode(t,n);for(l+=n+=w.decode.bytes;n<l;)o.blocks.push(b.varint.decode(t,n)),n+=b.varint.decode.bytes;break;default:n=_(7&c,t,n);}}};}(),L.encodingLength=s,L.encode=function i(o,r,h){h||(h=0),r||(r=v.allocUnsafe(s(o)));var c=h;return q(o.cache)&&(r[h++]=10,w.encode(n.encodingLength(o.cache),r,h),h+=w.encode.bytes,n.encode(o.cache,r,h),h+=n.encode.bytes),q(o.get)&&(r[h++]=18,w.encode(e.encodingLength(o.get),r,h),h+=w.encode.bytes,e.encode(o.get,r,h),h+=e.encode.bytes),q(o.iterator)&&(r[h++]=26,w.encode(t.encodingLength(o.iterator),r,h),h+=w.encode.bytes,t.encode(o.iterator,r,h),h+=t.encode.bytes),i.bytes=h-c,r},L.decode=function s(i,o,r){if(o||(o=0),r||(r=i.length),!(r<=i.length&&o<=i.length))throw new Error("Decoded message is not valid");for(var h=o,c={cache:null,get:null,iterator:null};;){if(r<=o)return s.bytes=o-h,c;var l=w.decode(i,o);switch(o+=w.decode.bytes,l>>3){case 1:var a=w.decode(i,o);o+=w.decode.bytes,c.cache=n.decode(i,o,o+a),o+=n.decode.bytes;break;case 2:a=w.decode(i,o),o+=w.decode.bytes,c.get=e.decode(i,o,o+a),o+=e.decode.bytes;break;case 3:a=w.decode(i,o),o+=w.decode.bytes,c.iterator=t.decode(i,o,o+a),o+=t.decode.bytes;break;default:o=_(7&l,i,o);}}};}();const{Extension:K}=k;class C{constructor(e,t){this.blocks=[],this.start=0,this.end=0,this.outgoing=e,this.from=t;}push(e){const t=this.blocks.push(e);(1===t||e<this.start)&&(this.start=e),(1===t||e>=this.end)&&(this.end=e+1),t>=128&&(this.send(),this.clear());}send(){this.blocks.length&&this.outgoing.send(K.encode({cache:{blocks:this.blocks,start:this.start,end:this.end}}),this.from);}clear(){this.start=this.end=0,this.blocks=[];}}class B{constructor(e){this.encoding=null,this.outgoing=null,this.db=e,this.active=0;}get(e,t){this.outgoing.broadcast(K.encode({get:{version:e,key:t}}));}iterator(e){e.ended||0!==e.limit&&(-1===e.limit&&(e.limit=0),this.outgoing.broadcast(K.encode({iterator:e})));}onmessage(e,t){const n=function(e){try{return K.decode(e)}catch(e){return null}}(e);n&&(n.cache&&this.oncache(n.cache,t),n.get&&this.onget(n.get,t),n.iterator&&this.oniterator(n.iterator,t));}oncache(e,t){e.blocks.length&&this.db.core.download(e);}onget(e,t){if(!e.version||e.version>this.db.version)return;const n=new C(this.outgoing,t),s=this.db.checkout(e.version);function i(){s.close().catch(N),n.send();}s.get(e.key,{extension:!1,wait:!1,update:!1,onseq:function(e){n.push(e);}}).then(i,i);}async oniterator(e,t){if(!e.version||e.version>this.db.version)return;const n=new C(this.outgoing,t);let s=e.checkpoint.length,i=0;const o=this.db.checkout(e.version),r=o.createRangeIterator({...e,wait:!1,extension:!1,update:!1,limit:0===e.limit?-1:e.limit,onseq(e){s&&s--||(i++,n.push(e));}});try{for(await r.open();i<2176&&await r.next(););}catch(e){}finally{o.close().catch(N),n.send();}}static register(e){const t=new this(e);return t.outgoing=e.core.registerExtension("hyperbee",t),t}}B.BATCH_SIZE=2048;var S=B;function N(){}const D=t$b,{Readable:I}=qt,M=t$8,R=L$2,U=r$6,O=f$4,A=n$5,T=r$4,{all:P}=n$3,F=class{constructor(e,t,n={}){this.batch=e,this.stack=[],this.opened=!1,this.encoding=t||e.encoding,this._limit="number"==typeof n.limit?n.limit:-1,this._gIncl=!n.gt,this._gKey=n.gt||n.gte||null,this._lIncl=!n.lt,this._lKey=n.lt||n.lte||null,this._reverse=!!n.reverse,this._version=0,this._checkpoint=n.checkpoint&&n.checkpoint.length?n.checkpoint:null,this._nexting=!1;}snapshot(e=this.batch.version){const t=[];for(const e of this.stack){let{node:n,i:s}=e;this._nexting&&e===this.stack[this.stack.length-1]&&(s=this._reverse?s+1:s-1),n.block&&(s<0||t.push(n.block.seq,n.offset,s));}return {version:e,gte:this._gIncl?this._gKey:null,gt:this._gIncl?null:this._gKey,lte:this._lIncl?this._lKey:null,lt:this._lIncl?null:this._lKey,limit:this._limit,reverse:this._reverse,ended:this.opened&&!t.length,checkpoint:this.opened?t:[]}}async open(){await this._open(),this.opened=!0;}async _open(){if(this._checkpoint){for(let e=0;e<this._checkpoint.length;e+=3){const t=this._checkpoint[e],n=this._checkpoint[e+1],s=this._checkpoint[e+2];this.stack.push({node:(await this.batch.getBlock(t)).getTreeNode(n),i:s});}return}this._nexting=!0;let e=await this.batch.getRoot(!1);if(!e)return void(this._nexting=!1);const t=this._reverse?this._lIncl:this._gIncl,n=this._reverse?this._lKey:this._gKey;if(!n)return this.stack.push({node:e,i:this._reverse?e.keys.length<<1:0}),void(this._nexting=!1);for(;;){const s={node:e,i:this._reverse?e.keys.length<<1:0};let i,o=0,r=e.keys.length;for(;o<r;){const h=o+r>>1;if(i=d.compare(n,await e.getKey(h)),0===i)return s.i=t?2*h+1:2*h+(this._reverse?0:2),this.stack.push(s),void(this._nexting=!1);i<0?r=h:o=h+1;}const h=i<0?r:o;if(s.i=2*h+(this._reverse?-1:1),s.i>=0&&s.i<=e.keys.length<<1&&this.stack.push(s),!e.children.length)return void(this._nexting=!1);e=await e.getChildNode(h);}}async next(){this._nexting=!0;const e=this._reverse?this._gKey:this._lKey,t=this._reverse?this._gIncl:this._lIncl;for(;this.stack.length&&(-1===this._limit||this._limit>0);){const n=this.stack[this.stack.length-1],s=1==(1&n.i),i=this._reverse?n.i<0?n.node.keys.length:n.i-- >>1:n.i++>>1;if(!s){if(!n.node.children.length)continue;const e=await n.node.getChildNode(i);n.node.block.seq<this.batch.core.length&&(n.node.children[i].value=null),this.stack.push({i:this._reverse?e.keys.length<<1:0,node:e});continue}if(i>=n.node.keys.length){this.stack.pop();continue}const o=n.node.keys[i],r=await this.batch.getBlock(o.seq);if(e){const n=d.compare(r.key,e);if(0===n?!t:this._reverse?n<0:n>0){this._limit=0;break}}return this._limit>0&&this._limit--,this._nexting=!1,r.final(this.encoding)}return this._nexting=!1,null}close(){return this.batch._closeSnapshot()}},W=class{constructor(e,t={}){if(this.batch=e,this.options=t,this.live=!!t.live,this.gte=0,this.lt=0,this.reverse=!!t.reverse,this.limit="number"==typeof t.limit?t.limit:-1,this.encoding=t.encoding||e.encoding,this.live&&this.reverse)throw new Error("Cannot have both live and reverse enabled")}async open(){await this.batch.getRoot(!1),this.gte=function(e,t){if(e.gt)return (e.gt<0?e.gt+t:e.gt)+1;const n=e.gte||e.since||1;return n<0?n+t:n}(this.options,this.batch.version),this.lt=this.live?1/0:function(e,t){if(0===e.lte||0===e.lt||0===e.end)return 0;if(e.lte)return (e.lte<0?e.lte+t:e.lte)+1;const n=e.lt||e.end||t;return n<0?n+t:n}(this.options,this.batch.version);}async next(){return 0===this.limit?null:(this.limit>0&&this.limit--,this.gte>=this.lt?null:this.reverse?this.lt<=1?null:u(await this.batch.getBlock(--this.lt),this.encoding):u(await this.batch.getBlock(this.gte++),this.encoding))}close(){return this.batch._closeSnapshot()}},H=class{constructor(e,t,n={}){this.left=new f(e,n),this.right=new f(t,n),this.limit="number"==typeof n.limit?n.limit:-1;}async open(){await Promise.all([this.left.open(),this.right.open()]);}async next(){if(0===this.limit)return null;const e=await this._next();return !e||null===e.left&&null===e.right?null:(this.limit--,e)}async _next(){const e=this.left,t=this.right;for(;;){const[n,s]=await Promise.all([e.peek(),t.peek()]);if(!n&&!s)return null;if(!n)return {left:null,right:await t.nextKey()};if(!s)return {left:await e.nextKey(),right:null};if(n.seq===s.seq&&n.isKey===s.isKey&&n.offset===s.offset){e.skip(),t.skip();continue}const i=await n.compare(s);if(!n.isKey||s.isKey)if(n.isKey||!s.isKey){if(n.isKey&&s.isKey)return 0===i?{left:await e.nextKey(),right:await t.nextKey()}:i<0?{left:await e.nextKey(),right:null}:{left:null,right:await t.nextKey()};0===i?await Promise.all([e.next(),t.next()]):i<0?await t.next():await e.next();}else await e.next();else await t.next();}}async close(){await Promise.all([this.left.close(),this.right.close()]);}},z=S,{YoloIndex:G,Node:V,Header:Y}=k,{BLOCK_NOT_AVAILABLE:Z,DECODING_ERROR:j}=E$1,J=R.alloc(1),Q=R.alloc(0);class X{constructor(e,t){this.seq=e,this.value=t;}}class ${constructor(e,t,n){this.seq=e,this.offset=t,this.value=n;}}class ee{constructor(e){this.keys=e,this.length=0;}get(e){return this.keys.get(e)||null}set(e,t){this.keys.set(e,t),e>=this.length&&(this.length=e+1);}gc(e){if(this.length-e>128)this.keys.clear();else for(let t=e;t<this.length;t++)this.keys.delete(t);this.length=e;}}class te{constructor(e){this.levels=e.levels.map((e=>{const t=[],n=[];for(let t=0;t<e.keys.length;t++)n.push(new X(e.keys[t],null));for(let n=0;n<e.children.length;n+=2)t.push(new $(e.children[n],e.children[n+1],null));return {keys:n,children:t}}));}get(e){return this.levels[e]}hasKey(e){for(const t of this.levels)for(const n of t.keys)if(n.seq===e)return !0;return !1}}function ne(e){return null===e.inflated&&(e.inflated=G.decode(e.index),e.index=null),new te(e.inflated)}function se(e){const t=e.map((e=>{const t=[],n=[];for(let n=0;n<e.value.keys.length;n++)t.push(e.value.keys[n].seq);for(let t=0;t<e.value.children.length;t++)n.push(e.value.children[t].seq,e.value.children[t].offset);return {keys:t,children:n}}));return G.encode({levels:t})}function ie(e,t){e.replicator._blocks.get(t)||e.get(t).catch(U);}class oe{constructor(e,t,n,s){this.block=e,this.offset=s,this.keys=t,this.children=n,this.changed=!1,this.preload();}preload(){if(null===this.block)return;const e=function(e){return e._source?e._source.originalCore:e.flush?e.session:e}(this.block.tree.core),t=function(e){return e._source?e._source.core.indexedLength:e.flush?e.indexedLength:e.length}(this.block.tree.core),n=e.core.bitfield;for(let s=0;s<this.keys.length;s++){const i=this.keys[s];i.value||(i.seq>=t||n.get(i.seq)||ie(e,i.seq));}for(let s=0;s<this.children.length;s++){const i=this.children[s];i.value||(i.seq>=t||n.get(i.seq)||ie(e,i.seq));}}async insertKey(e,t,n,s,i,o){let r,h=0,c=this.keys.length;for(;h<c;){const n=h+c>>1;if(r=R.compare(e.value,await this.getKey(n)),0===r){if(o){const e=await this.getKeyNode(n);if(!await o(e.final(i),s))return !0}if(!this.block.tree.tree.alwaysDuplicate){if(me((await this.getKeyNode(n)).value,t))return !0}return this.changed=!0,this.keys[n]=e,!0}r<0?c=n:h=n+1;}const l=r<0?c:h;return this.keys.splice(l,0,e),n&&this.children.splice(l+1,0,new $(0,0,n)),this.changed=!0,this.keys.length<9}removeKey(e){this.keys.splice(e,1),this.children.length&&(this.children[e+1].seq=0,this.children.splice(e+1,1)),this.changed=!0;}async siblings(e){for(let t=0;t<e.children.length;t++)if(e.children[t].value===this){const n=t?e.getChildNode(t-1):null,s=t<e.children.length-1?e.getChildNode(t+1):null;return {left:await n,index:t,right:await s}}throw new Error("Bad parent")}merge(e,t){this.changed=!0,this.keys.push(t);for(let t=0;t<e.keys.length;t++)this.keys.push(e.keys[t]);for(let t=0;t<e.children.length;t++)this.children.push(e.children[t]);}async split(){const e=this.keys.length>>1,t=oe.create(this.block);for(;t.keys.length<e;)t.keys.push(this.keys.pop());t.keys.reverse(),await this.getKey(this.keys.length-1);const n=this.keys.pop();if(this.children.length){for(;t.children.length<e+1;)t.children.push(this.children.pop());t.children.reverse();}return this.changed=!0,{left:this,median:n,right:t}}getKeyNode(e){return this.block.tree.getBlock(this.keys[e].seq)}async getChildNode(e){const t=this.children[e];if(t.value)return t.value;const n=t.seq===this.block.seq?this.block:await this.block.tree.getBlock(t.seq);return t.value=n.getTreeNode(t.offset)}setKey(e,t){this.keys[e]=t,this.changed=!0;}async getKey(e){const t=this.keys[e];if(t.value)return t.value;const n=t.seq===this.block.seq?this.block.key:await this.block.tree.getKey(t.seq);return t.value=n}indexChanges(e,t){const n=e.push(null)-1;this.changed=!1;for(const n of this.children)n.value&&n.value.changed&&(n.seq=t,n.offset=n.value.indexChanges(e,t),e[n.offset]=n);return n}updateChildren(e,t){for(const n of this.children)n.value&&n.seq===e&&(n.value.block=t,n.value.updateChildren(e,t));}static create(e){const t=new oe(e,[],[],0);return t.changed=!0,t}}class re{constructor(e,t,n){this.seq=e,this.tree=t,this.index=null,this.entry=n,this.key=n.key,this.value=n.value;}isTarget(e){return R.equals(this.key,e)}isDeletion(){return null===this.value&&(null===this.index&&(this.index=ne(this.entry)),!this.index.hasKey(this.seq))}final(e){return {seq:this.seq,key:e.key?e.key.decode(this.key):this.key,value:this.value&&(e.value?e.value.decode(this.value):this.value)}}getTreeNode(e){null===this.index&&(this.index=ne(this.entry));const t=this.index.get(e);return new oe(this,t.keys,t.children,e)}}class he extends re{constructor(e,t,n,s,i){super(e,t,{key:n,value:s,index:null,inflated:null}),this.pendingIndex=i;}isTarget(e){return !1}getTreeNode(e){return this.pendingIndex[e].value}}class ce extends O{constructor(e,t={}){var n,s;super(),this.feed=e,this.core=e,this.keyEncoding=t.keyEncoding?D(t.keyEncoding):null,this.valueEncoding=t.valueEncoding?D(t.valueEncoding):null,this.extension=!1!==t.extension?t.extension||z.register(this):null,this.metadata=t.metadata||null,this.lock=t.lock||M(),this.sep=t.sep||J,this.readonly=!!t.readonly,this.prefix=t.prefix||null,this.alwaysDuplicate=!1!==t.alwaysDuplicate,this._unprefixedKeyEncoding=this.keyEncoding,this._sub=!!this.prefix,this._checkout=t.checkout||0,this._view=!!t._view,this._onappendBound=this._view?null:this._onappend.bind(this),this._ontruncateBound=this._view?null:this._ontruncate.bind(this),this._watchers=this._onappendBound?[]:null,this._entryWatchers=this._onappendBound?[]:null,this._sessions=!1!==t.sessions,this._keyCache=null,this._nodeCache=null,this._batches=[],this._watchers&&(this.core.on("append",this._onappendBound),this.core.on("truncate",this._ontruncateBound)),this.prefix&&t._sub&&(this.keyEncoding=(n=this.prefix,s=this.keyEncoding,{encode:e=>R.concat([n,R.isBuffer(e)?e:we(s,e)]),decode(e){const t=e.slice(n.length,e.length);return s?s.decode(t):t}}));}async _open(){await this.core.ready();const e=T.from(this.core.globalCache);this._keyCache=new ee(e),this._nodeCache=new ee(T.from(e));}get version(){return Math.max(1,this._checkout||this.core.length)}get id(){return this.core.id}get key(){return this.core.key}get discoveryKey(){return this.core.discoveryKey}get writable(){return this.core.writable}get readable(){return this.core.readable}replicate(e,t){return this.core.replicate(e,t)}update(e){return this.core.update(e)}peek(e,t){return be(this.createRangeIterator(e,{...t,limit:1}))}createRangeIterator(e,t={}){const n=!1===(t=t?{...t,...e}:e).extension&&0!==t.limit?null:this.extension,s=t.keyEncoding?D(t.keyEncoding):this.keyEncoding;if(n){const{onseq:e,onwait:o}=t;let r=0,h=0;t=ve(s,{...t,sub:this._sub,onseq(t){r||(r=t+1),h&&h--,e&&e(t);},onwait(e){h||(h=z.BATCH_SIZE,n.iterator(i.snapshot(r))),o&&o(e);}});}else t=ve(s,{...t,sub:this._sub});const i=new F(new le(this,this._makeSnapshot(),null,!1,t),null,t);return i}createReadStream(e,t){const n=t&&t.signal||null;return ke(this.createRangeIterator(e,t),n)}createHistoryStream(e){const t=e&&e.live?this.core.session():this._makeSnapshot(),n=e&&e.signal||null;return ke(new W(new le(this,t,null,!1,e),e),n)}createDiffStream(e,t,n){"number"==typeof e&&(e=this.checkout(Math.max(1,e),{reuseSession:!0})),n=n?{...n,...t}:t;const s=e.version>this.version?e._makeSnapshot():this._makeSnapshot(),i=n&&n.signal||null,o=n&&n.keyEncoding?D(n.keyEncoding):this.keyEncoding;return o&&(n=ve(o,{...n,sub:this._sub})),ke(new H(new le(this,s,null,!1,n),new le(e,s,null,!1,n),n),i)}get(e,t){return new le(this,this._makeSnapshot(),null,!0,t).get(e)}getBySeq(e,t){return new le(this,this._makeSnapshot(),null,!0,t).getBySeq(e)}put(e,t,n){return new le(this,this.core,null,!0,n).put(e,t,n)}batch(e){return new le(this,this.core,M(),!0,e)}del(e,t){return new le(this,this.core,null,!0,t).del(e,t)}watch(e,t){if(!this._watchers)throw new Error("Can only watch the main bee instance");return new de(this,e,t)}async getAndWatch(e,t){if(!this._watchers)throw new Error("Can only watch the main bee instance");const n=new ae(this,e,t);if(await n._debouncedUpdate(),this.closing)throw await n.close(),new Error("Bee closed");return n}_onappend(){for(const e of this._watchers)e._onappend();for(const e of this._entryWatchers)e._onappend();}_ontruncate(){for(const e of this._watchers)e._ontruncate();for(const e of this._entryWatchers)e._ontruncate();this._nodeCache.gc(this.core.length),this._keyCache.gc(this.core.length);}_makeSnapshot(){return !1===this._sessions?this.core:this._checkout<=this.core.length||this._checkout<=1?this.core.snapshot():this.core.session({snapshot:!1})}checkout(e,t={}){e<1&&(e=1);const n=t.reuseSession||!1===this._sessions?this.core:e<=this.core.length||e<=1?this.core.snapshot():this.core.session({snapshot:!1});return new ce(n,{_view:!0,_sub:!1,prefix:this.prefix,sep:this.sep,lock:this.lock,checkout:e,keyEncoding:t.keyEncoding||this.keyEncoding,valueEncoding:t.valueEncoding||this.valueEncoding,extension:null!==this.extension&&this.extension})}snapshot(e){return this.checkout(Math.max(1,this.version),e)}sub(e,t={}){let n=t.sep||this.sep;R.isBuffer(n)||(n=R.from(n)),e=R.concat([this.prefix||Q,R.from(e),n]);const s=D(t.valueEncoding||this.valueEncoding),i=D(t.keyEncoding||this._unprefixedKeyEncoding);return new ce(this.core,{_view:!0,_sub:!0,prefix:e,sep:this.sep,lock:this.lock,checkout:this._checkout,valueEncoding:s,keyEncoding:i,extension:null!==this.extension&&this.extension,metadata:this.metadata})}async getHeader(e){const t=await this.core.get(0,e);try{return t&&Y.decode(t)}catch{throw j()}}async _close(){if(this._watchers)for(this.core.off("append",this._onappendBound),this.core.off("truncate",this._ontruncateBound);this._watchers.length;)await this._watchers[this._watchers.length-1].close();if(this._entryWatchers)for(;this._entryWatchers.length;)await this._entryWatchers[this._entryWatchers.length-1].close();for(;this._batches.length;)await this._batches[this._batches.length-1].close();return this.core.close()}static async isHyperbee(e,t){await e.ready();const n=await e.get(0,t);if(null===n)throw Z();try{return "hyperbee"===Y.decode(n).protocol}catch(e){return !1}}}class le{constructor(e,t,n,s,i={}){this.tree=e,this.feed=t,this.core=t,this.index=e._batches.push(this)-1,this.blocks=s?new Map:null,this.autoFlush=!n,this.rootSeq=0,this.root=null,this.length=0,this.options=i,this.locked=null,this.batchLock=n,this.onseq=this.options.onseq||xe,this.appending=null,this.isSnapshot=this.core!==this.tree.core,this.shouldUpdate=!1!==this.options.update,this.updating=null,this.encoding={key:i.keyEncoding?D(i.keyEncoding):e.keyEncoding,value:i.valueEncoding?D(i.valueEncoding):e.valueEncoding};}ready(){return this.tree.ready()}async lock(){if(this.tree.readonly)throw new Error("Hyperbee is marked as read-only");null===this.locked&&(this.locked=await this.tree.lock());}get version(){return Math.max(1,this.tree._checkout?this.tree._checkout:this.core.length+this.length)}async getRoot(e){return await this.ready(),e&&0===this.core.length&&this.core.writable&&!this.tree.readonly&&await this.core.append(Y.encode({protocol:"hyperbee",metadata:this.tree.metadata})),0===this.tree._checkout&&this.shouldUpdate&&(null===this.updating&&(this.updating=this.core.update()),await this.updating),this.version<2?null:(await this.getBlock(this.version-1)).getTreeNode(0)}async getKey(e){const t=this.core.fork===this.tree.core.fork?this.tree._keyCache.get(e):null;if(null!==t)return t;const n=(await this.getBlock(e)).key;return this.core.fork===this.tree.core.fork&&this.tree._keyCache.set(e,n),n}async _getNode(e){const t=this.core.fork===this.tree.core.fork?this.tree._nodeCache.get(e):null;if(null!==t)return t;const n=await this.core.get(e,{...this.options,valueEncoding:V});if(null===n)throw Z();const s=function(e){let t=e.key,n=e.value,s=e.index;if(2*(t.byteLength+(null===n?0:n.byteLength)+(null===s?0:s.byteLength))<t.buffer.byteLength){const[i,o,r]=P([e.key,e.value,e.index]);t=i,n=o,s=r;}return {key:t,value:n,index:s,inflated:null}}(n);return this.core.fork===this.tree.core.fork&&this.tree._nodeCache.set(e,s),s}async getBlock(e){0===this.rootSeq&&(this.rootSeq=e);let t=this.blocks&&this.blocks.get(e);if(t)return t;this.onseq(e);const n=await this._getNode(e);return t=new re(e,this,n),this.blocks&&this.blocks.size-this.length<128&&this.blocks.set(e,t),t}_onwait(e){this.options.onwait=null,this.tree.extension.get(this.rootSeq+1,e);}_getEncoding(e){return e?{key:e.keyEncoding?D(e.keyEncoding):this.encoding.key,value:e.valueEncoding?D(e.valueEncoding):this.encoding.value}:this.encoding}peek(e,t){return be(this.createRangeIterator(e,{...t,limit:1}))}createRangeIterator(e,t={}){t=t?{...t,...e}:e;const n=this._getEncoding(t);return new F(this,n,ve(n.key,{...t,sub:this.tree._sub}))}createReadStream(e,t){const n=t&&t.signal||null;return ke(this.createRangeIterator(e,t),n)}async getBySeq(e,t){const n=this._getEncoding(t);try{const t=(await this.getBlock(e)).final(n);return {key:t.key,value:t.value}}finally{await this._closeSnapshot();}}async get(e,t){const n=this._getEncoding(t);try{return await this._get(e,n)}finally{await this._closeSnapshot();}}async _get(e,t){e=we(t.key,e),null!==this.tree.extension&&!1!==this.options.extension&&(this.options.onwait=this._onwait.bind(this,e));let n=await this.getRoot(!1);if(!n)return null;for(;;){if(n.block.isTarget(e))return n.block.isDeletion()?null:n.block.final(t);let s,i=0,o=n.keys.length;for(;i<o;){const r=i+o>>1;if(s=R.compare(e,await n.getKey(r)),0===s)return (await this.getBlock(n.keys[r].seq)).final(t);s<0?o=r:i=r+1;}if(!n.children.length)return null;const r=s<0?o:i;n=await n.getChildNode(r);}}async put(e,t,n){const s=this.batchLock?await this.batchLock():null,i=n&&n.cas||null,o=this._getEncoding(n);if(this.locked||await this.lock(),!s)return this._put(e,t,o,i);try{return await this._put(e,t,o,i)}finally{s();}}async _put(e,t,n,s){const i={seq:0,key:e,value:t};e=we(n.key,e),t=we(n.value,t);const o=[];let r,h=r=await this.getRoot(!0);h||(h=r=oe.create(null));const c=i.seq=this.core.length+this.length,l=new X(c,e);for(;h.children.length;){o.push(h),h.changed=!0;let a,d=0,u=h.keys.length;for(;d<u;){const o=d+u>>1;if(a=R.compare(l.value,await h.getKey(o)),0===a){if(s){const e=await h.getKeyNode(o);if(!await s(e.final(n),i))return this._unlockMaybe()}if(!this.tree.alwaysDuplicate){if(me((await h.getKeyNode(o)).value,t))return this._unlockMaybe()}return h.setKey(o,l),this._append(r,c,e,t)}a<0?u=o:d=o+1;}const g=a<0?u:d;h=await h.getChildNode(g);}let a=!await h.insertKey(l,t,null,i,n,s);if(!h.changed)return this._unlockMaybe();for(;a;){const e=o.pop(),{median:s,right:i}=await h.split();e?(a=!await e.insertKey(s,t,i,null,n,null),h=e):(r=oe.create(h.block),r.changed=!0,r.keys.push(s),r.children.push(new $(0,0,h),new $(0,0,i)),a=!1);}return this._append(r,c,e,t)}async del(e,t){const n=this.batchLock?await this.batchLock():null,s=t&&t.cas||null,i=this._getEncoding(t);if(this.locked||await this.lock(),!n)return this._del(e,i,s);try{return await this._del(e,i,s)}finally{n();}}async _del(e,t,n){const s={seq:0,key:e,value:null};e=we(t.key,e);const i=[];let o=await this.getRoot(!0);if(!o)return this._unlockMaybe();const r=s.seq=this.core.length+this.length;for(;;){i.push(o);let h,c=0,l=o.keys.length;for(;c<l;){const a=c+l>>1;if(h=R.compare(e,await o.getKey(a)),0===h){if(n){const e=await o.getKeyNode(a);if(!await n(e.final(t),s))return this._unlockMaybe()}o.children.length?await fe(o,a,i):o.removeKey(a);for(const e of i)e.changed=!0;return this._append(await pe(i),r,e,null)}h<0?l=a:c=a+1;}if(!o.children.length)return this._unlockMaybe();const a=h<0?l:c;o=await o.getChildNode(a);}}async _closeSnapshot(){this.isSnapshot&&(await this.core.close(),this._finalize());}async close(){if(this.isSnapshot)return this._closeSnapshot();this.root=null,this.blocks&&this.blocks.clear(),this.length=0,this._unlock();}destroy(){this.close().catch(xe);}toBlocks(){if(this.appending)return this.appending;const e=new Array(this.length);for(let t=0;t<this.length;t++){const n=this.core.length+t,{pendingIndex:s,key:i,value:o}=this.blocks.get(n);if(t<this.length-1){s[0]=null;let e=0;for(;e<s.length;){const t=s[e];null===t||t.seq!==n?e===s.length-1?s.pop():s[e]=s.pop():t.offset=e++;}}e[t]=V.encode({key:i,value:o,index:se(s)});}return this.appending=e,e}flush(){if(!this.length)return this.close();const e=this.toBlocks();return this.root=null,this.blocks.clear(),this.length=0,this._appendBatch(e)}_unlockMaybe(){this.autoFlush&&this._unlock();}_unlock(){const e=this.locked;this.locked=null,null!==e&&e(),this._finalize();}_finalize(){if(this.index>=this.tree._batches.length||this.tree._batches[this.index]!==this)return;const e=this.tree._batches.pop();e!==this&&(e.index=this.index,this.tree._batches[e.index]=e);}_append(e,t,n,s){const i=[];if(e.indexChanges(i,t),i[0]=new $(t,0,e),!this.autoFlush){const o=new he(t,this,n,s,i);return e.block=o,this.root=e,this.length++,this.blocks.set(t,o),void e.updateChildren(t,o)}return this._appendBatch(V.encode({key:n,value:s,index:se(i)}))}async _appendBatch(e){try{await this.core.append(e);}finally{this._unlock();}}}class ae extends O{constructor(e,t,n={}){super(),this.keyEncoding=n.keyEncoding||e.keyEncoding,this.valueEncoding=n.valueEncoding||e.valueEncoding,this.index=e._entryWatchers.push(this)-1,this.bee=e,this.key=t,this.node=null,this._forceUpdate=!1,this._debouncedUpdate=A(this._processUpdate.bind(this)),this._updateOnce=!!n.updateOnce;}_close(){const e=this.bee._entryWatchers.pop();e!==this&&(e.index=this.index,this.bee._entryWatchers[e.index]=e);}_onappend(){this._debouncedUpdate();}_ontruncate(){this._forceUpdate=!0,this._debouncedUpdate();}async _processUpdate(){const e=this._forceUpdate;let t;this._forceUpdate=!1,this._updateOnce&&(this._updateOnce=!1,await this.bee.update({wait:!0}));try{t=await this.bee.get(this.key,{keyEncoding:this.keyEncoding,valueEncoding:this.valueEncoding});}catch(e){if("SNAPSHOT_NOT_AVAILABLE"===e.code)return;return this.bee.closing?void this.close().catch(U):void this.emit("error",e)}(e||t?.seq!==this.node?.seq)&&(this.node=t,this.emit("update"));}}class de extends O{constructor(e,t,n={}){super(),this.keyEncoding=n.keyEncoding||e.keyEncoding,this.valueEncoding=n.valueEncoding||e.valueEncoding,this.index=e._watchers.push(this)-1,this.bee=e,this.core=e.core,this.latestDiff=0,this.range=t,this.map=n.map||ge,this.current=null,this.previous=null,this.currentMapped=null,this.previousMapped=null,this.stream=null,this._lock=M(),this._flowing=!1,this._resolveOnChange=null,this._differ=n.differ||_e,this._eager=!!n.eager,this._updateOnce=!!n.updateOnce,this._onchange=n.onchange||null,this._flush=!1!==n.flush&&this.core.isAutobase,this.on("newListener",ue),this.ready().catch(U);}async _consume(){if(!this._flowing)try{for await(const e of this);}catch{}}async _open(){await this.bee.ready();const e={keyEncoding:this.keyEncoding,valueEncoding:this.valueEncoding};this.current=this._eager?this.bee.checkout(1,e):this.bee.snapshot(e),this._onchange&&(this._eager&&await this._onchange(),this._consume());}[Symbol.asyncIterator](){return this._flowing=!0,this}_ontruncate(){this.core.isAutobase&&this._onappend();}_onappend(){if(!(this.closing||this.core.isAutobase||this.core.core&&this.core.core.tree.length===this.core.length))return;const e=this._resolveOnChange;this._resolveOnChange=null,e&&e();}async _waitForChanges(){this.current.version<this.bee.version||this.closing||await new Promise((e=>{this._resolveOnChange=e;}));}async next(){try{return await this._next()}catch(e){if(this.closing)return {value:void 0,done:!0};throw await this.close(),e}}async _next(){const e=await this._lock();try{if(this.closing)return {value:void 0,done:!0};for(this.opened||await this.ready();;){if(await this._waitForChanges(),this.closing)return {value:void 0,done:!0};if(this._updateOnce&&(this._updateOnce=!1,await this.bee.update({wait:!0})),this._flush&&await this.core.base.flush(),this.closing)return {value:void 0,done:!0};if(await this._closePrevious(),this.previous=this.current.snapshot(),await this._closeCurrent(),this.current=this.bee.snapshot({keyEncoding:this.keyEncoding,valueEncoding:this.valueEncoding}),this.current.core.fork!==this.previous.core.fork)return await this._yield();this.stream=this._differ(this.current,this.previous,this.range);try{for await(const e of this.stream)return await this._yield()}finally{this.stream=null;}}}finally{e();}}async _yield(){if(this.currentMapped=this.map(this.current),this.previousMapped=this.map(this.previous),this._onchange)try{await this._onchange();}catch(e){U(e);}return this.emit("update"),{done:!1,value:[this.currentMapped,this.previousMapped]}}async return(){return await this.close(),{done:!0}}async _close(){const e=this.bee._watchers.pop();e!==this&&(e.index=this.index,this.bee._watchers[e.index]=e),this.stream&&!this.stream.destroying&&this.stream.destroy(),this._onappend(),await this._closeCurrent().catch(U),await this._closePrevious().catch(U);(await this._lock())();}destroy(){return this.close()}async _closeCurrent(){this.currentMapped&&await this.currentMapped.close(),this.current&&await this.current.close(),this.current=this.currentMapped=null;}async _closePrevious(){this.previousMapped&&await this.previousMapped.close(),this.previous&&await this.previous.close(),this.previous=this.previousMapped=null;}}function ue(e){"update"===e&&this._consume();}function ge(e){return e}async function ye(e,t){for(;e.children.length;)e=await e.getChildNode(t?0:e.children.length-1);return e.keys.length}async function fe(e,t,n){let[s,i]=await Promise.all([e.getChildNode(t),e.getChildNode(t+1)]);const[o,r]=await Promise.all([ye(s,!1),ye(i,!0)]);if(o<r){for(n.push(i);i.children.length;)n.push(i=i.children[0].value);e.keys[t]=i.keys.shift();}else {for(n.push(s);s.children.length;)n.push(s=s.children[s.children.length-1].value);e.keys[t]=s.keys.pop();}}async function pe(e){const t=e[0];for(;e.length>1;){const n=e.pop(),s=e[e.length-1];if(n.keys.length>=4)return t;let{left:i,index:o,right:r}=await n.siblings(s);if(i&&i.keys.length>4)return i.changed=!0,n.keys.unshift(s.keys[o-1]),i.children.length&&n.children.unshift(i.children.pop()),s.keys[o-1]=i.keys.pop(),t;if(r&&r.keys.length>4)return r.changed=!0,n.keys.push(s.keys[o]),r.children.length&&n.children.push(r.children.shift()),s.keys[o]=r.keys.shift(),t;i?(o--,r=n):i=n,i.merge(r,s.keys[o]),s.removeKey(o);}return !t.keys.length&&t.children.length?t.getChildNode(0):t}function ke(e,t){let n,s;const i=new I({signal:t,open(t){n=t,e.open().then(o,o);},read(t){n=t,e.next().then(r,o);},predestroy(){s=e.close(),s.catch(xe);},destroy(t){n=t,s||(s=e.close()),s.then(o,o);}});return i;function o(e){n(e);}function r(e){i.push(e),n(null);}}async function be(e){try{return await e.open(),await e.next()}finally{await e.close();}}function ve(e,t){if(!e)return t;if(e.encodeRange){const n=e.encodeRange({gt:t.gt,gte:t.gte,lt:t.lt,lte:t.lte});return t.gt=n.gt,t.gte=n.gte,t.lt=n.lt,t.lte=n.lte,t}var n;return void 0!==t.gt&&(t.gt=we(e,t.gt)),void 0!==t.gte&&(t.gte=we(e,t.gte)),void 0!==t.lt&&(t.lt=we(e,t.lt)),void 0!==t.lte&&(t.lte=we(e,t.lte)),!t.sub||t.gt||t.gte||(t.gt=we(e,J)),!t.sub||t.lt||t.lte||(t.lt=((n=we(e,Q))[n.length-1]++,n)),t}function we(e,t){return null==t?null:null!==e?e.encode(t):"string"==typeof t?R.from(t):t}function _e(e,t,n){return e.createDiffStream(t,n)}function me(e,t){return e===t||null!==e&&null!==t&&R.equals(e,t)}function xe(){}var Ee=ce;Ee.isHyperbee;

export { Ee as default };
